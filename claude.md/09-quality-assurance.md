# Quality Assurance

## Code Quality and Syntax Validation Requirements (v2.4)

**CRITICAL**: All code generated by Claude Code must pass comprehensive syntax checks and adhere to all directives specified in this CLAUDE.md file. This is a mandatory requirement that cannot be bypassed.

## Mandatory Syntax and Quality Checks

### Pre-Deployment Validation Checklist
Before any code is considered complete, it MUST pass all of the following validation steps:

#### ✅ Python Code Validation
```bash
# 1. Syntax validation
python -m py_compile filename.py

# 2. Import validation (critical for Docker containers)
python -c "import filename; print('Import successful')"

# 3. Code quality checks
flake8 filename.py                    # PEP8 compliance
black --check filename.py             # Formatting validation
isort --check-only filename.py        # Import order validation

# 4. Security scanning
bandit -r filename.py                 # Security vulnerability detection

# 5. Type checking (if type hints used)
mypy filename.py                      # Static type checking
```

#### ✅ JavaScript Code Validation
```bash
# 1. Syntax validation
node -c filename.js                   # Node.js syntax check

# 2. Code quality checks
eslint filename.js                    # ESLint validation
jshint filename.js                    # Alternative syntax checking

# 3. Module import validation
# Verify ES6 imports work correctly in browser environment

# 4. Browser compatibility validation
# Test in Chrome, Firefox, Safari, Edge
```

#### ✅ CSS Code Validation
```bash
# 1. Syntax validation
csslint filename.css                  # CSS syntax validation

# 2. Code quality checks
stylelint filename.css                # Modern CSS linting

# 3. Browser compatibility
# Verify CSS works across target browsers

# 4. Performance validation
# Check for unused CSS and optimization opportunities
```

#### ✅ HTML Code Validation
```bash
# 1. HTML5 validation
html5validator filename.html          # W3C HTML5 validation

# 2. Accessibility validation
axe-core filename.html               # Accessibility compliance

# 3. Cross-browser testing
# Manual verification in target browsers
```

## CLAUDE.md Directive Compliance Verification

Every piece of generated code MUST comply with ALL directives in this CLAUDE.md file:

### ✅ Critical Directive Compliance Checklist

**1. Python Import Requirements (CRITICAL)**
- [ ] **VERIFIED**: All Python imports use absolute imports only
- [ ] **NO RELATIVE IMPORTS**: No `from ..` or `from .` imports anywhere
- [ ] **DOCKER COMPATIBILITY**: All imports work correctly in Docker containers

**2. Exception Handling (CRITICAL)**
- [ ] **CUSTOM EXCEPTIONS**: No generic `except Exception as e` handlers
- [ ] **STRUCTURED ERRORS**: All exception handling uses specific exception types
- [ ] **F-STRING LOGGING**: All error messages use f-string formatting

**3. Documentation Standards (CRITICAL)**
- [ ] **MULTILINE DOCUMENTATION**: All functions/classes have comprehensive documentation
- [ ] **BUSINESS CONTEXT**: Documentation explains why code exists
- [ ] **TECHNICAL RATIONALE**: Documentation explains how code works
- [ ] **FILE-SPECIFIC SYNTAX**: Correct comment syntax for file type

**4. Memory System Usage (CRITICAL)**
- [ ] **CONTEXT STORAGE**: Important information stored in memory system
- [ ] **CONTINUITY**: Previous context recalled appropriately
- [ ] **LEARNING**: System knowledge accumulated over time

### Pre-Commit Validation Script
```bash
#!/bin/bash
# validate-code.sh - Comprehensive code validation pipeline

echo "🔍 Starting comprehensive code validation..."

# Python validation
echo "🐍 Validating Python code..."
find . -name "*.py" -not -path "./.*" | while read file; do
    echo "Checking $file"
    python -m py_compile "$file" || exit 1
    python -c "import sys; sys.path.append('.'); import $(basename $file .py)" 2>/dev/null || echo "Warning: Import check failed for $file"
    flake8 "$file" || exit 1
    black --check "$file" || exit 1
    isort --check-only "$file" || exit 1
done

# JavaScript validation
echo "📜 Validating JavaScript code..."
find . -name "*.js" -not -path "./node_modules/*" -not -path "./.*" | while read file; do
    echo "Checking $file"
    node -c "$file" || exit 1
    eslint "$file" || exit 1
done

# CSS validation
echo "🎨 Validating CSS code..."
find . -name "*.css" -not -path "./node_modules/*" -not -path "./.*" | while read file; do
    echo "Checking $file"
    stylelint "$file" || exit 1
done

echo "✅ All validation checks passed!"
```

## CI/CD Pipeline

The platform uses a comprehensive Jenkins and SonarQube CI/CD pipeline for automated testing, code quality analysis, and multi-environment deployment.

### Pipeline Overview
```bash
# Start Jenkins and SonarQube services
./jenkins/jenkins-setup.sh      # Setup Jenkins with plugins and configuration
./sonarqube/setup-sonarqube.sh  # Setup SonarQube with quality profiles and gates

# Pipeline trigger methods
# 1. Automatic: Git push/PR to GitHub triggers webhook
# 2. Manual: Jenkins UI or CLI trigger
# 3. Scheduled: Nightly builds for main branch
```

### Pipeline Environments
- **Development**: Local development environment
- **Staging**: `course-creator-staging` namespace, single replicas for testing
- **Production**: `course-creator-prod` namespace, 3+ replicas with autoscaling

### Pipeline Stages
1. **Code Quality** - Linting, formatting, SonarQube analysis
2. **Testing** - Unit, integration, and E2E tests
3. **Security** - Vulnerability scanning, secret detection
4. **Build** - Docker image building and security scanning
5. **Deploy** - Environment-specific deployment with health checks
6. **Monitor** - Post-deployment monitoring and alerting

### SonarQube Quality Gates
- **Code Coverage**: Minimum 80% for new code
- **Maintainability Rating**: A rating required
- **Reliability Rating**: A rating required
- **Security Rating**: A rating required
- **Duplicated Lines**: Less than 3% duplication
- **Code Smells**: Zero new code smells
- **Bugs**: Zero new bugs
- **Vulnerabilities**: Zero new vulnerabilities

### Jenkins Pipeline Configuration
```groovy
pipeline {
    agent any
    
    stages {
        stage('Code Quality') {
            steps {
                sh './validate-code.sh'
                sh 'sonar-scanner'
            }
        }
        
        stage('Testing') {
            parallel {
                stage('Unit Tests') {
                    steps {
                        sh 'python -m pytest tests/unit/ --junitxml=test-results/unit.xml'
                    }
                }
                stage('Integration Tests') {
                    steps {
                        sh 'python -m pytest tests/integration/ --junitxml=test-results/integration.xml'
                    }
                }
                stage('E2E Tests') {
                    steps {
                        sh 'python -m pytest tests/e2e/ --junitxml=test-results/e2e.xml'
                    }
                }
            }
        }
        
        stage('Security Scan') {
            steps {
                sh 'bandit -r services/ -f json -o security-report.json'
                sh 'safety check --json > dependency-report.json'
            }
        }
        
        stage('Build') {
            steps {
                sh 'docker-compose build'
                sh 'trivy image course-creator:latest'
            }
        }
        
        stage('Deploy') {
            when {
                branch 'main'
            }
            steps {
                sh 'docker-compose -f docker-compose.prod.yml up -d'
            }
        }
    }
    
    post {
        always {
            publishTestResults testResultsPattern: 'test-results/*.xml'
            publishHTML([
                allowMissing: false,
                alwaysLinkToLastBuild: true,
                keepAll: true,
                reportDir: 'htmlcov',
                reportFiles: 'index.html',
                reportName: 'Coverage Report'
            ])
        }
    }
}
```

### Emergency Procedures
```bash
# Force deployment (use only for critical fixes)
jenkins-cli build course-creator-pipeline -p FORCE_DEPLOY=true -p DEPLOY_ENVIRONMENT=prod

# Rollback deployment
kubectl rollout undo deployment/service-name -n course-creator-prod
```

## Centralized Logging System (v2.2 - Syslog Format)

The platform implements centralized logging with syslog format across all services:

### Syslog Format Implementation
All logs follow RFC 3164 syslog format:
```
Jul 31 08:46:30 hostname service[pid]: LEVEL - filename:line - message
```

Example log entries:
```
Jul 31 08:46:30 20b86b2e3329 course-generator[1]: INFO - /app/main.py:71 - Starting Course Generator Service
Jul 31 08:46:29 6dd7386d44f5 user-management[1]: INFO - /app/main.py:497 - Starting User Management Service on port 8000
```

### Log File Locations
- **Docker Environment**: `/var/log/course-creator/<service>.log` (mounted volume)
- **Development Environment**: `./logs/course-creator/<service>.log`
- **Console Output**: All services also output to stdout with syslog format

### Log File Management
- **Rotation**: 50MB max file size, 10 backup files
- **Levels**: DEBUG (file only), INFO+ (console and file)
- **Services Logged**: All microservices, uvicorn, FastAPI
- **Format**: Includes hostname, PID, service name, log level, file location, and message

### Monitoring Log Files
```bash
# View all service logs in syslog format
docker compose logs -f

# View specific service logs
docker compose logs -f user-management

# Monitor log files directly
tail -f ./logs/course-creator/*.log

# Check log file sizes and rotation
ls -lh ./logs/course-creator/
```

## Code Review Process

### Pull Request Requirements
- [ ] **All tests pass** - Unit, integration, and E2E tests
- [ ] **Code coverage maintained** - Minimum 80% coverage
- [ ] **SonarQube quality gate passed** - All quality metrics met
- [ ] **Security scan passed** - No new vulnerabilities
- [ ] **CLAUDE.md compliance verified** - All directives followed
- [ ] **Documentation updated** - README and API docs current
- [ ] **Manual testing completed** - Feature tested in staging environment

### Code Review Checklist
- [ ] **Architecture consistency** - Follows established patterns
- [ ] **Performance considerations** - No obvious performance issues
- [ ] **Security review** - No security vulnerabilities introduced
- [ ] **Error handling** - Proper exception handling implemented
- [ ] **Logging** - Appropriate logging levels and messages
- [ ] **Configuration** - Environment-specific configs handled properly

## Compliance and Audit

### Automated Compliance Checks
- **Daily Validation** - Automated validation runs on all changed files
- **Pre-commit Hooks** - Validation integrated into git workflow
- **CI/CD Integration** - Validation gates in deployment pipeline
- **Code Review Requirements** - Manual verification of CLAUDE.md compliance
- **Documentation Audits** - Regular reviews of documentation completeness

### Security Compliance
- **OWASP Top 10** - Regular security assessments
- **Dependency Scanning** - Automated vulnerability scanning of dependencies
- **Secret Detection** - Git hooks prevent secret commits
- **Access Control** - Role-based access to production systems
- **Audit Logging** - All administrative actions logged and monitored

### Performance Monitoring
- **Application Performance Monitoring (APM)** - Real-time performance tracking
- **Database Performance** - Query performance and optimization monitoring
- **Infrastructure Monitoring** - CPU, memory, disk, and network monitoring
- **User Experience Monitoring** - Frontend performance and error tracking

### Quality Metrics Dashboard
- **Code Coverage Trends** - Track coverage over time
- **Bug Density** - Bugs per lines of code
- **Technical Debt** - SonarQube technical debt tracking
- **Test Success Rate** - Percentage of passing tests over time
- **Deployment Frequency** - How often deployments occur
- **Mean Time to Recovery (MTTR)** - Average time to fix issues

## Continuous Improvement

### Quality Improvement Process
1. **Identify Issues** - Through monitoring, testing, and user feedback
2. **Root Cause Analysis** - Determine underlying causes
3. **Implement Fixes** - Address root causes, not just symptoms
4. **Validate Improvements** - Measure effectiveness of changes
5. **Update Processes** - Improve development and quality processes
6. **Share Learnings** - Document and share lessons learned

### Regular Quality Reviews
- **Weekly**: Code quality metrics review
- **Monthly**: Security scan results and remediation
- **Quarterly**: Architecture and technical debt assessment
- **Annually**: Comprehensive quality process review and improvement

This validation system ensures that all code maintains the high quality standards established in this repository and prevents regressions in critical areas like session management, documentation quality, and architectural compliance.