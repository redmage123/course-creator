{"version":3,"file":"enrollmentService-D1bivamY.js","sources":["../../src/services/enrollmentService.ts"],"sourcesContent":["/**\n * Enrollment Service\n *\n * BUSINESS CONTEXT:\n * Handles student enrollment operations for B2B corporate training.\n * Trainers and org admins enroll students in training programs (bulk operations).\n * Students do NOT self-enroll - they are assigned courses by trainers.\n *\n * TECHNICAL IMPLEMENTATION:\n * - Uses centralized apiClient with authentication\n * - Supports bulk enrollment operations for enterprise scale\n * - Handles enrollment status tracking and completion\n * - Integrates with course-management service (port 8001)\n */\n\nimport { apiClient } from './apiClient';\n\n/**\n * Enrollment Status\n */\nexport type EnrollmentStatus = 'active' | 'completed' | 'dropped' | 'pending';\n\n/**\n * Enrollment Interface\n */\nexport interface Enrollment {\n  id: string;\n  student_id: string;\n  student_name?: string;\n  student_email?: string;\n  course_id: string;\n  course_title?: string;\n  enrollment_date: string;\n  completion_date?: string;\n  status: EnrollmentStatus;\n  progress_percentage: number;\n  last_accessed?: string;\n}\n\n/**\n * Single Enrollment Request\n */\nexport interface EnrollStudentRequest {\n  student_id: string;\n  course_id: string;\n  enrollment_date?: string;\n}\n\n/**\n * Bulk Enrollment Request (for courses)\n */\nexport interface BulkEnrollStudentsRequest {\n  course_id: string;\n  student_ids: string[];\n  enrollment_date?: string;\n}\n\n/**\n * Bulk Enrollment Request (for tracks)\n */\nexport interface BulkEnrollStudentsInTrackRequest {\n  track_id: string;\n  student_ids: string[];\n  enrollment_date?: string;\n}\n\n/**\n * Bulk Enrollment Response\n */\nexport interface BulkEnrollmentResponse {\n  success_count: number;\n  failed_count: number;\n  failed_students: Array<{\n    student_id: string;\n    reason: string;\n  }>;\n  message: string;\n}\n\n/**\n * Student Enrollment Summary\n */\nexport interface StudentEnrollmentSummary {\n  student_id: string;\n  student_name: string;\n  total_enrollments: number;\n  active_enrollments: number;\n  completed_enrollments: number;\n  average_progress: number;\n}\n\n/**\n * Enrollment Service Class\n *\n * WHY THIS APPROACH:\n * - Centralized enrollment API logic\n * - Supports B2B bulk operations\n * - Type-safe interfaces for all operations\n * - Handles both single and bulk enrollments\n */\nclass EnrollmentService {\n  private baseUrl = '/enrollments';\n\n  /**\n   * Enroll single student in training program\n   */\n  async enrollStudent(data: EnrollStudentRequest): Promise<Enrollment> {\n    return await apiClient.post<Enrollment>(this.baseUrl, data);\n  }\n\n  /**\n   * Bulk enroll students in training program\n   * (Corporate training feature - enroll multiple students at once)\n   */\n  async bulkEnrollStudents(data: BulkEnrollStudentsRequest): Promise<BulkEnrollmentResponse> {\n    return await apiClient.post<BulkEnrollmentResponse>(\n      `/courses/${data.course_id}/bulk-enroll`,\n      {\n        student_ids: data.student_ids,\n        enrollment_date: data.enrollment_date\n      }\n    );\n  }\n\n  /**\n   * Bulk enroll students in training track\n   * (Corporate training feature - enroll students in entire track)\n   */\n  async bulkEnrollStudentsInTrack(\n    data: BulkEnrollStudentsInTrackRequest\n  ): Promise<BulkEnrollmentResponse> {\n    return await apiClient.post<BulkEnrollmentResponse>(\n      `/tracks/${data.track_id}/bulk-enroll`,\n      {\n        student_ids: data.student_ids,\n        enrollment_date: data.enrollment_date\n      }\n    );\n  }\n\n  /**\n   * Get enrollments for a specific training program\n   */\n  async getCourseEnrollments(courseId: string): Promise<Enrollment[]> {\n    return await apiClient.get<Enrollment[]>(`/courses/${courseId}/enrollments`);\n  }\n\n  /**\n   * Get enrollments for a specific student\n   */\n  async getStudentEnrollments(studentId: string): Promise<Enrollment[]> {\n    return await apiClient.get<Enrollment[]>(`/students/${studentId}/enrollments`);\n  }\n\n  /**\n   * Get current user's enrollments (for student dashboard)\n   */\n  async getMyEnrollments(): Promise<Enrollment[]> {\n    return await apiClient.get<Enrollment[]>(`${this.baseUrl}/me`);\n  }\n\n  /**\n   * Update enrollment status\n   */\n  async updateEnrollmentStatus(enrollmentId: string, status: EnrollmentStatus): Promise<Enrollment> {\n    return await apiClient.put<Enrollment>(`${this.baseUrl}/${enrollmentId}`, { status });\n  }\n\n  /**\n   * Remove student from training program\n   */\n  async unenrollStudent(enrollmentId: string): Promise<void> {\n    await apiClient.delete(`${this.baseUrl}/${enrollmentId}`);\n  }\n\n  /**\n   * Get enrollment summary for organization\n   * (For org admin dashboard)\n   */\n  async getOrganizationEnrollmentSummary(organizationId: string): Promise<StudentEnrollmentSummary[]> {\n    return await apiClient.get<StudentEnrollmentSummary[]>(\n      `/organizations/${organizationId}/enrollments/summary`\n    );\n  }\n\n  /**\n   * Get enrollment summary for instructor\n   * (For instructor dashboard)\n   */\n  async getInstructorEnrollmentSummary(instructorId: string): Promise<StudentEnrollmentSummary[]> {\n    return await apiClient.get<StudentEnrollmentSummary[]>(\n      `/instructors/${instructorId}/enrollments/summary`\n    );\n  }\n\n  /**\n   * Bulk upload students via CSV\n   * (Enterprise feature for bulk operations)\n   */\n  async bulkEnrollFromCSV(courseId: string, csvFile: File): Promise<BulkEnrollmentResponse> {\n    const formData = new FormData();\n    formData.append('file', csvFile);\n    formData.append('course_id', courseId);\n\n    return await apiClient.post<BulkEnrollmentResponse>(\n      '/enrollments/bulk-upload',\n      formData,\n      {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n      }\n    );\n  }\n\n  /**\n   * Search for students (for enrollment UI)\n   *\n   * BUSINESS CONTEXT:\n   * Instructors need to search and find students to enroll in courses.\n   * Searches by name, email, or student ID.\n   *\n   * @param query - Search term (name, email, or ID)\n   * @returns Array of matching students\n   */\n  async searchStudents(query: string): Promise<Array<{ id: string; name: string; email: string }>> {\n    return await apiClient.get<Array<{ id: string; name: string; email: string }>>(\n      `/students/search?q=${encodeURIComponent(query)}`\n    );\n  }\n\n  /**\n   * Get enrolled students for a course (for filtering)\n   *\n   * BUSINESS CONTEXT:\n   * When enrolling students, need to know who is already enrolled\n   * to prevent duplicates and show enrollment status.\n   *\n   * @param courseId - Course ID\n   * @returns Array of enrolled student IDs\n   */\n  async getEnrolledStudents(courseId: string): Promise<string[]> {\n    const enrollments = await apiClient.get<Enrollment[]>(`/courses/${courseId}/enrollments`);\n    return enrollments.map(enrollment => enrollment.student_id);\n  }\n\n  /**\n   * Enroll multiple students in a course (convenience method)\n   *\n   * BUSINESS CONTEXT:\n   * Simplified method for enrollment UI that matches test expectations.\n   * Wraps bulkEnrollStudents with a cleaner interface.\n   *\n   * @param params - Course ID and student IDs to enroll\n   * @returns Enrollment result with success/failure details\n   */\n  async enrollStudents(params: { courseId: string; studentIds: string[] }): Promise<{\n    enrolled: string[];\n    courseId: string;\n    enrolledCount: number;\n    failed?: Array<{ id: string; reason: string }>;\n  }> {\n    const result = await this.bulkEnrollStudents({\n      course_id: params.courseId,\n      student_ids: params.studentIds,\n    });\n\n    return {\n      enrolled: params.studentIds.filter((id, index) =>\n        !result.failed_students.some(failed => failed.student_id === id)\n      ),\n      courseId: params.courseId,\n      enrolledCount: result.success_count,\n      failed: result.failed_students.map(f => ({ id: f.student_id, reason: f.reason })),\n    };\n  }\n}\n\n// Export singleton instance\nexport const enrollmentService = new EnrollmentService();\n"],"names":["EnrollmentService","data","apiClient","courseId","studentId","enrollmentId","status","organizationId","instructorId","csvFile","formData","query","enrollment","params","result","id","index","failed","f","enrollmentService"],"mappings":"wCAoGA,MAAMA,CAAkB,CACd,QAAU,eAKlB,MAAM,cAAcC,EAAiD,CACnE,OAAO,MAAMC,EAAU,KAAiB,KAAK,QAASD,CAAI,CAC5D,CAMA,MAAM,mBAAmBA,EAAkE,CACzF,OAAO,MAAMC,EAAU,KACrB,YAAYD,EAAK,SAAS,eAC1B,CACE,YAAaA,EAAK,YAClB,gBAAiBA,EAAK,eAAA,CACxB,CAEJ,CAMA,MAAM,0BACJA,EACiC,CACjC,OAAO,MAAMC,EAAU,KACrB,WAAWD,EAAK,QAAQ,eACxB,CACE,YAAaA,EAAK,YAClB,gBAAiBA,EAAK,eAAA,CACxB,CAEJ,CAKA,MAAM,qBAAqBE,EAAyC,CAClE,OAAO,MAAMD,EAAU,IAAkB,YAAYC,CAAQ,cAAc,CAC7E,CAKA,MAAM,sBAAsBC,EAA0C,CACpE,OAAO,MAAMF,EAAU,IAAkB,aAAaE,CAAS,cAAc,CAC/E,CAKA,MAAM,kBAA0C,CAC9C,OAAO,MAAMF,EAAU,IAAkB,GAAG,KAAK,OAAO,KAAK,CAC/D,CAKA,MAAM,uBAAuBG,EAAsBC,EAA+C,CAChG,OAAO,MAAMJ,EAAU,IAAgB,GAAG,KAAK,OAAO,IAAIG,CAAY,GAAI,CAAE,OAAAC,CAAA,CAAQ,CACtF,CAKA,MAAM,gBAAgBD,EAAqC,CACzD,MAAMH,EAAU,OAAO,GAAG,KAAK,OAAO,IAAIG,CAAY,EAAE,CAC1D,CAMA,MAAM,iCAAiCE,EAA6D,CAClG,OAAO,MAAML,EAAU,IACrB,kBAAkBK,CAAc,sBAAA,CAEpC,CAMA,MAAM,+BAA+BC,EAA2D,CAC9F,OAAO,MAAMN,EAAU,IACrB,gBAAgBM,CAAY,sBAAA,CAEhC,CAMA,MAAM,kBAAkBL,EAAkBM,EAAgD,CACxF,MAAMC,EAAW,IAAI,SACrB,OAAAA,EAAS,OAAO,OAAQD,CAAO,EAC/BC,EAAS,OAAO,YAAaP,CAAQ,EAE9B,MAAMD,EAAU,KACrB,2BACAQ,EACA,CACE,QAAS,CACP,eAAgB,qBAAA,CAClB,CACF,CAEJ,CAYA,MAAM,eAAeC,EAA4E,CAC/F,OAAO,MAAMT,EAAU,IACrB,sBAAsB,mBAAmBS,CAAK,CAAC,EAAA,CAEnD,CAYA,MAAM,oBAAoBR,EAAqC,CAE7D,OADoB,MAAMD,EAAU,IAAkB,YAAYC,CAAQ,cAAc,GACrE,IAAIS,GAAcA,EAAW,UAAU,CAC5D,CAYA,MAAM,eAAeC,EAKlB,CACD,MAAMC,EAAS,MAAM,KAAK,mBAAmB,CAC3C,UAAWD,EAAO,SAClB,YAAaA,EAAO,UAAA,CACrB,EAED,MAAO,CACL,SAAUA,EAAO,WAAW,OAAO,CAACE,EAAIC,IACtC,CAACF,EAAO,gBAAgB,KAAKG,GAAUA,EAAO,aAAeF,CAAE,CAAA,EAEjE,SAAUF,EAAO,SACjB,cAAeC,EAAO,cACtB,OAAQA,EAAO,gBAAgB,IAAII,IAAM,CAAE,GAAIA,EAAE,WAAY,OAAQA,EAAE,MAAA,EAAS,CAAA,CAEpF,CACF,CAGO,MAAMC,EAAoB,IAAInB"}