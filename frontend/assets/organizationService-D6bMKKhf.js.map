{"version":3,"file":"organizationService-D6bMKKhf.js","sources":["../../src/services/organizationService.ts"],"sourcesContent":["/**\n * Organization Service\n *\n * BUSINESS CONTEXT:\n * Handles organization management for B2B corporate training platform.\n * Manages corporate customers, their trainers (instructors), and organizational structure.\n * Supports multi-tenant architecture with organization-level isolation.\n *\n * TECHNICAL IMPLEMENTATION:\n * - Uses centralized apiClient with authentication\n * - Handles organization CRUD operations\n * - Manages trainer/member assignments\n * - Integrates with organization-management service (port 8005)\n */\n\nimport { apiClient } from './apiClient';\nimport type { UserRole } from '../store/slices/authSlice';\n\n/**\n * Organization Interface\n */\nexport interface Organization {\n  id: string;\n  name: string;\n  description?: string;\n  industry?: string;\n  size?: 'small' | 'medium' | 'large' | 'enterprise';\n  website?: string;\n  contact_email?: string;\n  contact_phone?: string;\n  address?: string;\n  logo_url?: string;\n  created_at: string;\n  updated_at: string;\n  active: boolean;\n  member_count?: number;\n  trainer_count?: number;\n  student_count?: number;\n}\n\n/**\n * Organization Member (Trainer or Admin)\n */\nexport interface OrganizationMember {\n  id: string;\n  user_id: string;\n  organization_id: string;\n  username: string;\n  email: string;\n  full_name: string;\n  first_name?: string;\n  last_name?: string;\n  role: UserRole;\n  joined_date: string;\n  last_active?: string;\n  active: boolean;\n}\n\n/**\n * Create Organization Request\n */\nexport interface CreateOrganizationRequest {\n  name: string;\n  description?: string;\n  industry?: string;\n  size?: 'small' | 'medium' | 'large' | 'enterprise';\n  website?: string;\n  contact_email?: string;\n  contact_phone?: string;\n  address?: string;\n}\n\n/**\n * Update Organization Request\n */\nexport interface UpdateOrganizationRequest extends Partial<CreateOrganizationRequest> {}\n\n/**\n * Add Member Request\n */\nexport interface AddMemberRequest {\n  user_id: string;\n  role: UserRole;\n}\n\n/**\n * Bulk Add Members Request\n */\nexport interface BulkAddMembersRequest {\n  user_ids: string[];\n  role: UserRole;\n}\n\n/**\n * Organization List Response\n */\nexport interface OrganizationListResponse {\n  data: Organization[];\n  total: number;\n  page: number;\n  limit: number;\n  pages: number;\n}\n\n/**\n * Organization Service Class\n *\n * WHY THIS APPROACH:\n * - Centralized organization API logic\n * - Supports multi-tenant B2B architecture\n * - Type-safe interfaces for all operations\n * - Handles trainer and member management\n */\nclass OrganizationService {\n  private baseUrl = '/organizations';\n\n  /**\n   * Get all organizations (site admin only)\n   */\n  async getOrganizations(page: number = 1, limit: number = 20): Promise<OrganizationListResponse> {\n    return await apiClient.get<OrganizationListResponse>(this.baseUrl, {\n      params: { page, limit },\n    });\n  }\n\n  /**\n   * Get organization by ID\n   */\n  async getOrganizationById(id: string): Promise<Organization> {\n    return await apiClient.get<Organization>(`${this.baseUrl}/${id}`);\n  }\n\n  /**\n   * Get current user's organization\n   */\n  async getMyOrganization(): Promise<Organization> {\n    return await apiClient.get<Organization>(`${this.baseUrl}/me`);\n  }\n\n  /**\n   * Create new organization (site admin only)\n   */\n  async createOrganization(data: CreateOrganizationRequest): Promise<Organization> {\n    return await apiClient.post<Organization>(this.baseUrl, data);\n  }\n\n  /**\n   * Update organization\n   */\n  async updateOrganization(id: string, data: UpdateOrganizationRequest): Promise<Organization> {\n    return await apiClient.put<Organization>(`${this.baseUrl}/${id}`, data);\n  }\n\n  /**\n   * Delete organization (site admin only)\n   */\n  async deleteOrganization(id: string): Promise<void> {\n    await apiClient.delete(`${this.baseUrl}/${id}`);\n  }\n\n  /**\n   * Get organization members (trainers and admins)\n   */\n  async getOrganizationMembers(organizationId: string): Promise<OrganizationMember[]> {\n    return await apiClient.get<OrganizationMember[]>(`${this.baseUrl}/${organizationId}/members`);\n  }\n\n  /**\n   * Get organization trainers (instructors only)\n   */\n  async getOrganizationTrainers(organizationId: string): Promise<OrganizationMember[]> {\n    const members = await this.getOrganizationMembers(organizationId);\n    return members.filter(member => member.role === 'instructor');\n  }\n\n  /**\n   * Add member to organization\n   */\n  async addMember(organizationId: string, data: AddMemberRequest): Promise<OrganizationMember> {\n    return await apiClient.post<OrganizationMember>(\n      `${this.baseUrl}/${organizationId}/members`,\n      data\n    );\n  }\n\n  /**\n   * Bulk add members to organization\n   */\n  async bulkAddMembers(organizationId: string, data: BulkAddMembersRequest): Promise<{\n    success_count: number;\n    failed_count: number;\n    message: string;\n  }> {\n    return await apiClient.post(\n      `${this.baseUrl}/${organizationId}/members/bulk`,\n      data\n    );\n  }\n\n  /**\n   * Remove member from organization\n   */\n  async removeMember(organizationId: string, userId: string): Promise<void> {\n    await apiClient.delete(`${this.baseUrl}/${organizationId}/members/${userId}`);\n  }\n\n  /**\n   * Update member role\n   */\n  async updateMemberRole(\n    organizationId: string,\n    userId: string,\n    role: UserRole\n  ): Promise<OrganizationMember> {\n    return await apiClient.put<OrganizationMember>(\n      `${this.baseUrl}/${organizationId}/members/${userId}`,\n      { role }\n    );\n  }\n\n  /**\n   * Get organization statistics\n   */\n  async getOrganizationStats(organizationId: string): Promise<{\n    total_members: number;\n    total_trainers: number;\n    total_students: number;\n    total_programs: number;\n    total_enrollments: number;\n    completion_rate: number;\n  }> {\n    return await apiClient.get(`${this.baseUrl}/${organizationId}/stats`);\n  }\n\n  /**\n   * Search organizations (site admin only)\n   */\n  async searchOrganizations(query: string): Promise<Organization[]> {\n    return await apiClient.get<Organization[]>(`${this.baseUrl}/search`, {\n      params: { q: query },\n    });\n  }\n\n  /**\n   * Activate/deactivate organization\n   */\n  async toggleOrganizationStatus(id: string, active: boolean): Promise<Organization> {\n    return await apiClient.put<Organization>(`${this.baseUrl}/${id}/status`, { active });\n  }\n\n  /**\n   * Register new organization (public self-service registration)\n   *\n   * BUSINESS CONTEXT:\n   * Public registration endpoint for organizations to sign up.\n   * Creates organization + admin account in single transaction.\n   * Returns JWT token for auto-login after successful registration.\n   *\n   * @param formData - FormData object containing organization and admin details\n   * @returns Organization data with access_token and user info\n   */\n  async registerOrganization(formData: any): Promise<{\n    data: any;\n    access_token?: string;\n    user?: any;\n  }> {\n    // Convert FormData to JSON object for the backend endpoint\n    const data: any = {};\n    if (formData instanceof FormData) {\n      for (const [key, value] of formData.entries()) {\n        // Skip File objects - backend JSON endpoint doesn't handle file uploads\n        if (!(value instanceof File)) {\n          data[key] = value;\n        }\n      }\n    } else {\n      Object.assign(data, formData);\n    }\n\n    // Add required admin_role field\n    data.admin_role = 'organization_admin';\n\n    // Backend expects JSON at POST /api/v1/organizations\n    return await apiClient.post(`${this.baseUrl}`, data);\n  }\n}\n\n// Export singleton instance\nexport const organizationService = new OrganizationService();\n"],"names":["OrganizationService","page","limit","apiClient","id","data","organizationId","member","userId","role","query","active","formData","key","value","organizationService"],"mappings":"wCAiHA,MAAMA,CAAoB,CAChB,QAAU,iBAKlB,MAAM,iBAAiBC,EAAe,EAAGC,EAAgB,GAAuC,CAC9F,OAAO,MAAMC,EAAU,IAA8B,KAAK,QAAS,CACjE,OAAQ,CAAE,KAAAF,EAAM,MAAAC,CAAA,CAAM,CACvB,CACH,CAKA,MAAM,oBAAoBE,EAAmC,CAC3D,OAAO,MAAMD,EAAU,IAAkB,GAAG,KAAK,OAAO,IAAIC,CAAE,EAAE,CAClE,CAKA,MAAM,mBAA2C,CAC/C,OAAO,MAAMD,EAAU,IAAkB,GAAG,KAAK,OAAO,KAAK,CAC/D,CAKA,MAAM,mBAAmBE,EAAwD,CAC/E,OAAO,MAAMF,EAAU,KAAmB,KAAK,QAASE,CAAI,CAC9D,CAKA,MAAM,mBAAmBD,EAAYC,EAAwD,CAC3F,OAAO,MAAMF,EAAU,IAAkB,GAAG,KAAK,OAAO,IAAIC,CAAE,GAAIC,CAAI,CACxE,CAKA,MAAM,mBAAmBD,EAA2B,CAClD,MAAMD,EAAU,OAAO,GAAG,KAAK,OAAO,IAAIC,CAAE,EAAE,CAChD,CAKA,MAAM,uBAAuBE,EAAuD,CAClF,OAAO,MAAMH,EAAU,IAA0B,GAAG,KAAK,OAAO,IAAIG,CAAc,UAAU,CAC9F,CAKA,MAAM,wBAAwBA,EAAuD,CAEnF,OADgB,MAAM,KAAK,uBAAuBA,CAAc,GACjD,OAAOC,GAAUA,EAAO,OAAS,YAAY,CAC9D,CAKA,MAAM,UAAUD,EAAwBD,EAAqD,CAC3F,OAAO,MAAMF,EAAU,KACrB,GAAG,KAAK,OAAO,IAAIG,CAAc,WACjCD,CAAA,CAEJ,CAKA,MAAM,eAAeC,EAAwBD,EAI1C,CACD,OAAO,MAAMF,EAAU,KACrB,GAAG,KAAK,OAAO,IAAIG,CAAc,gBACjCD,CAAA,CAEJ,CAKA,MAAM,aAAaC,EAAwBE,EAA+B,CACxE,MAAML,EAAU,OAAO,GAAG,KAAK,OAAO,IAAIG,CAAc,YAAYE,CAAM,EAAE,CAC9E,CAKA,MAAM,iBACJF,EACAE,EACAC,EAC6B,CAC7B,OAAO,MAAMN,EAAU,IACrB,GAAG,KAAK,OAAO,IAAIG,CAAc,YAAYE,CAAM,GACnD,CAAE,KAAAC,CAAA,CAAK,CAEX,CAKA,MAAM,qBAAqBH,EAOxB,CACD,OAAO,MAAMH,EAAU,IAAI,GAAG,KAAK,OAAO,IAAIG,CAAc,QAAQ,CACtE,CAKA,MAAM,oBAAoBI,EAAwC,CAChE,OAAO,MAAMP,EAAU,IAAoB,GAAG,KAAK,OAAO,UAAW,CACnE,OAAQ,CAAE,EAAGO,CAAA,CAAM,CACpB,CACH,CAKA,MAAM,yBAAyBN,EAAYO,EAAwC,CACjF,OAAO,MAAMR,EAAU,IAAkB,GAAG,KAAK,OAAO,IAAIC,CAAE,UAAW,CAAE,OAAAO,CAAA,CAAQ,CACrF,CAaA,MAAM,qBAAqBC,EAIxB,CAED,MAAMP,EAAY,CAAA,EAClB,GAAIO,aAAoB,SACtB,SAAW,CAACC,EAAKC,CAAK,IAAKF,EAAS,UAE5BE,aAAiB,OACrBT,EAAKQ,CAAG,EAAIC,QAIhB,OAAO,OAAOT,EAAMO,CAAQ,EAI9B,OAAAP,EAAK,WAAa,qBAGX,MAAMF,EAAU,KAAK,GAAG,KAAK,OAAO,GAAIE,CAAI,CACrD,CACF,CAGO,MAAMU,EAAsB,IAAIf"}