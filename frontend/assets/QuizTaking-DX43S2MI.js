import{j as e}from"./query-vendor-DXemzGoE.js";import{a as p,h as G,u as R}from"./react-vendor-DLPaXABT.js";import{B as y}from"./index-DkecjcRV.js";import"./state-vendor-DnXO85Wm.js";const V="_questionContainer_p7ijp_5",U="_questionHeader_p7ijp_11",J="_questionMeta_p7ijp_19",W="_questionNumber_p7ijp_25",K="_difficulty_p7ijp_31",Y="_points_p7ijp_38",X="_questionText_p7ijp_44",Z="_optionsContainer_p7ijp_51",ee="_option_p7ijp_51",se="_selected_p7ijp_74",te="_correct_p7ijp_79",ne="_wrong_p7ijp_84",ae="_radioInput_p7ijp_89",ie="_optionText_p7ijp_95",re="_correctBadge_p7ijp_101",oe="_wrongBadge_p7ijp_107",ce="_textInputContainer_p7ijp_113",le="_textInput_p7ijp_113",ue="_textArea_p7ijp_134",de="_correctAnswerDisplay_p7ijp_150",pe="_explanation_p7ijp_169",_e="_tags_p7ijp_188",me="_tag_p7ijp_188",a={questionContainer:V,questionHeader:U,questionMeta:J,questionNumber:W,difficulty:K,points:Y,questionText:X,optionsContainer:Z,option:ee,selected:se,correct:te,wrong:ne,radioInput:ae,optionText:ie,correctBadge:re,wrongBadge:oe,textInputContainer:ce,textInput:le,textArea:ue,correctAnswerDisplay:de,explanation:pe,tags:_e,tag:me},he=({question:s,questionIndex:t,answer:l,onAnswerChange:i,showCorrectAnswer:r=!1,correctAnswer:o,isReview:n=!1})=>{const _=c=>{n||i(t,c)},x=c=>{switch(c){case"easy":return"#4caf50";case"medium":return"#ff9800";case"hard":return"#f44336";default:return"#666666"}},q=()=>{switch(s.question_type){case"multiple_choice":return e.jsx("div",{className:a.optionsContainer,children:s.options.map((c,h)=>{const g=l===c,f=r&&c===o,w=r&&g&&c!==o;return e.jsxs("label",{className:`${a.option} ${g?a.selected:""} ${f?a.correct:""} ${w?a.wrong:""}`,children:[e.jsx("input",{type:"radio",name:`question-${t}`,value:c,checked:g,onChange:j=>_(j.target.value),disabled:n,className:a.radioInput}),e.jsx("span",{className:a.optionText,children:c}),f&&e.jsx("span",{className:a.correctBadge,children:"âœ“ Correct"}),w&&e.jsx("span",{className:a.wrongBadge,children:"âœ— Incorrect"})]},h)})});case"true_false":return e.jsx("div",{className:a.optionsContainer,children:["True","False"].map(c=>{const h=l===c,g=r&&c===o,f=r&&h&&c!==o;return e.jsxs("label",{className:`${a.option} ${h?a.selected:""} ${g?a.correct:""} ${f?a.wrong:""}`,children:[e.jsx("input",{type:"radio",name:`question-${t}`,value:c,checked:h,onChange:w=>_(w.target.value),disabled:n,className:a.radioInput}),e.jsx("span",{className:a.optionText,children:c}),g&&e.jsx("span",{className:a.correctBadge,children:"âœ“ Correct"}),f&&e.jsx("span",{className:a.wrongBadge,children:"âœ— Incorrect"})]},c)})});case"short_answer":return e.jsxs("div",{className:a.textInputContainer,children:[e.jsx("input",{type:"text",value:l,onChange:c=>_(c.target.value),placeholder:"Enter your answer...",className:a.textInput,disabled:n}),r&&o&&e.jsxs("div",{className:a.correctAnswerDisplay,children:[e.jsx("strong",{children:"Correct Answer:"})," ",o]})]});case"essay":return e.jsxs("div",{className:a.textInputContainer,children:[e.jsx("textarea",{value:l,onChange:c=>_(c.target.value),placeholder:"Enter your answer... (Be thorough and specific)",className:a.textArea,rows:10,disabled:n}),r&&s.explanation&&e.jsxs("div",{className:a.correctAnswerDisplay,children:[e.jsx("strong",{children:"Sample Answer/Key Points:"}),e.jsx("p",{children:s.explanation})]})]});case"fill_in_blank":return e.jsxs("div",{className:a.textInputContainer,children:[e.jsx("input",{type:"text",value:l,onChange:c=>_(c.target.value),placeholder:"Fill in the blank...",className:a.textInput,disabled:n}),r&&o&&e.jsxs("div",{className:a.correctAnswerDisplay,children:[e.jsx("strong",{children:"Correct Answer:"})," ",o]})]});default:return e.jsx("div",{children:"Unsupported question type"})}};return e.jsxs("div",{className:a.questionContainer,children:[e.jsx("div",{className:a.questionHeader,children:e.jsxs("div",{className:a.questionMeta,children:[e.jsxs("span",{className:a.questionNumber,children:["Question ",t+1]}),e.jsx("span",{className:a.difficulty,style:{color:x(s.difficulty)},children:s.difficulty.toUpperCase()}),e.jsxs("span",{className:a.points,children:[s.points," ",s.points===1?"point":"points"]})]})}),e.jsx("div",{className:a.questionText,children:s.question_text}),q(),r&&s.explanation&&s.question_type!=="essay"&&e.jsxs("div",{className:a.explanation,children:[e.jsx("strong",{children:"Explanation:"}),e.jsx("p",{children:s.explanation})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:a.tags,children:s.tags.map((c,h)=>e.jsx("span",{className:a.tag,children:c},h))})]})},xe="_timer_4i69f_1",ge="_normal_4i69f_12",fe="_warning_4i69f_17",je="_critical_4i69f_23",qe="_timerIcon_4i69f_34",Ce="_urgentBadge_4i69f_38",z={timer:xe,normal:ge,warning:fe,critical:je,timerIcon:qe,urgentBadge:Ce},ve=({timeRemaining:s,onTimeExpired:t})=>{const[l,i]=p.useState(s);p.useEffect(()=>{if(l<=0){t();return}const n=setInterval(()=>{i(_=>Math.max(0,_-1))},1e3);return()=>clearInterval(n)},[l,t]);const r=n=>{const _=Math.floor(n/3600),x=Math.floor(n%3600/60),q=n%60;return _>0?`${_}:${x.toString().padStart(2,"0")}:${q.toString().padStart(2,"0")}`:`${x}:${q.toString().padStart(2,"0")}`},o=()=>l<=60?z.critical:l<=300?z.warning:z.normal;return e.jsxs("div",{className:`${z.timer} ${o()}`,children:[e.jsx("span",{className:z.timerIcon,children:"â±ï¸"}),e.jsx("span",{className:z.timerText,children:r(l)}),l<=60&&e.jsx("span",{className:z.urgentBadge,children:"Hurry!"})]})},Ne="_resultsContainer_f7wh9_1",ye="_resultsCard_f7wh9_10",we="_resultBanner_f7wh9_19",Se="_passed_f7wh9_25",ze="_failed_f7wh9_29",be="_resultIcon_f7wh9_33",Te="_performanceMessage_f7wh9_44",$e="_scoreSection_f7wh9_50",Ie="_mainScore_f7wh9_55",Qe="_scoreCircle_f7wh9_61",Be="_scorePercentage_f7wh9_72",ke="_scoreDetails_f7wh9_78",Ae="_passedText_f7wh9_88",De="_failedText_f7wh9_93",Ee="_statsSection_f7wh9_98",Pe="_statCard_f7wh9_106",Me="_statLabel_f7wh9_116",Le="_statValue_f7wh9_123",Oe="_actions_f7wh9_129",u={resultsContainer:Ne,resultsCard:ye,resultBanner:we,passed:Se,failed:ze,resultIcon:be,performanceMessage:Te,scoreSection:$e,mainScore:Ie,scoreCircle:Qe,scorePercentage:Be,scoreDetails:ke,passedText:Ae,failedText:De,statsSection:Ee,statCard:Pe,statLabel:Me,statValue:Le,actions:Oe},Fe=({quiz:s,attempt:t,onRetake:l,onClose:i})=>{if(!t.score)return null;const{score:r}=t,o=r.passed,n=Math.round(r.percentage),_=()=>n>=90?"Excellent work!":n>=80?"Great job!":n>=70?"Good effort!":n>=60?"Keep practicing!":"Review the material and try again.";return e.jsx("div",{className:u.resultsContainer,children:e.jsxs("div",{className:u.resultsCard,children:[e.jsxs("div",{className:`${u.resultBanner} ${o?u.passed:u.failed}`,children:[e.jsx("span",{className:u.resultIcon,children:o?"ðŸŽ‰":"ðŸ“š"}),e.jsx("h1",{children:o?"Congratulations!":"Not Quite There"}),e.jsx("p",{className:u.performanceMessage,children:_()})]}),e.jsx("div",{className:u.scoreSection,children:e.jsxs("div",{className:u.mainScore,children:[e.jsx("div",{className:u.scoreCircle,children:e.jsxs("span",{className:u.scorePercentage,children:[n,"%"]})}),e.jsxs("div",{className:u.scoreDetails,children:[e.jsxs("p",{children:[e.jsx("strong",{children:r.earned_points})," / ",r.total_points," points"]}),e.jsxs("p",{children:[e.jsx("strong",{children:r.correct_count})," / ",r.total_questions," correct"]}),e.jsxs("p",{className:o?u.passedText:u.failedText,children:[o?"âœ“ Passed":"âœ— Did not pass"," (Passing: ",r.passing_score,"%)"]})]})]})}),e.jsxs("div",{className:u.statsSection,children:[e.jsxs("div",{className:u.statCard,children:[e.jsx("span",{className:u.statLabel,children:"Time Spent"}),e.jsxs("span",{className:u.statValue,children:[Math.floor(t.time_spent_seconds/60),"min ",t.time_spent_seconds%60,"s"]})]}),e.jsxs("div",{className:u.statCard,children:[e.jsx("span",{className:u.statLabel,children:"Accuracy"}),e.jsxs("span",{className:u.statValue,children:[n,"%"]})]}),e.jsxs("div",{className:u.statCard,children:[e.jsx("span",{className:u.statLabel,children:"Questions"}),e.jsx("span",{className:u.statValue,children:r.total_questions})]})]}),e.jsxs("div",{className:u.actions,children:[e.jsx(y,{variant:"secondary",onClick:i,children:"Close"}),l&&!o&&e.jsx(y,{variant:"primary",onClick:l,children:"Retake Quiz"})]})]})})},k="https://176.9.99.103:8001/api/v1",T="https://176.9.99.103:8002/api/v1";class He extends Error{constructor(t,l,i){super(t),this.statusCode=l,this.detail=i,this.name="QuizServiceError"}}async function S(s){if(!s.ok){const t=await s.json().catch(()=>({detail:"An error occurred"}));throw new He(t.detail||`Request failed with status ${s.status}`,s.status,t.detail)}return s.json()}const I={async getQuiz(s){const t=await fetch(`${k}/quizzes/${s}`,{credentials:"include",headers:{"Content-Type":"application/json"}});return S(t)},async getQuizzesForCourse(s){const t=await fetch(`${k}/courses/${s}/quizzes`,{credentials:"include",headers:{"Content-Type":"application/json"}});return S(t)},async getActiveAttempt(s){const t=await fetch(`${T}/quiz-attempts/active?quizId=${s}`,{credentials:"include",headers:{"Content-Type":"application/json"}});return t.status===404?null:S(t)},async startQuiz(s){const t=await fetch(`${T}/quiz-attempts`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({quiz_id:s,started_at:new Date().toISOString()})});return S(t)},async saveAnswer(s,t,l){const i=await fetch(`${T}/quiz-attempts/${s}/answers`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({question_index:t,answer:l})});return S(i)},async submitQuiz(s,t){const l=await fetch(`${T}/quiz-attempts/${s}/submit`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({answers:t,submitted_at:new Date().toISOString()})});return S(l)},async getAttemptHistory(s){const t=await fetch(`${T}/quiz-attempts/history?quizId=${s}`,{credentials:"include",headers:{"Content-Type":"application/json"}});return S(t)},async getAttempt(s){const t=await fetch(`${T}/quiz-attempts/${s}`,{credentials:"include",headers:{"Content-Type":"application/json"}});return S(t)}},Ge=(s,t)=>{const[l,i]=p.useState(null),[r,o]=p.useState(null),[n,_]=p.useState({}),[x,q]=p.useState(0),[c,h]=p.useState(!0),[g,f]=p.useState(!1),[w,j]=p.useState(null);p.useEffect(()=>{if(!s||!t)return;(async()=>{try{h(!0),j(null);const C=await I.getQuiz(s);i(C);const v=await I.getActiveAttempt(s);v&&(o(v),_(v.answers||{}))}catch(C){j(C instanceof Error?C.message:"Failed to load quiz")}finally{h(!1)}})()},[s,t]);const B=p.useCallback(async()=>{if(s)try{h(!0),j(null);const m=await I.startQuiz(s);o(m),_({}),q(0)}catch(m){throw j(m instanceof Error?m.message:"Failed to start quiz"),m}finally{h(!1)}},[s]),$=p.useCallback(async(m,C)=>{if(r)try{const v={...n,[m]:C};_(v),await I.saveAnswer(r.id,m,C)}catch(v){console.error("Failed to save answer:",v)}},[r,n]),Q=p.useCallback(async()=>{if(!r)return null;try{f(!0),j(null);const m=await I.submitQuiz(r.id,n);return o(m),m}catch(m){throw j(m instanceof Error?m.message:"Failed to submit quiz"),m}finally{f(!1)}},[r,n]);return{quiz:l,attempt:r,answers:n,currentQuestionIndex:x,isLoading:c,isSubmitting:g,error:w,startQuiz:B,saveAnswer:$,submitQuiz:Q,setCurrentQuestionIndex:q}},Re="_quizContainer_19f8q_5",Ve="_loadingContainer_19f8q_13",Ue="_errorContainer_19f8q_14",Je="_spinner_19f8q_23",We="_quizHeader_19f8q_42",Ke="_quizInfo_19f8q_54",Ye="_quizDescription_19f8q_64",Xe="_progressSection_19f8q_70",Ze="_progressBar_19f8q_78",es="_progressFill_19f8q_87",ss="_progressText_19f8q_94",ts="_questionSection_19f8q_101",ns="_navigationSection_19f8q_110",as="_navigationCenter_19f8q_118",is="_questionIndicator_19f8q_124",rs="_questionGrid_19f8q_130",os="_questionButtons_19f8q_143",cs="_questionButton_19f8q_143",ls="_active_19f8q_167",us="_answered_19f8q_173",ds="_modal_19f8q_184",ps="_modalContent_19f8q_197",_s="_warningText_19f8q_218",ms="_modalActions_19f8q_223",d={quizContainer:Re,loadingContainer:Ve,errorContainer:Ue,spinner:Je,quizHeader:We,quizInfo:Ke,quizDescription:Ye,progressSection:Xe,progressBar:Ze,progressFill:es,progressText:ss,questionSection:ts,navigationSection:ns,navigationCenter:as,questionIndicator:is,questionGrid:rs,questionButtons:os,questionButton:cs,active:ls,answered:us,modal:ds,modalContent:ps,warningText:_s,modalActions:ms},js=()=>{const{quizId:s,courseId:t}=G(),l=R(),{quiz:i,attempt:r,answers:o,currentQuestionIndex:n,isLoading:_,isSubmitting:x,error:q,startQuiz:c,saveAnswer:h,submitQuiz:g,setCurrentQuestionIndex:f}=Ge(s,t),[w,j]=p.useState(!1),[B,$]=p.useState(!1),[Q,m]=p.useState(null);p.useEffect(()=>{if(i?.is_timed&&i.settings.time_limit_minutes&&r){const b=new Date(r.started_at).getTime(),N=Date.now(),O=Math.floor((N-b)/1e3),F=i.settings.time_limit_minutes*60,H=Math.max(0,F-O);m(H)}},[i,r]);const C=p.useCallback(async()=>{x||(await g(),j(!0))},[x,g]),v=p.useCallback(async(b,N)=>{await h(b,N)},[h]),A=()=>{n>0&&f(n-1)},D=()=>{i&&n<i.questions.length-1&&f(n+1)},E=async()=>{$(!1),await g()&&j(!0)},P=()=>i?Object.keys(o).length/i.questions.length*100:0;if(_)return e.jsxs("div",{className:d.loadingContainer,children:[e.jsx("div",{className:d.spinner}),e.jsx("p",{children:"Loading quiz..."})]});if(q)return e.jsxs("div",{className:d.errorContainer,children:[e.jsx("h2",{children:"Error Loading Quiz"}),e.jsx("p",{children:q}),e.jsx(y,{onClick:()=>l(-1),children:"Go Back"})]});if(!i||!r)return e.jsxs("div",{className:d.errorContainer,children:[e.jsx("h2",{children:"Quiz Not Found"}),e.jsx(y,{onClick:()=>l(-1),children:"Go Back"})]});if(w&&r.score)return e.jsx(Fe,{quiz:i,attempt:r,onRetake:i.allows_multiple_attempts?()=>c():void 0,onClose:()=>l(`/courses/${t}`)});const M=i.questions[n],L=n===i.questions.length-1;return e.jsxs("div",{className:d.quizContainer,children:[e.jsxs("div",{className:d.quizHeader,children:[e.jsxs("div",{className:d.quizInfo,children:[e.jsx("h1",{children:i.title}),i.description&&e.jsx("p",{className:d.quizDescription,children:i.description})]}),i.is_timed&&Q!==null&&e.jsx(ve,{timeRemaining:Q,onTimeExpired:C})]}),e.jsxs("div",{className:d.progressSection,children:[e.jsx("div",{className:d.progressBar,children:e.jsx("div",{className:d.progressFill,style:{width:`${P()}%`}})}),e.jsxs("div",{className:d.progressText,children:[e.jsxs("span",{children:[Object.keys(o).length," of ",i.questions.length," answered"]}),e.jsxs("span",{children:["Question ",n+1," of ",i.questions.length]})]})]}),e.jsx("div",{className:d.questionSection,children:e.jsx(he,{question:M,questionIndex:n,answer:o[n]||"",onAnswerChange:v})}),e.jsxs("div",{className:d.navigationSection,children:[e.jsx(y,{variant:"secondary",onClick:A,disabled:n===0,children:"â† Previous"}),e.jsx("div",{className:d.navigationCenter,children:e.jsxs("span",{className:d.questionIndicator,children:[n+1," / ",i.questions.length]})}),L?e.jsx(y,{variant:"primary",onClick:()=>$(!0),disabled:x,children:"Submit Quiz"}):e.jsx(y,{variant:"primary",onClick:D,children:"Next â†’"})]}),e.jsxs("div",{className:d.questionGrid,children:[e.jsx("h3",{children:"Questions"}),e.jsx("div",{className:d.questionButtons,children:i.questions.map((b,N)=>e.jsx("button",{className:`${d.questionButton} ${N===n?d.active:""} ${o[N]?d.answered:""}`,onClick:()=>f(N),children:N+1},N))})]}),B&&e.jsx("div",{className:d.modal,children:e.jsxs("div",{className:d.modalContent,children:[e.jsx("h2",{children:"Submit Quiz?"}),e.jsxs("p",{children:["You have answered ",Object.keys(o).length," out of ",i.questions.length," questions."]}),Object.keys(o).length<i.questions.length&&e.jsx("p",{className:d.warningText,children:"âš ï¸ Some questions are unanswered. Are you sure you want to submit?"}),e.jsxs("div",{className:d.modalActions,children:[e.jsx(y,{variant:"secondary",onClick:()=>$(!1),children:"Cancel"}),e.jsx(y,{variant:"primary",onClick:E,disabled:x,children:x?"Submitting...":"Yes, Submit"})]})]})})]})};export{js as QuizTaking,js as default};
//# sourceMappingURL=QuizTaking-DX43S2MI.js.map
