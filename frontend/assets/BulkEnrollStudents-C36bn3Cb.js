import{j as e}from"./query-vendor-D-Supqfh.js";import{u as V,a as s,L as $}from"./react-vendor-DF6vRnOe.js";import{D as w}from"./DashboardLayout-Cc2O226k.js";import{S as U,H as u,C as i,B as S}from"./index-RGOaqmnJ.js";import{S as A}from"./Select-DYtXz80p.js";import{e as v}from"./enrollmentService-C4gnh65f.js";import{t as M}from"./trainingProgramService-CRwaMVjK.js";import{u as H}from"./hooks-Dtke09KW.js";import"./state-vendor-CcNjB5Go.js";const Z=()=>{const k=V(),p=H(t=>t.user.profile),[l,C]=s.useState("course"),[h,P]=s.useState([]),[W,z]=s.useState(!0),[c,R]=s.useState(""),[g,_]=s.useState(""),[x,B]=s.useState(null),[d,T]=s.useState(!1),[m,f]=s.useState(!1),[I,a]=s.useState(null),[E,y]=s.useState(null),[n,j]=s.useState(null);s.useEffect(()=>{(async()=>{if(p?.organizationId)try{z(!0);const o=await M.getTrainingPrograms({organization_id:p.organizationId,published:!0});P(o.data)}catch(o){console.error("Failed to load training programs:",o),a("Failed to load organization training programs. Please refresh the page.")}finally{z(!1)}})()},[p?.organizationId]);const F=Array.from(new Map(h.filter(t=>t.track_id).map(t=>[t.track_id,{id:t.track_id,name:`Track ${t.track_id}`}])).values()),L=async t=>{if(t.preventDefault(),a(null),y(null),j(null),!c){a(`Please select a ${l==="course"?"training program":"track"}.`);return}if(d){if(!x){a("Please upload a CSV file.");return}try{f(!0);const r=await v.bulkEnrollFromCSV(c,x);j(r),r.success_count>0&&y(`Successfully enrolled ${r.success_count} student(s) from CSV!`),r.failed_count>0&&a(`${r.failed_count} enrollment(s) failed. See details below.`),r.failed_count===0&&(B(null),setTimeout(()=>k("/dashboard/org-admin"),3e3))}catch(r){console.error("Failed to upload CSV:",r),a(r.response?.data?.message||"Failed to process CSV file. Please check the format and try again.")}finally{f(!1)}return}if(!g.trim()){a("Please enter student IDs.");return}const o=g.split(/[,\n]/).map(r=>r.trim()).filter(r=>r.length>0);if(o.length===0){a("No valid student IDs found.");return}try{f(!0);let r;l==="course"?r=await v.bulkEnrollStudents({course_id:c,student_ids:o}):r=await v.bulkEnrollStudentsInTrack({track_id:c,student_ids:o}),j(r),r.success_count>0&&y(`Successfully enrolled ${r.success_count} student(s) in ${l}!`),r.failed_count>0&&a(`${r.failed_count} enrollment(s) failed. See details below.`),r.failed_count===0&&(_(""),setTimeout(()=>k("/dashboard/org-admin"),3e3))}catch(r){console.error("Failed to bulk enroll students:",r),a(r.response?.data?.message||"Failed to enroll students. Please try again.")}finally{f(!1)}},D=()=>{const t=`student_id,student_name,student_email
student123,John Doe,john@example.com
student456,Jane Smith,jane@example.com
student789,Bob Wilson,bob@example.com`,o=new Blob([t],{type:"text/csv"}),r=URL.createObjectURL(o),b=document.createElement("a");b.href=r,b.download="bulk_enrollment_template.csv",b.click(),URL.revokeObjectURL(r)};return W?e.jsx(w,{children:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(U,{size:"large"})})}):e.jsx(w,{children:e.jsxs("main",{style:{padding:"2rem",maxWidth:"1000px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx(u,{level:"h1",gutterBottom:!0,children:"Bulk Enroll Students"}),e.jsx("p",{style:{color:"#666",fontSize:"0.95rem",marginBottom:"1rem"},children:"Enroll multiple students across your organization's training programs or tracks"}),e.jsx(i,{variant:"outlined",padding:"medium",style:{backgroundColor:"#eff6ff"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"#1e40af"},children:[e.jsx("strong",{children:"ðŸ’¡ Tip:"})," Use track enrollment to enroll students in entire learning paths at once. CSV upload supports enrolling hundreds of students in seconds."]})})]}),e.jsxs(i,{variant:"outlined",padding:"large",style:{marginBottom:"1.5rem"},children:[e.jsx(u,{level:"h2",style:{fontSize:"1.25rem",marginBottom:"1rem"},children:"Enrollment Target"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem"},children:[e.jsx(i,{variant:l==="course"?"elevated":"outlined",padding:"medium",style:{cursor:"pointer",border:l==="course"?"2px solid #3b82f6":void 0,transition:"all 0.2s"},onClick:()=>C("course"),children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"2.5rem",marginBottom:"0.5rem"},children:"ðŸ“š"}),e.jsx("div",{style:{fontWeight:600,marginBottom:"0.25rem",fontSize:"1.1rem"},children:"Single Training Program"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#666"},children:"Enroll students in one specific course"})]})}),e.jsx(i,{variant:l==="track"?"elevated":"outlined",padding:"medium",style:{cursor:"pointer",border:l==="track"?"2px solid #3b82f6":void 0,transition:"all 0.2s"},onClick:()=>C("track"),children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"2.5rem",marginBottom:"0.5rem"},children:"ðŸŽ¯"}),e.jsx("div",{style:{fontWeight:600,marginBottom:"0.25rem",fontSize:"1.1rem"},children:"Complete Learning Track"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#666"},children:"Enroll students in all courses in a track"})]})})]})]}),e.jsxs(i,{variant:"outlined",padding:"large",style:{marginBottom:"1.5rem"},children:[e.jsx(u,{level:"h2",style:{fontSize:"1.25rem",marginBottom:"1rem"},children:"Input Method"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem"},children:[e.jsx(i,{variant:d?"outlined":"elevated",padding:"medium",style:{cursor:"pointer",border:d?void 0:"2px solid #10b981",transition:"all 0.2s"},onClick:()=>T(!1),children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"2.5rem",marginBottom:"0.5rem"},children:"âœï¸"}),e.jsx("div",{style:{fontWeight:600,marginBottom:"0.25rem",fontSize:"1.1rem"},children:"Manual Entry"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#666"},children:"Paste student IDs directly"})]})}),e.jsx(i,{variant:d?"elevated":"outlined",padding:"medium",style:{cursor:"pointer",border:d?"2px solid #10b981":void 0,transition:"all 0.2s"},onClick:()=>T(!0),children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"2.5rem",marginBottom:"0.5rem"},children:"ðŸ“¤"}),e.jsx("div",{style:{fontWeight:600,marginBottom:"0.25rem",fontSize:"1.1rem"},children:"CSV Upload"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#666"},children:"Upload file with student list"})]})})]})]}),I&&e.jsx(i,{variant:"outlined",padding:"medium",style:{marginBottom:"1.5rem",borderColor:"#ef4444",backgroundColor:"#fee2e2"},children:e.jsx("p",{style:{color:"#dc2626",margin:0,fontWeight:500},children:I})}),E&&e.jsx(i,{variant:"outlined",padding:"medium",style:{marginBottom:"1.5rem",borderColor:"#10b981",backgroundColor:"#d1fae5"},children:e.jsx("p",{style:{color:"#065f46",margin:0,fontWeight:500},children:E})}),n&&n.failed_students&&n.failed_students.length>0&&e.jsxs(i,{variant:"outlined",padding:"large",style:{marginBottom:"1.5rem",borderColor:"#f59e0b"},children:[e.jsxs(u,{level:"h3",style:{fontSize:"1.1rem",marginBottom:"1rem"},children:["Failed Enrollments (",n.failed_count,")"]}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"2px solid #e5e7eb"},children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left",fontWeight:600},children:"Student ID"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left",fontWeight:600},children:"Reason"})]})}),e.jsx("tbody",{children:n.failed_students.map((t,o)=>e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[e.jsx("td",{style:{padding:"0.5rem",fontFamily:"monospace"},children:t.student_id}),e.jsx("td",{style:{padding:"0.5rem",color:"#dc2626"},children:t.reason})]},o))})]})})]}),e.jsx(i,{variant:"outlined",padding:"large",children:e.jsxs("form",{onSubmit:L,children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{htmlFor:"target",style:{display:"block",fontWeight:500,marginBottom:"0.5rem"},children:l==="course"?"Select Training Program *":"Select Learning Track *"}),e.jsx(A,{id:"target",name:"target",value:c,onChange:t=>R(t),options:l==="course"?[{value:"",label:"Choose a training program..."},...h.map(t=>({value:t.id,label:`${t.title} (${t.difficulty_level})`}))]:[{value:"",label:"Choose a learning track..."},...F.map(t=>({value:t.id,label:t.name}))],disabled:m}),h.length===0&&e.jsx("p",{style:{fontSize:"0.875rem",color:"#dc2626",marginTop:"0.5rem"},children:"No training programs found for your organization."}),l==="track"&&F.length===0&&e.jsx("p",{style:{fontSize:"0.875rem",color:"#dc2626",marginTop:"0.5rem"},children:"No learning tracks configured yet."})]}),!d&&e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{htmlFor:"bulkStudentIds",style:{display:"block",fontWeight:500,marginBottom:"0.5rem"},children:"Student IDs (one per line or comma-separated) *"}),e.jsx("textarea",{id:"bulkStudentIds",name:"bulkStudentIds",rows:10,placeholder:`Enter student IDs, one per line:
student123
student456
student789
...

Or comma-separated: student123, student456, student789`,value:g,onChange:t=>_(t.target.value),disabled:m,style:{width:"100%",padding:"0.75rem",fontSize:"0.875rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontFamily:"monospace",resize:"vertical"}}),e.jsx("p",{style:{fontSize:"0.875rem",color:"#666",marginTop:"0.5rem"},children:"ðŸ’¡ Tip: You can paste hundreds of IDs at once for bulk processing."})]}),d&&e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"csvFile",style:{fontWeight:500},children:"CSV File *"}),e.jsx(S,{type:"button",variant:"text",size:"small",onClick:D,children:"ðŸ“¥ Download Template"})]}),e.jsx("input",{id:"csvFile",name:"csvFile",type:"file",accept:".csv",onChange:t=>B(t.target.files?.[0]||null),disabled:m,style:{width:"100%",padding:"1rem",fontSize:"0.875rem",border:"2px dashed #d1d5db",borderRadius:"0.375rem",cursor:"pointer",backgroundColor:"#f9fafb"}}),e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f0f9ff",borderRadius:"0.375rem",border:"1px solid #bae6fd"},children:[e.jsx("p",{style:{margin:"0 0 0.5rem",fontWeight:500,fontSize:"0.875rem",color:"#0c4a6e"},children:"CSV Format Requirements:"}),e.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.875rem",color:"#0c4a6e"},children:[e.jsxs("li",{children:["Required column: ",e.jsx("code",{style:{backgroundColor:"#e0f2fe",padding:"0.125rem 0.25rem",borderRadius:"0.25rem"},children:"student_id"})]}),e.jsxs("li",{children:["Optional columns: ",e.jsx("code",{style:{backgroundColor:"#e0f2fe",padding:"0.125rem 0.25rem",borderRadius:"0.25rem"},children:"student_name"}),", ",e.jsx("code",{style:{backgroundColor:"#e0f2fe",padding:"0.125rem 0.25rem",borderRadius:"0.25rem"},children:"student_email"})]}),e.jsx("li",{children:"Maximum recommended: 1000 students per upload"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end",paddingTop:"1rem",borderTop:"1px solid #e5e7eb"},children:[e.jsx($,{to:"/dashboard/org-admin",children:e.jsx(S,{variant:"secondary",disabled:m,children:"Cancel"})}),e.jsx(S,{type:"submit",variant:"primary",disabled:m||!c||(d?!x:!g.trim()),children:m?"Processing...":d?"Upload & Enroll":`Enroll Students in ${l==="course"?"Course":"Track"}`})]})]})}),n&&e.jsxs(i,{variant:"elevated",padding:"large",style:{marginTop:"1.5rem",backgroundColor:"#f0fdf4",border:"1px solid #86efac"},children:[e.jsx(u,{level:"h3",style:{fontSize:"1.1rem",marginBottom:"1rem",color:"#166534"},children:"Enrollment Summary"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:"0.875rem",color:"#166534"},children:"Total Processed"}),e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"1.75rem",fontWeight:"bold",color:"#166534"},children:n.success_count+n.failed_count})]}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:"0.875rem",color:"#166534"},children:"Successful"}),e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"1.75rem",fontWeight:"bold",color:"#16a34a"},children:n.success_count})]}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:"0.875rem",color:"#166534"},children:"Failed"}),e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"1.75rem",fontWeight:"bold",color:"#dc2626"},children:n.failed_count})]}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:"0.875rem",color:"#166534"},children:"Success Rate"}),e.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"1.75rem",fontWeight:"bold",color:"#16a34a"},children:[Math.round(n.success_count/(n.success_count+n.failed_count)*100),"%"]})]})]})]})]})})};export{Z as BulkEnrollStudents};
//# sourceMappingURL=BulkEnrollStudents-C36bn3Cb.js.map
