import{j as e}from"./query-vendor-D-Supqfh.js";import{u as L,h as N,a as s}from"./react-vendor-DF6vRnOe.js";import{D as F}from"./DashboardLayout-CaOp3wDO.js";import{S as x,H as Q,C as p,B as k}from"./index-DcdZfoXS.js";import{I as q}from"./Input-BNgj3fzd.js";import{C as Y}from"./Checkbox-Hduur2ig.js";import{e as u}from"./enrollmentService-BWM4yX8Y.js";import{t as _}from"./trainingProgramService-DQ5PbW1s.js";import{u as G}from"./hooks-Dtke09KW.js";import"./state-vendor-CcNjB5Go.js";const re=()=>{const y=L(),[z]=N(),m=G(r=>r.user.profile),S=z.get("courseId"),[w,W]=s.useState([]),[R,j]=s.useState(!0),[l,T]=s.useState(S||""),[i,b]=s.useState(""),[a,c]=s.useState([]),[h,v]=s.useState(!1),[A,C]=s.useState([]),[o,E]=s.useState([]),[g,B]=s.useState(!1),[I,d]=s.useState(null),[P,f]=s.useState(null);s.useEffect(()=>{(async()=>{if(m?.id)try{j(!0);const t=await _.getTrainingPrograms({instructor_id:m.id,published:!0});W(t.data)}catch(t){console.error("Failed to load training programs:",t),d("Failed to load your training programs. Please refresh the page.")}finally{j(!1)}})()},[m?.id]),s.useEffect(()=>{(async()=>{if(l)try{const t=await u.getEnrolledStudents(l);C(t)}catch(t){console.error("Failed to load enrolled students:",t)}})()},[l]),s.useEffect(()=>{const t=setTimeout(async()=>{if(!i.trim()){c([]);return}try{v(!0);const n=await u.searchStudents(i);c(n)}catch(n){console.error("Failed to search students:",n),c([])}finally{v(!1)}},300);return()=>clearTimeout(t)},[i]);const $=r=>{E(t=>t.includes(r)?t.filter(n=>n!==r):[...t,r])},D=async r=>{if(r.preventDefault(),d(null),f(null),!l){d("Please select a course.");return}if(o.length===0){d("Please select at least one student to enroll.");return}try{B(!0);const t=await u.enrollStudents({courseId:l,studentIds:o}),n=t.failed?.length||0;n>0?f(`${t.enrolledCount} student(s) enrolled, ${n} failed.`):f(`Successfully enrolled ${t.enrolledCount} student(s)!`),E([]),b(""),c([]);const H=await u.getEnrolledStudents(l);C(H),setTimeout(()=>{y("/instructor/students")},2e3)}catch(t){console.error("Failed to enroll students:",t),d(t.response?.data?.message||t.message||"Failed to enroll students. Please try again.")}finally{B(!1)}};return R&&!S?e.jsx(F,{children:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(x,{size:"large"})})}):e.jsx(F,{children:e.jsxs("main",{style:{padding:"2rem",maxWidth:"900px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx(Q,{level:"h1",gutterBottom:!0,children:"Enroll Students"}),e.jsx("p",{style:{color:"#666",fontSize:"0.95rem"},children:"Search for students and enroll them in your training programs"})]}),I&&e.jsx(p,{variant:"outlined",padding:"medium",style:{marginBottom:"1.5rem",borderColor:"#ef4444",backgroundColor:"#fee2e2"},children:e.jsx("p",{style:{color:"#dc2626",margin:0,fontWeight:500},role:"alert",children:I})}),P&&e.jsx(p,{variant:"outlined",padding:"medium",style:{marginBottom:"1.5rem",borderColor:"#10b981",backgroundColor:"#d1fae5"},children:e.jsx("p",{style:{color:"#065f46",margin:0,fontWeight:500},role:"alert",children:P})}),e.jsx(p,{variant:"outlined",padding:"large",children:e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{htmlFor:"course",style:{display:"block",fontWeight:600,marginBottom:"0.5rem"},children:"Select Course"}),e.jsxs("select",{id:"course",value:l,onChange:r=>T(r.target.value),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem"},required:!0,children:[e.jsx("option",{value:"",children:"Choose a course..."}),w.map(r=>e.jsx("option",{value:r.id,children:r.title},r.id))]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{htmlFor:"search",style:{display:"block",fontWeight:600,marginBottom:"0.5rem"},children:"Search Students"}),e.jsx(q,{id:"search",type:"text",value:i,onChange:r=>b(r.target.value),placeholder:"Search students by name, email, or ID",disabled:!l}),!l&&e.jsx("p",{style:{fontSize:"0.875rem",color:"#666",marginTop:"0.5rem"},children:"Please select a course first"})]}),h&&e.jsx("div",{style:{textAlign:"center",padding:"2rem"},children:e.jsx(x,{size:"medium"})}),!h&&a.length>0&&e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsxs("p",{style:{fontWeight:600,marginBottom:"0.75rem"},children:["Search Results (",a.length,")"]}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",border:"1px solid #d1d5db",borderRadius:"0.375rem"},children:a.map(r=>{const t=A.includes(r.id),n=o.includes(r.id);return e.jsx("div",{style:{padding:"0.75rem 1rem",borderBottom:"1px solid #e5e7eb",backgroundColor:n?"#eff6ff":"white",opacity:t?.6:1},children:e.jsx(Y,{label:e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:r.name}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#666"},children:r.email}),t&&e.jsx("div",{style:{fontSize:"0.75rem",color:"#f59e0b",marginTop:"0.25rem"},children:"Already enrolled"})]}),checked:n,onChange:()=>$(r.id),disabled:t})},r.id)})})]}),!h&&i&&a.length===0&&e.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#666"},children:['No students found matching "',i,'"']}),o.length>0&&e.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1rem",backgroundColor:"#f3f4f6",borderRadius:"0.375rem"},children:[e.jsxs("p",{style:{fontWeight:600,marginBottom:"0.5rem"},children:["Selected Students: ",o.length]}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#666"},children:o.map(r=>{const t=a.find(n=>n.id===r);return t?e.jsxs("div",{style:{marginBottom:"0.25rem"},children:["â€¢ ",t.name," (",t.email,")"]},r):null})})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx(k,{type:"button",variant:"secondary",onClick:()=>y("/instructor/students"),disabled:g,children:"Cancel"}),e.jsx(k,{type:"submit",variant:"primary",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(x,{size:"small"}),"Enrolling..."]}):o.length>0?`Enroll ${o.length} Student${o.length!==1?"s":""}`:"Enroll Students"})]})]})})]})})};export{re as EnrollStudents};
//# sourceMappingURL=EnrollStudents-CqaQEuPU.js.map
