import{j as e}from"./query-vendor-D-Supqfh.js";import{a as s,L as c}from"./react-vendor-DF6vRnOe.js";import{D as b}from"./DashboardLayout-CaOp3wDO.js";import{S as k,H as F,B as m,C as a}from"./index-DcdZfoXS.js";import{I as L}from"./Input-BNgj3fzd.js";import{S as C}from"./Select-DYtXz80p.js";import{e as u}from"./enrollmentService-BWM4yX8Y.js";import{u as P}from"./hooks-Dtke09KW.js";import"./state-vendor-CcNjB5Go.js";const V=()=>{const p=P(t=>t.user.profile),[l,h]=s.useState([]),[x,f]=s.useState([]),[w,y]=s.useState(!0),[j,v]=s.useState(null),[o,z]=s.useState(""),[d,_]=s.useState("all"),[g,E]=s.useState("name");s.useEffect(()=>{(async()=>{if(p?.id)try{y(!0),v(null);const r=await u.getInstructorEnrollmentSummary(p.id),n=[];for(const i of r){const D=await u.getStudentEnrollments(i.student_id);n.push(...D)}h(n),f(n)}catch(r){console.error("Failed to load enrollments:",r),v("Failed to load student enrollments. Please try again.")}finally{y(!1)}})()},[p?.id]),s.useEffect(()=>{let t=[...l];if(d!=="all"&&(t=t.filter(r=>r.status===d)),o.trim()){const r=o.toLowerCase();t=t.filter(n=>n.student_name?.toLowerCase().includes(r)||n.student_email?.toLowerCase().includes(r)||n.course_title?.toLowerCase().includes(r))}t.sort((r,n)=>{switch(g){case"name":return(r.student_name||"").localeCompare(n.student_name||"");case"progress":return n.progress_percentage-r.progress_percentage;case"date":return new Date(n.enrollment_date).getTime()-new Date(r.enrollment_date).getTime();default:return 0}}),f(t)},[l,o,d,g]);const W=async(t,r)=>{try{await u.updateEnrollmentStatus(t,r),h(n=>n.map(i=>i.id===t?{...i,status:r}:i))}catch(n){console.error("Failed to update enrollment status:",n),alert("Failed to update enrollment status. Please try again.")}},A=async(t,r)=>{if(confirm(`Are you sure you want to unenroll ${r}?`))try{await u.unenrollStudent(t),h(n=>n.filter(i=>i.id!==t))}catch(n){console.error("Failed to unenroll student:",n),alert("Failed to unenroll student. Please try again.")}},B=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),S=t=>{switch(t){case"active":return"#10b981";case"completed":return"#3b82f6";case"dropped":return"#ef4444";case"pending":return"#f59e0b";default:return"#6b7280"}};return w?e.jsx(b,{children:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(k,{size:"large"})})}):e.jsx(b,{children:e.jsxs("main",{style:{padding:"2rem",maxWidth:"1400px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx(F,{level:"h1",gutterBottom:!0,children:"Manage Students"}),e.jsx("p",{style:{color:"#666",fontSize:"0.95rem"},children:"View and manage student enrollments across all your training programs"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[e.jsx(c,{to:"/instructor/students/enroll",children:e.jsx(m,{variant:"primary",children:"Enroll Students"})}),e.jsx(c,{to:"/dashboard/instructor",children:e.jsx(m,{variant:"secondary",children:"Back to Dashboard"})})]})]}),j&&e.jsx(a,{variant:"outlined",padding:"medium",style:{marginBottom:"1.5rem",borderColor:"#ef4444",backgroundColor:"#fee2e2"},children:e.jsx("p",{style:{color:"#dc2626",margin:0},children:j})}),e.jsx(a,{variant:"outlined",padding:"large",style:{marginBottom:"1.5rem"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:[e.jsx("div",{children:e.jsx(L,{id:"search",name:"search",type:"text",placeholder:"Search by name, email, or course...",value:o,onChange:t=>z(t.target.value)})}),e.jsx("div",{children:e.jsx(C,{id:"status",name:"status",value:d,onChange:t=>_(t),options:[{value:"all",label:"All Statuses"},{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"pending",label:"Pending"},{value:"dropped",label:"Dropped"}]})}),e.jsx("div",{children:e.jsx(C,{id:"sort",name:"sort",value:g,onChange:t=>E(t),options:[{value:"name",label:"Sort by Name"},{value:"progress",label:"Sort by Progress"},{value:"date",label:"Sort by Date"}]})})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"1.5rem"},children:[e.jsxs(a,{variant:"elevated",padding:"medium",children:[e.jsx("p",{style:{margin:0,fontSize:"0.85rem",color:"#666"},children:"Total Enrollments"}),e.jsx("p",{style:{margin:"0.5rem 0 0",fontSize:"2rem",fontWeight:"bold",color:"#1f2937"},children:l.length})]}),e.jsxs(a,{variant:"elevated",padding:"medium",children:[e.jsx("p",{style:{margin:0,fontSize:"0.85rem",color:"#666"},children:"Active Students"}),e.jsx("p",{style:{margin:"0.5rem 0 0",fontSize:"2rem",fontWeight:"bold",color:"#10b981"},children:l.filter(t=>t.status==="active").length})]}),e.jsxs(a,{variant:"elevated",padding:"medium",children:[e.jsx("p",{style:{margin:0,fontSize:"0.85rem",color:"#666"},children:"Completed"}),e.jsx("p",{style:{margin:"0.5rem 0 0",fontSize:"2rem",fontWeight:"bold",color:"#3b82f6"},children:l.filter(t=>t.status==="completed").length})]}),e.jsxs(a,{variant:"elevated",padding:"medium",children:[e.jsx("p",{style:{margin:0,fontSize:"0.85rem",color:"#666"},children:"Average Progress"}),e.jsxs("p",{style:{margin:"0.5rem 0 0",fontSize:"2rem",fontWeight:"bold",color:"#f59e0b"},children:[l.length>0?Math.round(l.reduce((t,r)=>t+r.progress_percentage,0)/l.length):0,"%"]})]})]}),e.jsx(a,{variant:"outlined",padding:"none",children:x.length===0?e.jsxs("div",{style:{padding:"3rem",textAlign:"center"},children:[e.jsx("p",{style:{fontSize:"1.1rem",color:"#666",marginBottom:"1rem"},children:o||d!=="all"?"No enrollments match your filters":"No student enrollments yet"}),e.jsx(c,{to:"/instructor/students/enroll",children:e.jsx(m,{variant:"primary",children:"Enroll Your First Students"})})]}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f9fafb",borderBottom:"2px solid #e5e7eb"},children:[e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontWeight:600,fontSize:"0.875rem"},children:"Student"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontWeight:600,fontSize:"0.875rem"},children:"Course"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontWeight:600,fontSize:"0.875rem"},children:"Progress"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontWeight:600,fontSize:"0.875rem"},children:"Status"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontWeight:600,fontSize:"0.875rem"},children:"Enrolled"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontWeight:600,fontSize:"0.875rem"},children:"Actions"})]})}),e.jsx("tbody",{children:x.map(t=>e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500,marginBottom:"0.25rem"},children:t.student_name||"Unknown Student"}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:t.student_email})]})}),e.jsx("td",{style:{padding:"1rem"},children:e.jsx(c,{to:`/courses/${t.course_id}`,style:{color:"#3b82f6",textDecoration:"none"},children:t.course_title||"Unknown Course"})}),e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{flex:1,height:"8px",backgroundColor:"#e5e7eb",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${t.progress_percentage}%`,backgroundColor:"#3b82f6",transition:"width 0.3s ease"}})}),e.jsxs("span",{style:{fontSize:"0.875rem",fontWeight:500},children:[t.progress_percentage,"%"]})]})}),e.jsx("td",{style:{padding:"1rem"},children:e.jsx("span",{style:{display:"inline-block",padding:"0.25rem 0.75rem",borderRadius:"9999px",fontSize:"0.75rem",fontWeight:600,textTransform:"capitalize",backgroundColor:`${S(t.status)}20`,color:S(t.status)},children:t.status})}),e.jsx("td",{style:{padding:"1rem",fontSize:"0.875rem",color:"#6b7280"},children:B(t.enrollment_date)}),e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsx(c,{to:`/instructor/students/${t.student_id}/analytics`,children:e.jsx(m,{variant:"secondary",size:"small",children:"View"})}),e.jsxs("select",{value:t.status,onChange:r=>W(t.id,r.target.value),style:{padding:"0.375rem 0.5rem",fontSize:"0.875rem",borderRadius:"0.375rem",border:"1px solid #d1d5db",backgroundColor:"white",cursor:"pointer"},children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"dropped",children:"Dropped"})]}),e.jsx(m,{variant:"danger",size:"small",onClick:()=>A(t.id,t.student_name||"this student"),children:"Unenroll"})]})})]},t.id))})]})})})]})})};export{V as ManageStudents};
//# sourceMappingURL=ManageStudents-DdAHOYso.js.map
