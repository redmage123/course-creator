<!-- Data Table Component - Reusable Table with Sorting -->
<div class="data-table-wrapper" role="region" aria-labelledby="table-{{id}}-caption" tabindex="0">
    <table class="data-table" id="table-{{id}}">
        <caption id="table-{{id}}-caption" class="sr-only">{{caption}}</caption>
        <thead>
            <tr>
                {{#each columns}}
                <th
                    scope="col"
                    class="{{#if sortable}}sortable{{/if}}"
                    data-sort="{{sortKey}}"
                    role="columnheader"
                    {{#if sortable}}
                    aria-sort="none"
                    tabindex="0"
                    {{/if}}
                >
                    <div class="table-header-content">
                        <span>{{label}}</span>
                        {{#if sortable}}
                        <i class="fas fa-sort sort-icon" aria-hidden="true"></i>
                        {{/if}}
                    </div>
                </th>
                {{/each}}
            </tr>
        </thead>
        <tbody>
            {{#if hasRows}}
            {{rows}}
            {{else}}
            <tr>
                <td colspan="{{columnCount}}" class="table-empty">
                    <div class="empty-state">
                        <i class="fas fa-inbox" aria-hidden="true"></i>
                        <p>{{emptyMessage}}</p>
                    </div>
                </td>
            </tr>
            {{/if}}
        </tbody>
    </table>
</div>

<style>
    .data-table-wrapper {
        overflow-x: auto;
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
        font-size: var(--text-sm);
    }

    .data-table thead {
        background: var(--gray-50);
        border-bottom: 2px solid var(--border);
    }

    .data-table th {
        padding: var(--space-4) var(--space-4);
        text-align: left;
        font-weight: var(--weight-semibold);
        color: var(--text-secondary);
        white-space: nowrap;
    }

    .data-table th.sortable {
        cursor: pointer;
        user-select: none;
        transition: all var(--transition-base);
    }

    .data-table th.sortable:hover {
        background: var(--gray-100);
        color: var(--primary-600);
    }

    .data-table th.sortable:focus {
        outline: 2px solid var(--primary-600);
        outline-offset: -2px;
    }

    .table-header-content {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        justify-content: space-between;
    }

    .sort-icon {
        font-size: var(--text-xs);
        color: var(--text-muted);
        transition: color var(--transition-base);
    }

    .data-table th.sorted-asc .sort-icon::before {
        content: "\f0de"; /* fa-sort-up */
        color: var(--primary-600);
    }

    .data-table th.sorted-desc .sort-icon::before {
        content: "\f0dd"; /* fa-sort-down */
        color: var(--primary-600);
    }

    .data-table tbody tr {
        border-bottom: 1px solid var(--border);
        transition: background var(--transition-base);
    }

    .data-table tbody tr:hover {
        background: var(--gray-50);
    }

    .data-table tbody tr:last-child {
        border-bottom: none;
    }

    .data-table td {
        padding: var(--space-4) var(--space-4);
        color: var(--text-primary);
    }

    .table-empty {
        padding: var(--space-12) var(--space-6);
    }

    .empty-state {
        text-align: center;
        color: var(--text-muted);
    }

    .empty-state i {
        font-size: var(--text-4xl);
        margin-bottom: var(--space-3);
        display: block;
        color: var(--gray-400);
    }

    .empty-state p {
        font-size: var(--text-base);
        margin: 0;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .data-table {
            font-size: var(--text-xs);
        }

        .data-table th,
        .data-table td {
            padding: var(--space-3) var(--space-3);
        }
    }
</style>

<script>
    // Table sorting functionality
    (function() {
        const tableId = 'table-{{id}}';
        const table = document.getElementById(tableId);
        if (!table) return;

        const headers = table.querySelectorAll('th.sortable');
        let currentSort = { column: null, direction: 'none' };

        headers.forEach(header => {
            header.addEventListener('click', () => sortTable(header));
            header.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    sortTable(header);
                }
            });
        });

        function sortTable(header) {
            const sortKey = header.dataset.sort;
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            // Determine sort direction
            let direction = 'asc';
            if (currentSort.column === sortKey) {
                direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            }

            // Remove sort classes from all headers
            headers.forEach(h => {
                h.classList.remove('sorted-asc', 'sorted-desc');
                h.setAttribute('aria-sort', 'none');
            });

            // Add sort class to current header
            header.classList.add(`sorted-${direction}`);
            header.setAttribute('aria-sort', direction === 'asc' ? 'ascending' : 'descending');

            // Sort rows
            const columnIndex = Array.from(header.parentElement.children).indexOf(header);
            rows.sort((a, b) => {
                const aValue = a.children[columnIndex]?.textContent.trim() || '';
                const bValue = b.children[columnIndex]?.textContent.trim() || '';

                // Try numeric comparison first
                const aNum = parseFloat(aValue.replace(/[^0-9.-]/g, ''));
                const bNum = parseFloat(bValue.replace(/[^0-9.-]/g, ''));

                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return direction === 'asc' ? aNum - bNum : bNum - aNum;
                }

                // Fall back to string comparison
                return direction === 'asc'
                    ? aValue.localeCompare(bValue)
                    : bValue.localeCompare(aValue);
            });

            // Re-append sorted rows
            rows.forEach(row => tbody.appendChild(row));

            // Update current sort state
            currentSort = { column: sortKey, direction };
        }
    })();
</script>
