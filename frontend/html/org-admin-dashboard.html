<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../css/modern-ui/modern-ui.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organization Administration - Course Creator</title>
    <!-- Tami UI Feature Flag (must load first) -->
    
    <!-- Base styles -->
    <link rel="stylesheet" href="../css/base/reset.css">
    <link rel="stylesheet" href="../css/base/variables.css">
    <link rel="stylesheet" href="../css/base/typography.css">
    <!-- Utilities - SOLID Single Responsibility -->
    <link rel="stylesheet" href="../css/utilities.css">
    <!-- Components - SOLID Open/Closed -->
    <link rel="stylesheet" href="../css/components/dashboard-common.css">
    <link rel="stylesheet" href="../css/components/project-wizard.css">
    <link rel="stylesheet" href="../css/components/buttons.css">
    <link rel="stylesheet" href="../css/components/forms.css">
    <link rel="stylesheet" href="../css/components/modals.css">
    <link rel="stylesheet" href="../css/components/rbac-dashboard.css">
    <!-- Legacy/Feature specific -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/drag-drop.css">
    <link rel="stylesheet" href="../css/file-explorer.css">
    <link rel="stylesheet" href="../css/help-system.css">
    <!-- Tami UI System -->
    
    
    
    
    
    <style>
        /* Anti-blur fixes for all text and animations */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Prevent blur on transformed/animated elements */
        .tab-btn,
        .stat-card,
        .card,
        .project-card,
        .modal,
        .notification {
            backface-visibility: hidden;
            transform-style: preserve-3d;
        }

        /* Modal without backdrop - just the content box */
        .modal-no-backdrop {
            display: none;
            position: fixed;
            z-index: 1000;
        }

        .modal-no-backdrop.show {
            display: flex !important;
        }

        .org-admin-container {
            display: flex;
            min-height: 100vh;
            background-color: var(--background-color);
        }

        .sidebar {
            width: 280px;
            background: var(--card-background);
            border-right: 1px solid var(--border-color);
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
        }

        .org-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center !important;
        }

        .org-header h1 {
            text-align: center !important;
        }

        .org-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-background);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            display: block;
        }

        .tab-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-btn {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        .data-table tr:hover {
            background: var(--hover-color);
        }

        .action-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 0.25rem;
            font-size: 0.875rem;
        }

        .btn-edit {
            background: var(--warning-color);
            color: white;
        }

        .btn-delete {
            background: var(--error-color);
            color: white;
        }

        .btn-add {
            background: var(--success-color);
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--card-background);
            margin: 5% auto;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            position: relative;
        }

        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .role-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .role-org-admin {
            background: var(--primary-color);
            color: white;
        }

        .role-instructor {
            background: var(--info-color);
            color: white;
        }

        .role-student {
            background: var(--secondary-color);
            color: white;
        }

        .status-active {
            color: var(--success-color);
            font-weight: 600;
        }

        .status-inactive {
            color: var(--error-color);
            font-weight: 600;
        }

        .project-card {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .project-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .project-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-draft {
            background: var(--warning-color);
            color: white;
        }

        .status-active {
            background: var(--success-color);
            color: white;
        }

        .status-completed {
            background: var(--info-color);
            color: white;
        }

        .target-roles {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .role-tag {
            background: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        /* Project Creation Step Styles */
        .project-creation-steps {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }

        /* Progress tracker hidden state */
        .project-creation-steps.wizard-progress-hidden {
            display: none !important;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
        }

        .step {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: var(--background-color);
            border: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .step.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .step.completed {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .project-step {
            display: none;
        }

        .project-step.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* AI Suggestions Styles */
        .ai-suggestions {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .insights-container,
        .tracks-container,
        .objectives-container {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-color);
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 1rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Track Templates Styles */
        .track-templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }

        .track-template-card {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .track-template-card:hover {
            transform: translateY(-2px) translateZ(0);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }

        .track-template-card.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.05), rgba(var(--primary-color-rgb), 0.1));
        }

        .track-template-card.selected::after {
            content: '‚úì';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--success-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: bold;
        }

        .track-category {
            display: inline-block;
            background: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .track-duration {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .selected-tracks {
            background: var(--hover-color);
            border-radius: 8px;
            padding: 1rem;
        }

        .selected-track-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            border-left: 4px solid var(--primary-color);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Enhanced Modal Styles */
        .assignment-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .assignment-tab-content {
            display: none;
        }

        .assignment-tab-content.active {
            display: block;
        }

        .analytics-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }

        .analytics-summary .stat-card {
            background: linear-gradient(135deg, var(--card-background), var(--hover-color));
            border-left: 4px solid var(--primary-color);
        }

        .instructor-assignment-item {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .instructor-assignment-item h4 {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
        }

        .instructor-selector {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 1rem;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .assigned-instructors {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .instructor-tag {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .instructor-tag .remove-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .student-item {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .student-item:hover {
            background: var(--hover-color);
            border-color: var(--primary-color);
        }

        .student-item.selected {
            background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.1), rgba(var(--primary-color-rgb), 0.2));
            border-color: var(--primary-color);
        }

        .student-info {
            display: flex;
            flex-direction: column;
        }

        .student-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .student-email {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .enrollment-status {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-enrolled {
            background: var(--success-color);
            color: white;
        }

        .status-not-enrolled {
            background: var(--text-muted);
            color: white;
        }

        .ai-processing-section {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 4px solid var(--info-color);
        }

        .project-details-summary {
            background: var(--hover-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .project-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            font-size: 1rem;
            color: var(--text-color);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%) translateZ(0);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0) translateZ(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .org-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 1rem;
            }

            .step-indicator {
                flex-direction: column;
                gap: 0.5rem;
            }

            .track-templates-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Logo Upload Styles */
        .logo-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: var(--hover-color);
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(var(--primary-color-rgb), 0.1);
        }

        .logo-upload-area.dragover {
            border-color: var(--primary-color);
            background: rgba(var(--primary-color-rgb), 0.2);
        }

        .upload-content {
            pointer-events: none;
        }

        .upload-content i {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            display: block;
        }

        .upload-link {
            color: var(--primary-color);
            text-decoration: underline;
            cursor: pointer;
        }

        .file-types {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin: 0.5rem 0 0 0;
        }

        .form-help {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
            display: block;
        }

        .btn-link {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            text-decoration: underline;
            padding: 0;
        }

        .btn-link:hover {
            color: var(--secondary-color);
        }

        .required::after {
            content: ' *';
            color: var(--error-color);
        }

        .phone-input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .country-select {
            flex-shrink: 0;
        }

        /* Quick Actions Cards */
        .action-card {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .action-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }

        .action-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .action-content h4 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .action-content p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.4;
        }

        /* Floating Action Button (FAB) */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            z-index: 999;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* FAB Menu */
        .fab-menu {
            position: fixed;
            bottom: 5rem;
            right: 2rem;
            display: none;
            flex-direction: column;
            gap: 0.75rem;
            z-index: 998;
        }

        .fab-menu.active {
            display: flex;
        }

        .fab-menu-item {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 30px;
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
        }

        .fab-menu-item:hover {
            background: var(--primary-color);
            color: white;
            transform: translateX(-5px);
        }

        .fab-menu-item i {
            width: 20px;
            text-align: center;
        }

        /* Project Type Selection Styles */
        .project-type-option {
            transition: all 0.2s ease;
        }

        .project-type-option:hover {
            border-color: var(--primary-color) !important;
            background: rgba(var(--primary-color-rgb, 65, 105, 225), 0.05) !important;
        }

        .project-type-option input[type="radio"]:checked + div {
            color: var(--primary-color);
        }

        .project-type-option:has(input[type="radio"]:checked) {
            border-color: var(--primary-color) !important;
            background: rgba(var(--primary-color-rgb, 65, 105, 225), 0.08) !important;
            box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb, 65, 105, 225), 0.1);
        }
    </style>
    <!-- Security: DOMPurify for XSS protection -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div aria-live="polite" aria-atomic="true" class="sr-only" id="form-announcements"></div>
    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-overlay">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading dashboard...</p>
        </div>
    </div>

    <div class="org-admin-container">
        <!-- Sidebar -->
        <!-- Tami Navigation Sidebar -->
        <nav class="sidebar" role="navigation" aria-label="Main navigation" data-sidebar data-collapsed="false" data-mobile-open="false">
            <!-- Collapse Toggle Button -->
            <button data-sidebar-toggle aria-label="Toggle sidebar" title="Collapse/Expand Sidebar">
                ‚ò∞
            </button>

            <!-- Hamburger Menu (Mobile) -->
            <button data-hamburger aria-label="Toggle mobile menu">
                <span></span>
                <span></span>
                <span></span>
            </button>

            <div class="sidebar__header">
                <h2 class="sidebar__title">Organization Admin</h2>

                <a href="../index.html" class="sidebar__home-link" data-nav-item>
                    <span data-nav-icon>‚Üê</span>
                    <span data-nav-text>Back to Home</span>
                </a>

                <div class="org-info">
                    <h4 id="organizationName" class="org-info__name">Loading...</h4>
                    <p id="organizationDomain" class="org-info__domain"></p>
                </div>

                <!-- Navigation Items with Tami attributes -->
                <a href="#overview" class="nav-link active" data-tab="overview" data-nav-item data-active="true" aria-current="page">
                    <span data-nav-icon>üìä</span>
                    <span data-nav-text>Overview</span>
                </a>

                <a href="#projects" class="nav-link" data-tab="projects" data-nav-item data-active="false">
                    <span data-nav-icon>üéØ</span>
                    <span data-nav-text>Projects</span>
                </a>

                <a href="#courses" class="nav-link" data-tab="courses" data-nav-item data-active="false">
                    <span data-nav-icon>üìö</span>
                    <span data-nav-text>Courses</span>
                </a>

                <a href="#instructors" class="nav-link" data-tab="instructors" data-nav-item data-active="false">
                    <span data-nav-icon>üë®‚Äçüè´</span>
                    <span data-nav-text>Instructors</span>
                </a>

                <a href="#students" class="nav-link" data-tab="students" data-nav-item data-active="false">
                    <span data-nav-icon>üë•</span>
                    <span data-nav-text>Students</span>
                </a>

                <a href="#tracks" id="tracksTab" class="nav-link" data-tab="tracks" data-nav-item data-active="false">
                    <span data-nav-icon>üéì</span>
                    <span data-nav-text">Tracks</span>
                </a>

                <a href="#locations" id="locationsTab" class="nav-link" data-tab="locations" data-nav-item data-active="false">
                    <span data-nav-icon>üìç</span>
                    <span data-nav-text>Locations</span>
                </a>

                <a href="#schedules" id="schedulesTab" class="nav-link" data-tab="schedules" data-nav-item data-active="false">
                    <span data-nav-icon>üìÖ</span>
                    <span data-nav-text>Schedules</span>
                </a>

                <a href="#files" class="nav-link" data-tab="files" data-nav-item data-active="false">
                    <span data-nav-icon>üìÅ</span>
                    <span data-nav-text>Files</span>
                </a>

                <a href="#settings" class="nav-link" data-tab="settings" data-nav-item data-active="false">
                    <span data-nav-icon>‚öôÔ∏è</span>
                    <span data-nav-text>Settings</span>
                </a>

                <!-- Logout Button -->
                <button onclick="logout()" class="sidebar__logout-button" data-nav-item>
                    <span data-nav-icon>üö™</span>
                    <span data-nav-text>Logout</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main role="main" class="main-content">
            <!-- Organization Header -->
            <div class="org-header text-center cursor-pointer" onclick="document.querySelector('[data-tab=overview]').click()" title="Click to return to overview">
                <h1 id="orgTitle">Organization Dashboard</h1>
            </div>

            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="org-stats">
                    <div class="stat-card cursor-pointer" onclick="document.querySelector('[data-tab=projects]').click()" title="Click to view all projects">
                        <span class="stat-number" id="totalProjects">0</span>
                        <span>Active Projects</span>
                    </div>
                    <div class="stat-card cursor-pointer" onclick="document.querySelector('[data-tab=instructors]').click()" title="Click to view all instructors">
                        <span class="stat-number" id="totalInstructors">0</span>
                        <span>Instructors</span>
                    </div>
                    <div class="stat-card cursor-pointer" onclick="document.querySelector('[data-tab=students]').click()" title="Click to view all students">
                        <span class="stat-number" id="totalStudents">0</span>
                        <span>Total Students</span>
                    </div>
                    <div class="stat-card cursor-pointer" onclick="document.querySelector('[data-tab=tracks]').click()" title="Click to view all tracks">
                        <span class="stat-number" id="totalTracks">0</span>
                        <span>Learning Tracks</span>
                    </div>
                    <div class="stat-card cursor-pointer" onclick="document.querySelector('[data-tab=projects]').click()" title="Click to view courses in projects">
                        <span class="stat-number" id="totalCourses">0</span>
                        <span>Courses</span>
                    </div>
                </div>

                <!-- Quick Actions Section -->
                <div class="quick-actions-section my-xl">
                    <h3 class="mb-md">Quick Actions</h3>
                    <div class="grid-auto-fit-250 gap-md">
                        <div class="action-card cursor-pointer" onclick="showCreateProjectModal()">
                            <div class="action-icon action-icon-gradient-purple">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                            <div class="action-content">
                                <h4>Create New Project</h4>
                                <p>Start a new training project for your organization</p>
                            </div>
                        </div>

                        <div class="action-card cursor-pointer" onclick="showAddInstructorModal()">
                            <div class="action-icon action-icon-gradient-pink">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <div class="action-content">
                                <h4>Add Instructor</h4>
                                <p>Invite instructors to your organization</p>
                            </div>
                        </div>

                        <div class="action-card cursor-pointer" onclick="showAddStudentModal()">
                            <div class="action-icon action-icon-gradient-blue">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="action-content">
                                <h4>Add Student</h4>
                                <p>Add new students to your organization</p>
                            </div>
                        </div>

                        <div class="action-card cursor-pointer" onclick="document.querySelector('[data-tab=settings]').click()">
                            <div class="action-icon action-icon-gradient-orange">
                                <i class="fas fa-cog"></i>
                            </div>
                            <div class="action-content">
                                <h4>Organization Settings</h4>
                                <p>Manage organization configuration and preferences</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-xl" style="align-items: start;">
                    <div>
                        <h3 style="margin-top: 0;">Recent Projects</h3>
                        <div id="recentProjects">
                            <!-- Recent projects will be loaded here -->
                        </div>
                    </div>
                    <div>
                        <h3 style="margin-top: 0;">Recent Activity</h3>
                        <div id="recentActivity">
                            <!-- Recent activity will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projects Tab -->
            <div id="projects" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">Training Projects</h2>
                    <div class="tab-section-header__actions">
                        <select id="projectStatusFilter" onchange="filterProjects()" class="p-sm form-select">
                            <option value="">All Status</option>
                            <option value="draft">Draft</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                        </select>
                        <button class="btn btn-outline" onclick="window.OrgAdmin.Projects.showDraftsList()" title="Continue editing a saved draft">
                            üìÇ Continue from Draft
                        </button>
                        <button id="createProjectBtn" class="btn btn-primary" onclick="showCreateProjectModal()">
                            ‚ûï Create Project
                        </button>
                    </div>
                </div>

                <table class="data-table" id="projectsTable">
                    <thead>
                        <tr>
                            <th>Project</th>
                            <th>Status</th>
                            <th>Duration</th>
                            <th>Tracks</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="projectsTableBody">
                        <!-- Project data will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Courses Tab -->
            <div id="courses" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">AI-Generated Courses</h2>
                    <button class="btn btn-primary" id="generateCourseBtn" onclick="showGenerateCourseModal()">
                        ü§ñ Generate Course with AI
                    </button>
                </div>

                <!-- Course Generation Status -->
                <div id="courseGenerationStatus" class="hidden alert-info">
                    <div class="flex-center gap-md">
                        <div class="loading-spinner spinner-sm spinner-light"></div>
                        <div>
                            <strong>Generating Course...</strong>
                            <p class="mt-xs text-sm">AI is creating your course syllabus. This may take a moment.</p>
                        </div>
                    </div>
                </div>

                <!-- Courses Grid -->
                <div id="coursesGrid" class="grid-auto-fit-350 gap-lg">
                    <!-- Course cards will be loaded here -->
                    <div class="empty-state">
                        <p class="text-xl mb-md">üìö No courses generated yet</p>
                        <p>Click "Generate Course with AI" to create your first course.</p>
                    </div>
                </div>
            </div>

            <!-- Instructors Tab -->
            <div id="instructors" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">Instructors</h2>
                    <button class="btn btn-primary" onclick="showAddInstructorModal()">
                        ‚ûï Add Instructor
                    </button>
                </div>

                <table class="data-table" id="instructorsTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Joined</th>
                            <th>Last Login</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="instructorsTableBody">
                        <!-- Instructor data will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Students Tab -->
            <div id="students" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">Organization Students</h2>
                    <button class="btn btn-primary" onclick="showAddStudentModal()">
                        ‚ûï Add Student
                    </button>
                </div>

                <table class="data-table" id="studentsTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Projects Enrolled</th>
                            <th>Joined</th>
                            <th>Last Active</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody">
                        <!-- Student data will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Tracks Tab -->
            <div id="tracks" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">Learning Tracks</h2>
                    <button id="createTrackBtn" class="btn btn-primary" onclick="showCreateTrackModal()">
                        ‚ûï Create New Track
                    </button>
                </div>

                <!-- Filters -->
                <div class="toolbar mb-2xl">
                    <div class="toolbar__filters">
                        <select id="trackProjectFilter" onchange="loadTracks()" class="p-sm form-select">
                            <option value="">All Projects</option>
                            <!-- Project options will be populated here -->
                        </select>
                        <select id="trackStatusFilter" onchange="loadTracks()" class="p-sm form-select">
                            <option value="">All Statuses</option>
                            <option value="draft">Draft</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="archived">Archived</option>
                        </select>
                        <select id="trackDifficultyFilter" onchange="loadTracks()" class="p-sm form-select">
                            <option value="">All Difficulty Levels</option>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                        <input type="text" id="trackSearchInput" placeholder="Search tracks..."
                               onkeyup="loadTracks()" class="flex-1 p-sm form-input">
                    </div>
                </div>

                <!-- Tracks Table -->
                <table class="data-table" id="tracksTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Project</th>
                            <th>Difficulty</th>
                            <th>Duration</th>
                            <th>Students</th>
                            <th>Instructors</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tracksTableBody">
                        <!-- Track data will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Locations Tab -->
            <div id="locations" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">Locations Management</h2>
                    <div class="text-sm text-muted">
                        Manage locations instances and their custom tracks
                    </div>
                    <button id="createLocationBtn" class="btn btn-primary btn-sm">
                        + Create Locations
                    </button>
                </div>

                <!-- Locations Table -->
                <table class="data-table" id="locationsTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Country</th>
                            <th>City</th>
                            <th>Start Date</th>
                            <th>Status</th>
                            <th>Participants</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="locationsTableBody">
                        <!-- Locations data will be loaded here -->
                    </tbody>
                </table>

                <!-- Locations Tracks Section (nested CRUD for tracks at locations level) -->
                <div id="locationTracksSection" class="mt-lg" style="display: none;">
                    <div class="tab-section-header">
                        <h3 class="tab-section-header__title">Locations Tracks</h3>
                        <div class="text-sm text-muted">
                            Custom tracks for <span id="currentLocationName">this locations</span>
                        </div>
                        <button id="createTrackAtLocationBtn" class="btn btn-primary btn-sm">
                            + Create Track
                        </button>
                    </div>

                    <table class="data-table" id="locationTracksTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Difficulty</th>
                                <th>Duration</th>
                                <th>Max Students</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="locationTracksTableBody">
                            <!-- Track data for current locations will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Schedules Tab -->
            <div id="schedules" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">Course Scheduling</h2>
                    <div class="text-sm text-muted">
                        Schedule courses with instructors at specific times and locations
                    </div>
                    <button id="createScheduleBtn" class="btn btn-primary">
                        + Create Schedule
                    </button>
                </div>

                <!-- Schedule Filters -->
                <div class="schedule-filters" style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                    <div class="filter-group">
                        <label for="instructorFilter" style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem;">Instructor</label>
                        <select id="instructorFilter" class="form-control" style="min-width: 200px;">
                            <option value="">All Instructors</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="courseFilter" style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem;">Course</label>
                        <select id="courseFilter" class="form-control" style="min-width: 200px;">
                            <option value="">All Courses</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="locationFilter" style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem;">Locations</label>
                        <select id="locationFilter" class="form-control" style="min-width: 200px;">
                            <option value="">All Locations</option>
                        </select>
                    </div>
                </div>

                <!-- Calendar View Controls -->
                <div class="calendar-controls" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div class="view-toggle" style="display: flex; gap: 0.5rem;">
                        <button id="weeklyViewBtn" class="btn btn-sm btn-secondary active">Weekly</button>
                        <button id="monthlyViewBtn" class="btn btn-sm btn-secondary">Monthly</button>
                    </div>
                    <div class="calendar-navigation" style="display: flex; align-items: center; gap: 1rem;">
                        <button id="prevPeriodBtn" class="btn btn-sm btn-secondary">&larr; Previous</button>
                        <h3 id="currentPeriodLabel" style="margin: 0; font-size: 1.125rem;">Week of Jan 1, 2025</h3>
                        <button id="nextPeriodBtn" class="btn btn-sm btn-secondary">Next &rarr;</button>
                        <button id="todayBtn" class="btn btn-sm btn-primary">Today</button>
                    </div>
                </div>

                <!-- Calendar Grid -->
                <div id="scheduleCalendar" class="schedule-calendar">
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar content will be dynamically generated -->
                        <div class="loading-spinner"></div>
                        <p class="text-center">Loading calendar...</p>
                    </div>
                </div>

                <style>
                    .schedule-calendar {
                        background: var(--card-background);
                        border: 1px solid var(--border-color);
                        border-radius: 8px;
                        padding: 1.5rem;
                        min-height: 600px;
                    }

                    .calendar-grid {
                        display: grid;
                        grid-template-columns: 80px repeat(7, 1fr);
                        grid-template-rows: auto repeat(24, 60px);
                        gap: 1px;
                        background: var(--border-color);
                        border: 1px solid var(--border-color);
                    }

                    .calendar-header-cell {
                        background: var(--surface-color);
                        padding: 1rem 0.5rem;
                        text-align: center;
                        font-weight: 600;
                        border-bottom: 2px solid var(--primary-color);
                    }

                    .calendar-time-cell {
                        background: var(--surface-color);
                        padding: 0.5rem;
                        text-align: center;
                        font-size: 0.875rem;
                        color: var(--text-muted);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }

                    .calendar-day-cell {
                        background: white;
                        position: relative;
                        min-height: 60px;
                    }

                    .calendar-day-cell:hover {
                        background: var(--hover-color, #f5f5f5);
                    }

                    .schedule-item {
                        position: absolute;
                        left: 4px;
                        right: 4px;
                        background: var(--primary-color);
                        color: white;
                        padding: 0.5rem;
                        border-radius: 4px;
                        font-size: 0.75rem;
                        overflow: hidden;
                        cursor: pointer;
                        transition: all 0.2s ease;
                    }

                    .schedule-item:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                        z-index: 10;
                    }

                    .schedule-item.schedule-conflict {
                        background: var(--error-color, #dc3545);
                        border: 2px solid #a71d2a;
                    }

                    .schedule-item-title {
                        font-weight: 600;
                        margin-bottom: 0.25rem;
                    }

                    .schedule-item-time {
                        font-size: 0.7rem;
                        opacity: 0.9;
                    }

                    .schedule-filters {
                        background: var(--surface-color);
                        padding: 1rem;
                        border-radius: 8px;
                        border: 1px solid var(--border-color);
                    }

                    .view-toggle .btn.active {
                        background: var(--primary-color);
                        color: white;
                    }

                    .conflict-indicator {
                        position: absolute;
                        top: 4px;
                        right: 4px;
                        width: 8px;
                        height: 8px;
                        background: #ff0000;
                        border-radius: 50%;
                        animation: pulse 2s infinite;
                    }

                    @keyframes pulse {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.5; }
                    }
                </style>
            </div>

            <!-- Files Tab -->
            <div id="files" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">Organization Files</h2>
                    <div class="text-sm text-muted">
                        Manage course materials, documents, and assets
                    </div>
                </div>

                <!-- File Explorer Widget Container -->
                <div id="orgFileExplorerContainer"></div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <h2>Organization Settings</h2>

                <div class="grid grid-cols-2 gap-xl">
                    <div class="grid-col-full">
                        <h3>Organization Information</h3>
                        <form id="orgSettingsForm" class="grid grid-cols-2 gap-md">
                            <div class="form-group">
                                <label for="orgNameSetting" class="form-label required">Organization Name</label>
                                <input type="text" id="orgNameSetting" name="name" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="orgSlugSetting" class="form-label">Organization ID (URL Slug)</label>
                                <input type="text" id="orgSlugSetting" name="slug" class="form-input" readonly
                                       title="Organization ID cannot be changed after creation">
                            </div>
                            <div class="form-group grid-col-full">
                                <label for="orgDescriptionSetting" class="form-label">Description</label>
                                <textarea id="orgDescriptionSetting" name="description" rows="3" class="form-input"></textarea>
                            </div>
                            <div class="form-group grid-col-full">
                                <label for="orgStreetAddressSetting" class="form-label">Street Address</label>
                                <input type="text" id="orgStreetAddressSetting" name="street_address" class="form-input"
                                       maxlength="255" placeholder="Street number and name">
                            </div>
                            <div class="form-group">
                                <label for="orgCitySetting" class="form-label">City</label>
                                <input type="text" id="orgCitySetting" name="city" class="form-input"
                                       maxlength="100" placeholder="City name">
                            </div>
                            <div class="form-group">
                                <label for="orgStateProvinceSetting" class="form-label">State / Province</label>
                                <select id="orgStateProvinceSetting" name="state_province" class="form-select">
                                    <option value="N/A">N/A (Non-US)</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CA">California</option>
                                    <option value="CO">Colorado</option>
                                    <option value="CT">Connecticut</option>
                                    <option value="DE">Delaware</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="HI">Hawaii</option>
                                    <option value="ID">Idaho</option>
                                    <option value="IL">Illinois</option>
                                    <option value="IN">Indiana</option>
                                    <option value="IA">Iowa</option>
                                    <option value="KS">Kansas</option>
                                    <option value="KY">Kentucky</option>
                                    <option value="LA">Louisiana</option>
                                    <option value="ME">Maine</option>
                                    <option value="MD">Maryland</option>
                                    <option value="MA">Massachusetts</option>
                                    <option value="MI">Michigan</option>
                                    <option value="MN">Minnesota</option>
                                    <option value="MS">Mississippi</option>
                                    <option value="MO">Missouri</option>
                                    <option value="MT">Montana</option>
                                    <option value="NE">Nebraska</option>
                                    <option value="NV">Nevada</option>
                                    <option value="NH">New Hampshire</option>
                                    <option value="NJ">New Jersey</option>
                                    <option value="NM">New Mexico</option>
                                    <option value="NY">New York</option>
                                    <option value="NC">North Carolina</option>
                                    <option value="ND">North Dakota</option>
                                    <option value="OH">Ohio</option>
                                    <option value="OK">Oklahoma</option>
                                    <option value="OR">Oregon</option>
                                    <option value="PA">Pennsylvania</option>
                                    <option value="RI">Rhode Island</option>
                                    <option value="SC">South Carolina</option>
                                    <option value="SD">South Dakota</option>
                                    <option value="TN">Tennessee</option>
                                    <option value="TX">Texas</option>
                                    <option value="UT">Utah</option>
                                    <option value="VT">Vermont</option>
                                    <option value="VA">Virginia</option>
                                    <option value="WA">Washington</option>
                                    <option value="WV">West Virginia</option>
                                    <option value="WI">Wisconsin</option>
                                    <option value="WY">Wyoming</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="orgPostalCodeSetting" class="form-label">Postal Code</label>
                                <input type="text" id="orgPostalCodeSetting" name="postal_code" class="form-input"
                                       maxlength="20" placeholder="ZIP or postal code">
                            </div>
                            <div class="form-group">
                                <label for="orgCountrySetting" class="form-label">Country</label>
                                <select id="orgCountrySetting" name="country" class="form-select">
                                    <option value="US">üá∫üá∏ United States</option>
                                    <option value="CA">üá®üá¶ Canada</option>
                                    <option value="GB">üá¨üáß United Kingdom</option>
                                    <option value="AU">üá¶üá∫ Australia</option>
                                    <option value="DE">üá©üá™ Germany</option>
                                    <option value="FR">üá´üá∑ France</option>
                                    <option value="ES">üá™üá∏ Spain</option>
                                    <option value="IT">üáÆüáπ Italy</option>
                                    <option value="MX">üá≤üáΩ Mexico</option>
                                    <option value="BR">üáßüá∑ Brazil</option>
                                    <option value="IN">üáÆüá≥ India</option>
                                    <option value="JP">üáØüáµ Japan</option>
                                    <option value="CN">üá®üá≥ China</option>
                                    <option value="KR">üá∞üá∑ South Korea</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="orgContactEmailSetting" class="form-label required">Contact Email</label>
                                <input type="email" id="orgContactEmailSetting" name="contact_email" class="form-input" required
                                       placeholder="contact@organization.com">
                                <small class="form-help">Professional email address for organization</small>
                            </div>
                            <div class="form-group">
                                <label for="orgContactPhoneSetting" class="form-label required">Contact Phone</label>
                                <div class="phone-input-group">
                                    <select id="orgContactPhoneCountry" class="country-select form-select w-120">
                                        <option value="+1" data-country="US">üá∫üá∏ US (+1)</option>
                                        <option value="+44" data-country="GB">üá¨üáß UK (+44)</option>
                                        <option value="+33" data-country="FR">üá´üá∑ France (+33)</option>
                                        <option value="+49" data-country="DE">üá©üá™ Germany (+49)</option>
                                        <option value="+61" data-country="AU">üá¶üá∫ Australia (+61)</option>
                                        <option value="+81" data-country="JP">üáØüáµ Japan (+81)</option>
                                        <!-- Add more countries as needed -->
                                    </select>
                                    <input type="tel" id="orgContactPhoneSetting" name="contact_phone" required
                                           placeholder="555-123-4567" class="flex-1 ml-sm form-input">
                                </div>
                                <small class="form-help">Professional business phone number</small>
                            </div>
                            <div class="form-group">
                                <label for="orgDomainSetting" class="form-label">Website URL</label>
                                <input type="url" id="orgDomainSetting" name="domain"
                                       placeholder="https://organization.com" class="form-input">
                                <small class="form-help">Organization website URL (must start with http:// or https://)</small>
                            </div>
                            <div class="form-group">
                                <label for="orgLogoSetting" class="form-label">Logo URL</label>
                                <input type="url" id="orgLogoSetting" name="logo_url"
                                       placeholder="https://organization.com/logo.png" class="form-input">
                                <small class="form-help">Direct link to organization logo</small>
                            </div>
                            <div class="form-group grid-col-full">
                                <h4 class="text-primary my-2">Logo Upload</h4>
                                <div class="logo-upload-area" id="logoUploadAreaSettings">
                                    <div class="upload-content">
                                        <div class="text-2xl mb-md">üì§</div>
                                        <p>Drag & drop logo here or <span class="upload-link">click to browse</span></p>
                                        <p class="file-types">JPG, PNG, GIF (max 5MB)</p>
                                    </div>
                                    <input type="file" id="orgLogoFile" accept=".jpg,.jpeg,.png,.gif" hidden>
                                </div>
                                <div id="logoPreview" class="hidden mt-md">
                                    <img id="logoPreviewImg" class="logo-preview-img">
                                    <button type="button" id="removeLogo" class="btn-text-error ml-md">
                                        ‚ùå Remove
                                    </button>
                                </div>
                            </div>
                            <div class="form-group grid-col-full mt-md">
                                <button type="submit" class="btn btn-primary" id="saveOrgSettingsBtn">
                                    üíæ Save Organization Information
                                </button>
                                <button type="button" class="btn btn-secondary ml-md" id="cancelOrgSettingsBtn">
                                    ‚ùå Cancel Changes
                                </button>
                            </div>
                        </form>
                    </div>
                    <div>
                        <h3>Preferences</h3>
                        <form id="orgPreferencesForm">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="autoAssignByDomain" name="auto_assign_by_domain">
                                    Auto-assign users by email domain
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="enableProjectTemplates" name="enable_project_templates">
                                    Enable project templates
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="enableCustomBranding" name="enable_custom_branding">
                                    Enable custom branding
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Preferences</button>
                        </form>
                    </div>
                </div>

                <!-- Target Roles Management Section -->
                <div class="section-divider">
                    <h3>Target Roles Management</h3>
                    <p class="text-muted mb-xl">
                        Manage the list of available target roles for projects. These roles will appear in the dropdown when creating new projects.
                    </p>

                    <div class="grid-2fr-1fr">
                        <!-- Current Roles List -->
                        <div>
                            <h4>Current Target Roles</h4>
                            <div id="targetRolesList" class="card-role-list">
                                <!-- Roles will be populated here -->
                            </div>
                        </div>

                        <!-- Add New Role -->
                        <div>
                            <h4>Add New Role</h4>
                            <form id="addTargetRoleForm" class="card-bordered">
                                <div class="form-group">
                                    <label for="newTargetRole" class="form-label">Role Name</label>
                                    <input type="text" id="newTargetRole" placeholder="e.g., Frontend Developer" required
                                           class="form-input-full">
                                </div>
                                <button type="submit" class="btn btn-primary locations-filter-input">
                                    ‚ûï Add Role
                                </button>
                            </form>

                            <!-- Reset to Defaults -->
                            <button type="button" onclick="resetTargetRolesToDefaults()" class="btn btn-secondary w-full mt-2rem">
                                üîÑ Reset to Defaults
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Instructor Modal -->
    <div id="addInstructorModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="addInstructorModalTitle">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addInstructorModal')">&times;</span>
            <h2>Add New Instructor</h2>
            <form id="addInstructorForm">
                <div class="form-group">
                    <label for="instructorEmail" class="form-label">Email Address *</label>
                    <input type="email" id="instructorEmail" name="email" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="instructorFirstName" class="form-label">First Name *</label>
                    <input type="text" id="instructorFirstName" name="first_name" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="instructorLastName" class="form-label">Last Name *</label>
                    <input type="text" id="instructorLastName" name="last_name" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="instructorRole" class="form-label">Role</label>
                    <select id="instructorRole" name="role" class="form-select">
                        <option value="instructor">Instructor</option>
                        <option value="project_manager">Project Manager</option>
                        <option value="org_admin">Organization Admin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sendWelcomeEmail" name="send_welcome_email" checked>
                        Send welcome email
                    </label>
                </div>
                <div class="flex-end">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addInstructorModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Instructor</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Instructor Assignment Modal -->
    <div id="instructorAssignmentModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="instructorAssignmentTitle">
        <div class="modal-dialog">
            <span class="close" onclick="window.OrgAdmin.Instructors.closeAssignmentModal()">&times;</span>
            <h2 id="instructorAssignmentTitle">Assign Instructor to Tracks & Locations</h2>

            <div class="modal-body">
                <div id="assignmentInstructorInfo" class="info-section mb-2rem">
                    <!-- Instructor info will be populated dynamically -->
                </div>

                <!-- Track Assignment Section -->
                <div class="form-section">
                    <h3>Assign to Tracks</h3>
                    <div id="trackAssignmentList" class="checkbox-list">
                        <p class="text-muted">Loading tracks...</p>
                    </div>
                </div>

                <!-- Locations Assignment Section -->
                <div class="form-section" id="locationAssignmentSection" style="display: none;">
                    <h3>Assign to Locations</h3>
                    <p class="help-text">Select locations within assigned tracks</p>
                    <div id="locationAssignmentList" class="checkbox-list">
                        <!-- Locations checkboxes will be populated dynamically per track -->
                    </div>
                </div>
            </div>

            <div class="flex-end">
                <button type="button" class="btn btn-secondary" onclick="window.OrgAdmin.Instructors.closeAssignmentModal()">
                    Cancel
                </button>
                <button id="saveAssignmentsBtn" type="button" class="btn btn-primary" onclick="window.OrgAdmin.Instructors.saveAssignments()">
                    ‚úì Save Assignments
                </button>
            </div>
        </div>
    </div>

    <!-- Create Project Modal -->
    <div id="createProjectModal" class="modal-no-backdrop modal-center-fixed" role="dialog" aria-modal="true" aria-labelledby="createProjectModalTitle">
        <div class="modal-content-inner modal-content-flex">
            <!-- Draggable Modal Header -->
            <div class="modal-header draggable-handle modal-header-draggable">
                <div style="display: flex; align-items: center; gap: 0.5rem; flex: 1;">
                    <span style="font-size: 1.2rem; opacity: 0.6; user-select: none;" title="Drag to move modal">‚ãÆ‚ãÆ</span>
                    <h2 class="modal-header-title" style="margin: 0;">Create New Training Project</h2>
                </div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button type="button"
                            id="toggleWizardProgress"
                            class="btn-icon-header"
                            onclick="window.OrgAdmin.Projects.toggleWizardProgress()"
                            title="Show/hide wizard progress tracker"
                            style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.9rem; cursor: pointer; transition: all 0.2s;">
                        üìä Show Progress
                    </button>
                    <button class="close modal-close-white" onclick="window.OrgAdmin.Projects.resetProjectWizard(); closeModal('createProjectModal')" style="cursor: pointer; background: transparent; border: none; color: inherit; font-size: inherit;">&times;</button>
                </div>
            </div>

            <!-- Project Creation Steps - Wave 4 Wizard Progress -->
            <div id="project-wizard-progress" data-wizard-progress class="project-creation-steps project-steps-container wizard-progress-hidden">
                <!-- Wizard progress indicator will render here -->
            </div>

            <!-- Draft Indicator - Wave 4 Auto-Save -->
            <div data-draft-indicator class="wizard-draft-indicator" style="display: none;">
                <span data-draft-text>Draft saved just now</span>
            </div>

            <!-- Wizard steps container - Scrollable wrapper -->
            <div class="modal-body-scroll">
                <div class="px-lg pb-lg">
                <!-- Step 1: Project Details -->
            <div id="projectStep1" class="project-step active">
                <h3>Project Information</h3>

                <!-- Spreadsheet Upload Section -->
                <div class="upload-section upload-section-bg">
                    <h4 class="h4-top-flex">
                        üìä Quick Import from Spreadsheet
                        <button type="button" class="btn-icon btn-icon-inline" onclick="toggleUploadHelp()" title="Show example format">‚ÑπÔ∏è</button>
                    </h4>
                    <p class="upload-help-text">Upload an Excel (.xlsx, .xls) or LibreOffice Calc (.ods) file to automatically populate project details and tracks.</p>

                    <div id="uploadHelp" class="upload-help-box">
                        <strong>Expected spreadsheet format:</strong>
                        <table class="table-full-collapsed">
                            <thead>
                                <tr class="table-header-bg">
                                    <th class="table-cell-left">Column</th>
                                    <th class="table-cell-left">Required</th>
                                    <th class="table-cell-left">Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="table-cell-padding"><code>project_name</code></td>
                                    <td class="table-cell-padding">Yes</td>
                                    <td class="table-cell-padding">Project name</td>
                                </tr>
                                <tr class="table-row-alt-bg">
                                    <td class="table-cell-padding"><code>project_slug</code></td>
                                    <td class="table-cell-padding">Yes</td>
                                    <td class="table-cell-padding">URL-friendly slug (lowercase, hyphens)</td>
                                </tr>
                                <tr>
                                    <td class="table-cell-padding"><code>description</code></td>
                                    <td class="table-cell-padding">Yes</td>
                                    <td class="table-cell-padding">Project description</td>
                                </tr>
                                <tr class="table-row-alt-bg">
                                    <td class="table-cell-padding"><code>start_date</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Format: YYYY-MM-DD</td>
                                </tr>
                                <tr>
                                    <td class="table-cell-padding"><code>end_date</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Format: YYYY-MM-DD</td>
                                </tr>
                                <tr class="table-row-alt-bg">
                                    <td class="table-cell-padding"><code>tracks</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Comma-separated track names</td>
                                </tr>
                                <tr>
                                    <td class="table-cell-padding"><code>student_emails</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Comma-separated student emails</td>
                                </tr>
                                <tr class="table-row-alt-bg">
                                    <td class="table-cell-padding"><code>student_names</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Comma-separated student names (parallel to emails)</td>
                                </tr>
                                <tr>
                                    <td class="table-cell-padding"><code>instructor_emails</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Comma-separated instructor emails</td>
                                </tr>
                                <tr class="table-row-alt-bg">
                                    <td class="table-cell-padding"><code>instructor_names</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Comma-separated instructor names (parallel to emails)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="upload-button-row">
                        <input type="file" id="projectSpreadsheetUpload" accept=".xlsx,.xls,.ods" class="file-input-hidden" onchange="handleProjectSpreadsheetUpload(event)">
                        <button type="button" class="btn btn-outline flex-center-gap-half" onclick="document.getElementById('projectSpreadsheetUpload').click()">
                            üì§ Upload Spreadsheet
                        </button>
                        <button type="button" class="btn btn-secondary flex-center-gap-half" onclick="downloadProjectTemplate()">
                            üì• Download Template
                        </button>
                        <span id="uploadedFileName" class="upload-filename-text"></span>
                    </div>
                </div>

                <div class="divider-text">
                    ‚Äî OR ‚Äî
                </div>

                <form id="createProjectForm">
                    <!-- Step 0: Project Type Selection -->
                    <div class="project-type-box">
                        <div class="project-type-label">üìç Project Type</div>
                        <div class="project-type-options">
                            <label class="form-label project-type-option-label project-type-option">
                                <input type="radio" id="projectTypeSingle" name="project_type" value="single_location" checked onchange="handleProjectTypeChange(this.value)" class="project-type-radio">
                                <div class="multi-locations-text">
                                    <div class="project-type-title">üè¢ Single Locations Project</div>
                                    <div class="project-type-description">One locations with a single schedule. Best for most training programs.</div>
                                </div>
                            </label>
                            <label class="form-label project-type-option-label project-type-option">
                                <input type="radio" id="projectTypeMultiLocation" name="project_type" value="multi_location" onchange="handleProjectTypeChange(this.value)" class="project-type-radio">
                                <div class="multi-locations-text">
                                    <div class="project-type-title">üåç Multi-Locations Project</div>
                                    <div class="project-type-description">Run the same program in multiple locations or at different times. Each locations has independent scheduling and capacity.</div>
                                </div>
                            </label>
                        </div>
                        <input type="hidden" id="hasSubProjects" name="has_sub_projects" value="false">
                    </div>

                    <!-- Multi-Locations Note (shown when multi_location is selected) -->
                    <div id="locationInfoNote" class="locations-info-note">
                        <strong>‚ÑπÔ∏è Multi-Locations Setup</strong>
                        <p class="ai-message-text">
                            You'll be able to create multiple locations after setting up the main project. Each locations will have:
                            <ul class="locations-info-list">
                                <li>Independent locations (country, region, city)</li>
                                <li>Custom start and end dates</li>
                                <li>Separate enrollment capacity</li>
                                <li>Customizable track selection</li>
                            </ul>
                        </p>
                    </div>

                    <div class="form-group">
                        <label for="projectName" class="form-label">Project Name *</label>
                        <input type="text" id="projectName" name="name" required
                               oninput="generateProjectSlug()"
                               data-validate="required,minLength:3"
                               data-validate-message="Project name must be at least 3 characters"
                               class="form-input">
                        <div class="validation-error" style="display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label for="projectSlug" class="form-label">URL Slug *</label>
                        <input type="text" id="projectSlug" name="slug" required pattern="^[a-z0-9\-]+$"
                               oninput="validateProjectSlug()"
                               data-validate="required,pattern:^[a-z0-9\-]+$"
                               data-validate-message="Only lowercase letters, numbers, and hyphens allowed"
                               class="form-input">
                        <small>Only lowercase letters, numbers, and hyphens allowed</small>
                        <div id="projectSlugError" class="validation-error" style="display: none; color: #dc2626; margin-top: 0.25rem; font-size: 0.875rem;"></div>
                    </div>
                    <div class="form-group">
                        <label for="projectDescription" class="form-label">Project Description *</label>
                        <textarea id="projectDescription" name="description" placeholder="Describe the goals and objectives of this training project..." required
                                  data-validate="required,minLength:20"
                                  data-validate-message="Description must be at least 20 characters"
                                  class="form-input"></textarea>
                        <small>This description will be used by AI to suggest relevant tracks and content</small>
                        <div class="validation-error" style="display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label for="projectTargetRoles" class="form-label">Target Roles</label>
                        <select id="projectTargetRoles" name="target_roles" multiple size="10" class="select-full-padding form-select">
                            <!-- Technical Roles -->
                            <optgroup label="üë®‚Äçüíª Technical Roles">
                                <option value="application_developers">Application Developer</option>
                                <option value="devops_engineers">DevOps Engineer</option>
                                <option value="qa_engineers">QA Engineer</option>
                                <option value="operations_engineers">Operations Engineer</option>
                                <option value="system_administrators">System Administrator</option>
                                <option value="technical_architects">Technical Architect</option>
                                <option value="security_engineers">Security Engineer</option>
                                <option value="database_administrators">Database Administrator</option>
                            </optgroup>

                            <!-- Business Roles -->
                            <optgroup label="üíº Business Roles">
                                <option value="business_analysts">Business Analyst</option>
                                <option value="product_managers">Product Manager</option>
                                <option value="project_managers">Project Manager</option>
                                <option value="business_consultants">Business Consultant</option>
                            </optgroup>

                            <!-- Data & Analytics -->
                            <optgroup label="üìä Data & Analytics">
                                <option value="data_scientists">Data Scientist</option>
                                <option value="data_analysts">Data Analyst</option>
                                <option value="data_engineers">Data Engineer</option>
                                <option value="business_intelligence_analysts">Business Intelligence Analyst</option>
                            </optgroup>

                            <!-- Leadership & Management -->
                            <optgroup label="üëî Leadership & Management">
                                <option value="engineering_managers">Engineering Manager</option>
                                <option value="team_leads">Team Lead</option>
                                <option value="technical_directors">Technical Director</option>
                                <option value="cto">Chief Technology Officer</option>
                            </optgroup>
                        </select>
                        <small class="form-help">Hold Ctrl/Cmd to select multiple roles. Roles are organized by category for easier selection.</small>
                    </div>
                    <div class="grid-2-cols">
                        <div class="form-group">
                            <label for="projectDuration" class="form-label">Duration (weeks)</label>
                            <input type="number" id="projectDuration" name="duration_weeks" min="1" max="52" class="form-input" onchange="calculateProjectEndDate()">
                            <small class="form-help">Weekends are excluded from duration calculation</small>
                        </div>
                        <div class="form-group">
                            <label for="projectMaxParticipants" class="form-label">Maximum Participants</label>
                            <input type="number" id="projectMaxParticipants" name="max_participants" min="1"
                                   oninput="validateMaxParticipants()"
                                   class="form-input">
                            <small class="form-help">Leave empty for unlimited capacity</small>
                            <div id="projectMaxParticipantsError" class="validation-error" style="display: none; color: #dc2626; margin-top: 0.25rem; font-size: 0.875rem;"></div>
                        </div>
                    </div>
                    <div class="grid-2-cols">
                        <div class="form-group">
                            <label for="projectStartDate" class="form-label">Start Date</label>
                            <input type="date" id="projectStartDate" name="start_date" class="form-input" onchange="calculateProjectEndDate()">
                        </div>
                        <div class="form-group">
                            <label for="projectEndDate" class="form-label">End Date</label>
                            <input type="date" id="projectEndDate" name="end_date" class="form-input">
                            <small class="form-help">Auto-calculated from start date + duration (excluding weekends)</small>
                        </div>
                    </div>
                    <div class="flex-space-between">
                        <button type="button" class="btn btn-outline" onclick="window.OrgAdmin.Projects.saveCurrentProjectDraft()" title="Save your progress and continue later">
                            üíæ Save as Draft
                        </button>
                        <div class="flex-gap-1">
                            <button type="button" class="btn btn-secondary" onclick="window.OrgAdmin.Projects.resetProjectWizard(); closeModal('createProjectModal')">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="window.OrgAdmin.Projects.nextProjectStep()">Next: Configure Locations</button>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- Step 2: Subprojects / Locations (Multi-Locations) -->
            <div id="projectStep2" class="project-step">
                <h3>Configure Locations</h3>
                <p>Define locations for your multi-locations project. Each locations represents a separate locations or group.</p>

                <!-- Conditional Display: Only for Multi-Locations Projects -->
                <div id="subprojectsContent">
                    <!-- Info Box -->
                    <div class="gradient-purple-box">
                        <div class="flex-start-gap-1">
                            <div class="font-size-2rem">üåç</div>
                            <div>
                                <h4 class="h4-margin-tight">Multi-Locations Project Setup</h4>
                                <p class="p-margin-0-white">
                                    Set up training locations. Each locations can have its own schedule,
                                    instructors, and students while sharing the same tracks and content.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Locations List Container -->
                    <div id="locationsList" class="locations-list-section">
                        <h4 class="h4-margin-std">Defined Locations</h4>
                        <div id="locationsListContent" class="locations-list-content">
                            <!-- Locations will be dynamically added here -->
                            <div class="locations-empty-placeholder">
                                <p class="p-margin-0-muted">
                                    No locations defined yet. Click "Add Locations" to create your first locations.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Add Locations Button -->
                    <button
                        id="addLocationBtn"
                        type="button"
                        class="btn btn-primary mb-2rem"
                        onclick="window.OrgAdmin.Projects.showAddLocationForm()">
                        ‚ûï Add Locations
                    </button>

                    <!-- Add Locations Form (Hidden by default) -->
                    <div id="addLocationForm" class="locations-form-hidden">
                        <h4 class="h4-margin-std">Add New Locations</h4>

                        <div class="form-group">
                            <label for="locationName" class="form-label">Location Country *</label>
                            <input type="text" id="locationName" class="form-input" placeholder="e.g., United States, Canada, Germany" required>
                        </div>

                        <div class="form-group">
                            <label for="locationLocation" class="form-label">Locations *</label>
                            <input type="text" id="locationLocation" class="form-input" placeholder="e.g., New York, NY" required>
                        </div>

                        <div class="form-row locations-form-row">
                            <div class="form-group">
                                <label for="inlineLocationStartDate" class="form-label">Start Date</label>
                                <input type="date" id="inlineLocationStartDate" class="form-input">
                            </div>

                            <div class="form-group">
                                <label for="inlineLocationEndDate" class="form-label">End Date</label>
                                <input type="date" id="inlineLocationEndDate" class="form-input">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="inlineLocationMaxStudents" class="form-label">Max Students</label>
                            <input type="number" id="inlineLocationMaxStudents" class="form-input" placeholder="e.g., 30" min="1">
                        </div>

                        <div class="flex-gap-mt">
                            <button id="saveLocationBtn" type="button" class="btn btn-primary" onclick="window.OrgAdmin.Projects.saveLocation()">
                                ‚úì Add Locations
                            </button>
                            <button id="cancelLocationBtn" type="button" class="btn btn-secondary" onclick="window.OrgAdmin.Projects.cancelLocationForm()">
                                Cancel
                            </button>
                        </div>
                    </div>

                    <!-- Help Text -->
                    <div class="help-tip-box">
                        <strong>üí° Tip:</strong> You can add more locations later from the project detail view.
                        Instructors, students, and tracks will be assigned in the next steps.
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="button-group button-group--end mt-2xl">
                    <button type="button" class="btn btn-secondary px-lg py-md min-w-120" onclick="window.OrgAdmin.Projects.previousProjectStep()">
                        ‚Üê Back
                    </button>
                    <button type="button" class="btn btn-outline px-lg py-md min-w-140" onclick="window.OrgAdmin.Projects.saveCurrentProjectDraft()" title="Save your progress and continue later">
                        üíæ Save as Draft
                    </button>
                    <button type="button" class="btn btn-primary px-lg py-md min-w-180" onclick="window.OrgAdmin.Projects.nextProjectStep()">
                        Next: Configure Tracks ‚Üí
                    </button>
                </div>
            </div>

            <!-- Step 3: Training Tracks (formerly Step 2) -->
            <div id="projectStep3" class="project-step">
                <h3>Configure Training Tracks</h3>
                <p>Define learning paths tailored to different target audiences within your organization.</p>

                <!-- Track Requirement Toggle -->
                <div class="form-group mb-1-5">
                    <div class="flex-center-gap-half">
                        <input
                            type="checkbox"
                            id="needTracks"
                            checked
                            onchange="window.OrgAdmin.Projects.handleTrackRequirementChange()"
                            class="w-18-h-18">
                        <label for="needTracks" class="form-label label-cursor-pointer">
                            This project requires learning tracks
                        </label>
                    </div>
                    <small class="form-help ml-26">
                        Uncheck if this is a simple training session without structured tracks
                    </small>
                </div>

                <!-- Auto-Generated Tracks Display Container -->
                <div id="trackFieldsContainer">
                    <h4 style="margin-top: 0; margin-bottom: 1rem; color: var(--text-primary);">
                        Auto-Generated Training Tracks
                    </h4>
                    <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
                        Based on your target role selection in Step 1, we've automatically generated the following
                        learning tracks with appropriate difficulty levels, descriptions, and skill requirements.
                    </p>

                    <!-- Tracks will be displayed here by JavaScript -->
                    <div id="step3TracksList" class="tracks-preview-container">
                        <!-- Tracks populated by displayGeneratedTracksInStep3() -->
                        <div style="text-align: center; padding: 2rem; color: var(--text-muted);
                                    background: var(--hover-color); border-radius: 8px;">
                            <p>Loading tracks...</p>
                        </div>
                    </div>

                    <!-- Add Custom Track Section -->
                    <div class="mt-xl" style="border-top: 2px dashed var(--border-color); padding-top: 1.5rem;">
                        <div class="flex-between-center" style="margin-bottom: 1rem;">
                            <div>
                                <h4 style="margin: 0 0 0.25rem 0; color: var(--text-primary);">Need a Custom Track?</h4>
                                <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                                    Add additional tracks beyond the auto-generated ones
                                </p>
                            </div>
                            <button
                                type="button"
                                class="btn btn-outline px-lg py-md"
                                onclick="window.OrgAdmin.Projects.openManageTracksModal()"
                                style="white-space: nowrap;">
                                <span style="margin-right: 0.5rem;">‚ûï</span>
                                Add Custom Track
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="button-group button-group--end mt-2xl">
                    <button type="button" class="btn btn-secondary px-lg py-md" class="min-w-120 whitespace-nowrap" onclick="window.OrgAdmin.Projects.previousProjectStep()">
                        ‚Üê Back
                    </button>
                    <button type="button" class="btn btn-outline px-lg py-md" class="min-w-140 whitespace-nowrap" onclick="window.OrgAdmin.Projects.saveCurrentProjectDraft()" title="Save your progress and continue later">
                        üíæ Save as Draft
                    </button>
                    <button type="button" class="btn btn-primary px-lg py-md" class="min-w-200 whitespace-nowrap" onclick="window.OrgAdmin.Projects.nextProjectStep()">
                        Next: Review & Create ‚Üí
                    </button>
                </div>
            </div>

            <!-- Step 4: Review & Confirm Tracks -->
            <div id="projectStep4" class="project-step">
                <h3>Review & Confirm Tracks</h3>
                <p>Review the automatically generated learning tracks for your project. You can create additional custom tracks if needed.</p>

                <!-- Generated Tracks Review Container -->
                <div id="generatedTracksReview" class="track-review-box">
                    <h4 class="mb-1rem">Generated Learning Tracks:</h4>
                    <div id="tracksReviewList" class="track-review-list">
                        <!-- Tracks will be dynamically populated here -->
                        <div class="track-empty-message">
                            <p>No tracks generated yet. Go back to Step 2 and click "Next: Review & Create"</p>
                        </div>
                    </div>
                </div>

                <!-- Create Additional Track Section -->
                <div class="track-additional-box">
                    <div class="flex-between-center-mb">
                        <div>
                            <h4 class="h4-margin-tight">Need Additional Tracks?</h4>
                            <p class="p-margin-0-muted font-size-0-9rem">
                                Create custom tracks beyond the auto-generated ones
                            </p>
                        </div>
                        <button type="button" class="btn btn-secondary"
                                onclick="window.OrgAdmin.Projects.openCustomTrackCreation()"
                                class="btn-padding-custom whitespace-nowrap">
                            ‚ûï Create New Track
                        </button>
                    </div>
                </div>

                <!-- Optional Summary Statistics Toggle -->
                <div class="summary-toggle-container">
                    <button type="button"
                            id="toggleProjectSummary"
                            class="btn btn-outline-small"
                            onclick="window.OrgAdmin.Projects.toggleProjectSummary()"
                            title="Show/hide project summary statistics">
                        üìä Show Project Summary
                    </button>
                </div>

                <!-- Multi-Locations Notice (shown when has_sub_projects is true) -->
                <div id="multiLocationNotice" class="multi-locations-notice">
                    <div class="multi-locations-notice-content">
                        <div class="multi-locations-icon">üåç</div>
                        <div class="multi-locations-text">
                            <h4 class="multi-locations-title">Multi-Locations Project Setup</h4>
                            <p class="multi-locations-description">
                                After creating this project, you'll be able to set up multiple locations for different sites or time periods.
                                Each locations will have independent scheduling, capacity, and track selection.
                            </p>
                            <div class="multi-locations-steps">
                                <strong class="multi-locations-steps-title">üìã Next Steps:</strong>
                                <ol class="multi-locations-steps-list">
                                    <li>Complete project creation by clicking "Create Project & Tracks" below</li>
                                    <li>Navigate to the project detail view</li>
                                    <li>Click "‚ûï Create Locations" to set up your first locations</li>
                                </ol>
                            </div>
                            <p class="multi-locations-tip">
                                üí° Tip: You can also access locations management from the "Locations" section after project creation.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="button-group button-group--end mt-2xl">
                    <button type="button" class="btn btn-secondary px-lg py-md"
                            class="min-w-120 whitespace-nowrap"
                            onclick="window.OrgAdmin.Projects.previousProjectStep()">
                        ‚Üê Back
                    </button>
                    <button type="button" class="btn btn-secondary px-lg py-md"
                            class="min-w-140 whitespace-nowrap"
                            onclick="closeModal('createProjectModal')">
                        Save as Draft
                    </button>
                    <button id="submitProjectBtn" type="submit" class="btn btn-success px-lg py-md min-w-200 whitespace-nowrap"
                            onclick="window.OrgAdmin.Projects.finalizeProjectCreation(); return false;">
                        ‚úì Create Project & Tracks
                    </button>
                </div>
                </div>
                </div> <!-- Close wizard steps container -->
            </div> <!-- Close modal-body-scroll -->
        </div>
    </div>

    <!-- Project Summary Popup (Optional - Hidden by Default) -->
    <div id="projectSummaryPopup" class="project-summary-popup" style="display: none;">
        <div class="project-summary-popup-header">
            <h4 class="project-summary-popup-title">üìä Project Summary</h4>
            <button type="button"
                    class="project-summary-close-btn"
                    onclick="window.OrgAdmin.Projects.toggleProjectSummary()"
                    title="Close summary">
                √ó
            </button>
        </div>
        <div class="project-summary-popup-body">
            <div class="project-summary-stat">
                <div class="project-summary-stat-label">Total Tracks</div>
                <div id="popupTotalTracksCount" class="project-summary-stat-value project-summary-stat-value--primary">0</div>
            </div>
            <div class="project-summary-stat">
                <div class="project-summary-stat-label">Target Roles</div>
                <div id="popupTotalRolesCount" class="project-summary-stat-value project-summary-stat-value--success">0</div>
            </div>
            <div class="project-summary-stat">
                <div class="project-summary-stat-label">Status</div>
                <div id="popupProjectStatus" class="project-summary-stat-value project-summary-stat-value--success">‚úì Ready</div>
            </div>
        </div>
    </div>

    <!-- Create Locations Modal (5-Step Wizard) -->
    <div id="createLocationModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="createLocationModalTitle">
        <div class="modal-content modal-content--lg">
            <div class="locations-draggable-handle">
                <h2 id="createLocationModalTitle" class="locations-modal-title">üåç Create New Locations</h2>
                <span class="close" onclick="closeModal('createLocationModal')">&times;</span>
            </div>

            <!-- Progress indicator -->
            <div class="locations-progress-container">
                <div class="locations-progress-steps">
                    <div class="wizard-step-indicator active" data-step="1">
                        1. Basic Info
                    </div>
                    <div class="wizard-step-indicator" data-step="2">
                        2. Locations
                    </div>
                    <div class="wizard-step-indicator" data-step="3">
                        3. Schedule
                    </div>
                    <div class="wizard-step-indicator" data-step="4">
                        4. Tracks
                    </div>
                    <div class="wizard-step-indicator" data-step="5">
                        5. Review
                    </div>
                </div>
            </div>

            <div class="locations-modal-body">
                <!-- Step 1: Basic Information -->
                <div id="locationStep1" class="wizard-step active">
                    <h3 class="locations-step-title">üìù Basic Information</h3>
                    <form id="locationBasicInfoForm">
                        <div class="form-group">
                            <label for="locationName" class="form-label">Location Country *</label>
                            <input type="text" id="locationName" name="name" required placeholder="e.g., United States, Canada, Germany" class="form-input">
                            <small class="form-help">A descriptive name for this locations</small>
                        </div>
                        <div class="form-group">
                            <label for="locationSlug" class="form-label">Slug (URL-friendly identifier) *</label>
                            <input type="text" id="locationSlug" name="slug" required placeholder="e.g., boston-fall-2025" pattern="[a-z0-9-]+" class="form-input">
                            <small class="form-help">Lowercase letters, numbers, and hyphens only</small>
                        </div>
                        <div class="form-group">
                            <label for="locationDescription" class="form-label">Description</label>
                            <textarea id="locationDescription" name="description" rows="4" placeholder="Describe this locations and its unique characteristics..." class="form-input"></textarea>
                        </div>
                    </form>
                    <div class="locations-step-nav--end">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('createLocationModal')">Cancel</button>
                        <button type="button" class="btn btn-primary next-step-btn" onclick="nextLocationStep()">Next: Locations ‚Üí</button>
                    </div>
                </div>

                <!-- Step 2: Locations Information -->
                <div id="locationStep2" class="wizard-step">
                    <h3 class="locations-step-title">üìç Locations Details</h3>
                    <form id="locationLocationForm">
                        <div class="form-group">
                            <label for="locationCountry" class="form-label">Country *</label>
                            <select id="locationCountry" name="location_country" required onchange="loadRegionsForCountry(this.value)" class="form-select">
                                <option value="">Select Country</option>
                                <option value="United States">United States</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="Canada">Canada</option>
                                <option value="Germany">Germany</option>
                                <option value="France">France</option>
                                <option value="Japan">Japan</option>
                                <option value="Australia">Australia</option>
                                <option value="Brazil">Brazil</option>
                                <option value="India">India</option>
                                <option value="China">China</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="locationRegion" class="form-label">State/Province/Region</label>
                            <select id="locationRegion" name="location_region" class="form-select">
                                <option value="">Select Region (optional)</option>
                            </select>
                            <small class="form-help">Will load based on selected country</small>
                        </div>
                        <div class="form-group">
                            <label for="locationCity" class="form-label">City</label>
                            <input type="text" id="locationCity" name="location_city" placeholder="e.g., Boston" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="locationTimezone" class="form-label">Timezone *</label>
                            <select id="locationTimezone" name="timezone" required class="form-select">
                                <option value="UTC">UTC (Coordinated Universal Time)</option>
                                <option value="America/New_York">America/New York (EST/EDT)</option>
                                <option value="America/Chicago">America/Chicago (CST/CDT)</option>
                                <option value="America/Denver">America/Denver (MST/MDT)</option>
                                <option value="America/Los_Angeles">America/Los Angeles (PST/PDT)</option>
                                <option value="America/Toronto">America/Toronto (EST/EDT)</option>
                                <option value="Europe/London">Europe/London (GMT/BST)</option>
                                <option value="Europe/Paris">Europe/Paris (CET/CEST)</option>
                                <option value="Europe/Berlin">Europe/Berlin (CET/CEST)</option>
                                <option value="Asia/Tokyo">Asia/Tokyo (JST)</option>
                                <option value="Asia/Shanghai">Asia/Shanghai (CST)</option>
                                <option value="Asia/Kolkata">Asia/Kolkata (IST)</option>
                                <option value="Australia/Sydney">Australia/Sydney (AEST/AEDT)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="locationAddress" class="form-label">Physical Address (optional)</label>
                            <textarea id="locationAddress" name="location_address" rows="2" placeholder="Full street address for this locations..." class="form-input"></textarea>
                            <small class="form-help">Optional: Full address if training is at a specific building</small>
                        </div>
                    </form>
                    <div class="locations-step-nav">
                        <button type="button" class="btn btn-secondary" onclick="previousLocationStep()">‚Üê Back</button>
                        <button type="button" class="btn btn-primary next-step-btn" onclick="nextLocationStep()">Next: Schedule ‚Üí</button>
                    </div>
                </div>

                <!-- Step 3: Schedule Configuration -->
                <div id="locationStep3" class="wizard-step">
                    <h3 class="locations-step-title">üìÖ Schedule & Capacity</h3>
                    <form id="locationScheduleForm">
                        <div class="form-group">
                            <label for="locationStartDate" class="form-label">Start Date</label>
                            <input type="date" id="locationStartDate" name="start_date" onchange="calculateLocationEndDate()" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="locationDuration" class="form-label">Duration (weeks)</label>
                            <input type="number" id="locationDuration" name="duration_weeks" min="1" max="52" onchange="calculateLocationEndDate()" class="form-input">
                            <small class="form-help">Weekends are excluded from duration calculation</small>
                        </div>
                        <div class="form-group">
                            <label for="locationEndDate" class="form-label">End Date</label>
                            <input type="date" id="locationEndDate" name="end_date" class="form-input">
                            <small class="form-help">Auto-calculated from start date + duration (excluding weekends)</small>
                        </div>
                        <div class="form-group">
                            <label for="locationMaxParticipants" class="form-label">Maximum Participants</label>
                            <input type="number" id="locationMaxParticipants" name="max_participants" min="1"
                                   oninput="validateLocationMaxParticipants()"
                                   placeholder="e.g., 30" class="form-input">
                            <small class="form-help">Leave empty for unlimited capacity</small>
                            <div id="locationMaxParticipantsError" class="validation-error" style="display: none; color: #dc2626; margin-top: 0.25rem; font-size: 0.875rem;"></div>
                        </div>
                    </form>
                    <div class="locations-step-nav">
                        <button type="button" class="btn btn-secondary" onclick="previousLocationStep()">‚Üê Back</button>
                        <button type="button" class="btn btn-primary next-step-btn" onclick="nextLocationStep()">Next: Tracks ‚Üí</button>
                    </div>
                </div>

                <!-- Step 4: Track Selection -->
                <div id="locationStep4" class="wizard-step">
                    <h3 class="locations-step-title">üìö Select Tracks</h3>
                    <p class="text-muted mb-md">
                        Choose which tracks from the parent project will be included in this locations.
                        You can customize start/end dates and instructors for each track.
                    </p>
                    <div id="availableTracksList" class="locations-tracks-list">
                        <!-- Track items will be loaded dynamically -->
                        <div class="locations-tracks-placeholder">
                            <p>Loading tracks from parent project...</p>
                        </div>
                    </div>
                    <div class="locations-step-nav">
                        <button type="button" class="btn btn-secondary" onclick="previousLocationStep()">‚Üê Back</button>
                        <button type="button" class="btn btn-primary next-step-btn" onclick="nextLocationStep()">Next: Review ‚Üí</button>
                    </div>
                </div>

                <!-- Step 5: Review & Create -->
                <div id="locationStep5" class="wizard-step">
                    <h3 class="locations-step-title">‚úÖ Review & Create</h3>
                    <p class="subtitle-text">Review your locations details before creating.</p>

                    <div id="reviewBasicInfo" class="review-section">
                        <h4 class="review-section-title">Basic Information</h4>
                        <p id="reviewName" class="review-text"></p>
                        <p id="reviewSlug" class="review-text--muted"></p>
                        <p id="reviewDescription" class="review-text--description"></p>
                    </div>

                    <div id="reviewLocation" class="review-section">
                        <h4 class="review-section-title">Locations</h4>
                        <p id="reviewLocationDetails" class="review-text"></p>
                        <p id="reviewTimezone" class="review-text--muted"></p>
                    </div>

                    <div id="reviewSchedule" class="review-section">
                        <h4 class="review-section-title">Schedule & Capacity</h4>
                        <p id="reviewDates" class="review-text"></p>
                        <p id="reviewCapacity" class="review-text"></p>
                    </div>

                    <div id="reviewTracks" class="review-section">
                        <h4 class="review-section-title">Selected Tracks</h4>
                        <div id="reviewTracksList"></div>
                    </div>

                    <div class="locations-step-nav">
                        <button type="button" class="btn btn-secondary" onclick="previousLocationStep()">‚Üê Back</button>
                        <button type="button" id="submitLocationBtn" class="btn btn-primary" onclick="submitLocationCreation()">Create Locations</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Detail View Modal -->
    <div id="projectDetailView" class="modal-backdrop project-detail-modal" role="dialog" aria-modal="true" aria-labelledby="projectDetailTitle">
        <div class="modal-content modal-content--2xl modal-content--full-height">
            <div class="locations-draggable-handle">
                <h2 id="projectDetailTitle" class="project-detail-title">üìÅ Project Details</h2>
                <span class="close" onclick="closeProjectDetail()">&times;</span>
            </div>

            <!-- Project Detail Tabs -->
            <div class="project-detail-tabs">
                <div class="project-tabs-container">
                    <button class="tab-btn active" data-tab="overview" onclick="switchProjectDetailTab('overview')">
                        üìä Overview
                    </button>
                    <button class="tab-btn" data-tab="locations" onclick="switchProjectDetailTab('locations')">
                        üåç Locations
                    </button>
                    <button class="tab-btn" data-tab="analytics" onclick="switchProjectDetailTab('analytics')">
                        üìà Analytics
                    </button>
                </div>
            </div>

            <div class="locations-modal-body">
                <!-- Overview Tab -->
                <div id="projectDetailOverview" class="project-detail-tab active">
                    <div id="projectOverviewContent">
                        <!-- Will be populated dynamically -->
                        <p class="project-detail-loading">Loading project details...</p>
                    </div>
                </div>

                <!-- Locations Tab -->
                <div id="locationsTabContent" class="project-detail-tab">
                    <!-- Filters Section -->
                    <div class="locations-filters-section">
                        <h3 class="locations-filters-title">üîç Filter Locations</h3>
                        <div class="summary-grid">
                            <div class="form-group locations-filter-group">
                                <label for="locationCountryFilter" class="form-label">Country</label>
                                <select id="locationCountryFilter" onchange="applyLocationFilters()" class="locations-filter-input form-select">
                                    <option value="">All Countries</option>
                                    <option value="United States">United States</option>
                                    <option value="United Kingdom">United Kingdom</option>
                                    <option value="Canada">Canada</option>
                                    <option value="Germany">Germany</option>
                                    <option value="France">France</option>
                                    <option value="Japan">Japan</option>
                                    <option value="Australia">Australia</option>
                                    <option value="Brazil">Brazil</option>
                                    <option value="India">India</option>
                                    <option value="China">China</option>
                                </select>
                            </div>
                            <div class="form-group locations-filter-group">
                                <label for="locationRegionFilter" class="form-label">Region/State</label>
                                <input type="text" id="locationRegionFilter" placeholder="e.g., California" onchange="applyLocationFilters()" class="locations-filter-input form-input">
                            </div>
                            <div class="form-group locations-filter-group">
                                <label for="locationCityFilter" class="form-label">City</label>
                                <input type="text" id="locationCityFilter" placeholder="e.g., Boston" onchange="applyLocationFilters()" class="locations-filter-input form-input">
                            </div>
                            <div class="form-group locations-filter-group">
                                <label for="locationStatusFilter" class="form-label">Status</label>
                                <select id="locationStatusFilter" onchange="applyLocationFilters()" class="locations-filter-input form-select">
                                    <option value="">All Status</option>
                                    <option value="draft">Draft</option>
                                    <option value="active">Active</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                    <option value="archived">Archived</option>
                                </select>
                            </div>
                            <div class="form-group locations-filter-group">
                                <label for="locationDateFromFilter" class="form-label">Start Date From</label>
                                <input type="date" id="locationDateFromFilter" onchange="applyLocationFilters()" class="locations-filter-input form-input">
                            </div>
                            <div class="form-group locations-filter-group">
                                <label for="locationDateToFilter" class="form-label">Start Date To</label>
                                <input type="date" id="locationDateToFilter" onchange="applyLocationFilters()" class="locations-filter-input form-input">
                            </div>
                        </div>
                        <div class="locations-filters-actions">
                            <button id="clearLocationsFiltersBtn" class="btn btn-secondary" onclick="clearLocationFilters()">Clear Filters</button>
                        </div>
                    </div>

                    <!-- View Toggle and Create Button -->
                    <div class="locations-view-controls">
                        <div class="chat-input-container">
                            <button id="locationListViewBtn" class="btn btn-secondary active locations-view-btn" onclick="showLocationListView()">
                                üìã List View
                            </button>
                            <button id="locationTimelineViewBtn" class="btn btn-secondary locations-view-btn" onclick="showLocationTimelineView()">
                                üìÖ Timeline View
                            </button>
                        </div>
                        <button id="createLocationBtn" class="btn btn-primary" onclick="openCreateLocationModal()">
                            ‚ûï Create Locations
                        </button>
                    </div>

                    <!-- List View Container -->
                    <div id="locationListViewContainer">
                        <!-- Locations List -->
                        <div id="locationsList">
                            <!-- Locations items will be loaded here dynamically -->
                        </div>

                        <!-- Empty State -->
                        <div id="locationsEmptyState" class="locations-empty-state">
                            <div class="locations-empty-icon">üåç</div>
                            <h3 class="locations-empty-title">No Locations Created Yet</h3>
                            <p class="subtitle-text">
                                This project doesn't have any locations yet. Create your first locations to run this training program in multiple locations.
                            </p>
                            <button class="btn btn-primary" onclick="openCreateLocationModal()">Create First Locations</button>
                        </div>
                    </div>

                    <!-- Timeline View Container (Hidden by default) -->
                    <div id="locationTimelineContainer" class="locations-timeline-container">
                        <div class="locations-timeline-content">
                            <div id="timelineContent">
                                <!-- Timeline will be rendered here -->
                                <p class="locations-timeline-placeholder">Timeline view will display locations on a visual calendar.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Comparison Controls (When locations selected) -->
                    <div id="locationComparisonControls" class="locations-comparison-controls">
                        <div class="locations-comparison-inner">
                            <span id="selectedLocationCount">0 locations selected</span>
                            <button id="compareLocationsBtn" class="btn locations-comparison-btn" onclick="openLocationComparison()">
                                Compare
                            </button>
                            <button class="btn locations-comparison-btn--clear" onclick="clearLocationSelection()">
                                Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div id="projectDetailAnalytics" class="project-detail-tab">
                    <div id="projectAnalyticsContent">
                        <!-- Will be populated dynamically -->
                        <p class="project-detail-loading">Project analytics will be displayed here.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Locations Comparison Modal -->
    <div id="locationComparisonModal" class="modal-backdrop locations-comparison-modal" role="dialog" aria-modal="true" aria-labelledby="locationComparisonTitle">
        <div class="modal-content modal-content--xl">
            <div class="locations-comparison-header">
                <h2 id="locationComparisonTitle" class="locations-comparison-title">üìä Compare Locations</h2>
                <span class="close" onclick="closeModal('locationComparisonModal')">&times;</span>
            </div>
            <div class="locations-comparison-body">
                <table id="comparisonTable" class="data-table" class="locations-filter-input">
                    <!-- Comparison table will be populated dynamically -->
                </table>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="addStudentModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="addStudentModalTitle">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addStudentModal')">&times;</span>
            <h2>Add Student to Organization</h2>
            <form id="addStudentForm">
                <div class="form-group">
                    <label for="studentEmail" class="form-label">Email Address *</label>
                    <input type="email" id="studentEmail" name="user_email" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="studentFirstName" class="form-label">First Name *</label>
                    <input type="text" id="studentFirstName" name="first_name" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="studentLastName" class="form-label">Last Name *</label>
                    <input type="text" id="studentLastName" name="last_name" required class="form-input">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sendStudentWelcomeEmail" name="send_welcome_email" checked>
                        Send welcome email
                    </label>
                </div>
                <div class="flex-end">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addStudentModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Student</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Project Instantiation Modal -->
    <div id="instantiateProjectModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="instantiateProjectModalTitle">
        <div class="modal-content modal-content--md">
            <span class="close" onclick="closeModal('instantiateProjectModal')">&times;</span>
            <h2>Instantiate Project</h2>
            <p>This will make the project active and available to students. Default tracks and modules will be created if none exist.</p>

            <div id="projectInstantiationDetails">
                <!-- Project details will be populated here -->
            </div>

            <div class="ai-processing-section">
                <h4>ü§ñ AI Processing Options</h4>
                <label>
                    <input type="checkbox" id="processWithAI" checked> Process project description with AI for enhanced content generation
                </label>
                <p class="ai-help-text">
                    AI will analyze the project description and suggest optimized tracks, modules, and learning paths.
                </p>
            </div>

            <div class="flex-end">
                <button type="button" class="btn btn-secondary" onclick="closeModal('instantiateProjectModal')">Cancel</button>
                <button type="button" class="btn btn-success" onclick="confirmProjectInstantiation()">üöÄ Instantiate Project</button>
            </div>
        </div>
    </div>

    <!-- Instructor Assignment Modal -->
    <div id="instructorAssignmentModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="instructorAssignmentModalTitle">
        <div class="modal-content modal-content--lg">
            <span class="close" onclick="closeModal('instructorAssignmentModal')">&times;</span>
            <h2>Assign Instructors</h2>

            <div class="assignment-tabs">
                <button class="tab-btn active" onclick="switchAssignmentTab('tracks')">Track Assignments</button>
                <button class="tab-btn" onclick="switchAssignmentTab('modules')">Module Assignments</button>
            </div>

            <!-- Track Assignment Tab -->
            <div id="trackAssignmentTab" class="assignment-tab-content active">
                <h3>Assign Instructors to Tracks</h3>
                <div id="trackAssignmentList">
                    <!-- Track assignment interface will be populated here -->
                </div>
            </div>

            <!-- Module Assignment Tab -->
            <div id="moduleAssignmentTab" class="assignment-tab-content">
                <h3>Assign Instructors to Modules (Minimum 2 per module)</h3>
                <div id="moduleAssignmentList">
                    <!-- Module assignment interface will be populated here -->
                </div>
            </div>

            <div class="flex-end mt-xl">
                <button type="button" class="btn btn-secondary" onclick="closeModal('instructorAssignmentModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveInstructorAssignments()">Save Assignments</button>
            </div>
        </div>
    </div>

    <!-- Student Enrollment Modal -->
    <div id="studentEnrollmentModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="studentEnrollmentModalTitle">
        <div class="modal-content modal-content--xl">
            <span class="close" onclick="closeModal('studentEnrollmentModal')">&times;</span>
            <h2>Manage Student Enrollments</h2>

            <div class="flex-gap-2">
                <!-- Available Students -->
                <div class="flex-1">
                    <h3>Available Students</h3>
                    <div class="mb-md">
                        <input type="text" id="studentSearchInput" placeholder="Search students..."
                               onkeyup="searchStudents()" class="input-full form-input">
                    </div>
                    <div id="availableStudentsList" class="max-h-400 overflow-y-auto border-solid p-lg-1">
                        <!-- Available students will be populated here -->
                    </div>
                </div>

                <!-- Track Assignment -->
                <div class="flex-1">
                    <h3>Enroll in Track</h3>
                    <div class="mb-md">
                        <select id="enrollmentTrackSelect" class="input-full form-select">
                            <option value="">Select Track...</option>
                            <!-- Track options will be populated here -->
                        </select>
                    </div>

                    <div id="enrolledStudentsList" class="max-h-400 overflow-y-auto border-solid p-lg-1">
                        <!-- Enrolled students will be populated here -->
                    </div>
                </div>
            </div>

            <div class="flex-end mt-xl">
                <button type="button" class="btn btn-secondary" onclick="closeModal('studentEnrollmentModal')">Close</button>
                <button type="button" class="btn btn-primary" onclick="bulkEnrollStudents()">Enroll Selected Students</button>
            </div>
        </div>
    </div>

    <!-- Project Analytics Modal -->
    <div id="projectAnalyticsModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="projectAnalyticsModalTitle">
        <div class="modal-content modal-content--2xl">
            <span class="close" onclick="closeModal('projectAnalyticsModal')">&times;</span>
            <h2>Project Analytics Dashboard</h2>

            <div class="analytics-summary grid-analytics">
                <div class="stat-card">
                    <span class="stat-number" id="analyticsEnrolledStudents">0</span>
                    <span>Enrolled Students</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="analyticsActiveStudents">0</span>
                    <span>Active Students</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="analyticsCompletedStudents">0</span>
                    <span>Completed</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="analyticsAverageProgress">0%</span>
                    <span>Average Progress</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="analyticsAverageScore">0%</span>
                    <span>Average Quiz Score</span>
                </div>
            </div>

            <div class="analytics-tabs">
                <button class="tab-btn active" onclick="switchAnalyticsTab('overview')">Overview</button>
                <button class="tab-btn" onclick="switchAnalyticsTab('progress')">Progress Tracking</button>
                <button class="tab-btn" onclick="switchAnalyticsTab('performance')">Performance</button>
                <button class="tab-btn" onclick="switchAnalyticsTab('engagement')">Engagement</button>
            </div>

            <div id="analyticsTabContent" class="mt-xl">
                <!-- Analytics tab content will be populated here -->
            </div>

            <div class="flex-end mt-xl">
                <button type="button" class="btn btn-outline" onclick="exportAnalytics()">üìä Export Report</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('projectAnalyticsModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Student Unenrollment Modal -->
    <div id="studentUnenrollmentModal" class="modal student-unenrollment-modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('studentUnenrollmentModal')">&times;</span>
            <h2>Unenroll Students from Project</h2>
            <p>Select students to unenroll from this project. Their progress will be preserved for audit purposes.</p>
            
            <div class="unenrollment-options">
                <h4>üîß Unenrollment Options</h4>
                <div>
                    <label>
                        <input type="checkbox" id="unenrollFromProject" checked> 
                        Unenroll from entire project (removes from all tracks)
                    </label>
                    <label>
                        <input type="checkbox" id="preserveProgress" checked> 
                        Preserve student progress data for audit purposes
                    </label>
                </div>
            </div>
            
            <div id="enrolledStudentsList" class="students-list">
                <!-- Enrolled students will be loaded here -->
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeModal('studentUnenrollmentModal')">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmStudentUnenrollment()" disabled>
                    ‚ùå Unenroll Selected Students
                </button>
            </div>
        </div>
    </div>

    <!-- Instructor Removal Modal -->
    <div id="instructorRemovalModal" class="modal instructor-removal-modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('instructorRemovalModal')">&times;</span>
            <h2>Remove Instructors</h2>
            <p>Select instructors to remove from project or organization. You can transfer their assignments to avoid disruption.</p>
            
            <div class="removal-options">
                <h4>üîß Removal Options</h4>
                <div>
                    <label>
                        <input type="checkbox" id="removeFromOrganization"> 
                        Remove from entire organization (removes from all projects)
                    </label>
                    <label>
                        <input type="checkbox" id="transferAssignments"> 
                        Transfer assignments to another instructor
                    </label>
                </div>
                
                <div id="replacementInstructorSection" class="replacement-instructor-section d-none">
                    <label for="replacementInstructorSelect" class="form-label">Select Replacement Instructor:</label>
                    <select id="replacementInstructorSelect" class="form-input form-select">
                        <option value="">-- Select Replacement --</option>
                        <!-- Options populated dynamically -->
                    </select>
                </div>
            </div>
            
            <div id="assignedInstructorsList" class="instructors-list">
                <!-- Assigned instructors will be loaded here -->
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeModal('instructorRemovalModal')">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmInstructorRemoval()" disabled>
                    üóëÔ∏è Remove Selected Instructors
                </button>
            </div>
        </div>
    </div>

    <!-- Create/Edit Track Modal -->
    <!--
    ========================================
    CREATE TRACK MODAL
    ========================================

    BUSINESS PURPOSE:
    Allows organization admins to create new learning tracks that group related courses
    together. Tracks define learning pathways with estimated duration, prerequisites,
    and difficulty levels.

    DATABASE MAPPING:
    - Maps to course_creator.tracks table
    - prerequisites and learning_objectives are JSONB arrays
    - difficulty_level enum: beginner, intermediate, advanced
    - estimated_duration_hours: integer (1-10000)

    ACCESSIBILITY:
    - ARIA labels for screen readers
    - Keyboard navigation support
    - Form validation with clear error messages

    CSS CLASSES:
    - modal-backdrop: Full-screen overlay
    - modal-content--md: Medium-width modal (600px)
    - form-group: Standard form field container
    - form-group--full: Full-width form field (spans 2 columns)
    - form-input/form-select: Consistent input styling

    JAVASCRIPT INTEGRATION:
    - Form submission handled by submitTrack() in org-admin-dashboard.js
    - Modal close handled by closeModal() utility function
    - Uses data-modal attribute for modal management
    -->
    <div id="createTrackModal" class="modal-backdrop" role="dialog" aria-modal="true"
         aria-labelledby="createTrackModalTitle" data-modal="createTrack">
        <div class="modal-content modal-content--md">
            <!-- Close Button: Triggers modal close via data-dismiss attribute -->
            <span class="close" data-dismiss="modal" data-modal-id="createTrackModal" aria-label="Close modal">&times;</span>

            <h2 id="createTrackModalTitle">Create New Track</h2>
            <p class="subtitle-text">Create a new learning track for your organization</p>

            <!--
            FORM SUBMISSION:
            - Submits via submitTrack() handler in JavaScript
            - Validates JSONB fields before submission
            - Shows loading state during API call
            - Closes modal and refreshes table on success
            -->
            <form id="createTrackForm" data-form-type="createTrack">
                <div class="grid-2-cols">
                    <!--
                    TRACK NAME FIELD
                    - Required field (DB constraint: NOT NULL)
                    - Max length: 255 characters
                    - Used for display in track listings and navigation
                    - Should be descriptive and unique within organization
                    -->
                    <div class="form-group form-group--full">
                        <label for="trackName" class="form-label required">Track Name</label>
                        <input type="text" id="trackName" name="name" required maxlength="255"
                               placeholder="e.g., Python Fundamentals" class="form-input"
                               aria-required="true" aria-describedby="trackNameHelp">
                    </div>

                    <!--
                    DESCRIPTION FIELD
                    - Optional field (DB allows NULL)
                    - Provides context about track content and objectives
                    - Displayed in track details view
                    -->
                    <div class="form-group form-group--full">
                        <label for="trackDescription" class="form-label">Description</label>
                        <textarea id="trackDescription" name="description" rows="4"
                                  placeholder="Describe the track objectives and content..." class="form-input"
                                  aria-describedby="trackDescHelp"></textarea>
                    </div>

                    <!--
                    DIFFICULTY LEVEL FIELD
                    - Enum field in DB: beginner | intermediate | advanced
                    - Default: intermediate
                    - Helps students select appropriate tracks for their skill level
                    -->
                    <div class="form-group">
                        <label for="trackDifficultyLevel" class="form-label">Difficulty Level</label>
                        <select id="trackDifficultyLevel" name="difficulty_level" class="form-select"
                                aria-describedby="trackDifficultyHelp">
                            <option value="beginner">Beginner</option>
                            <option value="intermediate" selected>Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>

                    <!--
                    ESTIMATED DURATION FIELD
                    - Integer field: total learning hours (1-10000)
                    - Used for planning and student time management
                    - Includes all courses, assessments, and practice time
                    -->
                    <div class="form-group">
                        <label for="trackDurationHours" class="form-label">Estimated Duration (hours)</label>
                        <input type="number" id="trackDurationHours" name="estimated_duration_hours"
                               min="1" max="10000" placeholder="e.g., 40" class="form-input"
                               aria-describedby="trackDurationHelp">
                        <small id="trackDurationHelp">Total estimated learning time in hours</small>
                    </div>

                    <!--
                    PREREQUISITES FIELD (JSONB)
                    - PostgreSQL JSONB array stored as: ["item1", "item2", ...]
                    - Default: [] (empty array)
                    - JavaScript must validate JSON format before submission
                    - Displayed as bullet list in track details
                    - Example: ["Python basics", "Git fundamentals", "SQL knowledge"]
                    -->
                    <div class="form-group form-group--full">
                        <label for="trackPrerequisites" class="form-label">Prerequisites (JSON Array)</label>
                        <textarea id="trackPrerequisites" name="prerequisites" rows="3" class="form-input"
                                  placeholder='["Python basics", "Git fundamentals", "SQL knowledge"]'
                                  aria-describedby="trackPrereqHelp" data-json-field="true">[]</textarea>
                        <small id="trackPrereqHelp">Enter as JSON array. Example: ["Item 1", "Item 2", "Item 3"]</small>
                    </div>

                    <!--
                    LEARNING OBJECTIVES FIELD (JSONB)
                    - PostgreSQL JSONB array stored as: ["objective1", "objective2", ...]
                    - Default: [] (empty array)
                    - JavaScript must validate JSON format before submission
                    - Displayed as learning outcomes in track details
                    - Example: ["Master Django framework", "Build REST APIs", "Deploy to production"]
                    -->
                    <div class="form-group form-group--full">
                        <label for="trackLearningObjectives" class="form-label">Learning Objectives (JSON Array)</label>
                        <textarea id="trackLearningObjectives" name="learning_objectives" rows="3" class="form-input"
                                  placeholder='["Master Django framework", "Build REST APIs", "Deploy to production"]'
                                  aria-describedby="trackObjectivesHelp" data-json-field="true">[]</textarea>
                        <small id="trackObjectivesHelp">Enter as JSON array. Example: ["Objective 1", "Objective 2", "Objective 3"]</small>
                    </div>

                    <!--
                    IS ACTIVE CHECKBOX
                    - Boolean field, default: true
                    - Controls track visibility and enrollment availability
                    - Inactive tracks hidden from student view but preserved in DB
                    -->
                    <div class="form-group form-group--full">
                        <label class="form-label">
                            <input type="checkbox" id="trackIsActive" name="is_active" checked
                                   aria-describedby="trackActiveHelp">
                            <span>Track is Active</span>
                        </label>
                        <small id="trackActiveHelp">Active tracks are visible to students and can accept enrollments</small>
                    </div>
                </div>

                <!--
                MODAL FOOTER ACTIONS
                - Cancel: Closes modal without saving (data-dismiss pattern)
                - Create Track: Submits form (type="submit" triggers form submission)
                -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" data-dismiss="modal"
                            data-modal-id="createTrackModal" aria-label="Cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitCreateTrackBtn">Create Track</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Track Creation Modal (Advanced) -->
    <div id="customTrackModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="customTrackModalTitle">
        <div class="modal-content modal-content--lg modal-content--full-height">
            <span class="close" onclick="closeModal('customTrackModal')">&times;</span>
            <h2 id="customTrackModalTitle">Create Custom Track</h2>
            <p class="subtitle-text">
                Advanced track creation with custom options, scheduling, and automation
            </p>

            <form id="customTrackForm" onsubmit="submitCustomTrack(event)">
                <!-- Basic Information Section -->
                <fieldset class="fieldset-bordered">
                    <legend class="fieldset-legend">Basic Information</legend>

                    <div class="grid-2-cols">
                        <div class="form-group form-group--full">
                            <label for="customTrackName" class="form-label required">Track Name</label>
                            <input type="text" id="customTrackName" name="name" required maxlength="200"
                                   placeholder="e.g., Advanced Python Development" class="form-input">
                        </div>

                        <div class="form-group form-group--full">
                            <label for="customTrackDescription" class="form-label">Description</label>
                            <textarea id="customTrackDescription" name="description" rows="4" maxlength="1000"
                                      placeholder="Describe the track objectives, content, and expected outcomes..." class="form-input"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="customTrackProject" class="form-label required">Project</label>
                            <select id="customTrackProject" name="project_id" required class="form-select">
                                <option value="">Select Project</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="customTrackCategory" class="form-label">Category</label>
                            <select id="customTrackCategory" name="category" class="form-select">
                                <option value="">Select Category</option>
                                <option value="software-development">Software Development</option>
                                <option value="data-science">Data Science</option>
                                <option value="devops">DevOps & Cloud</option>
                                <option value="business-analysis">Business Analysis</option>
                                <option value="project-management">Project Management</option>
                                <option value="design">Design & UX</option>
                                <option value="security">Security & Compliance</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="customTrackDifficulty" class="form-label">Difficulty Level</label>
                            <select id="customTrackDifficulty" name="difficulty_level" class="form-select">
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                                <option value="expert">Expert</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="customTrackTags" class="form-label">Tags (comma-separated)</label>
                            <input type="text" id="customTrackTags" name="tags"
                                   placeholder="e.g., python, web, api, rest" class="form-input">
                            <small>Add searchable keywords</small>
                        </div>
                    </div>
                </fieldset>

                <!-- Schedule & Duration Section -->
                <fieldset class="fieldset-bordered">
                    <legend class="fieldset-legend">Schedule & Duration</legend>

                    <div class="grid-2-cols">
                        <div class="form-group">
                            <label for="customTrackDuration" class="form-label">Duration (weeks)</label>
                            <input type="number" id="customTrackDuration" name="duration_weeks" min="1" max="52"
                                   placeholder="e.g., 12" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="customTrackHoursPerWeek" class="form-label">Hours Per Week</label>
                            <input type="number" id="customTrackHoursPerWeek" name="hours_per_week" min="1" max="40"
                                   placeholder="e.g., 10" class="form-input">
                            <small>Expected time commitment</small>
                        </div>

                        <div class="form-group">
                            <label for="customTrackStartDate" class="form-label">Start Date</label>
                            <input type="date" id="customTrackStartDate" name="start_date" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="customTrackEndDate" class="form-label">End Date</label>
                            <input type="date" id="customTrackEndDate" name="end_date" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="customTrackSelfPaced" class="form-label">Self-Paced</label>
                            <select id="customTrackSelfPaced" name="self_paced" class="form-select">
                                <option value="false">No - Instructor-Led</option>
                                <option value="true">Yes - Self-Paced</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="customTrackStatus" class="form-label">Initial Status</label>
                            <select id="customTrackStatus" name="status" class="form-select">
                                <option value="draft">Draft</option>
                                <option value="active">Active</option>
                                <option value="scheduled">Scheduled</option>
                            </select>
                        </div>
                    </div>
                </fieldset>

                <!-- Enrollment & Capacity Section -->
                <fieldset class="fieldset-bordered">
                    <legend class="fieldset-legend">Enrollment & Capacity</legend>

                    <div class="grid-2-cols">
                        <div class="form-group">
                            <label for="customTrackMaxStudents" class="form-label">Max Students</label>
                            <input type="number" id="customTrackMaxStudents" name="max_students" min="1" max="1000"
                                   placeholder="e.g., 30" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="customTrackMinStudents" class="form-label">Min Students</label>
                            <input type="number" id="customTrackMinStudents" name="min_students" min="1" max="100"
                                   placeholder="e.g., 5" class="form-input">
                            <small>Minimum to run track</small>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackAutoEnroll" name="auto_enroll">
                                Enable Auto-Enrollment
                            </label>
                            <small>Automatically enroll matching users</small>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackWaitlist" name="waitlist_enabled">
                                Enable Waitlist
                            </label>
                            <small>When track reaches capacity</small>
                        </div>
                    </div>
                </fieldset>

                <!-- Learning Objectives & Prerequisites Section -->
                <fieldset class="fieldset-bordered">
                    <legend class="fieldset-legend">Learning Objectives & Prerequisites</legend>

                    <div class="grid grid-gap-1">
                        <div class="form-group">
                            <label for="customTrackAudience" class="form-label">Target Audience (comma-separated)</label>
                            <input type="text" id="customTrackAudience" name="target_audience"
                                   placeholder="e.g., Software Engineers, Data Analysts, Technical Leads" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="customTrackPrerequisites" class="form-label">Prerequisites (comma-separated)</label>
                            <textarea id="customTrackPrerequisites" name="prerequisites" rows="2"
                                      placeholder="e.g., Python basics, Command line proficiency, Git fundamentals" class="form-input"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="customTrackObjectives" class="form-label">Learning Objectives (comma-separated)</label>
                            <textarea id="customTrackObjectives" name="learning_objectives" rows="3"
                                      placeholder="e.g., Build RESTful APIs, Implement authentication, Deploy applications" class="form-input"></textarea>
                        </div>
                    </div>
                </fieldset>

                <!-- Assessment & Certification Section -->
                <fieldset class="fieldset-bordered">
                    <legend class="fieldset-legend">Assessment & Certification</legend>

                    <div class="grid-2-cols">
                        <div class="form-group">
                            <label for="customTrackPassingScore" class="form-label">Passing Score (%)</label>
                            <input type="number" id="customTrackPassingScore" name="passing_score"
                                   min="0" max="100" value="70" placeholder="e.g., 70" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="customTrackRequiredQuizzes" class="form-label">Required Quizzes</label>
                            <input type="number" id="customTrackRequiredQuizzes" name="required_quizzes"
                                   min="0" max="50" placeholder="e.g., 5" class="form-input">
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackCertificate" name="certificate_enabled" checked>
                                Issue Certificate
                            </label>
                            <small>Upon successful completion</small>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackFinalProject" name="final_project_required">
                                Require Final Project
                            </label>
                        </div>
                    </div>
                </fieldset>

                <!-- Advanced Options Section -->
                <fieldset class="fieldset-bordered">
                    <legend class="fieldset-legend">Advanced Options</legend>

                    <div class="grid-1-col-gap-1">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackAIAssistant" name="ai_assistant_enabled" checked>
                                Enable AI Learning Assistant
                            </label>
                            <small>Provide personalized AI support</small>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackPeerReview" name="peer_review_enabled">
                                Enable Peer Review
                            </label>
                            <small>Students review each other's work</small>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackDiscussionForum" name="discussion_forum_enabled" checked>
                                Enable Discussion Forum
                            </label>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackProgressTracking" name="progress_tracking_enabled" checked>
                                Enable Progress Tracking
                            </label>
                            <small>Track student progress metrics</small>
                        </div>

                        <div class="form-group">
                            <label for="customTrackNotificationFrequency" class="form-label">Notification Frequency</label>
                            <select id="customTrackNotificationFrequency" name="notification_frequency" class="form-select">
                                <option value="none">None</option>
                                <option value="daily">Daily</option>
                                <option value="weekly" selected>Weekly</option>
                                <option value="milestone">Milestone-Based</option>
                            </select>
                        </div>
                    </div>
                </fieldset>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeModal('customTrackModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Custom Track</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Track Details Modal -->
    <div id="trackDetailsModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="trackDetailsModalTitle">
        <div class="modal-content modal-content--lg">
            <span class="close" onclick="closeModal('trackDetailsModal')">&times;</span>
            <h2 id="trackDetailsTitle">Track Details</h2>

            <div id="trackDetailsContent">
                <!-- Track details will be loaded here -->
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeModal('trackDetailsModal')">Close</button>
                <button type="button" class="btn btn-primary" onclick="editTrackFromDetails()">Edit Track</button>
            </div>
        </div>
    </div>

    <!-- Edit Track Modal -->
    <!--
    ========================================
    EDIT TRACK MODAL
    ========================================

    BUSINESS PURPOSE:
    Allows organization admins to modify existing track details including metadata,
    difficulty level, prerequisites, and learning objectives. Changes propagate to
    all associated courses and sub-projects using this track.

    DATABASE MAPPING:
    - Updates course_creator.tracks table by track.id
    - All fields except organization_id and created_at are editable
    - prerequisites and learning_objectives are JSONB arrays
    - difficulty_level enum: beginner, intermediate, advanced
    - estimated_duration_hours: integer (1-10000)

    WORKFLOW:
    1. User clicks "Edit" button on track row in table
    2. JavaScript populates form fields with existing track data
    3. User modifies desired fields
    4. Form submission triggers PUT request to /api/v1/tracks/{id}
    5. Success: Modal closes, table refreshes, success message displayed
    6. Failure: Validation errors displayed inline

    ACCESSIBILITY:
    - ARIA labels for screen readers
    - Keyboard navigation support
    - Pre-populated fields maintain accessibility context
    - Hidden ID field preserves track identity

    CSS CLASSES:
    - modal-backdrop: Full-screen overlay (z-index: 1000)
    - modal-content--md: Medium-width modal (600px)
    - form-group: Standard form field container
    - form-group--full: Full-width form field (spans 2 columns)
    - grid-2-cols: Two-column responsive grid layout

    JAVASCRIPT INTEGRATION:
    - Form submission handled by submitEditTrack() in org-admin-dashboard.js
    - Modal populated by populateEditTrackForm(trackData) function
    - Modal close handled by closeModal() utility function
    - Uses data-form-type attribute for form identification
    -->
    <div id="editTrackModal" class="modal-backdrop" role="dialog" aria-modal="true"
         aria-labelledby="editTrackModalTitle" data-modal="editTrack">
        <div class="modal-content modal-content--md">
            <!-- Close Button: Triggers modal close via data-dismiss attribute -->
            <span class="close" data-dismiss="modal" data-modal-id="editTrackModal"
                  aria-label="Close modal">&times;</span>

            <h2 id="editTrackModalTitle">Edit Track</h2>
            <p class="subtitle-text">Update track information</p>

            <form id="editTrackForm" data-form-type="editTrack">
                <!--
                HIDDEN TRACK ID FIELD
                - Stores UUID of track being edited
                - Required for PUT request to correct endpoint
                - Populated by JavaScript when modal opens
                -->
                <input type="hidden" id="editTrackId" name="id" aria-hidden="true">

                <div class="grid-2-cols">
                    <!--
                    TRACK NAME FIELD
                    - Required field (DB constraint: NOT NULL)
                    - Max length: 255 characters
                    - Pre-populated with existing track name
                    - Changes reflect immediately in track listings
                    -->
                    <div class="form-group form-group--full">
                        <label for="editTrackName" class="form-label required">Track Name</label>
                        <input type="text" id="editTrackName" name="name" required maxlength="255"
                               placeholder="e.g., Python Fundamentals" class="form-input"
                               aria-required="true" aria-describedby="editTrackNameHelp">
                    </div>

                    <!--
                    DESCRIPTION FIELD
                    - Optional field (DB allows NULL)
                    - Textarea for longer text content
                    - Pre-populated with existing description
                    - Displayed in track details view and catalog
                    -->
                    <div class="form-group form-group--full">
                        <label for="editTrackDescription" class="form-label">Description</label>
                        <textarea id="editTrackDescription" name="description" rows="4"
                                  placeholder="Describe the track objectives and content..."
                                  class="form-input" aria-describedby="editTrackDescHelp"></textarea>
                    </div>

                    <!--
                    DIFFICULTY LEVEL FIELD
                    - Enum field: beginner, intermediate, advanced
                    - Default: intermediate (if not set)
                    - Used for filtering and student recommendations
                    - Pre-selected based on existing value
                    -->
                    <div class="form-group">
                        <label for="editTrackDifficultyLevel" class="form-label">Difficulty Level</label>
                        <select id="editTrackDifficultyLevel" name="difficulty_level"
                                class="form-select" aria-describedby="editTrackDiffHelp">
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>

                    <!--
                    ESTIMATED DURATION FIELD
                    - Integer field (hours)
                    - Range: 1-10000 hours
                    - Used for planning and time estimates
                    - Pre-populated with existing duration
                    -->
                    <div class="form-group">
                        <label for="editTrackDurationHours" class="form-label">Estimated Duration (hours)</label>
                        <input type="number" id="editTrackDurationHours" name="estimated_duration_hours"
                               min="1" max="10000" placeholder="e.g., 40" class="form-input"
                               aria-describedby="editTrackDurationHelp">
                        <small id="editTrackDurationHelp">Total estimated learning time in hours</small>
                    </div>

                    <!--
                    PREREQUISITES FIELD (JSONB)
                    - PostgreSQL JSONB array stored as: ["item1", "item2", ...]
                    - Pre-populated with existing array stringified
                    - JavaScript validates JSON format before submission
                    - Displayed as bullet list in track details
                    -->
                    <div class="form-group form-group--full">
                        <label for="editTrackPrerequisites" class="form-label">Prerequisites (JSON Array)</label>
                        <textarea id="editTrackPrerequisites" name="prerequisites" rows="3"
                                  class="form-input" data-json-field="true"
                                  placeholder='["Python basics", "Git fundamentals", "SQL knowledge"]'
                                  aria-describedby="editTrackPrereqHelp"></textarea>
                        <small id="editTrackPrereqHelp">Enter as JSON array. Example: ["Item 1", "Item 2", "Item 3"]</small>
                    </div>

                    <!--
                    LEARNING OBJECTIVES FIELD (JSONB)
                    - PostgreSQL JSONB array stored as: ["objective1", "objective2", ...]
                    - Pre-populated with existing array stringified
                    - JavaScript validates JSON format before submission
                    - Displayed as bullet list to students
                    -->
                    <div class="form-group form-group--full">
                        <label for="editTrackLearningObjectives" class="form-label">Learning Objectives (JSON Array)</label>
                        <textarea id="editTrackLearningObjectives" name="learning_objectives"
                                  rows="3" class="form-input" data-json-field="true"
                                  placeholder='["Master Django framework", "Build REST APIs", "Deploy to production"]'
                                  aria-describedby="editTrackObjHelp"></textarea>
                        <small id="editTrackObjHelp">Enter as JSON array. Example: ["Objective 1", "Objective 2", "Objective 3"]</small>
                    </div>

                    <!--
                    IS ACTIVE CHECKBOX
                    - Boolean field (DB default: true)
                    - Controls track visibility to students
                    - Inactive tracks: Hidden from catalog, cannot enroll
                    - Active tracks: Visible in catalog, enrollments open
                    - Pre-checked based on existing value
                    -->
                    <div class="form-group form-group--full">
                        <label class="form-label">
                            <input type="checkbox" id="editTrackIsActive" name="is_active"
                                   aria-describedby="editTrackActiveHelp">
                            <span>Track is Active</span>
                        </label>
                        <small id="editTrackActiveHelp">Active tracks are visible to students and can accept enrollments</small>
                    </div>
                </div>

                <!--
                MODAL FOOTER ACTIONS
                - Cancel: Closes modal without saving (data-dismiss pattern)
                - Update Track: Submits form (type="submit" triggers form submission)
                - Form submission sends PUT request to /api/v1/tracks/{id}
                -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" data-dismiss="modal"
                            data-modal-id="editTrackModal" aria-label="Cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitEditTrackBtn">Update Track</button>
                </div>
            </form>
        </div>
    </div>

    <!--
    ========================================
    DELETE TRACK CONFIRMATION MODAL
    ========================================

    BUSINESS PURPOSE:
    Provides a confirmation dialog before permanently deleting a track. This is a
    critical operation that affects all associated courses, sub-projects, and student
    enrollments. The modal displays warnings about data loss and cascading effects.

    DATABASE MAPPING:
    - Deletes row from course_creator.tracks table by track.id
    - CASCADE behavior depends on foreign key constraints
    - May soft-delete (is_deleted flag) or hard-delete depending on implementation
    - Related enrollments and progress data handling varies

    WORKFLOW:
    1. User clicks "Delete" button on track row in table
    2. Modal opens with track name and warning message
    3. JavaScript populates deleteTrackWarning with impact details
    4. User confirms or cancels deletion
    5. Confirmation triggers DELETE request to /api/v1/tracks/{id}
    6. Success: Modal closes, table refreshes, track removed
    7. Failure: Error message displayed (e.g., "Track has active enrollments")

    SAFETY FEATURES:
    - Explicit confirmation required (two-step process)
    - Warning message displays potential impact
    - Danger-styled button (red) indicates destructive action
    - Cancel button equally prominent for easy abort

    ACCESSIBILITY:
    - ARIA labels for screen readers
    - Keyboard navigation support (Escape key closes modal)
    - Clear warning text for impact visibility
    - Hidden ID field preserves track identity

    CSS CLASSES:
    - modal-backdrop: Full-screen overlay
    - modal-w-500: Medium-width modal (500px)
    - text-error-bold: Red bold text for warnings
    - btn-danger: Red button indicating destructive action

    JAVASCRIPT INTEGRATION:
    - Modal opened by showDeleteTrackModal(trackId, trackName)
    - Deletion confirmed by confirmDeleteTrack() in org-admin-dashboard.js
    - Modal close handled by closeModal() utility function
    - Uses data-modal attribute for modal management
    -->
    <div id="deleteTrackModal" class="modal-backdrop" role="dialog" aria-modal="true"
         aria-labelledby="deleteTrackModalTitle" data-modal="deleteTrack">
        <div class="modal-content modal-w-500">
            <!-- Close Button: Triggers modal close via data-dismiss attribute -->
            <span class="close" data-dismiss="modal" data-modal-id="deleteTrackModal"
                  aria-label="Close modal">&times;</span>

            <h2 id="deleteTrackModalTitle">Delete Track</h2>

            <!--
            CONFIRMATION MESSAGE
            - Clear question prompts user decision
            - Warning paragraph displays impact details (populated by JavaScript)
            - text-error-bold class makes warning highly visible
            -->
            <p>Are you sure you want to delete this track?</p>
            <p id="deleteTrackWarning" class="text-error-bold" role="alert"></p>

            <!--
            HIDDEN TRACK ID FIELD
            - Stores UUID of track to be deleted
            - Required for DELETE request to correct endpoint
            - Populated by JavaScript when modal opens
            -->
            <input type="hidden" id="deleteTrackId" aria-hidden="true">

            <!--
            MODAL FOOTER ACTIONS
            - Cancel: Closes modal without deleting (data-dismiss pattern)
            - Delete Track: Confirms deletion (data-action triggers confirmDeleteTrack)
            - Danger button styling emphasizes destructive nature
            -->
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" data-dismiss="modal"
                        data-modal-id="deleteTrackModal" aria-label="Cancel">Cancel</button>
                <button type="button" id="confirmDeleteTrackBtn" class="btn btn-danger"
                        data-action="deleteTrack" aria-label="Confirm deletion">Delete Track</button>
            </div>
        </div>
    </div>

    <!-- ========================================================================
         LOCATIONS MANAGEMENT MODALS
         Purpose: Full CRUD operations for locations instances
         ======================================================================== -->

    <!-- Create Locations Modal -->
    <div id="createStandaloneLocationModal" class="modal-backdrop" role="dialog" aria-modal="true"
         aria-labelledby="createStandaloneLocationModalTitle" data-modal="createStandaloneLocation">
        <div class="modal-content modal-w-700">
            <span class="close" data-dismiss="modal" data-modal-id="createStandaloneLocationModal" aria-label="Close modal">&times;</span>

            <h2 id="createStandaloneLocationModalTitle">Create New Locations</h2>

            <form id="createStandaloneLocationForm">
                <!-- Basic Information -->
                <div class="form-group">
                    <label for="standaloneLocationName" class="form-label required">Locations Name</label>
                    <input type="text" id="standaloneLocationName" name="name" required maxlength="255"
                           placeholder="e.g., New York Training Center" class="form-input">
                </div>

                <div class="form-group">
                    <label for="standaloneLocationSlug" class="form-label required">URL Slug</label>
                    <input type="text" id="standaloneLocationSlug" name="slug" required maxlength="100"
                           placeholder="e.g., ny-training-center" class="form-input">
                </div>

                <div class="form-group">
                    <label for="standaloneLocationDescription" class="form-label">Description</label>
                    <textarea id="standaloneLocationDescription" name="description" rows="3" class="form-input"
                              placeholder="Describe this locations instance"></textarea>
                </div>

                <!-- Locations Details -->
                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label for="standaloneLocationCountry" class="form-label required">Country</label>
                        <input type="text" id="standaloneLocationCountry" name="country" required maxlength="100"
                               placeholder="e.g., United States" class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="standaloneLocationRegion" class="form-label">Region/State</label>
                        <input type="text" id="standaloneLocationRegion" name="region" maxlength="100"
                               placeholder="e.g., New York" class="form-input">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label for="standaloneLocationCity" class="form-label">City</label>
                        <input type="text" id="standaloneLocationCity" name="city" maxlength="100"
                               placeholder="e.g., Manhattan" class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="standaloneLocationTimezone" class="form-label required">Timezone</label>
                        <select id="standaloneLocationTimezone" name="timezone" required class="form-select">
                            <option value="UTC">UTC</option>
                            <option value="America/New_York">Eastern Time (ET)</option>
                            <option value="America/Chicago">Central Time (CT)</option>
                            <option value="America/Denver">Mountain Time (MT)</option>
                            <option value="America/Los_Angeles">Pacific Time (PT)</option>
                            <option value="Europe/London">London (GMT)</option>
                            <option value="Europe/Paris">Paris (CET)</option>
                            <option value="Asia/Tokyo">Tokyo (JST)</option>
                        </select>
                    </div>
                </div>

                <!-- Schedule -->
                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label for="standaloneLocationStartDate" class="form-label">Start Date</label>
                        <input type="date" id="standaloneLocationStartDate" name="start_date" class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="standaloneLocationEndDate" class="form-label">End Date</label>
                        <input type="date" id="standaloneLocationEndDate" name="end_date" class="form-input">
                    </div>
                </div>

                <!-- Capacity -->
                <div class="form-group">
                    <label for="standaloneLocationMaxParticipants" class="form-label">Max Participants</label>
                    <input type="number" id="standaloneLocationMaxParticipants" name="max_participants" min="1"
                           placeholder="e.g., 100" class="form-input"
                           data-validate="required,min:1"
                           data-validate-message="Maximum participants must be at least 1">
                    <div class="validation-error" style="display: none;"></div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" data-dismiss="modal"
                            data-modal-id="createStandaloneLocationModal" aria-label="Cancel">Cancel</button>
                    <button type="submit" id="submitCreateStandaloneLocationBtn" class="btn btn-primary"
                            data-action="createStandaloneLocation" aria-label="Create locations">Create Locations</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Locations Modal -->
    <div id="editLocationModal" class="modal-backdrop" role="dialog" aria-modal="true"
         aria-labelledby="editLocationModalTitle" data-modal="editLocation">
        <div class="modal-content modal-w-700">
            <span class="close" data-dismiss="modal" data-modal-id="editLocationModal"
                  aria-label="Close modal">&times;</span>
            
            <h2 id="editLocationModalTitle">Edit Locations</h2>
            
            <form id="editLocationForm">
                <input type="hidden" id="editLocationId" name="id">

                <div class="form-group">
                    <label for="editLocationName" class="form-label required">Locations Name</label>
                    <input type="text" id="editLocationName" name="name" required maxlength="255" class="form-input">
                </div>

                <div class="form-group">
                    <label for="editLocationDescription" class="form-label">Description</label>
                    <textarea id="editLocationDescription" name="description" rows="3" class="form-input"></textarea>
                </div>

                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label for="editLocationCountry" class="form-label required">Country</label>
                        <input type="text" id="editLocationCountry" name="country" required class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="editLocationRegion" class="form-label">Region/State</label>
                        <input type="text" id="editLocationRegion" name="region" class="form-input">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label for="editLocationCity" class="form-label">City</label>
                        <input type="text" id="editLocationCity" name="city" class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="editLocationTimezone" class="form-label required">Timezone</label>
                        <select id="editLocationTimezone" name="timezone" required class="form-select">
                            <option value="UTC">UTC</option>
                            <option value="America/New_York">Eastern Time (ET)</option>
                            <option value="America/Chicago">Central Time (CT)</option>
                            <option value="America/Denver">Mountain Time (MT)</option>
                            <option value="America/Los_Angeles">Pacific Time (PT)</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label for="editLocationStartDate" class="form-label">Start Date</label>
                        <input type="date" id="editLocationStartDate" name="start_date" class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="editLocationEndDate" class="form-label">End Date</label>
                        <input type="date" id="editLocationEndDate" name="end_date" class="form-input">
                    </div>
                </div>

                <div class="form-group">
                    <label for="editLocationMaxParticipants" class="form-label">Max Participants</label>
                    <input type="number" id="editLocationMaxParticipants" name="max_participants" min="1" class="form-input">
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" data-dismiss="modal"
                            data-modal-id="editLocationModal" aria-label="Cancel">Cancel</button>
                    <button type="submit" id="submitEditLocationBtn" class="btn btn-primary"
                            data-action="updateLocation" aria-label="Update locations">Update Locations</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Locations Modal -->
    <div id="deleteLocationModal" class="modal-backdrop" role="dialog" aria-modal="true"
         aria-labelledby="deleteLocationModalTitle" data-modal="deleteLocation">
        <div class="modal-content modal-w-500">
            <span class="close" data-dismiss="modal" data-modal-id="deleteLocationModal"
                  aria-label="Close modal">&times;</span>
            
            <h2 id="deleteLocationModalTitle">Delete Locations</h2>
            
            <p class="mb-md">
                Are you sure you want to delete <strong id="deleteLocationName"></strong>?
                This will also delete all tracks associated with this locations.
            </p>
            
            <input type="hidden" id="deleteLocationId">
            
            <div class="modal-actions">
                <button type="button" class="btn btn-outline" data-dismiss="modal"
                        data-modal-id="deleteLocationModal" aria-label="Cancel">Cancel</button>
                <button type="button" id="confirmDeleteLocationBtn" class="btn btn-danger"
                        data-action="deleteLocation" aria-label="Confirm deletion">Delete Locations</button>
            </div>
        </div>
    </div>

    <!-- ========================================================================
         TRACK AT LOCATIONS LEVEL MODALS
         Purpose: Create custom tracks for specific locations instances
         User Requirement: "locations dashboard should be able to add or delete tracks"
         ======================================================================== -->

    <!-- Create Track at Locations Modal -->
    <div id="createTrackAtLocationModal" class="modal-backdrop" role="dialog" aria-modal="true"
         aria-labelledby="createTrackAtLocationModalTitle" data-modal="createTrackAtLocation">
        <div class="modal-content modal-w-700">
            <span class="close" data-dismiss="modal" data-modal-id="createTrackAtLocationModal"
                  aria-label="Close modal">&times;</span>
            
            <h2 id="createTrackAtLocationModalTitle">Create Track for Locations</h2>
            
            <form id="createTrackAtLocationForm">
                <input type="hidden" id="locationTrackLocationId" name="location_id">

                <div class="form-group">
                    <label for="locationTrackName" class="form-label required">Track Name</label>
                    <input type="text" id="locationTrackName" name="name" required maxlength="255"
                           placeholder="e.g., Local Business Analyst Track" class="form-input">
                </div>

                <div class="form-group">
                    <label for="locationTrackDescription" class="form-label">Description</label>
                    <textarea id="locationTrackDescription" name="description" rows="3" class="form-input"
                              placeholder="Describe this custom track for the locations"></textarea>
                </div>

                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label for="locationTrackType" class="form-label required">Track Type</label>
                        <select id="locationTrackType" name="track_type" required class="form-select">
                            <option value="sequential">Sequential</option>
                            <option value="flexible">Flexible</option>
                            <option value="milestone_based">Milestone Based</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="locationTrackDifficultyLevel" class="form-label required">Difficulty Level</label>
                        <select id="locationTrackDifficultyLevel" name="difficulty_level" required class="form-select">
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label for="locationTrackDurationWeeks" class="form-label">Duration (weeks)</label>
                        <input type="number" id="locationTrackDurationWeeks" name="duration_weeks" min="1" max="104"
                               placeholder="e.g., 12" class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="locationTrackMaxStudents" class="form-label">Max Students</label>
                        <input type="number" id="locationTrackMaxStudents" name="max_students" min="1"
                               placeholder="e.g., 30" class="form-input"
                               data-validate="required,min:1"
                               data-validate-message="Maximum number of students must be at least 1"
                               oninput="validateLocationTrackMaxStudents()">
                        <div class="validation-error" style="display: none;"></div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" data-dismiss="modal"
                            data-modal-id="createTrackAtLocationModal" aria-label="Cancel">Cancel</button>
                    <button type="submit" id="submitCreateTrackAtLocationBtn" class="btn btn-primary"
                            data-action="createTrackAtLocation" aria-label="Create track">Create Track</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Track at Locations Modal -->
    <div id="editTrackAtLocationModal" class="modal-backdrop" role="dialog" aria-modal="true"
         aria-labelledby="editTrackAtLocationModalTitle" data-modal="editTrackAtLocation">
        <div class="modal-content modal-w-700">
            <span class="close" data-dismiss="modal" data-modal-id="editTrackAtLocationModal"
                  aria-label="Close modal">&times;</span>
            
            <h2 id="editTrackAtLocationModalTitle">Edit Track</h2>
            
            <form id="editTrackAtLocationForm">
                <input type="hidden" id="editLocationTrackId" name="id">

                <div class="form-group">
                    <label for="editLocationTrackName" class="form-label required">Track Name</label>
                    <input type="text" id="editLocationTrackName" name="name" required maxlength="255" class="form-input">
                </div>

                <div class="form-group">
                    <label for="editLocationTrackDescription" class="form-label">Description</label>
                    <textarea id="editLocationTrackDescription" name="description" rows="3" class="form-input"></textarea>
                </div>

                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label for="editLocationTrackType" class="form-label required">Track Type</label>
                        <select id="editLocationTrackType" name="track_type" required class="form-select">
                            <option value="sequential">Sequential</option>
                            <option value="flexible">Flexible</option>
                            <option value="milestone_based">Milestone Based</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="editLocationTrackDifficultyLevel" class="form-label required">Difficulty Level</label>
                        <select id="editLocationTrackDifficultyLevel" name="difficulty_level" required class="form-select">
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                        <label for="editLocationTrackDurationWeeks" class="form-label">Duration (weeks)</label>
                        <input type="number" id="editLocationTrackDurationWeeks" name="duration_weeks" min="1" max="104" class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="editLocationTrackMaxStudents" class="form-label">Max Students</label>
                        <input type="number" id="editLocationTrackMaxStudents" name="max_students" min="1" class="form-input"
                               data-validate="required,min:1"
                               data-validate-message="Maximum number of students must be at least 1"
                               oninput="validateEditLocationTrackMaxStudents()">
                        <div class="validation-error" style="display: none;"></div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" data-dismiss="modal"
                            data-modal-id="editTrackAtLocationModal" aria-label="Cancel">Cancel</button>
                    <button type="submit" id="submitEditTrackAtLocationBtn" class="btn btn-primary"
                            data-action="updateTrackAtLocation" aria-label="Update track">Update Track</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Track at Locations Modal -->
    <div id="deleteTrackAtLocationModal" class="modal-backdrop" role="dialog" aria-modal="true"
         aria-labelledby="deleteTrackAtLocationModalTitle" data-modal="deleteTrackAtLocation">
        <div class="modal-content modal-w-500">
            <span class="close" data-dismiss="modal" data-modal-id="deleteTrackAtLocationModal"
                  aria-label="Close modal">&times;</span>
            
            <h2 id="deleteTrackAtLocationModalTitle">Delete Track</h2>
            
            <p class="mb-md">
                Are you sure you want to delete <strong id="deleteLocationTrackName"></strong>?
                This action cannot be undone.
            </p>
            
            <input type="hidden" id="deleteLocationTrackId">
            
            <div class="modal-actions">
                <button type="button" class="btn btn-outline" data-dismiss="modal"
                        data-modal-id="deleteTrackAtLocationModal" aria-label="Cancel">Cancel</button>
                <button type="button" id="confirmDeleteTrackAtLocationBtn" class="btn btn-danger"
                        data-action="deleteTrackAtLocation" aria-label="Confirm deletion">Delete Track</button>
            </div>
        </div>
    </div>

    <!-- Generate Course Modal -->
    <div id="generateCourseModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="generateCourseModalTitle">
        <div class="modal-content" class="modal-w-700">
            <span class="close" onclick="closeModal('generateCourseModal')">&times;</span>
            <h2 id="generateCourseModalTitle">Generate Course with AI</h2>

            <form id="generateCourseForm">
                <div class="form-group">
                    <label for="generateCourseTitle" class="form-label required">Course Title</label>
                    <input type="text" id="generateCourseTitle" name="title" required maxlength="200"
                           placeholder="e.g., Introduction to Python Programming" class="form-input">
                </div>

                <div class="form-group">
                    <label for="generateCourseDescription" class="form-label required">Course Description</label>
                    <textarea id="generateCourseDescription" name="description" required rows="4"
                              placeholder="A comprehensive course for beginners learning Python programming..." class="form-input"></textarea>
                    <small class="form-help">This description will be used by AI to generate course content</small>
                </div>

                <div class="grid-2-cols">
                    <div class="form-group">
                        <label for="generateCourseCategory" class="form-label required">Category</label>
                        <select id="generateCourseCategory" name="category" required class="form-select">
                            <option value="">Select Category</option>
                            <option value="Programming">Programming</option>
                            <option value="Data Science">Data Science</option>
                            <option value="Web Development">Web Development</option>
                            <option value="DevOps">DevOps</option>
                            <option value="Cloud Computing">Cloud Computing</option>
                            <option value="Cybersecurity">Cybersecurity</option>
                            <option value="Database">Database</option>
                            <option value="AI/ML">AI/ML</option>
                            <option value="Mobile Development">Mobile Development</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="generateCourseDifficulty" class="form-label required">Difficulty Level</label>
                        <select id="generateCourseDifficulty" name="difficulty" required class="form-select">
                            <option value="">Select Difficulty</option>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="generateCourseDuration" class="form-label">Estimated Duration (hours)</label>
                    <input type="number" id="generateCourseDuration" name="duration" min="1" max="500"
                           placeholder="e.g., 40" class="form-input">
                </div>

                <!-- Success message -->
                <div class="generation-success" id="generateCourseSuccess" class="success-banner">
                    Course generated successfully!
                </div>

                <div class="flex-end mt-2rem">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('generateCourseModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitGenerateCourse">
                        üöÄ Generate Course
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Course Details/Edit Modal -->
    <div id="courseDetailsModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="courseDetailsModalTitle">
        <div class="modal-content modal-content--lg">
            <span class="close close-modal" onclick="closeModal('courseDetailsModal')">&times;</span>
            <h2 id="courseDetailsModalTitle">Course Details</h2>

            <div id="courseDetailsContent">
                <!-- Course details will be populated here -->
                <div id="courseSyllabusContent">
                    <!-- Syllabus content -->
                </div>
            </div>

            <div class="flex-end mt-2rem">
                <button type="button" class="btn btn-secondary" onclick="closeModal('courseDetailsModal')">Close</button>
                <button type="button" class="btn btn-primary" id="editSyllabusBtn" onclick="showEditSyllabusModal()">
                    ‚úèÔ∏è Edit Syllabus
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Syllabus Modal -->
    <div id="editSyllabusModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="editSyllabusModalTitle">
        <div class="modal-content modal-content--lg">
            <span class="close close-modal" onclick="closeModal('editSyllabusModal')">&times;</span>
            <h2 id="editSyllabusModalTitle">Edit Course Syllabus</h2>

            <form id="editSyllabusForm">
                <div class="form-group">
                    <label for="editSyllabusTitle" class="form-label required">Course Title</label>
                    <input type="text" id="editSyllabusTitle" name="title" required maxlength="200" class="form-input">
                </div>

                <div class="form-group">
                    <label for="editSyllabusDescription" class="form-label">Description</label>
                    <textarea id="editSyllabusDescription" name="description" rows="3" class="form-input"></textarea>
                </div>

                <h3 class="mt-2rem mb-lg">Course Modules</h3>
                <div id="editModulesList">
                    <!-- Module editing fields will be populated here -->
                    <div class="form-group course-module">
                        <label for="editModule1Title" class="form-label">Module 1 Title</label>
                        <input type="text" id="editModule1Title" name="module_1_title" maxlength="200"
                               placeholder="Module 1 Title" class="form-input">
                    </div>
                </div>

                <div class="generation-success" id="saveSyllabusSuccess" class="success-banner">
                    Syllabus updated successfully
                </div>

                <div class="flex-end mt-2rem">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editSyllabusModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="saveSyllabusEditsBtn">
                        üíæ Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Floating Action Button (FAB) -->
    <button class="fab" id="fabButton" onclick="toggleFabMenu()" title="Quick Actions">
        <i class="fas fa-plus" id="fabIcon"></i>
    </button>

    <!-- FAB Menu -->
    <div class="fab-menu" id="fabMenu">
        <div class="fab-menu-item" onclick="fabAction('project')">
            <i class="fas fa-project-diagram"></i>
            <span>New Project</span>
        </div>
        <div class="fab-menu-item" onclick="fabAction('instructor')">
            <i class="fas fa-chalkboard-teacher"></i>
            <span>Add Instructor</span>
        </div>
        <div class="fab-menu-item" onclick="fabAction('student')">
            <i class="fas fa-user-plus"></i>
            <span>Add Student</span>
        </div>
        <div class="fab-menu-item" onclick="fabAction('track')">
            <i class="fas fa-road"></i>
            <span>New Track</span>
        </div>
        <div class="fab-menu-item" onclick="fabAction('settings')">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </div>
    </div>

    <script src="../js/config-global.js"></script>
    <script type="module">
        // Import Auth module and initialize it for dashboard
        import { Auth } from '../js/modules/auth.js';
        import { showNotification } from '../js/modules/notifications.js';

        // Make Auth available globally for the dashboard script
        window.Auth = Auth;
        window.authManager = Auth;  // org-admin-core.js expects window.authManager
        window.showNotification = showNotification;

        console.log('‚úÖ Auth module loaded and made global');
        console.log('üîç Auth object:', window.Auth);
        console.log('üîç Has startSessionMonitoring?', typeof window.Auth?.startSessionMonitoring);
        console.log('üîç Has activityTracker?', typeof window.Auth?.activityTracker);

        // Initialize auth FIRST (loads saved token and starts token refresh)
        if (window.Auth) {
            console.log('üîê Initializing auth system from dashboard HTML...');
            try {
                window.Auth.initializeAuth();  // CRITICAL: This starts token refresh!
                window.Auth.startSessionMonitoring();
                console.log('‚úÖ Auth initialized and session monitoring started');
            } catch (error) {
                console.error('‚ùå Error initializing auth:', error);
            }
        }
    </script>
    <!-- File Explorer Initialization -->
    <script type="module">
        // Initialize file explorer when Files tab is loaded
        import { initOrgAdminFileExplorer } from '../js/modules/org-admin-file-manager.js';

        // Track if file explorer has been initialized
        let fileExplorerInitialized = false;

        // Listen for tab changes
        document.addEventListener('click', (e) => {
            const tabLink = e.target.closest('[data-tab="files"]');
            if (tabLink && !fileExplorerInitialized) {
                // Get organization ID from URL
                const urlParams = new URLSearchParams(window.location.search);
                const orgId = urlParams.get('org_id') || 1;

                // Initialize file explorer
                setTimeout(() => {
                    const fileExplorer = initOrgAdminFileExplorer('orgFileExplorerContainer', orgId);
                    if (fileExplorer) {
                        fileExplorerInitialized = true;
                        console.log('‚úÖ File explorer initialized for org admin');
                    }
                }, 100);
            }
        });
    </script>

    <!-- Floating AI Assistant for Main Dashboard -->
    <div id="dashboardAIChatPanel" class="ai-assistant-panel ai-panel-fixed">
        <!-- Draggable header -->
        <div class="ai-assistant-header ai-panel-header">
            <h4 class="ai-panel-title">üí¨ AI Assistant</h4>
            <button type="button" onclick="toggleDashboardAIChat()" class="ai-panel-close-btn">&times;</button>
        </div>

        <!-- Chat content -->
        <div class="ai-panel-content-wrapper">
            <p class="ai-panel-intro-text">
                Ask me anything about managing your organization, creating projects, or platform features.
            </p>

            <!-- Messages container -->
            <div id="dashboardAIChatMessages" class="ai-panel-messages-container">
                <div class="ai-message">
                    <strong class="ai-message-author">ü§ñ AI Assistant:</strong>
                    <p class="ai-message-text">
                        Hi! I'm here to help you manage your organization. You can ask me to:
                        <br>‚Ä¢ Create new projects or tracks
                        <br>‚Ä¢ Add instructors or students
                        <br>‚Ä¢ Get analytics and reports
                        <br>‚Ä¢ Find specific features
                    </p>
                </div>
            </div>

            <!-- Input area -->
            <div class="chat-input-container">
                <textarea id="dashboardAIChatInput" placeholder="Ask AI for help..." class="chat-textarea form-input" onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendDashboardAIChatMessage(); }"></textarea>
                <button type="button" onclick="sendDashboardAIChatMessage()" class="btn btn-primary" class="chat-send-button whitespace-nowrap">üì§</button>
            </div>
        </div>
    </div>

    <!-- Floating AI Assistant Button -->
    <button id="aiAssistantButton" onclick="toggleDashboardAIChat()" class="ai-assistant-fab" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
        üí¨
    </button>

    <!-- Help Button (F1) -->
    <button id="helpButton" onclick="window.HelpSystem.openHelpModal()" class="help-fab" title="Help (Press F1)" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
        ‚ùì
        <span class="help-fab-hint">Press F1 for Help</span>
    </button>

    <!-- Help Modal -->
    <div id="helpModal" class="help-modal">
        <div class="help-modal-content">
            <!-- Header -->
            <div class="help-header">
                <h1>üìö Help & Documentation</h1>
                <button class="help-close-btn" onclick="window.HelpSystem.closeHelpModal()">&times;</button>
            </div>

            <!-- Search Bar -->
            <div class="help-search-bar">
                <input
                    type="text"
                    id="helpSearchInput"
                    class="help-search-input"
                    placeholder="üîç Search help articles..."
                    oninput="window.HelpSystem.searchHelp(this.value)"
                >
            </div>

            <!-- Main Body -->
            <div class="help-body">
                <!-- Sidebar with categories -->
                <div class="help-sidebar">
                    <button class="help-category-btn active" data-category="gettingStarted" onclick="window.HelpSystem.showHelpCategory('gettingStarted')">
                        <span class="category-icon">üöÄ</span> Getting Started
                    </button>
                    <button class="help-category-btn" data-category="projects" onclick="window.HelpSystem.showHelpCategory('projects')">
                        <span class="category-icon">üìã</span> Projects
                    </button>
                    <button class="help-category-btn" data-category="tracks" onclick="window.HelpSystem.showHelpCategory('tracks')">
                        <span class="category-icon">üõ§Ô∏è</span> Tracks
                    </button>
                    <button class="help-category-btn" data-category="members" onclick="window.HelpSystem.showHelpCategory('members')">
                        <span class="category-icon">üë•</span> Members
                    </button>
                    <button class="help-category-btn" data-category="analytics" onclick="window.HelpSystem.showHelpCategory('analytics')">
                        <span class="category-icon">üìä</span> Analytics
                    </button>
                    <button class="help-category-btn" data-category="settings" onclick="window.HelpSystem.showHelpCategory('settings')">
                        <span class="category-icon">‚öôÔ∏è</span> Settings
                    </button>
                    <button class="help-category-btn" data-category="shortcuts" onclick="window.HelpSystem.showHelpCategory('shortcuts')">
                        <span class="category-icon">‚å®Ô∏è</span> Keyboard Shortcuts
                    </button>

                    <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">

                    <button class="help-category-btn" onclick="window.HelpSystem.startGuidedTour()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                        <span class="category-icon">üéØ</span> Guided Tour
                    </button>
                </div>

                <!-- Content Area -->
                <div id="helpContentArea" class="help-content">
                    <!-- Content loaded dynamically by JavaScript -->
                    <div class="help-category-header">
                        <h2>üöÄ Getting Started</h2>
                    </div>
                    <p>Loading help content...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Toggle dashboard AI chat panel
        function toggleDashboardAIChat() {
            const panel = document.getElementById('dashboardAIChatPanel');
            const button = document.getElementById('aiAssistantButton');

            if (panel.style.display === 'none' || !panel.style.display) {
                panel.style.display = 'flex';
                button.style.display = 'none';
                makeDraggable(panel, panel.querySelector('.ai-assistant-header'));
            } else {
                panel.style.display = 'none';
                button.style.display = 'block';
            }
        }

        // Toggle modal AI chat (inside project creation modal)
        function toggleModalAIChat() {
            const panel = document.getElementById('modalAIChatPanel');
            if (panel) {
                panel.style.display = panel.style.display === 'none' ? 'flex' : 'none';
            }
        }

        // Send dashboard AI chat message
        async function sendDashboardAIChatMessage() {
            const input = document.getElementById('dashboardAIChatInput');
            const messagesContainer = document.getElementById('dashboardAIChatMessages');

            if (!input || !messagesContainer) return;

            const userMessage = input.value.trim();
            if (!userMessage) return;

            // Add user message
            const userDiv = document.createElement('div');
            userDiv.innerHTML = `
                <div class="user-message-wrapper">
                    <strong class="user-message-sender">You:</strong>
                    <p class="user-message-bubble">
                        ${escapeHtml(userMessage)}
                    </p>
                </div>
            `;
            messagesContainer.appendChild(userDiv);
            input.value = '';
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Show typing indicator
            const typingDiv = document.createElement('div');
            typingDiv.className = 'ai-typing';
            typingDiv.innerHTML = '<em class="ai-typing">ü§ñ AI is thinking...</em>';
            messagesContainer.appendChild(typingDiv);

            try {
                // Call AI assistant (use existing AI module)
                if (window.OrgAdmin && window.OrgAdmin.AI && window.OrgAdmin.AI.sendMessage) {
                    const response = await window.OrgAdmin.AI.sendMessage(userMessage);
                    typingDiv.remove();

                    const aiDiv = document.createElement('div');
                    aiDiv.innerHTML = `
                        <div class="mb-lg">
                            <strong class="ai-message-author">ü§ñ AI Assistant:</strong>
                            <p class="ai-message-text">
                                ${escapeHtml(response.message || 'I can help you with that. What would you like to know?')}
                            </p>
                        </div>
                    `;
                    messagesContainer.appendChild(aiDiv);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            } catch (error) {
                typingDiv.remove();
                console.error('AI chat error:', error);
            }
        }

        // Send modal AI chat message
        async function sendModalAIChatMessage() {
            const input = document.getElementById('modalAIChatInput');
            const messagesContainer = document.getElementById('modalAIChatMessages');

            if (!input || !messagesContainer) return;

            const userMessage = input.value.trim();
            if (!userMessage) return;

            // Use the existing sendAIChatMessage from org-admin-projects.js
            if (window.OrgAdmin && window.OrgAdmin.Projects && window.OrgAdmin.Projects.sendAIChatMessage) {
                // Set the input values for the existing function
                document.getElementById('aiChatInput').value = userMessage;
                await window.OrgAdmin.Projects.sendAIChatMessage();
                input.value = '';
            }
        }

        // Make element draggable
        function makeDraggable(element, handle) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            let isDragging = false;
            let isInitialized = false;

            handle.onmousedown = dragMouseDown;
            handle.style.cursor = 'move';

            function dragMouseDown(e) {
                // Don't drag if clicking on interactive elements
                const target = e.target;
                const interactiveTags = ['INPUT', 'BUTTON', 'SELECT', 'TEXTAREA', 'A'];
                if (interactiveTags.includes(target.tagName) || target.closest('button, input, select, textarea, a')) {
                    return;
                }

                e.preventDefault();
                e.stopPropagation();  // Prevent event from bubbling to backdrop

                // On first drag, remove CSS centering transform and convert to positioned element
                if (!isInitialized) {
                    const rect = element.getBoundingClientRect();
                    // Use setProperty with 'important' to override CSS !important rules
                    element.style.setProperty('transform', 'none', 'important');
                    element.style.setProperty('top', rect.top + 'px', 'important');
                    element.style.setProperty('left', rect.left + 'px', 'important');
                    isInitialized = true;
                }

                pos3 = e.clientX;
                pos4 = e.clientY;
                isDragging = true;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;

                // Add dragging cursor to body
                document.body.style.cursor = 'move';
            }

            function elementDrag(e) {
                if (!isDragging) return;
                e.preventDefault();
                e.stopPropagation();

                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;

                // Use setProperty with 'important' to ensure positioning works
                element.style.setProperty('top', (element.offsetTop - pos2) + 'px', 'important');
                element.style.setProperty('left', (element.offsetLeft - pos1) + 'px', 'important');
            }

            function closeDragElement() {
                isDragging = false;
                document.onmouseup = null;
                document.onmousemove = null;

                // Restore default cursor
                document.body.style.cursor = '';
            }
        }

        // Expose makeDraggable globally so it can be called from modules
        window.makeDraggable = makeDraggable;

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Toggle upload help section
        function toggleUploadHelp() {
            const helpSection = document.getElementById('uploadHelp');
            if (helpSection) {
                helpSection.style.display = helpSection.style.display === 'none' ? 'block' : 'none';
            }
        }

        /**
         * Handle project type selection change
         * Updates UI to show/hide locations information and sets has_sub_projects flag
         *
         * @param {string} value - The selected project type ('single_location' or 'multi_location')
         */
        function handleProjectTypeChange(value) {
            const hasSubProjectsInput = document.getElementById('hasSubProjects');
            const locationInfoNote = document.getElementById('locationInfoNote');

            if (value === 'multi_location') {
                // Multi-locations project selected
                if (hasSubProjectsInput) {
                    hasSubProjectsInput.value = 'true';
                }
                if (locationInfoNote) {
                    locationInfoNote.style.display = 'block';
                }
            } else {
                // Single locations project selected
                if (hasSubProjectsInput) {
                    hasSubProjectsInput.value = 'false';
                }
                if (locationInfoNote) {
                    locationInfoNote.style.display = 'none';
                }
            }
        }

        // ==============================================================================
        // LOCATIONS CREATION WIZARD FUNCTIONS
        // ==============================================================================

        let currentLocationStep = 1;
        const locationFormData = {};

        // Wave 5: Locations wizard refactored - functions now in locations-wizard.js module
        // Access via window.LocationWizard.nextStep(), window.LocationWizard.previousStep(), etc.
        
        // Initialize wizard when DOM ready
        document.addEventListener('DOMContentLoaded', async () => {
            if (typeof window.LocationWizard !== 'undefined') {
                await window.LocationWizard.initialize();
            }
        });

        // Wrapper functions for onclick handlers (delegate to module)
        function nextLocationStep() {
            if (window.LocationWizard) window.LocationWizard.nextStep();
        }
        
        function previousLocationStep() {
            if (window.LocationWizard) window.LocationWizard.previousStep();
        }
        
        function resetLocationWizard() {
            if (window.LocationWizard) window.LocationWizard.reset();
        }
        
        function submitLocationCreation() {
            if (window.LocationWizard) window.LocationWizard.submit();
        }
        // ==============================================================================
        // PROJECT DETAIL VIEW FUNCTIONS
        // ==============================================================================

        let currentLocations = [];
        let selectedLocationIds = [];

        /**
         * Open project detail view modal
         * @param {string} projectId - The project ID to view
         */
        async function openProjectDetail(projectId) {
            // Store globally for locations creation
            window.currentProjectId = projectId;

            const modal = document.getElementById('projectDetailView');
            modal.style.display = 'flex';

            try {
                const organizationId = localStorage.getItem('organization_id');
                const token = localStorage.getItem('token');

                // Fetch project details
                const response = await fetch(
                    `https://localhost:8004/api/v1/organizations/${organizationId}/projects/${projectId}`,
                    {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );

                if (!response.ok) {
                    throw new Error('Failed to load project details');
                }

                const project = await response.json();

                // Update modal title
                document.getElementById('projectDetailTitle').textContent = `üìÅ ${project.name}`;

                // Populate overview tab
                populateProjectOverview(project);

                // Load locations if project has sub-projects
                if (project.has_sub_projects) {
                    await loadProjectLocations(projectId);
                }

            } catch (error) {
                console.error('Error loading project details:', error);
                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification(
                        `Failed to load project: ${error.message}`,
                        'error'
                    );
                }
            }
        }

        /**
         * Close project detail view modal
         */
        function closeProjectDetail() {
            const modal = document.getElementById('projectDetailView');
            modal.style.display = 'none';
            window.currentProjectId = null;
            currentLocations = [];
            selectedLocationIds = [];
        }

        /**
         * Switch between project detail tabs
         * @param {string} tabName - The tab to switch to (overview, locations, analytics)
         */
        function switchProjectDetailTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('#projectDetailView .tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.borderBottomColor = 'transparent';
            });
            const activeBtn = document.querySelector(`#projectDetailView .tab-btn[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.style.borderBottomColor = 'var(--primary-color)';
            }

            // Update tab content
            document.querySelectorAll('.project-detail-tab').forEach(tab => {
                tab.style.display = 'none';
            });

            if (tabName === 'overview') {
                document.getElementById('projectDetailOverview').style.display = 'block';
            } else if (tabName === 'locations') {
                document.getElementById('locationsTabContent').style.display = 'block';
            } else if (tabName === 'analytics') {
                document.getElementById('projectDetailAnalytics').style.display = 'block';
            }
        }

        /**
         * Populate project overview tab
         * @param {object} project - Project data
         */
        function populateProjectOverview(project) {
            const content = document.getElementById('projectOverviewContent');
            content.innerHTML = `
                <div class="grid grid-gap-1-5">
                    <div class="card-hover-bg">
                        <h3>Project Information</h3>
                        <p><strong>Name:</strong> ${project.name}</p>
                        <p><strong>Slug:</strong> ${project.slug}</p>
                        <p><strong>Description:</strong> ${project.description || 'No description'}</p>
                        <p><strong>Status:</strong> <span class="badge-status">${project.status}</span></p>
                        <p><strong>Multi-Locations:</strong> ${project.has_sub_projects ? '‚úÖ Yes (Locations enabled)' : '‚ùå No'}</p>
                    </div>
                    <div class="card-hover-bg">
                        <h3>Schedule</h3>
                        <p><strong>Start Date:</strong> ${project.start_date || 'Not set'}</p>
                        <p><strong>End Date:</strong> ${project.end_date || 'Not set'}</p>
                        <p><strong>Duration:</strong> ${project.duration_weeks ? `${project.duration_weeks} weeks` : 'Not calculated'}</p>
                    </div>
                </div>
            `;
        }

        /**
         * Load and display project locations
         * @param {string} projectId - The project ID
         */
        async function loadProjectLocations(projectId) {
            try {
                const organizationId = localStorage.getItem('organization_id');
                const token = localStorage.getItem('token');

                // Build query params from filters
                const params = new URLSearchParams();
                const country = document.getElementById('locationCountryFilter').value;
                const region = document.getElementById('locationRegionFilter').value;
                const city = document.getElementById('locationCityFilter').value;
                const status = document.getElementById('locationStatusFilter').value;
                const dateFrom = document.getElementById('locationDateFromFilter').value;
                const dateTo = document.getElementById('locationDateToFilter').value;

                if (country) params.append('location_country', country);
                if (region) params.append('location_region', region);
                if (city) params.append('location_city', city);
                if (status) params.append('status', status);
                if (dateFrom) params.append('start_date_from', dateFrom);
                if (dateTo) params.append('start_date_to', dateTo);

                // Fetch locations
                const response = await fetch(
                    `https://localhost:8004/api/v1/organizations/${organizationId}/projects/${projectId}/sub-projects?${params}`,
                    {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );

                if (!response.ok) {
                    throw new Error('Failed to load locations');
                }

                const locations = await response.json();
                currentLocations = Array.isArray(locations) ? locations : [];

                // Display locations
                displayLocationsList(currentLocations);

            } catch (error) {
                console.error('Error loading locations:', error);
                document.getElementById('locationsList').innerHTML = `
                    <div class="error-message-block">
                        <p>Failed to load locations: ${error.message}</p>
                    </div>
                `;
            }
        }

        /**
         * Display locations in list view
         * @param {array} locations - Array of locations objects
         */
        function displayLocationsList(locations) {
            const locationsList = document.getElementById('locationsList');
            const emptyState = document.getElementById('locationsEmptyState');

            if (!locations || locations.length === 0) {
                locationsList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';

            locationsList.innerHTML = locations.map(locationItem => {
                const locationAddress = [locationItem.location_city, locationItem.location_region, locationItem.location_country]
                    .filter(Boolean)
                    .join(', ');

                const capacity = locationItem.max_participants
                    ? `${locationItem.current_participants || 0}/${locationItem.max_participants}`
                    : 'Unlimited';

                const statusColors = {
                    'draft': '#6c757d',
                    'active': '#28a745',
                    'completed': '#007bff',
                    'cancelled': '#dc3545',
                    'archived': '#6c757d'
                };

                return `
                    <div class="locations-item card-locations-item">
                        <div class="flex-between-start">
                            <div class="flex-1">
                                <div class="flex-center-gap-1">
                                    <input type="checkbox" class="locations-checkbox w-18 h-18" data-locations-id="${locationItem.id}" onchange="toggleLocationSelection('${locationItem.id}')">
                                    <h3 class="h3-no-margin">${locationItem.name}</h3>
                                    <span class="badge-status-dynamic" style="background: ${statusColors[locationItem.status] || '#6c757d'};">
                                        ${locationItem.status}
                                    </span>
                                </div>
                                <p class="text-muted text-my-xs text-xs">${locationItem.description || 'No description'}</p>
                                <div class="grid-auto-fit-200">
                                    <div>
                                        <strong class="locations-locations">üìç Address:</strong><br>
                                        <span>${locationAddress}</span>
                                    </div>
                                    <div>
                                        <strong>üìÖ Schedule:</strong><br>
                                        <span class="locations-start-date">${locationItem.start_date || 'TBD'}</span> - ${locationItem.end_date || 'TBD'}
                                        ${locationItem.duration_weeks ? `<span class="text-muted text-xs">(${locationItem.duration_weeks} weeks)</span>` : ''}
                                    </div>
                                    <div>
                                        <strong class="locations-capacity">üë• Capacity:</strong><br>
                                        <span>${capacity}</span>
                                    </div>
                                    <div>
                                        <strong>üåê Timezone:</strong><br>
                                        <span>${locationItem.timezone || 'UTC'}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-gap-0-5">
                                <button class="btn btn-secondary btn-padding-sm" onclick="editLocation('${locationItem.id}')">‚úèÔ∏è Edit</button>
                                <button class="btn btn-secondary btn-padding-sm" onclick="viewLocationDetails('${locationItem.id}')">üëÅÔ∏è View</button>
                                <button class="btn btn-secondary btn-padding-sm btn-danger" onclick="deleteLocation('${locationItem.id}', '${locationItem.name}')">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * Apply locations filters
         */
        function applyLocationFilters() {
            if (window.currentProjectId) {
                loadProjectLocations(window.currentProjectId);
            }
        }

        /**
         * Clear all locations filters
         */
        function clearLocationFilters() {
            document.getElementById('locationCountryFilter').value = '';
            document.getElementById('locationRegionFilter').value = '';
            document.getElementById('locationCityFilter').value = '';
            document.getElementById('locationStatusFilter').value = '';
            document.getElementById('locationDateFromFilter').value = '';
            document.getElementById('locationDateToFilter').value = '';

            applyLocationFilters();
        }

        /**
         * Show locations list view
         */
        function showLocationListView() {
            document.getElementById('locationListViewContainer').style.display = 'block';
            document.getElementById('locationTimelineContainer').style.display = 'none';

            document.getElementById('locationListViewBtn').classList.add('active');
            document.getElementById('locationTimelineViewBtn').classList.remove('active');
        }

        /**
         * Show locations timeline view
         */
        function showLocationTimelineView() {
            document.getElementById('locationListViewContainer').style.display = 'none';
            document.getElementById('locationTimelineContainer').style.display = 'block';

            document.getElementById('locationListViewBtn').classList.remove('active');
            document.getElementById('locationTimelineViewBtn').classList.add('active');

            // Render timeline
            renderLocationTimeline(currentLocations);
        }

        /**
         * Render locations timeline visualization
         * @param {array} locations - Array of locations objects
         */
        function renderLocationTimeline(locations) {
            const timelineContent = document.getElementById('timelineContent');

            if (!locations || locations.length === 0) {
                timelineContent.innerHTML = '<p class="timeline-empty-message text-center">No locations to display on timeline.</p>';
                return;
            }

            // Simple timeline visualization (can be enhanced with a library like vis.js)
            const html = locations.map(locations => {
                const width = locations.duration_weeks ? `${Math.min(locations.duration_weeks * 10, 300)}px` : '100px';
                return `
                    <div class="timeline-bar card-timeline-bar">
                        <div class="timeline-label">${locations.name}</div>
                        <div class="flex-gap-2">
                            <span class="timeline-start"><strong>Start:</strong> ${locations.start_date || 'TBD'}</span>
                            <div class="flex-1 timeline-progress-bar h-8" style="max-width: ${width};"></div>
                            <span class="timeline-end"><strong>End:</strong> ${locations.end_date || 'TBD'}</span>
                        </div>
                        <div class="text-muted text-xs mt-0-5">
                            üìç ${[locations.location_city, locations.location_country].filter(Boolean).join(', ')}
                        </div>
                    </div>
                `;
            }).join('');

            timelineContent.innerHTML = html;
        }

        /**
         * Open create locations modal
         */
        function openCreateLocationModal() {
            // Close project detail view
            closeProjectDetail();

            // Open locations creation modal
            const modal = document.getElementById('createLocationModal');
            modal.style.display = 'flex';
        }

        /**
         * Toggle locations selection for comparison
         * @param {string} locationId - The locations ID
         */
        function toggleLocationSelection(locationId) {
            const checkbox = document.querySelector(`.locations-checkbox[data-locations-id="${locationId}"]`);

            if (checkbox.checked) {
                if (!selectedLocationIds.includes(locationId)) {
                    selectedLocationIds.push(locationId);
                }
            } else {
                selectedLocationIds = selectedLocationIds.filter(id => id !== locationId);
            }

            updateLocationSelectionControls();
        }

        /**
         * Update comparison controls visibility
         */
        function updateLocationSelectionControls() {
            const controls = document.getElementById('locationComparisonControls');
            const countSpan = document.getElementById('selectedLocationCount');

            if (selectedLocationIds.length > 0) {
                controls.style.display = 'block';
                countSpan.textContent = `${selectedLocationIds.length} locations${selectedLocationIds.length > 1 ? 's' : ''} selected`;
            } else {
                controls.style.display = 'none';
            }
        }

        /**
         * Clear locations selection
         */
        function clearLocationSelection() {
            selectedLocationIds = [];
            document.querySelectorAll('.locations-checkbox').forEach(cb => cb.checked = false);
            updateLocationSelectionControls();
        }

        /**
         * Open locations comparison modal
         */
        function openLocationComparison() {
            if (selectedLocationIds.length < 2) {
                alert('Please select at least 2 locations to compare.');
                return;
            }

            const selectedLocations = currentLocations.filter(c => selectedLocationIds.includes(c.id));

            const modal = document.getElementById('locationComparisonModal');
            const table = document.getElementById('comparisonTable');

            // Build comparison table
            const metrics = [
                { label: 'Locations', key: 'locations', format: (c) => [c.location_city, c.location_region, c.location_country].filter(Boolean).join(', ') },
                { label: 'Start Date', key: 'start_date' },
                { label: 'End Date', key: 'end_date' },
                { label: 'Duration', key: 'duration_weeks', format: (c) => c.duration_weeks ? `${c.duration_weeks} weeks` : 'N/A' },
                { label: 'Capacity', key: 'max_participants', format: (c) => c.max_participants ? `${c.current_participants || 0}/${c.max_participants}` : 'Unlimited' },
                { label: 'Status', key: 'status' },
                { label: 'Timezone', key: 'timezone' }
            ];

            let html = '<thead><tr><th>Metric</th>';
            selectedLocations.forEach(locations => {
                html += `<th class="locations-column-header">${locations.name}</th>`;
            });
            html += '</tr></thead><tbody>';

            metrics.forEach(metric => {
                html += `<tr data-metric="${metric.key}"><td><strong>${metric.label}</strong></td>`;
                selectedLocations.forEach(locations => {
                    const value = metric.format ? metric.format(locations) : (locations[metric.key] || 'N/A');
                    html += `<td>${value}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody>';
            table.innerHTML = html;

            modal.style.display = 'flex';
        }

        /**
         * Edit locations
         * @param {string} locationId - The locations ID
         */
        function editLocation(locationId) {
            // TODO: Implement edit functionality
            alert(`Edit locations ${locationId} - Feature coming soon`);
        }

        /**
         * View locations details
         * @param {string} locationId - The locations ID
         */
        function viewLocationDetails(locationId) {
            // TODO: Implement view details
            const locations = currentLocations.find(c => c.id === locationId);
            if (locations) {
                alert(`Locations Details:\n\nName: ${locations.name}\nLocation: ${[locations.location_city, locations.location_country].filter(Boolean).join(', ')}\nStatus: ${locations.status}`);
            }
        }

        /**
         * Delete locations
         * @param {string} locationId - The locations ID
         * @param {string} locationName - The locations name
         */
        async function deleteLocation(locationId, locationName) {
            if (!confirm(`Are you sure you want to delete "${locationName}"? This action cannot be undone.`)) {
                return;
            }

            try {
                const organizationId = localStorage.getItem('organization_id');
                const token = localStorage.getItem('token');

                const response = await fetch(
                    `https://localhost:8004/api/v1/organizations/${organizationId}/projects/${window.currentProjectId}/sub-projects/${locationId}`,
                    {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );

                if (!response.ok) {
                    throw new Error('Failed to delete locations');
                }

                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification(
                        `Locations "${locationName}" deleted successfully`,
                        'success'
                    );
                }

                // Reload locations
                await loadProjectLocations(window.currentProjectId);

            } catch (error) {
                console.error('Error deleting locations:', error);
                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification(
                        `Failed to delete locations: ${error.message}`,
                        'error'
                    );
                }
            }
        }

        // Handle spreadsheet upload for project creation
        async function handleProjectSpreadsheetUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const fileNameSpan = document.getElementById('uploadedFileName');
            fileNameSpan.textContent = `Uploading ${file.name}...`;

            try {
                // Create FormData to send file
                const formData = new FormData();
                formData.append('file', file);

                // Send to backend for parsing
                const response = await fetch('https://localhost:8004/api/v1/projects/import-spreadsheet', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`Upload failed: ${response.statusText}`);
                }

                const data = await response.json();

                fileNameSpan.textContent = `‚úÖ ${file.name} parsed successfully! AI is analyzing...`;
                fileNameSpan.style.color = '#28a745';

                // Store parsed data globally for AI assistant and project creation
                window.parsedProjectData = data;

                // Send to AI assistant for validation and analysis
                await sendProjectToAIForValidation(data, file.name);

            } catch (error) {
                console.error('Error uploading spreadsheet:', error);
                fileNameSpan.textContent = `‚ùå Error: ${error.message}`;
                fileNameSpan.style.color = '#dc3545';

                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification(`Failed to import spreadsheet: ${error.message}`, 'error');
                }
            }
        }

        // Send parsed project data to AI assistant for validation
        async function sendProjectToAIForValidation(projectData, filename) {
            const aiChatMessages = document.getElementById('aiChatMessages');
            if (!aiChatMessages) {
                console.error('AI chat messages container not found');
                return;
            }

            // Build validation prompt for AI
            const validationPrompt = `I've uploaded a project spreadsheet (${filename}) with the following data:

**Project Information:**
- Name: ${projectData.project_name}
- Slug: ${projectData.project_slug}
- Description: ${projectData.description}
- Start Date: ${projectData.start_date || 'Not specified'}
- End Date: ${projectData.end_date || 'Not specified'}

**Training Tracks:** ${projectData.tracks && projectData.tracks.length > 0 ? projectData.tracks.join(', ') : 'None specified'}

**Students:** ${projectData.students && projectData.students.length > 0 ? projectData.students.length + ' students' : 'None specified'}
${projectData.students && projectData.students.length > 0 ? projectData.students.map(s => `  - ${s.email}${s.name ? ' (' + s.name + ')' : ''}`).join('\\n') : ''}

**Instructors:** ${projectData.instructors && projectData.instructors.length > 0 ? projectData.instructors.length + ' instructors' : 'None specified'}
${projectData.instructors && projectData.instructors.length > 0 ? projectData.instructors.map(i => `  - ${i.email}${i.name ? ' (' + i.name + ')' : ''}`).join('\\n') : ''}

Please analyze this project data and:
1. Check for any errors, inconsistencies, or missing critical information
2. Validate email addresses format
3. Suggest improvements or optimizations
4. Recommend any additional tracks, students, or instructors that might be beneficial
5. Provide an overall assessment

If everything looks good and you approve, I'll proceed with automated project creation including all tracks, students, and instructors.`;

            // Add user message to chat
            const userMessage = document.createElement('div');
            userMessage.className = 'ai-message user-message';
            userMessage.innerHTML = `<div class="message-content">${escapeHtml(validationPrompt).replace(/\n/g, '<br>')}</div>`;
            aiChatMessages.appendChild(userMessage);
            aiChatMessages.scrollTop = aiChatMessages.scrollHeight;

            // Send to AI assistant
            const aiInput = document.getElementById('aiInput');
            if (aiInput) {
                aiInput.value = validationPrompt;

                // Trigger AI assistant send (assumes sendAIMessage function exists)
                if (typeof sendAIMessage === 'function') {
                    await sendAIMessage();
                }
            }

            // Show notification
            if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                window.OrgAdmin.Utils.showNotification('Project data sent to AI for validation. Check the AI Assistant panel for analysis.', 'info');
            }
        }

        // Create project automatically after AI approval
        async function createProjectFromAIApproval() {
            if (!window.parsedProjectData) {
                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification('No project data available. Please upload a spreadsheet first.', 'error');
                }
                return;
            }

            const fileNameSpan = document.getElementById('uploadedFileName');
            if (fileNameSpan) {
                fileNameSpan.textContent = '‚öôÔ∏è Creating project automatically...';
                fileNameSpan.style.color = '#007bff';
            }

            try {
                // Send to automated project creation endpoint
                const response = await fetch('https://localhost:8004/api/v1/projects/create-from-spreadsheet', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(window.parsedProjectData)
                });

                if (!response.ok) {
                    throw new Error(`Project creation failed: ${response.statusText}`);
                }

                const result = await response.json();

                if (fileNameSpan) {
                    fileNameSpan.textContent = `‚úÖ Project created successfully!`;
                    fileNameSpan.style.color = '#28a745';
                }

                // Show success notification with details
                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    const message = `Project "${result.project_name}" created with ${result.tracks_created || 0} tracks, ${result.students_enrolled || 0} students, and ${result.instructors_assigned || 0} instructors.`;
                    window.OrgAdmin.Utils.showNotification(message, 'success');
                }

                // Close modal and refresh projects
                closeModal('createProjectModal');
                if (window.OrgAdmin && window.OrgAdmin.Projects && window.OrgAdmin.Projects.loadProjects) {
                    await window.OrgAdmin.Projects.loadProjects();
                }

                // Clear stored data
                window.parsedProjectData = null;

            } catch (error) {
                console.error('Error creating project:', error);

                if (fileNameSpan) {
                    fileNameSpan.textContent = `‚ùå Error: ${error.message}`;
                    fileNameSpan.style.color = '#dc3545';
                }

                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification(`Failed to create project: ${error.message}`, 'error');
                }
            }
        }

        // Download project import template
        async function downloadProjectTemplate() {
            try {
                const response = await fetch('https://localhost:8004/api/v1/projects/template', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`Download failed: ${response.statusText}`);
                }

                // Get the blob and create download link
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'project_import_template.xlsx';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);

                // Show notification
                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification('Template downloaded successfully!', 'success');
                }

            } catch (error) {
                console.error('Error downloading template:', error);

                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification(`Failed to download template: ${error.message}`, 'error');
                }
            }
        }

        // Make modals draggable
        document.addEventListener('DOMContentLoaded', function() {
            // Make project creation modal draggable from header
            const projectModal = document.getElementById('createProjectModal');
            const projectHandle = document.querySelector('#createProjectModal .draggable-handle');

            if (projectModal && projectHandle) {
                makeDraggable(projectModal, projectHandle);
            }

            // Make locations creation modal draggable
            const locationModal = document.getElementById('createLocationModal');
            const locationHandle = document.querySelector('#createLocationModal .draggable-handle');

            if (locationModal && locationHandle) {
                makeDraggable(locationModal, locationHandle);
            }

            // Make project detail view draggable
            const detailView = document.getElementById('projectDetailView');
            const detailHandle = document.querySelector('#projectDetailView .draggable-handle');

            if (detailView && detailHandle) {
                makeDraggable(detailView, detailHandle);
            }
        });
    </script>

    <!-- Project Date Calculation Script -->
    <script>
    /**
     * Calculate project end date from start date and duration, excluding weekends
     *
     * BUSINESS CONTEXT:
     * Projects run Monday-Friday only. Duration in weeks means number of business weeks.
     * Weekends (Saturday, Sunday) are not counted as project days.
     *
     * TECHNICAL IMPLEMENTATION:
     * - Reads start date and duration (weeks) from form fields
     * - Calculates end date by adding business days (5 days per week)
     * - Skips weekends during calculation
     * - Sets calculated end date in readonly field
     *
     * USAGE:
     * Called automatically when:
     * - User changes project start date
     * - User changes project duration
     */
    function calculateProjectEndDate() {
        const startDateInput = document.getElementById('projectStartDate');
        const durationInput = document.getElementById('projectDuration');
        const endDateInput = document.getElementById('projectEndDate');

        // Validation: require both start date and duration
        if (!startDateInput || !durationInput || !endDateInput) {
            return;
        }

        const startDateValue = startDateInput.value;
        const durationWeeks = parseInt(durationInput.value);

        // Validation: require valid inputs
        if (!startDateValue || !durationWeeks || durationWeeks < 1) {
            endDateInput.value = '';
            return;
        }

        // Parse start date
        const startDate = new Date(startDateValue + 'T00:00:00');

        // Calculate total business days needed (5 days per week)
        const totalBusinessDays = durationWeeks * 5;

        // Calculate end date by adding business days (excluding weekends)
        // IMPORTANT: Start date counts as the first business day
        let currentDate = new Date(startDate);
        let businessDaysAdded = 1;  // Count start date as day 1

        while (businessDaysAdded < totalBusinessDays) {
            currentDate.setDate(currentDate.getDate() + 1);
            const dayOfWeek = currentDate.getDay();

            // Skip weekends (0 = Sunday, 6 = Saturday)
            if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                businessDaysAdded++;
            }
        }

        // Format date as YYYY-MM-DD for date input
        const year = currentDate.getFullYear();
        const month = String(currentDate.getMonth() + 1).padStart(2, '0');
        const day = String(currentDate.getDate()).padStart(2, '0');
        const endDateFormatted = `${year}-${month}-${day}`;

        // Set calculated end date
        endDateInput.value = endDateFormatted;
    }

    // Make function globally accessible
    window.calculateProjectEndDate = calculateProjectEndDate;

    /**
     * Calculate location end date from start date and duration (excluding weekends)
     *
     * BUSINESS CONTEXT:
     * Locations (sub-projects) use the same business day calculation as the main project.
     * Duration is measured in weeks (5 business days each), excluding weekends.
     *
     * TECHNICAL IMPLEMENTATION:
     * - Reads locationStartDate and locationDuration inputs
     * - Calculates business days (weeks * 5)
     * - Iterates through dates, skipping weekends
     * - Sets the calculated end date in locationEndDate input (readonly)
     *
     * USAGE:
     * Called automatically when:
     * - User changes location start date
     * - User changes location duration
     */
    function calculateLocationEndDate() {
        const startDateInput = document.getElementById('locationStartDate');
        const durationInput = document.getElementById('locationDuration');
        const endDateInput = document.getElementById('locationEndDate');

        // Validation: require all inputs to exist
        if (!startDateInput || !durationInput || !endDateInput) {
            return;
        }

        const startDateValue = startDateInput.value;
        const durationWeeks = parseInt(durationInput.value);

        // Validation: require valid inputs
        if (!startDateValue || !durationWeeks || durationWeeks < 1) {
            endDateInput.value = '';
            return;
        }

        // Parse start date
        const startDate = new Date(startDateValue + 'T00:00:00');

        // Calculate total business days needed (5 days per week)
        const totalBusinessDays = durationWeeks * 5;

        // Calculate end date by adding business days (excluding weekends)
        // IMPORTANT: Start date counts as the first business day
        let currentDate = new Date(startDate);
        let businessDaysAdded = 1;  // Count start date as day 1

        while (businessDaysAdded < totalBusinessDays) {
            currentDate.setDate(currentDate.getDate() + 1);
            const dayOfWeek = currentDate.getDay();

            // Skip weekends (0 = Sunday, 6 = Saturday)
            if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                businessDaysAdded++;
            }
        }

        // Format date as YYYY-MM-DD for date input
        const year = currentDate.getFullYear();
        const month = String(currentDate.getMonth() + 1).padStart(2, '0');
        const day = String(currentDate.getDate()).padStart(2, '0');
        const endDateFormatted = `${year}-${month}-${day}`;

        // Set calculated end date
        endDateInput.value = endDateFormatted;
    }

    // Make function globally accessible
    window.calculateLocationEndDate = calculateLocationEndDate;

    /**
     * Auto-generate URL slug from project name
     *
     * BUSINESS CONTEXT:
     * URL slugs must be unique, URL-safe identifiers for projects.
     * Auto-generating from the project name ensures:
     * - Consistent formatting (lowercase, hyphens)
     * - Valid characters only (alphanumeric + hyphens)
     * - User-friendly URLs that reflect the project name
     *
     * TECHNICAL IMPLEMENTATION:
     * - Converts to lowercase
     * - Replaces spaces and special characters with hyphens
     * - Removes consecutive hyphens
     * - Trims leading/trailing hyphens
     * - Matches pattern: ^[a-z0-9-]+$
     *
     * USAGE:
     * Called automatically when user types in project name field
     */
    function generateProjectSlug() {
        const nameInput = document.getElementById('projectName');
        const slugInput = document.getElementById('projectSlug');

        if (!nameInput || !slugInput) return;

        const projectName = nameInput.value;

        // Convert to lowercase and replace spaces with hyphens
        let slug = projectName
            .toLowerCase()
            .trim()
            // Replace spaces with hyphens
            .replace(/\s+/g, '-')
            // Replace special characters with hyphens
            .replace(/[^a-z0-9-]/g, '-')
            // Remove consecutive hyphens
            .replace(/-+/g, '-')
            // Remove leading/trailing hyphens
            .replace(/^-+|-+$/g, '');

        slugInput.value = slug;
    }

    // Make function globally accessible
    window.generateProjectSlug = generateProjectSlug;

    /**
     * Validate project slug in real-time and show error message
     *
     * BUSINESS CONTEXT:
     * Provides immediate feedback to users when they manually edit the slug field.
     * Prevents submission of invalid slugs by showing clear validation errors.
     *
     * TECHNICAL IMPLEMENTATION:
     * - Tests slug against pattern: ^[a-z0-9-]+$
     * - Shows/hides validation error message
     * - Adds visual feedback (red border on error)
     *
     * USAGE:
     * Called automatically when user types in slug field
     */
    function validateProjectSlug() {
        const slugInput = document.getElementById('projectSlug');
        const errorDiv = document.getElementById('projectSlugError');

        if (!slugInput || !errorDiv) return true;

        const slug = slugInput.value.trim();

        // Pattern: lowercase letters, numbers, hyphens only
        const validPattern = /^[a-z0-9-]+$/;

        if (!slug) {
            // Empty is handled by required validation
            errorDiv.style.display = 'none';
            slugInput.style.borderColor = '';
            return false;
        }

        if (!validPattern.test(slug)) {
            // Show error message
            const invalidChars = slug.replace(/[a-z0-9-]/g, '').split('').filter((v, i, a) => a.indexOf(v) === i);
            const charList = invalidChars.length > 0 ? ` Invalid characters: ${invalidChars.join(', ')}` : '';

            errorDiv.textContent = `Only lowercase letters (a-z), numbers (0-9), and hyphens (-) are allowed.${charList}`;
            errorDiv.style.display = 'block';
            slugInput.style.borderColor = '#dc2626';
            return false;
        } else {
            // Valid slug
            errorDiv.style.display = 'none';
            slugInput.style.borderColor = '#10b981'; // Green border for valid
            return true;
        }
    }

    // Make function globally accessible
    window.validateProjectSlug = validateProjectSlug;

    /**
     * Validate maximum participants field (project) in real-time
     *
     * BUSINESS CONTEXT:
     * Maximum participants must be a positive integer (whole number).
     * Provides immediate feedback when users enter invalid data.
     *
     * TECHNICAL IMPLEMENTATION:
     * - Checks if value is a positive integer
     * - Shows error for negative numbers, decimals, or non-numeric input
     * - Provides visual feedback (red/green border)
     *
     * USAGE:
     * Called automatically when user types in project max participants field
     */
    function validateMaxParticipants() {
        const input = document.getElementById('projectMaxParticipants');
        const errorDiv = document.getElementById('projectMaxParticipantsError');

        if (!input || !errorDiv) return true;

        // Check for invalid input first (e.g., non-numeric characters in type="number" field)
        if (input.validity.badInput) {
            errorDiv.textContent = 'Invalid input - please enter numbers only';
            errorDiv.style.display = 'block';
            input.style.borderColor = '#dc2626';
            return false;
        }

        const value = input.value.trim();

        // Empty is allowed (unlimited capacity)
        if (!value) {
            errorDiv.style.display = 'none';
            input.style.borderColor = '';
            return true;
        }

        // Check if it's a valid positive integer
        const num = Number(value);
        const isValid = !isNaN(num) && num > 0 && Number.isInteger(num);

        if (!isValid) {
            let errorMsg = 'Must be a positive whole number (e.g., 10, 25, 50)';

            if (num <= 0) {
                errorMsg = 'Must be greater than 0';
            } else if (!Number.isInteger(num)) {
                errorMsg = 'Must be a whole number (no decimals)';
            }

            errorDiv.textContent = errorMsg;
            errorDiv.style.display = 'block';
            input.style.borderColor = '#dc2626';
            return false;
        } else {
            errorDiv.style.display = 'none';
            input.style.borderColor = '#10b981'; // Green border for valid
            return true;
        }
    }

    // Make function globally accessible
    window.validateMaxParticipants = validateMaxParticipants;

    /**
     * Validate maximum participants field (location) in real-time
     *
     * BUSINESS CONTEXT:
     * Location maximum participants must be a positive integer.
     * Same validation logic as project max participants.
     *
     * USAGE:
     * Called automatically when user types in location max participants field
     */
    function validateLocationMaxParticipants() {
        const input = document.getElementById('locationMaxParticipants');
        const errorDiv = document.getElementById('locationMaxParticipantsError');

        if (!input || !errorDiv) return true;

        // Check for invalid input first (e.g., non-numeric characters in type="number" field)
        if (input.validity.badInput) {
            errorDiv.textContent = 'Invalid input - please enter numbers only';
            errorDiv.style.display = 'block';
            input.style.borderColor = '#dc2626';
            return false;
        }

        const value = input.value.trim();

        // Empty is allowed (unlimited capacity)
        if (!value) {
            errorDiv.style.display = 'none';
            input.style.borderColor = '';
            return true;
        }

        // Check if it's a valid positive integer
        const num = Number(value);
        const isValid = !isNaN(num) && num > 0 && Number.isInteger(num);

        if (!isValid) {
            let errorMsg = 'Must be a positive whole number (e.g., 10, 25, 50)';

            if (num <= 0) {
                errorMsg = 'Must be greater than 0';
            } else if (!Number.isInteger(num)) {
                errorMsg = 'Must be a whole number (no decimals)';
            }

            errorDiv.textContent = errorMsg;
            errorDiv.style.display = 'block';
            input.style.borderColor = '#dc2626';
            return false;
        } else {
            errorDiv.style.display = 'none';
            input.style.borderColor = '#10b981'; // Green border for valid
            return true;
        }
    }

    // Make function globally accessible
    window.validateLocationMaxParticipants = validateLocationMaxParticipants;

    /**
     * Validate locationTrackMaxStudents field (real-time validation)
     *
     * BUSINESS PURPOSE:
     * Provides immediate feedback when user enters max students for a location track
     * Ensures value is a positive whole number greater than 0 (required field)
     *
     * VALIDATION RULES:
     * - Required (cannot be empty)
     * - Must be positive integer > 0
     * - No decimals allowed
     */
    function validateLocationTrackMaxStudents() {
        const input = document.getElementById('locationTrackMaxStudents');
        const errorDiv = input ? input.nextElementSibling : null;

        if (!input || !errorDiv) return true;

        const value = input.value.trim();

        // Required field - cannot be empty
        if (!value) {
            errorDiv.textContent = 'Maximum number of students is required';
            errorDiv.style.display = 'block';
            input.style.borderColor = '#dc2626';
            return false;
        }

        // Check if it's a valid positive integer
        const num = Number(value);
        const isValid = !isNaN(num) && num > 0 && Number.isInteger(num);

        if (!isValid) {
            let errorMsg = 'Must be a positive whole number (e.g., 10, 25, 50)';

            if (num <= 0) {
                errorMsg = 'Must be greater than 0';
            } else if (!Number.isInteger(num)) {
                errorMsg = 'Must be a whole number (no decimals)';
            }

            errorDiv.textContent = errorMsg;
            errorDiv.style.display = 'block';
            input.style.borderColor = '#dc2626';
            return false;
        } else {
            errorDiv.style.display = 'none';
            errorDiv.textContent = '';
            input.style.borderColor = '#10b981'; // Green border for valid
            return true;
        }
    }

    // Make function globally accessible
    window.validateLocationTrackMaxStudents = validateLocationTrackMaxStudents;

    /**
     * Validate editLocationTrackMaxStudents field (real-time validation for edit modal)
     *
     * BUSINESS PURPOSE:
     * Provides immediate feedback when user edits max students for an existing location track
     * Ensures value is a positive whole number greater than 0 (required field)
     *
     * VALIDATION RULES:
     * - Required (cannot be empty)
     * - Must be positive integer > 0
     * - No decimals allowed
     */
    function validateEditLocationTrackMaxStudents() {
        const input = document.getElementById('editLocationTrackMaxStudents');
        const errorDiv = input ? input.nextElementSibling : null;

        if (!input || !errorDiv) return true;

        const value = input.value.trim();

        // Required field - cannot be empty
        if (!value) {
            errorDiv.textContent = 'Maximum number of students is required';
            errorDiv.style.display = 'block';
            input.style.borderColor = '#dc2626';
            return false;
        }

        // Check if it's a valid positive integer
        const num = Number(value);
        const isValid = !isNaN(num) && num > 0 && Number.isInteger(num);

        if (!isValid) {
            let errorMsg = 'Must be a positive whole number (e.g., 10, 25, 50)';

            if (num <= 0) {
                errorMsg = 'Must be greater than 0';
            } else if (!Number.isInteger(num)) {
                errorMsg = 'Must be a whole number (no decimals)';
            }

            errorDiv.textContent = errorMsg;
            errorDiv.style.display = 'block';
            input.style.borderColor = '#dc2626';
            return false;
        } else {
            errorDiv.style.display = 'none';
            errorDiv.textContent = '';
            input.style.borderColor = '#10b981'; // Green border for valid
            return true;
        }
    }

    // Make function globally accessible
    window.validateEditLocationTrackMaxStudents = validateEditLocationTrackMaxStudents;
    </script>

    <!-- Navigation System Module (Wave 4) -->
    <script type="module" src="../js/modules/navigation-system.js"></script>

    <!-- Locations Wizard Module (Wave 5 - WizardFramework) -->
    <script type="module" src="../js/modules/locations-wizard.js"></script>

    <!-- Tracks CRUD Module (TDD Implementation - Matches course_creator.tracks Schema) -->
    <script type="module" src="../js/modules/org-admin/tracks-crud.js"></script>

    <!-- Course Management Module (TDD Implementation - Course Creation with Locations) -->
    <script type="module" src="../js/modules/org-admin-courses.js"></script>

    <!-- Scheduling Module (TDD Implementation - Instructor Scheduling with Conflict Detection) -->
    <script type="module" src="../js/modules/org-admin-scheduling.js"></script>

    <!-- Help System Module (Comprehensive Help with AI Integration) -->
    <script type="module" src="../js/modules/help-system.js"></script>

    <!-- AI Assistant Chat Widget -->
    <button class="ai-chat-toggle" id="ai-chat-toggle" onclick="toggleAIChat()">
        ü§ñ AI Assistant
    </button>

    <div class="ai-chat-panel" id="ai-chat-panel">
        <div class="ai-chat-header">
            <span>ü§ñ AI Project Assistant</span>
            <button class="ai-chat-close" onclick="toggleAIChat()">√ó</button>
        </div>

        <div class="ai-quick-actions">
            <button class="ai-quick-action" onclick="sendQuickQuestion('Help me create a training project')">
                üí° Project ideas
            </button>
            <button class="ai-quick-action" onclick="sendQuickQuestion('Suggest learning tracks')">
                üìö Suggest tracks
            </button>
            <button class="ai-quick-action" onclick="sendQuickQuestion('Best practices for multi-locations projects')">
                üåç Multi-locations tips
            </button>
        </div>

        <div class="ai-chat-messages" id="ai-chat-messages">
            <div class="ai-message assistant">
                <div class="ai-message-bubble">
                    üëã Hi! I'm your AI project assistant. I can help you with:
                    <br><br>
                    ‚Ä¢ <strong>Project planning</strong> and structure
                    <br>
                    ‚Ä¢ <strong>Learning track</strong> recommendations
                    <br>
                    ‚Ä¢ <strong>Multi-locations</strong> project setup
                    <br>
                    ‚Ä¢ <strong>Best practices</strong> for training programs
                    <br><br>
                    Just ask me anything about creating your project!
                </div>
            </div>
            <div class="ai-typing" id="ai-typing" style="display: none;">
                <div class="ai-typing-dots">
                    <div class="ai-typing-dot"></div>
                    <div class="ai-typing-dot"></div>
                    <div class="ai-typing-dot"></div>
                </div>
            </div>
        </div>

        <div class="ai-chat-input-container">
            <input type="text"
                   class="ai-chat-input"
                   id="ai-chat-input"
                   placeholder="Ask me anything about projects..."
                   onkeypress="handleAIChatKeypress(event)">
            <button class="ai-chat-send" id="ai-chat-send" onclick="sendAIMessage()">
                Send
            </button>
        </div>
    </div>

    <style>
        /* AI Chat Widget Styles */
        .ai-chat-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 9999;
        }

        .ai-chat-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
        }

        .ai-chat-toggle.active {
            background: #ef4444;
        }

        .ai-chat-panel {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 400px;
            height: 600px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            z-index: 9998;
        }

        .ai-chat-panel.active {
            display: flex;
        }

        .ai-chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 12px 12px 0 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ai-chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .ai-chat-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .ai-quick-actions {
            display: flex;
            gap: 0.5rem;
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            flex-wrap: wrap;
        }

        .ai-quick-action {
            padding: 0.5rem 0.75rem;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ai-quick-action:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .ai-message {
            display: flex;
            gap: 0.5rem;
        }

        .ai-message.assistant {
            flex-direction: row;
        }

        .ai-message.user {
            flex-direction: row-reverse;
        }

        .ai-message-bubble {
            padding: 0.75rem 1rem;
            border-radius: 12px;
            max-width: 80%;
        }

        .ai-message.assistant .ai-message-bubble {
            background: #f3f4f6;
            color: #1f2937;
        }

        .ai-message.user .ai-message-bubble {
            background: #667eea;
            color: white;
        }

        .ai-typing {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .ai-typing-dots {
            display: flex;
            gap: 4px;
        }

        .ai-typing-dot {
            width: 8px;
            height: 8px;
            background: #9ca3af;
            border-radius: 50%;
            animation: aiTyping 1.4s infinite;
        }

        .ai-typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .ai-typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes aiTyping {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: translateY(0);
            }
            30% {
                opacity: 1;
                transform: translateY(-10px);
            }
        }

        .ai-chat-input-container {
            display: flex;
            gap: 0.5rem;
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
        }

        .ai-chat-input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
        }

        .ai-chat-send {
            padding: 0.75rem 1.5rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        .ai-chat-send:hover {
            background: #5568d3;
        }

        /* Project Summary Popup Styles */
        .summary-toggle-container {
            margin: 1rem 0;
            text-align: center;
        }

        .btn-outline-small {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-outline-small:hover {
            background: #667eea;
            color: white;
        }

        .project-summary-popup {
            position: fixed;
            bottom: 30px;
            right: 120px;
            width: 320px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 9500;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .project-summary-popup-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .project-summary-popup-title {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .project-summary-close-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            width: 24px;
            height: 24px;
            transition: transform 0.2s;
        }

        .project-summary-close-btn:hover {
            transform: scale(1.2);
        }

        .project-summary-popup-body {
            padding: 1.5rem;
        }

        .project-summary-stat {
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .project-summary-stat:last-child {
            margin-bottom: 0;
        }

        .project-summary-stat-label {
            font-size: 0.85rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .project-summary-stat-value {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .project-summary-stat-value--primary {
            color: #667eea;
        }

        .project-summary-stat-value--success {
            color: #10b981;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .project-summary-popup {
                right: 10px;
                left: 10px;
                width: auto;
            }
        }
    </style>

    <!-- AI Assistant Integration Module -->
    <script type="module">
        import { initializeAIAssistant, sendContextAwareMessage, CONTEXT_TYPES } from '../js/modules/ai-assistant.js';
        import { escapeHtml } from '../js/modules/org-admin-utils.js';

        /**
         * AI Chat Functions
         *
         * BUSINESS CONTEXT:
         * Provides an AI-powered assistant for project creation with context awareness,
         * RAG integration, and intelligent suggestions based on the knowledge base.
         */

        // Initialize AI Assistant on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Get current organization and project context
            const orgId = window.currentOrganizationId || null;

            // Initialize with PROJECT_CREATION context
            initializeAIAssistant(CONTEXT_TYPES.PROJECT_CREATION, {
                organizationId: orgId,
                contextType: 'org_admin_dashboard'
            });

            console.log('‚úÖ AI Assistant initialized for org-admin dashboard');

            // Initialize Help System with keyboard shortcuts and AI integration
            if (window.HelpSystem && window.HelpSystem.initializeHelpSystem) {
                window.HelpSystem.initializeHelpSystem();
                console.log('‚úÖ Help System initialized with AI integration and F1 keyboard shortcut');
            }
        });

        window.toggleAIChat = function() {
            const toggle = document.getElementById('ai-chat-toggle');
            const panel = document.getElementById('ai-chat-panel');

            toggle.classList.toggle('active');
            panel.classList.toggle('active');

            // Focus input when opening
            if (panel.classList.contains('active')) {
                document.getElementById('ai-chat-input').focus();
            }
        };

        window.sendQuickQuestion = function(question) {
            const input = document.getElementById('ai-chat-input');
            input.value = question;
            window.sendAIMessage();
        };

        window.handleAIChatKeypress = function(event) {
            if (event.key === 'Enter') {
                window.sendAIMessage();
            }
        };

        window.sendAIMessage = async function() {
            const input = document.getElementById('ai-chat-input');
            const message = input.value.trim();

            if (!message) return;

            // Add user message to chat
            const messagesContainer = document.getElementById('ai-chat-messages');
            const userMessage = document.createElement('div');
            userMessage.className = 'ai-message user';
            userMessage.innerHTML = `<div class="ai-message-bubble">${escapeHtml(message)}</div>`;
            messagesContainer.appendChild(userMessage);

            // Clear input
            input.value = '';

            // Show typing indicator
            const typing = document.getElementById('ai-typing');
            typing.style.display = 'flex';

            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            try {
                /**
                 * WHY USE sendContextAwareMessage:
                 * - Integrates with RAG knowledge base
                 * - Provides NLP preprocessing for better intent detection
                 * - Includes metadata service fuzzy search
                 * - Queries knowledge graph for relationships
                 * - Falls back gracefully if AI service is unavailable
                 */
                const response = await sendContextAwareMessage(message, {
                    forceWebSearch: false // Only use web search if detected as needed
                });

                // Hide typing indicator
                typing.style.display = 'none';

                // Display AI response
                const assistantMessage = document.createElement('div');
                assistantMessage.className = 'ai-message assistant';

                let responseHTML = `<div class="ai-message-bubble">${escapeHtml(response.message)}`;

                // Add suggestions if available
                if (response.suggestions && response.suggestions.length > 0) {
                    responseHTML += '<br><br><strong>Suggestions:</strong><ul style="margin: 0.5rem 0; padding-left: 1.5rem;">';
                    response.suggestions.forEach(suggestion => {
                        responseHTML += `<li>${escapeHtml(suggestion)}</li>`;
                    });
                    responseHTML += '</ul>';
                }

                // Add metadata if web search was used
                if (response.webSearchUsed) {
                    responseHTML += '<br><small style="opacity: 0.7;">üåê Included web research</small>';
                }

                responseHTML += '</div>';
                assistantMessage.innerHTML = responseHTML;

                messagesContainer.appendChild(assistantMessage);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                console.log('‚úÖ AI response received:', {
                    suggestions: response.suggestions?.length || 0,
                    webSearchUsed: response.webSearchUsed,
                    ragSources: response.ragSources?.length || 0
                });

            } catch (error) {
                // Hide typing indicator
                typing.style.display = 'none';

                // Show error message
                const errorMessage = document.createElement('div');
                errorMessage.className = 'ai-message assistant';
                errorMessage.innerHTML = `
                    <div class="ai-message-bubble" style="background: #fee2e2; color: #991b1b;">
                        ‚ö†Ô∏è I encountered an error processing your request. Please try again.
                        <br><small>${escapeHtml(error.message)}</small>
                    </div>
                `;
                messagesContainer.appendChild(errorMessage);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                console.error('‚ùå AI chat error:', error);
            }
        };
    </script>

    <!-- Modular JavaScript Architecture -->
    <script type="module" src="../js/org-admin-main.js?v=20251019-location-safe-clear"></script>
    <script src="../js/focus-manager.js?v=20251019-location-safe-clear"></script>

</body>
</html>