<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organization Administration - Course Creator</title>
    <link rel="stylesheet" href="../css/main.css">
    <style>
        /* Anti-blur fixes for all text and animations */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Prevent blur on transformed/animated elements */
        .tab-btn,
        .stat-card,
        .card,
        .project-card,
        .modal,
        .notification {
            backface-visibility: hidden;
            transform-style: preserve-3d;
        }

        .org-admin-container {
            display: flex;
            min-height: 100vh;
            background-color: var(--background-color);
        }

        .sidebar {
            width: 280px;
            background: var(--card-background);
            border-right: 1px solid var(--border-color);
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
        }

        .org-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .org-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-background);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            display: block;
        }

        .tab-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-btn {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        .data-table tr:hover {
            background: var(--hover-color);
        }

        .action-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 0.25rem;
            font-size: 0.875rem;
        }

        .btn-edit {
            background: var(--warning-color);
            color: white;
        }

        .btn-delete {
            background: var(--error-color);
            color: white;
        }

        .btn-add {
            background: var(--success-color);
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--card-background);
            margin: 5% auto;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            position: relative;
        }

        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .role-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .role-org-admin {
            background: var(--primary-color);
            color: white;
        }

        .role-instructor {
            background: var(--info-color);
            color: white;
        }

        .role-student {
            background: var(--secondary-color);
            color: white;
        }

        .status-active {
            color: var(--success-color);
            font-weight: 600;
        }

        .status-inactive {
            color: var(--error-color);
            font-weight: 600;
        }

        .project-card {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .project-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .project-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-draft {
            background: var(--warning-color);
            color: white;
        }

        .status-active {
            background: var(--success-color);
            color: white;
        }

        .status-completed {
            background: var(--info-color);
            color: white;
        }

        .target-roles {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .role-tag {
            background: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        /* Project Creation Step Styles */
        .project-creation-steps {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
        }

        .step {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: var(--background-color);
            border: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .step.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .step.completed {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .project-step {
            display: none;
        }

        .project-step.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* AI Suggestions Styles */
        .ai-suggestions {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .insights-container,
        .tracks-container,
        .objectives-container {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-color);
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 1rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Track Templates Styles */
        .track-templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }

        .track-template-card {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .track-template-card:hover {
            transform: translateY(-2px) translateZ(0);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }

        .track-template-card.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.05), rgba(var(--primary-color-rgb), 0.1));
        }

        .track-template-card.selected::after {
            content: '✓';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--success-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: bold;
        }

        .track-category {
            display: inline-block;
            background: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .track-duration {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .selected-tracks {
            background: var(--hover-color);
            border-radius: 8px;
            padding: 1rem;
        }

        .selected-track-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            border-left: 4px solid var(--primary-color);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Enhanced Modal Styles */
        .assignment-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .assignment-tab-content {
            display: none;
        }

        .assignment-tab-content.active {
            display: block;
        }

        .analytics-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }

        .analytics-summary .stat-card {
            background: linear-gradient(135deg, var(--card-background), var(--hover-color));
            border-left: 4px solid var(--primary-color);
        }

        .instructor-assignment-item {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .instructor-assignment-item h4 {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
        }

        .instructor-selector {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 1rem;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .assigned-instructors {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .instructor-tag {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .instructor-tag .remove-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .student-item {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .student-item:hover {
            background: var(--hover-color);
            border-color: var(--primary-color);
        }

        .student-item.selected {
            background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.1), rgba(var(--primary-color-rgb), 0.2));
            border-color: var(--primary-color);
        }

        .student-info {
            display: flex;
            flex-direction: column;
        }

        .student-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .student-email {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .enrollment-status {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-enrolled {
            background: var(--success-color);
            color: white;
        }

        .status-not-enrolled {
            background: var(--text-muted);
            color: white;
        }

        .ai-processing-section {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 4px solid var(--info-color);
        }

        .project-details-summary {
            background: var(--hover-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .project-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            font-size: 1rem;
            color: var(--text-color);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%) translateZ(0);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0) translateZ(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .org-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 1rem;
            }

            .step-indicator {
                flex-direction: column;
                gap: 0.5rem;
            }

            .track-templates-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Logo Upload Styles */
        .logo-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: var(--hover-color);
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(var(--primary-color-rgb), 0.1);
        }

        .logo-upload-area.dragover {
            border-color: var(--primary-color);
            background: rgba(var(--primary-color-rgb), 0.2);
        }

        .upload-content {
            pointer-events: none;
        }

        .upload-content i {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            display: block;
        }

        .upload-link {
            color: var(--primary-color);
            text-decoration: underline;
            cursor: pointer;
        }

        .file-types {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin: 0.5rem 0 0 0;
        }

        .form-help {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
            display: block;
        }

        .btn-link {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            text-decoration: underline;
            padding: 0;
        }

        .btn-link:hover {
            color: var(--secondary-color);
        }

        .required::after {
            content: ' *';
            color: var(--error-color);
        }

        .phone-input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .country-select {
            flex-shrink: 0;
        }

        /* Quick Actions Cards */
        .action-card {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .action-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }

        .action-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .action-content h4 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .action-content p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.4;
        }

        /* Floating Action Button (FAB) */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            z-index: 999;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* FAB Menu */
        .fab-menu {
            position: fixed;
            bottom: 5rem;
            right: 2rem;
            display: none;
            flex-direction: column;
            gap: 0.75rem;
            z-index: 998;
        }

        .fab-menu.active {
            display: flex;
        }

        .fab-menu-item {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 30px;
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
        }

        .fab-menu-item:hover {
            background: var(--primary-color);
            color: white;
            transform: translateX(-5px);
        }

        .fab-menu-item i {
            width: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div id="loadingSpinner" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 8px; text-align: center;">
            <div class="loading-spinner" style="margin: 0 auto 1rem auto;"></div>
            <p>Loading dashboard...</p>
        </div>
    </div>

    <div class="org-admin-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div style="padding: 0 1.5rem;">
                <h2 style="margin: 0 0 1rem 0; color: var(--primary-color);">Organization Admin</h2>

                <a href="../index.html" style="display: block; padding: 0.5rem 1rem; background: var(--hover-color); border-radius: 4px; text-decoration: none; color: var(--text-color); margin-bottom: 1rem; transition: all 0.3s ease;">
                    ← Back to Home
                </a>

                <div class="org-info" style="margin-bottom: 2rem; padding: 1rem; background: var(--hover-color); border-radius: 8px;">
                    <h4 id="orgName" style="margin: 0 0 0.5rem 0;">Loading...</h4>
                    <p id="orgDomain" style="margin: 0; color: var(--text-muted); font-size: 0.875rem;"></p>
                </div>

                <ul style="list-style: none; padding: 0; margin: 0;">
                    <li style="margin-bottom: 0.5rem;">
                        <a href="#overview" class="nav-link active" data-tab="overview">
                            📊 Overview
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="#projects" class="nav-link" data-tab="projects">
                            🎯 Projects
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="#instructors" class="nav-link" data-tab="instructors">
                            👨‍🏫 Instructors
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="#students" class="nav-link" data-tab="students">
                            👥 Students
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="#tracks" class="nav-link" data-tab="tracks">
                            🎓 Tracks
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="#settings" class="nav-link" data-tab="settings">
                            ⚙️ Settings
                        </a>
                    </li>
                    <li style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                        <button onclick="logout()" style="width: 100%; padding: 0.75rem 1rem; background: var(--error-color); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; transition: all 0.3s ease;">
                            🚪 Logout
                        </button>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Organization Header -->
            <div class="org-header">
                <h1 id="orgTitle">Organization Dashboard</h1>
                <p id="orgDescription">Manage your organization's training programs and team members</p>
            </div>

            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="org-stats">
                    <div class="stat-card" onclick="document.querySelector('[data-tab=projects]').click()" style="cursor: pointer;" title="Click to view all projects">
                        <span class="stat-number" id="totalProjects">0</span>
                        <span>Active Projects</span>
                    </div>
                    <div class="stat-card" onclick="document.querySelector('[data-tab=instructors]').click()" style="cursor: pointer;" title="Click to view all instructors">
                        <span class="stat-number" id="totalInstructors">0</span>
                        <span>Instructors</span>
                    </div>
                    <div class="stat-card" onclick="document.querySelector('[data-tab=students]').click()" style="cursor: pointer;" title="Click to view all students">
                        <span class="stat-number" id="totalStudents">0</span>
                        <span>Total Students</span>
                    </div>
                    <div class="stat-card" onclick="document.querySelector('[data-tab=tracks]').click()" style="cursor: pointer;" title="Click to view all tracks">
                        <span class="stat-number" id="totalTracks">0</span>
                        <span>Learning Tracks</span>
                    </div>
                    <div class="stat-card" onclick="document.querySelector('[data-tab=projects]').click()" style="cursor: pointer;" title="Click to view courses in projects">
                        <span class="stat-number" id="totalCourses">0</span>
                        <span>Courses</span>
                    </div>
                </div>

                <!-- Quick Actions Section -->
                <div class="quick-actions-section" style="margin: 2rem 0;">
                    <h3 style="margin-bottom: 1rem;">Quick Actions</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div class="action-card" onclick="showCreateProjectModal()" style="cursor: pointer;">
                            <div class="action-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                            <div class="action-content">
                                <h4>Create New Project</h4>
                                <p>Start a new training project for your organization</p>
                            </div>
                        </div>

                        <div class="action-card" onclick="showAddInstructorModal()" style="cursor: pointer;">
                            <div class="action-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <div class="action-content">
                                <h4>Add Instructor</h4>
                                <p>Invite instructors to your organization</p>
                            </div>
                        </div>

                        <div class="action-card" onclick="showAddStudentModal()" style="cursor: pointer;">
                            <div class="action-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="action-content">
                                <h4>Add Student</h4>
                                <p>Add new students to your organization</p>
                            </div>
                        </div>

                        <div class="action-card" onclick="document.querySelector('[data-tab=settings]').click()" style="cursor: pointer;">
                            <div class="action-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                                <i class="fas fa-cog"></i>
                            </div>
                            <div class="action-content">
                                <h4>Organization Settings</h4>
                                <p>Manage organization configuration and preferences</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <h3>Recent Projects</h3>
                        <div id="recentProjects">
                            <!-- Recent projects will be loaded here -->
                        </div>
                    </div>
                    <div>
                        <h3>Recent Activity</h3>
                        <div id="recentActivity">
                            <!-- Recent activity will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projects Tab -->
            <div id="projects" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>Training Projects</h2>
                    <div style="display: flex; gap: 1rem;">
                        <select id="projectStatusFilter" onchange="filterProjects()" style="padding: 0.5rem;">
                            <option value="">All Status</option>
                            <option value="draft">Draft</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                        </select>
                        <button class="btn btn-primary" onclick="showCreateProjectModal()">
                            ➕ Create Project
                        </button>
                    </div>
                </div>

                <div id="projectsList">
                    <!-- Projects will be loaded here -->
                </div>
            </div>

            <!-- Instructors Tab -->
            <div id="instructors" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>Instructors</h2>
                    <button class="btn btn-primary" onclick="showAddInstructorModal()">
                        ➕ Add Instructor
                    </button>
                </div>

                <table class="data-table" id="instructorsTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Joined</th>
                            <th>Last Login</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Instructor data will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Students Tab -->
            <div id="students" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>Organization Students</h2>
                    <button class="btn btn-primary" onclick="showAddStudentModal()">
                        ➕ Add Student
                    </button>
                </div>

                <table class="data-table" id="studentsTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Projects Enrolled</th>
                            <th>Joined</th>
                            <th>Last Active</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Student data will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Tracks Tab -->
            <div id="tracks" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>Learning Tracks</h2>
                    <button class="btn btn-primary" onclick="showCreateTrackModal()">
                        ➕ Create New Track
                    </button>
                </div>

                <!-- Filters -->
                <div style="display: flex; gap: 1rem; margin-bottom: 2rem; align-items: center;">
                    <select id="trackProjectFilter" onchange="loadTracks()" style="padding: 0.5rem;">
                        <option value="">All Projects</option>
                        <!-- Project options will be populated here -->
                    </select>
                    <select id="trackStatusFilter" onchange="loadTracks()" style="padding: 0.5rem;">
                        <option value="">All Statuses</option>
                        <option value="draft">Draft</option>
                        <option value="active">Active</option>
                        <option value="completed">Completed</option>
                        <option value="archived">Archived</option>
                    </select>
                    <select id="trackDifficultyFilter" onchange="loadTracks()" style="padding: 0.5rem;">
                        <option value="">All Difficulty Levels</option>
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                    </select>
                    <input type="text" id="trackSearchInput" placeholder="Search tracks..."
                           onkeyup="loadTracks()" style="flex: 1; padding: 0.5rem;">
                </div>

                <!-- Tracks Table -->
                <table class="data-table" id="tracksTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Project</th>
                            <th>Difficulty</th>
                            <th>Duration</th>
                            <th>Students</th>
                            <th>Instructors</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tracksTableBody">
                        <!-- Track data will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <h2>Organization Settings</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div style="grid-column: 1 / -1;">
                        <h3>Organization Information</h3>
                        <form id="orgSettingsForm" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="orgNameSetting" class="required">Organization Name</label>
                                <input type="text" id="orgNameSetting" name="name" required>
                            </div>
                            <div class="form-group">
                                <label for="orgSlugSetting">Organization ID (URL Slug)</label>
                                <input type="text" id="orgSlugSetting" name="slug" readonly 
                                       title="Organization ID cannot be changed after creation">
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label for="orgDescriptionSetting">Description</label>
                                <textarea id="orgDescriptionSetting" name="description" rows="3"></textarea>
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label for="orgStreetAddressSetting">Street Address</label>
                                <input type="text" id="orgStreetAddressSetting" name="street_address"
                                       maxlength="255" placeholder="Street number and name">
                            </div>
                            <div class="form-group">
                                <label for="orgCitySetting">City</label>
                                <input type="text" id="orgCitySetting" name="city"
                                       maxlength="100" placeholder="City name">
                            </div>
                            <div class="form-group">
                                <label for="orgStateProvinceSetting">State / Province</label>
                                <select id="orgStateProvinceSetting" name="state_province">
                                    <option value="N/A">N/A (Non-US)</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CA">California</option>
                                    <option value="CO">Colorado</option>
                                    <option value="CT">Connecticut</option>
                                    <option value="DE">Delaware</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="HI">Hawaii</option>
                                    <option value="ID">Idaho</option>
                                    <option value="IL">Illinois</option>
                                    <option value="IN">Indiana</option>
                                    <option value="IA">Iowa</option>
                                    <option value="KS">Kansas</option>
                                    <option value="KY">Kentucky</option>
                                    <option value="LA">Louisiana</option>
                                    <option value="ME">Maine</option>
                                    <option value="MD">Maryland</option>
                                    <option value="MA">Massachusetts</option>
                                    <option value="MI">Michigan</option>
                                    <option value="MN">Minnesota</option>
                                    <option value="MS">Mississippi</option>
                                    <option value="MO">Missouri</option>
                                    <option value="MT">Montana</option>
                                    <option value="NE">Nebraska</option>
                                    <option value="NV">Nevada</option>
                                    <option value="NH">New Hampshire</option>
                                    <option value="NJ">New Jersey</option>
                                    <option value="NM">New Mexico</option>
                                    <option value="NY">New York</option>
                                    <option value="NC">North Carolina</option>
                                    <option value="ND">North Dakota</option>
                                    <option value="OH">Ohio</option>
                                    <option value="OK">Oklahoma</option>
                                    <option value="OR">Oregon</option>
                                    <option value="PA">Pennsylvania</option>
                                    <option value="RI">Rhode Island</option>
                                    <option value="SC">South Carolina</option>
                                    <option value="SD">South Dakota</option>
                                    <option value="TN">Tennessee</option>
                                    <option value="TX">Texas</option>
                                    <option value="UT">Utah</option>
                                    <option value="VT">Vermont</option>
                                    <option value="VA">Virginia</option>
                                    <option value="WA">Washington</option>
                                    <option value="WV">West Virginia</option>
                                    <option value="WI">Wisconsin</option>
                                    <option value="WY">Wyoming</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="orgPostalCodeSetting">Postal Code</label>
                                <input type="text" id="orgPostalCodeSetting" name="postal_code"
                                       maxlength="20" placeholder="ZIP or postal code">
                            </div>
                            <div class="form-group">
                                <label for="orgCountrySetting">Country</label>
                                <select id="orgCountrySetting" name="country">
                                    <option value="US">🇺🇸 United States</option>
                                    <option value="CA">🇨🇦 Canada</option>
                                    <option value="GB">🇬🇧 United Kingdom</option>
                                    <option value="AU">🇦🇺 Australia</option>
                                    <option value="DE">🇩🇪 Germany</option>
                                    <option value="FR">🇫🇷 France</option>
                                    <option value="ES">🇪🇸 Spain</option>
                                    <option value="IT">🇮🇹 Italy</option>
                                    <option value="MX">🇲🇽 Mexico</option>
                                    <option value="BR">🇧🇷 Brazil</option>
                                    <option value="IN">🇮🇳 India</option>
                                    <option value="JP">🇯🇵 Japan</option>
                                    <option value="CN">🇨🇳 China</option>
                                    <option value="KR">🇰🇷 South Korea</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="orgContactEmailSetting" class="required">Contact Email</label>
                                <input type="email" id="orgContactEmailSetting" name="contact_email" required
                                       placeholder="contact@organization.com">
                                <small class="form-help">Professional email address for organization</small>
                            </div>
                            <div class="form-group">
                                <label for="orgContactPhoneSetting" class="required">Contact Phone</label>
                                <div class="phone-input-group">
                                    <select id="orgContactPhoneCountry" class="country-select" style="width: 120px;">
                                        <option value="+1" data-country="US">🇺🇸 US (+1)</option>
                                        <option value="+44" data-country="GB">🇬🇧 UK (+44)</option>
                                        <option value="+33" data-country="FR">🇫🇷 France (+33)</option>
                                        <option value="+49" data-country="DE">🇩🇪 Germany (+49)</option>
                                        <option value="+61" data-country="AU">🇦🇺 Australia (+61)</option>
                                        <option value="+81" data-country="JP">🇯🇵 Japan (+81)</option>
                                        <!-- Add more countries as needed -->
                                    </select>
                                    <input type="tel" id="orgContactPhoneSetting" name="contact_phone" required
                                           placeholder="555-123-4567" style="flex: 1; margin-left: 0.5rem;">
                                </div>
                                <small class="form-help">Professional business phone number</small>
                            </div>
                            <div class="form-group">
                                <label for="orgDomainSetting">Website Domain</label>
                                <input type="url" id="orgDomainSetting" name="domain" 
                                       placeholder="https://organization.com">
                                <small class="form-help">Organization website URL</small>
                            </div>
                            <div class="form-group">
                                <label for="orgLogoSetting">Logo URL</label>
                                <input type="url" id="orgLogoSetting" name="logo_url"
                                       placeholder="https://organization.com/logo.png">
                                <small class="form-help">Direct link to organization logo</small>
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <h4 style="margin: 1rem 0 0.5rem 0; color: var(--primary-color);">Logo Upload</h4>
                                <div class="logo-upload-area" id="logoUploadAreaSettings">
                                    <div class="upload-content">
                                        <div style="font-size: 2rem; margin-bottom: 1rem;">📤</div>
                                        <p>Drag & drop logo here or <span class="upload-link">click to browse</span></p>
                                        <p class="file-types">JPG, PNG, GIF (max 5MB)</p>
                                    </div>
                                    <input type="file" id="orgLogoFile" accept=".jpg,.jpeg,.png,.gif" hidden>
                                </div>
                                <div id="logoPreview" style="margin-top: 1rem; display: none;">
                                    <img id="logoPreviewImg" style="max-width: 200px; max-height: 100px; border-radius: 4px;">
                                    <button type="button" id="removeLogo" class="btn-link" style="margin-left: 1rem; color: var(--error-color);">
                                        ❌ Remove
                                    </button>
                                </div>
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1; margin-top: 1rem;">
                                <button type="submit" class="btn btn-primary" id="saveOrgSettingsBtn">
                                    💾 Save Organization Information
                                </button>
                                <button type="button" class="btn btn-secondary" id="cancelOrgSettingsBtn" style="margin-left: 1rem;">
                                    ❌ Cancel Changes
                                </button>
                            </div>
                        </form>
                    </div>
                    <div>
                        <h3>Preferences</h3>
                        <form id="orgPreferencesForm">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="autoAssignByDomain" name="auto_assign_by_domain">
                                    Auto-assign users by email domain
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="enableProjectTemplates" name="enable_project_templates">
                                    Enable project templates
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="enableCustomBranding" name="enable_custom_branding">
                                    Enable custom branding
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Preferences</button>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Instructor Modal -->
    <div id="addInstructorModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addInstructorModal')">&times;</span>
            <h2>Add New Instructor</h2>
            <form id="addInstructorForm">
                <div class="form-group">
                    <label for="instructorEmail">Email Address *</label>
                    <input type="email" id="instructorEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="instructorFirstName">First Name *</label>
                    <input type="text" id="instructorFirstName" name="first_name" required>
                </div>
                <div class="form-group">
                    <label for="instructorLastName">Last Name *</label>
                    <input type="text" id="instructorLastName" name="last_name" required>
                </div>
                <div class="form-group">
                    <label for="instructorRole">Role</label>
                    <select id="instructorRole" name="role">
                        <option value="instructor">Instructor</option>
                        <option value="project_manager">Project Manager</option>
                        <option value="org_admin">Organization Admin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sendWelcomeEmail" name="send_welcome_email" checked>
                        Send welcome email
                    </label>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addInstructorModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Instructor</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Project Modal -->
    <div id="createProjectModal" class="modal">
        <div class="modal-content draggable-modal" style="max-width: 800px;">
            <div class="modal-header draggable-handle" style="cursor: move; padding: 1rem; background: var(--primary-color); color: white; margin: -1.5rem -1.5rem 1rem -1.5rem; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; color: white;">Create New Training Project</h2>
                <span class="close" onclick="closeModal('createProjectModal')" style="color: white; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
            </div>
            
            <!-- Project Creation Steps -->
            <div class="project-creation-steps" style="margin-bottom: 2rem;">
                <div class="step-indicator">
                    <span class="step active" data-step="1">1. Project Details</span>
                    <span class="step" data-step="2">2. AI-Enhanced Planning</span>
                    <span class="step" data-step="3">3. Track Templates</span>
                </div>
            </div>
            
            <!-- Step 1: Project Details -->
            <div id="projectStep1" class="project-step active">
                <h3>Project Information</h3>
                <form id="createProjectForm">
                    <div class="form-group">
                        <label for="projectName">Project Name *</label>
                        <input type="text" id="projectName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="projectSlug">URL Slug *</label>
                        <input type="text" id="projectSlug" name="slug" required pattern="^[a-z0-9-]+$">
                        <small>Only lowercase letters, numbers, and hyphens allowed</small>
                    </div>
                    <div class="form-group">
                        <label for="projectDescription">Project Description *</label>
                        <textarea id="projectDescription" name="description" placeholder="Describe the goals and objectives of this training project..." required></textarea>
                        <small>This description will be used by AI to suggest relevant tracks and content</small>
                    </div>
                    <div class="form-group">
                        <label for="projectTargetRoles">Target Roles (one per line)</label>
                        <textarea id="projectTargetRoles" name="target_roles" placeholder="Application Developer&#10;Business Analyst&#10;Operations Engineer"></textarea>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="projectDuration">Duration (weeks)</label>
                            <input type="number" id="projectDuration" name="duration_weeks" min="1" max="52">
                        </div>
                        <div class="form-group">
                            <label for="projectMaxParticipants">Maximum Participants</label>
                            <input type="number" id="projectMaxParticipants" name="max_participants" min="1">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="projectStartDate">Start Date</label>
                            <input type="date" id="projectStartDate" name="start_date">
                        </div>
                        <div class="form-group">
                            <label for="projectEndDate">End Date</label>
                            <input type="date" id="projectEndDate" name="end_date">
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('createProjectModal')">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="nextProjectStep()">Next: Get AI Suggestions</button>
                    </div>
                </form>
            </div>
            
            <!-- Step 2: AI-Enhanced Planning -->
            <div id="projectStep2" class="project-step">
                <h3>AI-Enhanced Project Planning</h3>
                <div id="ragLoadingIndicator" style="display: none;">
                    <p>🤖 Analyzing your project description with AI...</p>
                    <div class="loading-spinner"></div>
                </div>
                <div id="ragSuggestions" style="display: none;">
                    <div class="ai-suggestions">
                        <h4>📊 AI-Generated Insights</h4>
                        <div id="projectInsights" class="insights-container">
                            <!-- AI insights will be populated here -->
                        </div>
                        
                        <h4>🎯 Recommended Track Structure</h4>
                        <div id="recommendedTracks" class="tracks-container">
                            <!-- Recommended tracks will be populated here -->
                        </div>
                        
                        <h4>📚 Suggested Learning Objectives</h4>
                        <div id="suggestedObjectives" class="objectives-container">
                            <!-- Learning objectives will be populated here -->
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button type="button" class="btn btn-secondary" onclick="previousProjectStep()">Back</button>
                    <button type="button" class="btn btn-info" onclick="regenerateAISuggestions()">🔄 Regenerate Suggestions</button>
                    <button type="button" class="btn btn-primary" onclick="nextProjectStep()">Next: Select Tracks</button>
                </div>
            </div>
            
            <!-- Step 3: Track Templates -->
            <div id="projectStep3" class="project-step">
                <h3>Select Training Tracks</h3>
                <p>Choose from existing track templates or create custom tracks for your project:</p>
                
                <div class="track-selection">
                    <h4>Available Track Templates</h4>
                    <div id="trackTemplates" class="track-templates-grid">
                        <!-- Track templates will be loaded here -->
                    </div>
                    
                    <div class="custom-track-section" style="margin-top: 2rem;">
                        <h4>Create Custom Track</h4>
                        <button type="button" class="btn btn-outline btn-primary" onclick="showCustomTrackForm()">
                            ➕ Add Custom Track
                        </button>
                    </div>
                </div>
                
                <div id="selectedTracks" class="selected-tracks" style="margin-top: 2rem; display: none;">
                    <h4>Selected Tracks</h4>
                    <div id="selectedTracksList"></div>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button type="button" class="btn btn-secondary" onclick="previousProjectStep()">Back</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('createProjectModal')">Save as Draft</button>
                    <button type="submit" class="btn btn-primary" onclick="finalizeProjectCreation()">Create Project</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="addStudentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addStudentModal')">&times;</span>
            <h2>Add Student to Organization</h2>
            <form id="addStudentForm">
                <div class="form-group">
                    <label for="studentEmail">Email Address *</label>
                    <input type="email" id="studentEmail" name="user_email" required>
                </div>
                <div class="form-group">
                    <label for="studentFirstName">First Name *</label>
                    <input type="text" id="studentFirstName" name="first_name" required>
                </div>
                <div class="form-group">
                    <label for="studentLastName">Last Name *</label>
                    <input type="text" id="studentLastName" name="last_name" required>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sendStudentWelcomeEmail" name="send_welcome_email" checked>
                        Send welcome email
                    </label>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addStudentModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Student</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Project Instantiation Modal -->
    <div id="instantiateProjectModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeModal('instantiateProjectModal')">&times;</span>
            <h2>Instantiate Project</h2>
            <p>This will make the project active and available to students. Default tracks and modules will be created if none exist.</p>
            
            <div id="projectInstantiationDetails">
                <!-- Project details will be populated here -->
            </div>
            
            <div class="ai-processing-section" style="margin: 2rem 0;">
                <h4>🤖 AI Processing Options</h4>
                <label>
                    <input type="checkbox" id="processWithAI" checked> Process project description with AI for enhanced content generation
                </label>
                <p style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">
                    AI will analyze the project description and suggest optimized tracks, modules, and learning paths.
                </p>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('instantiateProjectModal')">Cancel</button>
                <button type="button" class="btn btn-success" onclick="confirmProjectInstantiation()">🚀 Instantiate Project</button>
            </div>
        </div>
    </div>

    <!-- Instructor Assignment Modal -->
    <div id="instructorAssignmentModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <span class="close" onclick="closeModal('instructorAssignmentModal')">&times;</span>
            <h2>Assign Instructors</h2>
            
            <div class="assignment-tabs">
                <button class="tab-btn active" onclick="switchAssignmentTab('tracks')">Track Assignments</button>
                <button class="tab-btn" onclick="switchAssignmentTab('modules')">Module Assignments</button>
            </div>
            
            <!-- Track Assignment Tab -->
            <div id="trackAssignmentTab" class="assignment-tab-content active">
                <h3>Assign Instructors to Tracks</h3>
                <div id="trackAssignmentList">
                    <!-- Track assignment interface will be populated here -->
                </div>
            </div>
            
            <!-- Module Assignment Tab -->
            <div id="moduleAssignmentTab" class="assignment-tab-content">
                <h3>Assign Instructors to Modules (Minimum 2 per module)</h3>
                <div id="moduleAssignmentList">
                    <!-- Module assignment interface will be populated here -->
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('instructorAssignmentModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveInstructorAssignments()">Save Assignments</button>
            </div>
        </div>
    </div>

    <!-- Student Enrollment Modal -->
    <div id="studentEnrollmentModal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <span class="close" onclick="closeModal('studentEnrollmentModal')">&times;</span>
            <h2>Manage Student Enrollments</h2>
            
            <div style="display: flex; gap: 2rem;">
                <!-- Available Students -->
                <div style="flex: 1;">
                    <h3>Available Students</h3>
                    <div style="margin-bottom: 1rem;">
                        <input type="text" id="studentSearchInput" placeholder="Search students..." 
                               onkeyup="searchStudents()" style="width: 100%; padding: 0.5rem;">
                    </div>
                    <div id="availableStudentsList" style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border-color); padding: 1rem;">
                        <!-- Available students will be populated here -->
                    </div>
                </div>
                
                <!-- Track Assignment -->
                <div style="flex: 1;">
                    <h3>Enroll in Track</h3>
                    <div style="margin-bottom: 1rem;">
                        <select id="enrollmentTrackSelect" style="width: 100%; padding: 0.5rem;">
                            <option value="">Select Track...</option>
                            <!-- Track options will be populated here -->
                        </select>
                    </div>
                    
                    <div id="enrolledStudentsList" style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border-color); padding: 1rem;">
                        <!-- Enrolled students will be populated here -->
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('studentEnrollmentModal')">Close</button>
                <button type="button" class="btn btn-primary" onclick="bulkEnrollStudents()">Enroll Selected Students</button>
            </div>
        </div>
    </div>

    <!-- Project Analytics Modal -->
    <div id="projectAnalyticsModal" class="modal">
        <div class="modal-content" style="max-width: 1200px;">
            <span class="close" onclick="closeModal('projectAnalyticsModal')">&times;</span>
            <h2>Project Analytics Dashboard</h2>
            
            <div class="analytics-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                <div class="stat-card">
                    <span class="stat-number" id="analyticsEnrolledStudents">0</span>
                    <span>Enrolled Students</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="analyticsActiveStudents">0</span>
                    <span>Active Students</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="analyticsCompletedStudents">0</span>
                    <span>Completed</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="analyticsAverageProgress">0%</span>
                    <span>Average Progress</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="analyticsAverageScore">0%</span>
                    <span>Average Quiz Score</span>
                </div>
            </div>
            
            <div class="analytics-tabs">
                <button class="tab-btn active" onclick="switchAnalyticsTab('overview')">Overview</button>
                <button class="tab-btn" onclick="switchAnalyticsTab('progress')">Progress Tracking</button>
                <button class="tab-btn" onclick="switchAnalyticsTab('performance')">Performance</button>
                <button class="tab-btn" onclick="switchAnalyticsTab('engagement')">Engagement</button>
            </div>
            
            <div id="analyticsTabContent" style="margin-top: 2rem;">
                <!-- Analytics tab content will be populated here -->
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                <button type="button" class="btn btn-outline" onclick="exportAnalytics()">📊 Export Report</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('projectAnalyticsModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Student Unenrollment Modal -->
    <div id="studentUnenrollmentModal" class="modal student-unenrollment-modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('studentUnenrollmentModal')">&times;</span>
            <h2>Unenroll Students from Project</h2>
            <p>Select students to unenroll from this project. Their progress will be preserved for audit purposes.</p>
            
            <div class="unenrollment-options">
                <h4>🔧 Unenrollment Options</h4>
                <div>
                    <label>
                        <input type="checkbox" id="unenrollFromProject" checked> 
                        Unenroll from entire project (removes from all tracks)
                    </label>
                    <label>
                        <input type="checkbox" id="preserveProgress" checked> 
                        Preserve student progress data for audit purposes
                    </label>
                </div>
            </div>
            
            <div id="enrolledStudentsList" class="students-list">
                <!-- Enrolled students will be loaded here -->
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeModal('studentUnenrollmentModal')">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmStudentUnenrollment()" disabled>
                    ❌ Unenroll Selected Students
                </button>
            </div>
        </div>
    </div>

    <!-- Instructor Removal Modal -->
    <div id="instructorRemovalModal" class="modal instructor-removal-modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('instructorRemovalModal')">&times;</span>
            <h2>Remove Instructors</h2>
            <p>Select instructors to remove from project or organization. You can transfer their assignments to avoid disruption.</p>
            
            <div class="removal-options">
                <h4>🔧 Removal Options</h4>
                <div>
                    <label>
                        <input type="checkbox" id="removeFromOrganization"> 
                        Remove from entire organization (removes from all projects)
                    </label>
                    <label>
                        <input type="checkbox" id="transferAssignments"> 
                        Transfer assignments to another instructor
                    </label>
                </div>
                
                <div id="replacementInstructorSection" class="replacement-instructor-section" style="display: none;">
                    <label for="replacementInstructorSelect">Select Replacement Instructor:</label>
                    <select id="replacementInstructorSelect" class="form-input">
                        <option value="">-- Select Replacement --</option>
                        <!-- Options populated dynamically -->
                    </select>
                </div>
            </div>
            
            <div id="assignedInstructorsList" class="instructors-list">
                <!-- Assigned instructors will be loaded here -->
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeModal('instructorRemovalModal')">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmInstructorRemoval()" disabled>
                    🗑️ Remove Selected Instructors
                </button>
            </div>
        </div>
    </div>

    <!-- Create/Edit Track Modal -->
    <div id="trackModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeModal('trackModal')">&times;</span>
            <h2 id="trackModalTitle">Create New Track</h2>

            <form id="trackForm" onsubmit="submitTrack(event)">
                <input type="hidden" id="trackId" name="trackId">

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="trackName" class="required">Track Name</label>
                        <input type="text" id="trackName" name="name" required maxlength="200"
                               placeholder="e.g., Python Fundamentals">
                    </div>

                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="trackDescription">Description</label>
                        <textarea id="trackDescription" name="description" rows="4" maxlength="1000"
                                  placeholder="Describe the track objectives and content..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="trackProject" class="required">Project</label>
                        <select id="trackProject" name="project_id" required>
                            <option value="">Select Project</option>
                            <!-- Projects will be populated here -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="trackDifficulty">Difficulty Level</label>
                        <select id="trackDifficulty" name="difficulty_level">
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="trackDuration">Duration (weeks)</label>
                        <input type="number" id="trackDuration" name="duration_weeks" min="1" max="52"
                               placeholder="e.g., 8">
                    </div>

                    <div class="form-group">
                        <label for="trackMaxStudents">Max Students</label>
                        <input type="number" id="trackMaxStudents" name="max_students" min="1" max="1000"
                               placeholder="e.g., 30">
                    </div>

                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="trackAudience">Target Audience (comma-separated)</label>
                        <input type="text" id="trackAudience" name="target_audience"
                               placeholder="e.g., Beginners, Students, Professionals">
                        <small>Enter audience types separated by commas</small>
                    </div>

                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="trackPrerequisites">Prerequisites (comma-separated)</label>
                        <input type="text" id="trackPrerequisites" name="prerequisites"
                               placeholder="e.g., Basic programming, Computer literacy">
                        <small>Enter prerequisites separated by commas</small>
                    </div>

                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="trackObjectives">Learning Objectives (comma-separated)</label>
                        <textarea id="trackObjectives" name="learning_objectives" rows="3"
                                  placeholder="e.g., Understand Python syntax, Build simple applications, Debug code"></textarea>
                        <small>Enter learning objectives separated by commas</small>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeModal('trackModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="trackSubmitBtn">Create Track</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Track Details Modal -->
    <div id="trackDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <span class="close" onclick="closeModal('trackDetailsModal')">&times;</span>
            <h2 id="trackDetailsTitle">Track Details</h2>

            <div id="trackDetailsContent">
                <!-- Track details will be loaded here -->
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeModal('trackDetailsModal')">Close</button>
                <button type="button" class="btn btn-primary" onclick="editTrackFromDetails()">Edit Track</button>
            </div>
        </div>
    </div>

    <!-- Delete Track Confirmation Modal -->
    <div id="deleteTrackModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close" onclick="closeModal('deleteTrackModal')">&times;</span>
            <h2>Delete Track</h2>

            <p>Are you sure you want to delete this track?</p>
            <p id="deleteTrackWarning" style="color: var(--error-color); font-weight: bold;"></p>

            <input type="hidden" id="deleteTrackId">

            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeModal('deleteTrackModal')">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmDeleteTrack()">Delete Track</button>
            </div>
        </div>
    </div>

    <!-- Floating Action Button (FAB) -->
    <button class="fab" id="fabButton" onclick="toggleFabMenu()" title="Quick Actions">
        <i class="fas fa-plus" id="fabIcon"></i>
    </button>

    <!-- FAB Menu -->
    <div class="fab-menu" id="fabMenu">
        <div class="fab-menu-item" onclick="fabAction('project')">
            <i class="fas fa-project-diagram"></i>
            <span>New Project</span>
        </div>
        <div class="fab-menu-item" onclick="fabAction('instructor')">
            <i class="fas fa-chalkboard-teacher"></i>
            <span>Add Instructor</span>
        </div>
        <div class="fab-menu-item" onclick="fabAction('student')">
            <i class="fas fa-user-plus"></i>
            <span>Add Student</span>
        </div>
        <div class="fab-menu-item" onclick="fabAction('track')">
            <i class="fas fa-road"></i>
            <span>New Track</span>
        </div>
        <div class="fab-menu-item" onclick="fabAction('settings')">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </div>
    </div>

    <script src="../js/config-global.js"></script>
    <script type="module">
        // Import Auth module
        import { Auth } from '../js/modules/auth.js';
        import { showNotification } from '../js/modules/notifications.js';

        // Make Auth available globally for the dashboard script
        window.Auth = Auth;
        window.showNotification = showNotification;

        console.log('✅ Auth module loaded and made global');
    </script>
    <!-- Modular JavaScript Architecture -->
    <script type="module" src="../js/org-admin-main.js"></script>
</body>
</html>