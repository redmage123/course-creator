<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../css/modern-ui/modern-ui.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organization Administration - Course Creator</title>
    <!-- Tami UI Feature Flag (must load first) -->
    
    <!-- Base styles -->
    <link rel="stylesheet" href="../css/base/reset.css">
    <link rel="stylesheet" href="../css/base/variables.css">
    <link rel="stylesheet" href="../css/base/typography.css">
    <!-- Utilities - SOLID Single Responsibility -->
    <link rel="stylesheet" href="../css/utilities.css">
    <!-- Components - SOLID Open/Closed -->
    <link rel="stylesheet" href="../css/components/dashboard-common.css">
    <link rel="stylesheet" href="../css/components/project-wizard.css">
    <link rel="stylesheet" href="../css/components/buttons.css">
    <link rel="stylesheet" href="../css/components/forms.css">
    <link rel="stylesheet" href="../css/components/modals.css">
    <link rel="stylesheet" href="../css/components/rbac-dashboard.css">
    <!-- Legacy/Feature specific -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/drag-drop.css">
    <link rel="stylesheet" href="../css/file-explorer.css">
    <!-- Tami UI System -->
    
    
    
    
    
    <style>
        /* Anti-blur fixes for all text and animations */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Prevent blur on transformed/animated elements */
        .tab-btn,
        .stat-card,
        .card,
        .project-card,
        .modal,
        .notification {
            backface-visibility: hidden;
            transform-style: preserve-3d;
        }

        /* Modal without backdrop - just the content box */
        .modal-no-backdrop {
            display: none;
            position: fixed;
            z-index: 1000;
        }

        .modal-no-backdrop.show {
            display: flex !important;
        }

        .org-admin-container {
            display: flex;
            min-height: 100vh;
            background-color: var(--background-color);
        }

        .sidebar {
            width: 280px;
            background: var(--card-background);
            border-right: 1px solid var(--border-color);
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
        }

        .org-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center !important;
        }

        .org-header h1 {
            text-align: center !important;
        }

        .org-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-background);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            display: block;
        }

        .tab-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-btn {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        .data-table tr:hover {
            background: var(--hover-color);
        }

        .action-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 0.25rem;
            font-size: 0.875rem;
        }

        .btn-edit {
            background: var(--warning-color);
            color: white;
        }

        .btn-delete {
            background: var(--error-color);
            color: white;
        }

        .btn-add {
            background: var(--success-color);
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--card-background);
            margin: 5% auto;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            position: relative;
        }

        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .role-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .role-org-admin {
            background: var(--primary-color);
            color: white;
        }

        .role-instructor {
            background: var(--info-color);
            color: white;
        }

        .role-student {
            background: var(--secondary-color);
            color: white;
        }

        .status-active {
            color: var(--success-color);
            font-weight: 600;
        }

        .status-inactive {
            color: var(--error-color);
            font-weight: 600;
        }

        .project-card {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .project-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .project-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-draft {
            background: var(--warning-color);
            color: white;
        }

        .status-active {
            background: var(--success-color);
            color: white;
        }

        .status-completed {
            background: var(--info-color);
            color: white;
        }

        .target-roles {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .role-tag {
            background: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        /* Project Creation Step Styles */
        .project-creation-steps {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
        }

        .step {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: var(--background-color);
            border: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .step.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .step.completed {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .project-step {
            display: none;
        }

        .project-step.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* AI Suggestions Styles */
        .ai-suggestions {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .insights-container,
        .tracks-container,
        .objectives-container {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-color);
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 1rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Track Templates Styles */
        .track-templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }

        .track-template-card {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .track-template-card:hover {
            transform: translateY(-2px) translateZ(0);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }

        .track-template-card.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.05), rgba(var(--primary-color-rgb), 0.1));
        }

        .track-template-card.selected::after {
            content: '✓';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--success-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: bold;
        }

        .track-category {
            display: inline-block;
            background: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .track-duration {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .selected-tracks {
            background: var(--hover-color);
            border-radius: 8px;
            padding: 1rem;
        }

        .selected-track-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            border-left: 4px solid var(--primary-color);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Enhanced Modal Styles */
        .assignment-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .assignment-tab-content {
            display: none;
        }

        .assignment-tab-content.active {
            display: block;
        }

        .analytics-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }

        .analytics-summary .stat-card {
            background: linear-gradient(135deg, var(--card-background), var(--hover-color));
            border-left: 4px solid var(--primary-color);
        }

        .instructor-assignment-item {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .instructor-assignment-item h4 {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
        }

        .instructor-selector {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 1rem;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .assigned-instructors {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .instructor-tag {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .instructor-tag .remove-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .student-item {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .student-item:hover {
            background: var(--hover-color);
            border-color: var(--primary-color);
        }

        .student-item.selected {
            background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.1), rgba(var(--primary-color-rgb), 0.2));
            border-color: var(--primary-color);
        }

        .student-info {
            display: flex;
            flex-direction: column;
        }

        .student-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .student-email {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .enrollment-status {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-enrolled {
            background: var(--success-color);
            color: white;
        }

        .status-not-enrolled {
            background: var(--text-muted);
            color: white;
        }

        .ai-processing-section {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 4px solid var(--info-color);
        }

        .project-details-summary {
            background: var(--hover-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .project-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            font-size: 1rem;
            color: var(--text-color);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%) translateZ(0);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0) translateZ(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .org-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 1rem;
            }

            .step-indicator {
                flex-direction: column;
                gap: 0.5rem;
            }

            .track-templates-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Logo Upload Styles */
        .logo-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: var(--hover-color);
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(var(--primary-color-rgb), 0.1);
        }

        .logo-upload-area.dragover {
            border-color: var(--primary-color);
            background: rgba(var(--primary-color-rgb), 0.2);
        }

        .upload-content {
            pointer-events: none;
        }

        .upload-content i {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            display: block;
        }

        .upload-link {
            color: var(--primary-color);
            text-decoration: underline;
            cursor: pointer;
        }

        .file-types {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin: 0.5rem 0 0 0;
        }

        .form-help {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
            display: block;
        }

        .btn-link {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            text-decoration: underline;
            padding: 0;
        }

        .btn-link:hover {
            color: var(--secondary-color);
        }

        .required::after {
            content: ' *';
            color: var(--error-color);
        }

        .phone-input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .country-select {
            flex-shrink: 0;
        }

        /* Quick Actions Cards */
        .action-card {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .action-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }

        .action-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .action-content h4 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .action-content p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.4;
        }

        /* Floating Action Button (FAB) */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            z-index: 999;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* FAB Menu */
        .fab-menu {
            position: fixed;
            bottom: 5rem;
            right: 2rem;
            display: none;
            flex-direction: column;
            gap: 0.75rem;
            z-index: 998;
        }

        .fab-menu.active {
            display: flex;
        }

        .fab-menu-item {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 30px;
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
        }

        .fab-menu-item:hover {
            background: var(--primary-color);
            color: white;
            transform: translateX(-5px);
        }

        .fab-menu-item i {
            width: 20px;
            text-align: center;
        }

        /* Project Type Selection Styles */
        .project-type-option {
            transition: all 0.2s ease;
        }

        .project-type-option:hover {
            border-color: var(--primary-color) !important;
            background: rgba(var(--primary-color-rgb, 65, 105, 225), 0.05) !important;
        }

        .project-type-option input[type="radio"]:checked + div {
            color: var(--primary-color);
        }

        .project-type-option:has(input[type="radio"]:checked) {
            border-color: var(--primary-color) !important;
            background: rgba(var(--primary-color-rgb, 65, 105, 225), 0.08) !important;
            box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb, 65, 105, 225), 0.1);
        }
    </style>
    <!-- Security: DOMPurify for XSS protection -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div aria-live="polite" aria-atomic="true" class="sr-only" id="form-announcements"></div>
    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-overlay">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading dashboard...</p>
        </div>
    </div>

    <div class="org-admin-container">
        <!-- Sidebar -->
        <!-- Tami Navigation Sidebar -->
        <nav class="sidebar" role="navigation" aria-label="Main navigation" data-sidebar data-collapsed="false" data-mobile-open="false">
            <!-- Collapse Toggle Button -->
            <button data-sidebar-toggle aria-label="Toggle sidebar" title="Collapse/Expand Sidebar">
                ☰
            </button>

            <!-- Hamburger Menu (Mobile) -->
            <button data-hamburger aria-label="Toggle mobile menu">
                <span></span>
                <span></span>
                <span></span>
            </button>

            <div class="sidebar__header">
                <h2 class="sidebar__title">Organization Admin</h2>

                <a href="../index.html" class="sidebar__home-link" data-nav-item>
                    <span data-nav-icon>←</span>
                    <span data-nav-text>Back to Home</span>
                </a>

                <div class="org-info">
                    <h4 id="organizationName" class="org-info__name">Loading...</h4>
                    <p id="organizationDomain" class="org-info__domain"></p>
                </div>

                <!-- Navigation Items with Tami attributes -->
                <a href="#overview" class="nav-link active" data-tab="overview" data-nav-item data-active="true" aria-current="page">
                    <span data-nav-icon>📊</span>
                    <span data-nav-text>Overview</span>
                </a>

                <a href="#projects" class="nav-link" data-tab="projects" data-nav-item data-active="false">
                    <span data-nav-icon>🎯</span>
                    <span data-nav-text>Projects</span>
                </a>

                <a href="#courses" class="nav-link" data-tab="courses" data-nav-item data-active="false">
                    <span data-nav-icon>📚</span>
                    <span data-nav-text>Courses</span>
                </a>

                <a href="#instructors" class="nav-link" data-tab="instructors" data-nav-item data-active="false">
                    <span data-nav-icon>👨‍🏫</span>
                    <span data-nav-text>Instructors</span>
                </a>

                <a href="#students" class="nav-link" data-tab="students" data-nav-item data-active="false">
                    <span data-nav-icon>👥</span>
                    <span data-nav-text>Students</span>
                </a>

                <a href="#tracks" class="nav-link" data-tab="tracks" data-nav-item data-active="false">
                    <span data-nav-icon>🎓</span>
                    <span data-nav-text>Tracks</span>
                </a>

                <a href="#files" class="nav-link" data-tab="files" data-nav-item data-active="false">
                    <span data-nav-icon>📁</span>
                    <span data-nav-text>Files</span>
                </a>

                <a href="#settings" class="nav-link" data-tab="settings" data-nav-item data-active="false">
                    <span data-nav-icon>⚙️</span>
                    <span data-nav-text>Settings</span>
                </a>

                <!-- Logout Button -->
                <button onclick="logout()" class="sidebar__logout-button" data-nav-item>
                    <span data-nav-icon>🚪</span>
                    <span data-nav-text>Logout</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main role="main" class="main-content">
            <!-- Organization Header -->
            <div class="org-header text-center cursor-pointer" onclick="document.querySelector('[data-tab=overview]').click()" title="Click to return to overview">
                <h1 id="orgTitle">Organization Dashboard</h1>
            </div>

            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="org-stats">
                    <div class="stat-card cursor-pointer" onclick="document.querySelector('[data-tab=projects]').click()" title="Click to view all projects">
                        <span class="stat-number" id="totalProjects">0</span>
                        <span>Active Projects</span>
                    </div>
                    <div class="stat-card cursor-pointer" onclick="document.querySelector('[data-tab=instructors]').click()" title="Click to view all instructors">
                        <span class="stat-number" id="totalInstructors">0</span>
                        <span>Instructors</span>
                    </div>
                    <div class="stat-card cursor-pointer" onclick="document.querySelector('[data-tab=students]').click()" title="Click to view all students">
                        <span class="stat-number" id="totalStudents">0</span>
                        <span>Total Students</span>
                    </div>
                    <div class="stat-card cursor-pointer" onclick="document.querySelector('[data-tab=tracks]').click()" title="Click to view all tracks">
                        <span class="stat-number" id="totalTracks">0</span>
                        <span>Learning Tracks</span>
                    </div>
                    <div class="stat-card cursor-pointer" onclick="document.querySelector('[data-tab=projects]').click()" title="Click to view courses in projects">
                        <span class="stat-number" id="totalCourses">0</span>
                        <span>Courses</span>
                    </div>
                </div>

                <!-- Quick Actions Section -->
                <div class="quick-actions-section my-xl">
                    <h3 class="mb-md">Quick Actions</h3>
                    <div class="grid-auto-fit-250 gap-md">
                        <div class="action-card cursor-pointer" onclick="showCreateProjectModal()">
                            <div class="action-icon action-icon-gradient-purple">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                            <div class="action-content">
                                <h4>Create New Project</h4>
                                <p>Start a new training project for your organization</p>
                            </div>
                        </div>

                        <div class="action-card cursor-pointer" onclick="showAddInstructorModal()">
                            <div class="action-icon action-icon-gradient-pink">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <div class="action-content">
                                <h4>Add Instructor</h4>
                                <p>Invite instructors to your organization</p>
                            </div>
                        </div>

                        <div class="action-card cursor-pointer" onclick="showAddStudentModal()">
                            <div class="action-icon action-icon-gradient-blue">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="action-content">
                                <h4>Add Student</h4>
                                <p>Add new students to your organization</p>
                            </div>
                        </div>

                        <div class="action-card cursor-pointer" onclick="document.querySelector('[data-tab=settings]').click()">
                            <div class="action-icon action-icon-gradient-orange">
                                <i class="fas fa-cog"></i>
                            </div>
                            <div class="action-content">
                                <h4>Organization Settings</h4>
                                <p>Manage organization configuration and preferences</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-xl">
                    <div>
                        <h3>Recent Projects</h3>
                        <div id="recentProjects">
                            <!-- Recent projects will be loaded here -->
                        </div>
                    </div>
                    <div>
                        <h3>Recent Activity</h3>
                        <div id="recentActivity">
                            <!-- Recent activity will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projects Tab -->
            <div id="projects" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">Training Projects</h2>
                    <div class="tab-section-header__actions">
                        <select id="projectStatusFilter" onchange="filterProjects()" class="p-sm form-select">
                            <option value="">All Status</option>
                            <option value="draft">Draft</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                        </select>
                        <button class="btn btn-outline" onclick="window.OrgAdmin.Projects.showDraftsList()" title="Continue editing a saved draft">
                            📂 Continue from Draft
                        </button>
                        <button class="btn btn-primary" onclick="showCreateProjectModal()">
                            ➕ Create Project
                        </button>
                    </div>
                </div>

                <table class="data-table" id="projectsTable">
                    <thead>
                        <tr>
                            <th>Project</th>
                            <th>Status</th>
                            <th>Duration</th>
                            <th>Tracks</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="projectsTableBody">
                        <!-- Project data will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Courses Tab -->
            <div id="courses" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">AI-Generated Courses</h2>
                    <button class="btn btn-primary" id="generateCourseBtn" onclick="showGenerateCourseModal()">
                        🤖 Generate Course with AI
                    </button>
                </div>

                <!-- Course Generation Status -->
                <div id="courseGenerationStatus" class="hidden alert-info">
                    <div class="flex-center gap-md">
                        <div class="loading-spinner spinner-sm spinner-light"></div>
                        <div>
                            <strong>Generating Course...</strong>
                            <p class="mt-xs text-sm">AI is creating your course syllabus. This may take a moment.</p>
                        </div>
                    </div>
                </div>

                <!-- Courses Grid -->
                <div id="coursesGrid" class="grid-auto-fit-350 gap-lg">
                    <!-- Course cards will be loaded here -->
                    <div class="empty-state">
                        <p class="text-xl mb-md">📚 No courses generated yet</p>
                        <p>Click "Generate Course with AI" to create your first course.</p>
                    </div>
                </div>
            </div>

            <!-- Instructors Tab -->
            <div id="instructors" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">Instructors</h2>
                    <button class="btn btn-primary" onclick="showAddInstructorModal()">
                        ➕ Add Instructor
                    </button>
                </div>

                <table class="data-table" id="instructorsTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Joined</th>
                            <th>Last Login</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="instructorsTableBody">
                        <!-- Instructor data will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Students Tab -->
            <div id="students" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">Organization Students</h2>
                    <button class="btn btn-primary" onclick="showAddStudentModal()">
                        ➕ Add Student
                    </button>
                </div>

                <table class="data-table" id="studentsTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Projects Enrolled</th>
                            <th>Joined</th>
                            <th>Last Active</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody">
                        <!-- Student data will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Tracks Tab -->
            <div id="tracks" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">Learning Tracks</h2>
                    <button class="btn btn-primary" onclick="showCreateTrackModal()">
                        ➕ Create New Track
                    </button>
                </div>

                <!-- Filters -->
                <div class="toolbar mb-2xl">
                    <div class="toolbar__filters">
                        <select id="trackProjectFilter" onchange="loadTracks()" class="p-sm form-select">
                            <option value="">All Projects</option>
                            <!-- Project options will be populated here -->
                        </select>
                        <select id="trackStatusFilter" onchange="loadTracks()" class="p-sm form-select">
                            <option value="">All Statuses</option>
                            <option value="draft">Draft</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="archived">Archived</option>
                        </select>
                        <select id="trackDifficultyFilter" onchange="loadTracks()" class="p-sm form-select">
                            <option value="">All Difficulty Levels</option>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                        <input type="text" id="trackSearchInput" placeholder="Search tracks..."
                               onkeyup="loadTracks()" class="flex-1 p-sm form-input">
                    </div>
                </div>

                <!-- Tracks Table -->
                <table class="data-table" id="tracksTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Project</th>
                            <th>Difficulty</th>
                            <th>Duration</th>
                            <th>Students</th>
                            <th>Instructors</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tracksTableBody">
                        <!-- Track data will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Files Tab -->
            <div id="files" class="tab-content">
                <div class="tab-section-header">
                    <h2 class="tab-section-header__title">Organization Files</h2>
                    <div class="text-sm text-muted">
                        Manage course materials, documents, and assets
                    </div>
                </div>

                <!-- File Explorer Widget Container -->
                <div id="orgFileExplorerContainer"></div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <h2>Organization Settings</h2>

                <div class="grid grid-cols-2 gap-xl">
                    <div class="grid-col-full">
                        <h3>Organization Information</h3>
                        <form id="orgSettingsForm" class="grid grid-cols-2 gap-md">
                            <div class="form-group">
                                <label for="orgNameSetting" class="form-label required">Organization Name</label>
                                <input type="text" id="orgNameSetting" name="name" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="orgSlugSetting" class="form-label">Organization ID (URL Slug)</label>
                                <input type="text" id="orgSlugSetting" name="slug" class="form-input" readonly
                                       title="Organization ID cannot be changed after creation">
                            </div>
                            <div class="form-group grid-col-full">
                                <label for="orgDescriptionSetting" class="form-label">Description</label>
                                <textarea id="orgDescriptionSetting" name="description" rows="3" class="form-input"></textarea>
                            </div>
                            <div class="form-group grid-col-full">
                                <label for="orgStreetAddressSetting" class="form-label">Street Address</label>
                                <input type="text" id="orgStreetAddressSetting" name="street_address" class="form-input"
                                       maxlength="255" placeholder="Street number and name">
                            </div>
                            <div class="form-group">
                                <label for="orgCitySetting" class="form-label">City</label>
                                <input type="text" id="orgCitySetting" name="city" class="form-input"
                                       maxlength="100" placeholder="City name">
                            </div>
                            <div class="form-group">
                                <label for="orgStateProvinceSetting" class="form-label">State / Province</label>
                                <select id="orgStateProvinceSetting" name="state_province" class="form-select">
                                    <option value="N/A">N/A (Non-US)</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CA">California</option>
                                    <option value="CO">Colorado</option>
                                    <option value="CT">Connecticut</option>
                                    <option value="DE">Delaware</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="HI">Hawaii</option>
                                    <option value="ID">Idaho</option>
                                    <option value="IL">Illinois</option>
                                    <option value="IN">Indiana</option>
                                    <option value="IA">Iowa</option>
                                    <option value="KS">Kansas</option>
                                    <option value="KY">Kentucky</option>
                                    <option value="LA">Louisiana</option>
                                    <option value="ME">Maine</option>
                                    <option value="MD">Maryland</option>
                                    <option value="MA">Massachusetts</option>
                                    <option value="MI">Michigan</option>
                                    <option value="MN">Minnesota</option>
                                    <option value="MS">Mississippi</option>
                                    <option value="MO">Missouri</option>
                                    <option value="MT">Montana</option>
                                    <option value="NE">Nebraska</option>
                                    <option value="NV">Nevada</option>
                                    <option value="NH">New Hampshire</option>
                                    <option value="NJ">New Jersey</option>
                                    <option value="NM">New Mexico</option>
                                    <option value="NY">New York</option>
                                    <option value="NC">North Carolina</option>
                                    <option value="ND">North Dakota</option>
                                    <option value="OH">Ohio</option>
                                    <option value="OK">Oklahoma</option>
                                    <option value="OR">Oregon</option>
                                    <option value="PA">Pennsylvania</option>
                                    <option value="RI">Rhode Island</option>
                                    <option value="SC">South Carolina</option>
                                    <option value="SD">South Dakota</option>
                                    <option value="TN">Tennessee</option>
                                    <option value="TX">Texas</option>
                                    <option value="UT">Utah</option>
                                    <option value="VT">Vermont</option>
                                    <option value="VA">Virginia</option>
                                    <option value="WA">Washington</option>
                                    <option value="WV">West Virginia</option>
                                    <option value="WI">Wisconsin</option>
                                    <option value="WY">Wyoming</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="orgPostalCodeSetting" class="form-label">Postal Code</label>
                                <input type="text" id="orgPostalCodeSetting" name="postal_code" class="form-input"
                                       maxlength="20" placeholder="ZIP or postal code">
                            </div>
                            <div class="form-group">
                                <label for="orgCountrySetting" class="form-label">Country</label>
                                <select id="orgCountrySetting" name="country" class="form-select">
                                    <option value="US">🇺🇸 United States</option>
                                    <option value="CA">🇨🇦 Canada</option>
                                    <option value="GB">🇬🇧 United Kingdom</option>
                                    <option value="AU">🇦🇺 Australia</option>
                                    <option value="DE">🇩🇪 Germany</option>
                                    <option value="FR">🇫🇷 France</option>
                                    <option value="ES">🇪🇸 Spain</option>
                                    <option value="IT">🇮🇹 Italy</option>
                                    <option value="MX">🇲🇽 Mexico</option>
                                    <option value="BR">🇧🇷 Brazil</option>
                                    <option value="IN">🇮🇳 India</option>
                                    <option value="JP">🇯🇵 Japan</option>
                                    <option value="CN">🇨🇳 China</option>
                                    <option value="KR">🇰🇷 South Korea</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="orgContactEmailSetting" class="form-label required">Contact Email</label>
                                <input type="email" id="orgContactEmailSetting" name="contact_email" class="form-input" required
                                       placeholder="contact@organization.com">
                                <small class="form-help">Professional email address for organization</small>
                            </div>
                            <div class="form-group">
                                <label for="orgContactPhoneSetting" class="form-label required">Contact Phone</label>
                                <div class="phone-input-group">
                                    <select id="orgContactPhoneCountry" class="country-select form-select w-120">
                                        <option value="+1" data-country="US">🇺🇸 US (+1)</option>
                                        <option value="+44" data-country="GB">🇬🇧 UK (+44)</option>
                                        <option value="+33" data-country="FR">🇫🇷 France (+33)</option>
                                        <option value="+49" data-country="DE">🇩🇪 Germany (+49)</option>
                                        <option value="+61" data-country="AU">🇦🇺 Australia (+61)</option>
                                        <option value="+81" data-country="JP">🇯🇵 Japan (+81)</option>
                                        <!-- Add more countries as needed -->
                                    </select>
                                    <input type="tel" id="orgContactPhoneSetting" name="contact_phone" required
                                           placeholder="555-123-4567" class="flex-1 ml-sm form-input">
                                </div>
                                <small class="form-help">Professional business phone number</small>
                            </div>
                            <div class="form-group">
                                <label for="orgDomainSetting" class="form-label">Website URL</label>
                                <input type="url" id="orgDomainSetting" name="domain"
                                       placeholder="https://organization.com" class="form-input">
                                <small class="form-help">Organization website URL (must start with http:// or https://)</small>
                            </div>
                            <div class="form-group">
                                <label for="orgLogoSetting" class="form-label">Logo URL</label>
                                <input type="url" id="orgLogoSetting" name="logo_url"
                                       placeholder="https://organization.com/logo.png" class="form-input">
                                <small class="form-help">Direct link to organization logo</small>
                            </div>
                            <div class="form-group grid-col-full">
                                <h4 class="text-primary my-2">Logo Upload</h4>
                                <div class="logo-upload-area" id="logoUploadAreaSettings">
                                    <div class="upload-content">
                                        <div class="text-2xl mb-md">📤</div>
                                        <p>Drag & drop logo here or <span class="upload-link">click to browse</span></p>
                                        <p class="file-types">JPG, PNG, GIF (max 5MB)</p>
                                    </div>
                                    <input type="file" id="orgLogoFile" accept=".jpg,.jpeg,.png,.gif" hidden>
                                </div>
                                <div id="logoPreview" class="hidden mt-md">
                                    <img id="logoPreviewImg" class="logo-preview-img">
                                    <button type="button" id="removeLogo" class="btn-text-error ml-md">
                                        ❌ Remove
                                    </button>
                                </div>
                            </div>
                            <div class="form-group grid-col-full mt-md">
                                <button type="submit" class="btn btn-primary" id="saveOrgSettingsBtn">
                                    💾 Save Organization Information
                                </button>
                                <button type="button" class="btn btn-secondary ml-md" id="cancelOrgSettingsBtn">
                                    ❌ Cancel Changes
                                </button>
                            </div>
                        </form>
                    </div>
                    <div>
                        <h3>Preferences</h3>
                        <form id="orgPreferencesForm">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="autoAssignByDomain" name="auto_assign_by_domain">
                                    Auto-assign users by email domain
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="enableProjectTemplates" name="enable_project_templates">
                                    Enable project templates
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="enableCustomBranding" name="enable_custom_branding">
                                    Enable custom branding
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Preferences</button>
                        </form>
                    </div>
                </div>

                <!-- Target Roles Management Section -->
                <div class="section-divider">
                    <h3>Target Roles Management</h3>
                    <p class="text-muted mb-xl">
                        Manage the list of available target roles for projects. These roles will appear in the dropdown when creating new projects.
                    </p>

                    <div class="grid-2fr-1fr">
                        <!-- Current Roles List -->
                        <div>
                            <h4>Current Target Roles</h4>
                            <div id="targetRolesList" class="card-role-list">
                                <!-- Roles will be populated here -->
                            </div>
                        </div>

                        <!-- Add New Role -->
                        <div>
                            <h4>Add New Role</h4>
                            <form id="addTargetRoleForm" class="card-bordered">
                                <div class="form-group">
                                    <label for="newTargetRole" class="form-label">Role Name</label>
                                    <input type="text" id="newTargetRole" placeholder="e.g., Frontend Developer" required
                                           class="form-input-full">
                                </div>
                                <button type="submit" class="btn btn-primary cohort-filter-input">
                                    ➕ Add Role
                                </button>
                            </form>

                            <!-- Reset to Defaults -->
                            <button type="button" onclick="resetTargetRolesToDefaults()" class="btn btn-secondary w-full mt-2rem">
                                🔄 Reset to Defaults
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Instructor Modal -->
    <div id="addInstructorModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="addInstructorModalTitle">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addInstructorModal')">&times;</span>
            <h2>Add New Instructor</h2>
            <form id="addInstructorForm">
                <div class="form-group">
                    <label for="instructorEmail" class="form-label">Email Address *</label>
                    <input type="email" id="instructorEmail" name="email" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="instructorFirstName" class="form-label">First Name *</label>
                    <input type="text" id="instructorFirstName" name="first_name" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="instructorLastName" class="form-label">Last Name *</label>
                    <input type="text" id="instructorLastName" name="last_name" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="instructorRole" class="form-label">Role</label>
                    <select id="instructorRole" name="role" class="form-select">
                        <option value="instructor">Instructor</option>
                        <option value="project_manager">Project Manager</option>
                        <option value="org_admin">Organization Admin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sendWelcomeEmail" name="send_welcome_email" checked>
                        Send welcome email
                    </label>
                </div>
                <div class="flex-end">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addInstructorModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Instructor</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Project Modal -->
    <div id="createProjectModal" class="modal-no-backdrop modal-center-fixed" role="dialog" aria-modal="true" aria-labelledby="createProjectModalTitle">
        <div class="modal-content-inner modal-content-flex">
            <!-- Draggable Modal Header -->
            <div class="modal-header draggable-handle modal-header-draggable">
                <h2 class="modal-header-title">Create New Training Project</h2>
                <span class="close modal-close-white" onclick="window.OrgAdmin.Projects.resetProjectWizard(); closeModal('createProjectModal')">&times;</span>
            </div>

            <!-- Project Creation Steps - Wave 4 Wizard Progress -->
            <div id="project-wizard-progress" data-wizard-progress class="project-creation-steps project-steps-container">
                <!-- Wizard progress indicator will render here -->
            </div>

            <!-- Draft Indicator - Wave 4 Auto-Save -->
            <div data-draft-indicator class="wizard-draft-indicator" style="display: none;">
                <span data-draft-text>Draft saved just now</span>
            </div>

            <!-- Wizard steps container - Scrollable wrapper -->
            <div class="modal-body-scroll">
                <div class="px-lg pb-lg">
                <!-- Step 1: Project Details -->
            <div id="projectStep1" class="project-step active">
                <h3>Project Information</h3>

                <!-- Spreadsheet Upload Section -->
                <div class="upload-section upload-section-bg">
                    <h4 class="h4-top-flex">
                        📊 Quick Import from Spreadsheet
                        <button type="button" class="btn-icon btn-icon-inline" onclick="toggleUploadHelp()" title="Show example format">ℹ️</button>
                    </h4>
                    <p class="upload-help-text">Upload an Excel (.xlsx, .xls) or LibreOffice Calc (.ods) file to automatically populate project details and tracks.</p>

                    <div id="uploadHelp" class="upload-help-box">
                        <strong>Expected spreadsheet format:</strong>
                        <table class="table-full-collapsed">
                            <thead>
                                <tr class="table-header-bg">
                                    <th class="table-cell-left">Column</th>
                                    <th class="table-cell-left">Required</th>
                                    <th class="table-cell-left">Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="table-cell-padding"><code>project_name</code></td>
                                    <td class="table-cell-padding">Yes</td>
                                    <td class="table-cell-padding">Project name</td>
                                </tr>
                                <tr class="table-row-alt-bg">
                                    <td class="table-cell-padding"><code>project_slug</code></td>
                                    <td class="table-cell-padding">Yes</td>
                                    <td class="table-cell-padding">URL-friendly slug (lowercase, hyphens)</td>
                                </tr>
                                <tr>
                                    <td class="table-cell-padding"><code>description</code></td>
                                    <td class="table-cell-padding">Yes</td>
                                    <td class="table-cell-padding">Project description</td>
                                </tr>
                                <tr class="table-row-alt-bg">
                                    <td class="table-cell-padding"><code>start_date</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Format: YYYY-MM-DD</td>
                                </tr>
                                <tr>
                                    <td class="table-cell-padding"><code>end_date</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Format: YYYY-MM-DD</td>
                                </tr>
                                <tr class="table-row-alt-bg">
                                    <td class="table-cell-padding"><code>tracks</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Comma-separated track names</td>
                                </tr>
                                <tr>
                                    <td class="table-cell-padding"><code>student_emails</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Comma-separated student emails</td>
                                </tr>
                                <tr class="table-row-alt-bg">
                                    <td class="table-cell-padding"><code>student_names</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Comma-separated student names (parallel to emails)</td>
                                </tr>
                                <tr>
                                    <td class="table-cell-padding"><code>instructor_emails</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Comma-separated instructor emails</td>
                                </tr>
                                <tr class="table-row-alt-bg">
                                    <td class="table-cell-padding"><code>instructor_names</code></td>
                                    <td class="table-cell-padding">No</td>
                                    <td class="table-cell-padding">Comma-separated instructor names (parallel to emails)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="upload-button-row">
                        <input type="file" id="projectSpreadsheetUpload" accept=".xlsx,.xls,.ods" class="file-input-hidden" onchange="handleProjectSpreadsheetUpload(event)">
                        <button type="button" class="btn btn-outline flex-center-gap-half" onclick="document.getElementById('projectSpreadsheetUpload').click()">
                            📤 Upload Spreadsheet
                        </button>
                        <button type="button" class="btn btn-secondary flex-center-gap-half" onclick="downloadProjectTemplate()">
                            📥 Download Template
                        </button>
                        <span id="uploadedFileName" class="upload-filename-text"></span>
                    </div>
                </div>

                <div class="divider-text">
                    — OR —
                </div>

                <form id="createProjectForm">
                    <!-- Step 0: Project Type Selection -->
                    <div class="project-type-box">
                        <div class="project-type-label">📍 Project Type</div>
                        <div class="project-type-options">
                            <label class="form-label project-type-option-label project-type-option">
                                <input type="radio" id="projectTypeSingle" name="project_type" value="single_location" checked onchange="handleProjectTypeChange(this.value)" class="project-type-radio">
                                <div class="multi-location-text">
                                    <div class="project-type-title">🏢 Single Location Project</div>
                                    <div class="project-type-description">One location with a single schedule. Best for most training programs.</div>
                                </div>
                            </label>
                            <label class="form-label project-type-option-label project-type-option">
                                <input type="radio" id="projectTypeMultiLocation" name="project_type" value="multi_location" onchange="handleProjectTypeChange(this.value)" class="project-type-radio">
                                <div class="multi-location-text">
                                    <div class="project-type-title">🌍 Multi-Location Project (Cohorts)</div>
                                    <div class="project-type-description">Run the same program in multiple locations or at different times. Each cohort has independent scheduling and capacity.</div>
                                </div>
                            </label>
                        </div>
                        <input type="hidden" id="hasSubProjects" name="has_sub_projects" value="false">
                    </div>

                    <!-- Multi-Location Note (shown when multi_location is selected) -->
                    <div id="cohortInfoNote" class="cohort-info-note">
                        <strong>ℹ️ Multi-Location Setup</strong>
                        <p class="ai-message-text">
                            You'll be able to create multiple cohorts after setting up the main project. Each cohort will have:
                            <ul class="cohort-info-list">
                                <li>Independent location (country, region, city)</li>
                                <li>Custom start and end dates</li>
                                <li>Separate enrollment capacity</li>
                                <li>Customizable track selection</li>
                            </ul>
                        </p>
                    </div>

                    <div class="form-group">
                        <label for="projectName" class="form-label">Project Name *</label>
                        <input type="text" id="projectName" name="name" required
                               data-validate="required,minLength:3"
                               data-validate-message="Project name must be at least 3 characters"
                               class="form-input">
                        <div class="validation-error" style="display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label for="projectSlug" class="form-label">URL Slug *</label>
                        <input type="text" id="projectSlug" name="slug" required pattern="^[a-z0-9\-]+$"
                               data-validate="required,pattern:^[a-z0-9\-]+$"
                               data-validate-message="Only lowercase letters, numbers, and hyphens allowed"
                               class="form-input">
                        <small>Only lowercase letters, numbers, and hyphens allowed</small>
                        <div class="validation-error" style="display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label for="projectDescription" class="form-label">Project Description *</label>
                        <textarea id="projectDescription" name="description" placeholder="Describe the goals and objectives of this training project..." required
                                  data-validate="required,minLength:20"
                                  data-validate-message="Description must be at least 20 characters"
                                  class="form-input"></textarea>
                        <small>This description will be used by AI to suggest relevant tracks and content</small>
                        <div class="validation-error" style="display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label for="projectTargetRoles" class="form-label">Target Roles</label>
                        <select id="projectTargetRoles" name="target_roles" multiple size="10" class="select-full-padding form-select">
                            <!-- Technical Roles -->
                            <optgroup label="👨‍💻 Technical Roles">
                                <option value="application_developers">Application Developer</option>
                                <option value="devops_engineers">DevOps Engineer</option>
                                <option value="qa_engineers">QA Engineer</option>
                                <option value="operations_engineers">Operations Engineer</option>
                                <option value="system_administrators">System Administrator</option>
                                <option value="technical_architects">Technical Architect</option>
                                <option value="security_engineers">Security Engineer</option>
                                <option value="database_administrators">Database Administrator</option>
                            </optgroup>

                            <!-- Business Roles -->
                            <optgroup label="💼 Business Roles">
                                <option value="business_analysts">Business Analyst</option>
                                <option value="product_managers">Product Manager</option>
                                <option value="project_managers">Project Manager</option>
                                <option value="business_consultants">Business Consultant</option>
                            </optgroup>

                            <!-- Data & Analytics -->
                            <optgroup label="📊 Data & Analytics">
                                <option value="data_scientists">Data Scientist</option>
                                <option value="data_analysts">Data Analyst</option>
                                <option value="data_engineers">Data Engineer</option>
                                <option value="business_intelligence_analysts">Business Intelligence Analyst</option>
                            </optgroup>

                            <!-- Leadership & Management -->
                            <optgroup label="👔 Leadership & Management">
                                <option value="engineering_managers">Engineering Manager</option>
                                <option value="team_leads">Team Lead</option>
                                <option value="technical_directors">Technical Director</option>
                                <option value="cto">Chief Technology Officer</option>
                            </optgroup>
                        </select>
                        <small class="form-help">Hold Ctrl/Cmd to select multiple roles. Roles are organized by category for easier selection.</small>
                    </div>
                    <div class="grid-2-cols">
                        <div class="form-group">
                            <label for="projectDuration" class="form-label">Duration (weeks)</label>
                            <input type="number" id="projectDuration" name="duration_weeks" min="1" max="52" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="projectMaxParticipants" class="form-label">Maximum Participants</label>
                            <input type="number" id="projectMaxParticipants" name="max_participants" min="1" class="form-input">
                        </div>
                    </div>
                    <div class="grid-2-cols">
                        <div class="form-group">
                            <label for="projectStartDate" class="form-label">Start Date</label>
                            <input type="date" id="projectStartDate" name="start_date" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="projectEndDate" class="form-label">End Date</label>
                            <input type="date" id="projectEndDate" name="end_date" class="form-input">
                        </div>
                    </div>
                    <div class="flex-space-between">
                        <button type="button" class="btn btn-outline" onclick="window.OrgAdmin.Projects.saveCurrentProjectDraft()" title="Save your progress and continue later">
                            💾 Save as Draft
                        </button>
                        <div class="flex-gap-1">
                            <button type="button" class="btn btn-secondary" onclick="window.OrgAdmin.Projects.resetProjectWizard(); closeModal('createProjectModal')">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="window.OrgAdmin.Projects.nextProjectStep()">Next: Configure Locations</button>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- Step 2: Subprojects / Cohorts (Multi-Location) -->
            <div id="projectStep2" class="project-step">
                <h3>Configure Locations</h3>
                <p>Define locations for your multi-location project. Each location represents a separate location or group.</p>

                <!-- Conditional Display: Only for Multi-Location Projects -->
                <div id="subprojectsContent">
                    <!-- Info Box -->
                    <div class="gradient-purple-box">
                        <div class="flex-start-gap-1">
                            <div class="font-size-2rem">🌍</div>
                            <div>
                                <h4 class="h4-margin-tight">Multi-Location Project Setup</h4>
                                <p class="p-margin-0-white">
                                    Set up training locations. Each location can have its own schedule,
                                    instructors, and students while sharing the same tracks and content.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Cohorts List Container -->
                    <div id="cohortsList" class="cohorts-list-section">
                        <h4 class="h4-margin-std">Defined Locations</h4>
                        <div id="cohortsListContent" class="cohorts-list-content">
                            <!-- Cohorts will be dynamically added here -->
                            <div class="cohort-empty-placeholder">
                                <p class="p-margin-0-muted">
                                    No locations defined yet. Click "Add Location" to create your first location.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Add Location Button -->
                    <button
                        type="button"
                        class="btn btn-primary mb-2rem"
                        onclick="window.OrgAdmin.Projects.showAddCohortForm()">
                        ➕ Add Location
                    </button>

                    <!-- Add Cohort Form (Hidden by default) -->
                    <div id="addCohortForm" class="cohort-form-hidden">
                        <h4 class="h4-margin-std">Add New Location</h4>

                        <div class="form-group">
                            <label for="cohortName" class="form-label">Location Name *</label>
                            <input type="text" id="cohortName" class="form-input" placeholder="e.g., New York Campus, Downtown Branch" required>
                        </div>

                        <div class="form-group">
                            <label for="cohortLocation" class="form-label">Location *</label>
                            <input type="text" id="cohortLocation" class="form-input" placeholder="e.g., New York, NY" required>
                        </div>

                        <div class="form-row cohort-form-row">
                            <div class="form-group">
                                <label for="cohortStartDate" class="form-label">Start Date</label>
                                <input type="date" id="cohortStartDate" class="form-input">
                            </div>

                            <div class="form-group">
                                <label for="cohortEndDate" class="form-label">End Date</label>
                                <input type="date" id="cohortEndDate" class="form-input">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="cohortMaxStudents" class="form-label">Max Students</label>
                            <input type="number" id="cohortMaxStudents" class="form-input" placeholder="e.g., 30" min="1">
                        </div>

                        <div class="flex-gap-mt">
                            <button type="button" class="btn btn-primary" onclick="window.OrgAdmin.Projects.saveCohort()">
                                ✓ Add Cohort
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="window.OrgAdmin.Projects.cancelCohortForm()">
                                Cancel
                            </button>
                        </div>
                    </div>

                    <!-- Help Text -->
                    <div class="help-tip-box">
                        <strong>💡 Tip:</strong> You can add more locations later from the project detail view.
                        Instructors, students, and tracks will be assigned in the next steps.
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="button-group button-group--end mt-2xl">
                    <button type="button" class="btn btn-secondary px-lg py-md min-w-120" onclick="window.OrgAdmin.Projects.previousProjectStep()">
                        ← Back
                    </button>
                    <button type="button" class="btn btn-outline px-lg py-md min-w-140" onclick="window.OrgAdmin.Projects.saveCurrentProjectDraft()" title="Save your progress and continue later">
                        💾 Save as Draft
                    </button>
                    <button type="button" class="btn btn-primary px-lg py-md min-w-180" onclick="window.OrgAdmin.Projects.nextProjectStep()">
                        Next: Configure Tracks →
                    </button>
                </div>
            </div>

            <!-- Step 3: Training Tracks (formerly Step 2) -->
            <div id="projectStep3" class="project-step">
                <h3>Configure Training Tracks</h3>
                <p>Define learning paths tailored to different target audiences within your organization.</p>

                <!-- Track Requirement Toggle -->
                <div class="form-group mb-1-5">
                    <div class="flex-center-gap-half">
                        <input
                            type="checkbox"
                            id="needTracks"
                            checked
                            onchange="window.OrgAdmin.Projects.handleTrackRequirementChange()"
                            class="w-18-h-18">
                        <label for="needTracks" class="form-label label-cursor-pointer">
                            This project requires learning tracks
                        </label>
                    </div>
                    <small class="form-help ml-26">
                        Uncheck if this is a simple training session without structured tracks
                    </small>
                </div>

                <!-- Track Creation Fields Container -->
                <div id="trackFieldsContainer">
                    <!-- Selected Roles Summary -->
                    <div class="track-fields-box">
                        <h4 class="h4-margin-top-0">
                            Target Roles from Step 1:
                        </h4>
                        <div id="selectedRolesSummary" class="flex-wrap-gap-half">
                            <!-- Will be populated with selected roles from Step 1 -->
                        </div>
                        <p class="p-margin-link">
                            <a href="#" onclick="window.OrgAdmin.Projects.previousProjectStep(); return false;" class="link-primary">
                                ← Go back to Step 1
                            </a> to change your role selection
                        </p>
                    </div>

                    <!-- Track Mapping Info Box -->
                    <div class="info-box-blue">
                        <div class="flex-start-gap-half">
                            <span class="font-size-1-2rem">ℹ️</span>
                            <div>
                                <strong>Automatic Track Mapping</strong>
                                <p class="p-margin-track">
                                    Based on your target roles from Step 1, we'll automatically generate pre-configured
                                    learning tracks with appropriate difficulty level, description, and skill requirements.
                                    You'll review these tracks before creation.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="button-group button-group--end mt-2xl">
                    <button type="button" class="btn btn-secondary px-lg py-md" class="min-w-120 whitespace-nowrap" onclick="window.OrgAdmin.Projects.previousProjectStep()">
                        ← Back
                    </button>
                    <button type="button" class="btn btn-outline px-lg py-md" class="min-w-140 whitespace-nowrap" onclick="window.OrgAdmin.Projects.saveCurrentProjectDraft()" title="Save your progress and continue later">
                        💾 Save as Draft
                    </button>
                    <button type="button" class="btn btn-primary px-lg py-md" class="min-w-200 whitespace-nowrap" onclick="window.OrgAdmin.Projects.nextProjectStep()">
                        Next: Review & Create →
                    </button>
                </div>
            </div>

            <!-- Step 4: Review & Confirm Tracks -->
            <div id="projectStep4" class="project-step">
                <h3>Review & Confirm Tracks</h3>
                <p>Review the automatically generated learning tracks for your project. You can create additional custom tracks if needed.</p>

                <!-- Generated Tracks Review Container -->
                <div id="generatedTracksReview" class="track-review-box">
                    <h4 class="mb-1rem">Generated Learning Tracks:</h4>
                    <div id="tracksReviewList" class="track-review-list">
                        <!-- Tracks will be dynamically populated here -->
                        <div class="track-empty-message">
                            <p>No tracks generated yet. Go back to Step 2 and click "Next: Review & Create"</p>
                        </div>
                    </div>
                </div>

                <!-- Create Additional Track Section -->
                <div class="track-additional-box">
                    <div class="flex-between-center-mb">
                        <div>
                            <h4 class="h4-margin-tight">Need Additional Tracks?</h4>
                            <p class="p-margin-0-muted font-size-0-9rem">
                                Create custom tracks beyond the auto-generated ones
                            </p>
                        </div>
                        <button type="button" class="btn btn-secondary"
                                onclick="window.OrgAdmin.Projects.openCustomTrackCreation()"
                                class="btn-padding-custom whitespace-nowrap">
                            ➕ Create New Track
                        </button>
                    </div>
                </div>

                <!-- Summary Statistics -->
                <div class="summary-card">
                    <h4 class="summary-card-title">Project Summary:</h4>
                    <div class="summary-grid">
                        <div>
                            <div class="summary-stat-label">Total Tracks</div>
                            <div id="totalTracksCount" class="summary-stat-value summary-stat-value--primary">0</div>
                        </div>
                        <div>
                            <div class="summary-stat-label">Target Roles</div>
                            <div id="totalRolesCount" class="summary-stat-value summary-stat-value--success">0</div>
                        </div>
                        <div>
                            <div class="summary-stat-label">Status</div>
                            <div class="summary-stat-value summary-stat-value--success">✓ Ready</div>
                        </div>
                    </div>
                </div>

                <!-- Multi-Location Cohorts Notice (shown when has_sub_projects is true) -->
                <div id="multiLocationNotice" class="multi-location-notice">
                    <div class="multi-location-notice-content">
                        <div class="multi-location-icon">🌍</div>
                        <div class="multi-location-text">
                            <h4 class="multi-location-title">Multi-Location Project Setup</h4>
                            <p class="multi-location-description">
                                After creating this project, you'll be able to set up multiple cohorts for different locations or time periods.
                                Each cohort will have independent scheduling, capacity, and track selection.
                            </p>
                            <div class="multi-location-steps">
                                <strong class="multi-location-steps-title">📋 Next Steps:</strong>
                                <ol class="multi-location-steps-list">
                                    <li>Complete project creation by clicking "Create Project & Tracks" below</li>
                                    <li>Navigate to the project detail view</li>
                                    <li>Click "➕ Create Location" to set up your first location</li>
                                </ol>
                            </div>
                            <p class="multi-location-tip">
                                💡 Tip: You can also access location management from the "Locations" section after project creation.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="button-group button-group--end mt-2xl">
                    <button type="button" class="btn btn-secondary px-lg py-md"
                            class="min-w-120 whitespace-nowrap"
                            onclick="window.OrgAdmin.Projects.previousProjectStep()">
                        ← Back
                    </button>
                    <button type="button" class="btn btn-secondary px-lg py-md"
                            class="min-w-140 whitespace-nowrap"
                            onclick="closeModal('createProjectModal')">
                        Save as Draft
                    </button>
                    <button type="button" class="btn btn-success px-lg py-md"
                            class="min-w-200 whitespace-nowrap"
                            onclick="window.OrgAdmin.Projects.finalizeProjectCreation()">
                        ✓ Create Project & Tracks
                    </button>
                </div>
                </div>
                </div> <!-- Close wizard steps container -->
            </div> <!-- Close modal-body-scroll -->
        </div>
    </div>

    <!-- Create Location Modal (5-Step Wizard) -->
    <div id="createCohortModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="createCohortModalTitle">
        <div class="modal-content modal-content--lg">
            <div class="cohort-draggable-handle">
                <h2 id="createCohortModalTitle" class="cohort-modal-title">🌍 Create New Location</h2>
                <span class="close" onclick="closeModal('createCohortModal')">&times;</span>
            </div>

            <!-- Progress indicator -->
            <div class="cohort-progress-container">
                <div class="cohort-progress-steps">
                    <div class="wizard-step-indicator active" data-step="1">
                        1. Basic Info
                    </div>
                    <div class="wizard-step-indicator" data-step="2">
                        2. Location
                    </div>
                    <div class="wizard-step-indicator" data-step="3">
                        3. Schedule
                    </div>
                    <div class="wizard-step-indicator" data-step="4">
                        4. Tracks
                    </div>
                    <div class="wizard-step-indicator" data-step="5">
                        5. Review
                    </div>
                </div>
            </div>

            <div class="cohort-modal-body">
                <!-- Step 1: Basic Information -->
                <div id="cohortStep1" class="wizard-step active">
                    <h3 class="cohort-step-title">📝 Basic Information</h3>
                    <form id="cohortBasicInfoForm">
                        <div class="form-group">
                            <label for="cohortName" class="form-label">Location Name *</label>
                            <input type="text" id="cohortName" name="name" required placeholder="e.g., Boston Cohort Fall 2025" class="form-input">
                            <small class="form-help">A descriptive name for this cohort/location</small>
                        </div>
                        <div class="form-group">
                            <label for="cohortSlug" class="form-label">Slug (URL-friendly identifier) *</label>
                            <input type="text" id="cohortSlug" name="slug" required placeholder="e.g., boston-fall-2025" pattern="[a-z0-9-]+" class="form-input">
                            <small class="form-help">Lowercase letters, numbers, and hyphens only</small>
                        </div>
                        <div class="form-group">
                            <label for="cohortDescription" class="form-label">Description</label>
                            <textarea id="cohortDescription" name="description" rows="4" placeholder="Describe this cohort and its unique characteristics..." class="form-input"></textarea>
                        </div>
                    </form>
                    <div class="cohort-step-nav--end">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('createCohortModal')">Cancel</button>
                        <button type="button" class="btn btn-primary next-step-btn" onclick="nextCohortStep()">Next: Location →</button>
                    </div>
                </div>

                <!-- Step 2: Location Information -->
                <div id="cohortStep2" class="wizard-step">
                    <h3 class="cohort-step-title">📍 Location Details</h3>
                    <form id="cohortLocationForm">
                        <div class="form-group">
                            <label for="cohortCountry" class="form-label">Country *</label>
                            <select id="cohortCountry" name="location_country" required onchange="loadRegionsForCountry(this.value)" class="form-select">
                                <option value="">Select Country</option>
                                <option value="United States">United States</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="Canada">Canada</option>
                                <option value="Germany">Germany</option>
                                <option value="France">France</option>
                                <option value="Japan">Japan</option>
                                <option value="Australia">Australia</option>
                                <option value="Brazil">Brazil</option>
                                <option value="India">India</option>
                                <option value="China">China</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="cohortRegion" class="form-label">State/Province/Region</label>
                            <select id="cohortRegion" name="location_region" class="form-select">
                                <option value="">Select Region (optional)</option>
                            </select>
                            <small class="form-help">Will load based on selected country</small>
                        </div>
                        <div class="form-group">
                            <label for="cohortCity" class="form-label">City</label>
                            <input type="text" id="cohortCity" name="location_city" placeholder="e.g., Boston" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="cohortTimezone" class="form-label">Timezone *</label>
                            <select id="cohortTimezone" name="timezone" required class="form-select">
                                <option value="UTC">UTC (Coordinated Universal Time)</option>
                                <option value="America/New_York">America/New York (EST/EDT)</option>
                                <option value="America/Chicago">America/Chicago (CST/CDT)</option>
                                <option value="America/Denver">America/Denver (MST/MDT)</option>
                                <option value="America/Los_Angeles">America/Los Angeles (PST/PDT)</option>
                                <option value="America/Toronto">America/Toronto (EST/EDT)</option>
                                <option value="Europe/London">Europe/London (GMT/BST)</option>
                                <option value="Europe/Paris">Europe/Paris (CET/CEST)</option>
                                <option value="Europe/Berlin">Europe/Berlin (CET/CEST)</option>
                                <option value="Asia/Tokyo">Asia/Tokyo (JST)</option>
                                <option value="Asia/Shanghai">Asia/Shanghai (CST)</option>
                                <option value="Asia/Kolkata">Asia/Kolkata (IST)</option>
                                <option value="Australia/Sydney">Australia/Sydney (AEST/AEDT)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="cohortAddress" class="form-label">Physical Address (optional)</label>
                            <textarea id="cohortAddress" name="location_address" rows="2" placeholder="Full street address for this location..." class="form-input"></textarea>
                            <small class="form-help">Optional: Full address if training is at a specific building</small>
                        </div>
                    </form>
                    <div class="cohort-step-nav">
                        <button type="button" class="btn btn-secondary" onclick="previousCohortStep()">← Back</button>
                        <button type="button" class="btn btn-primary next-step-btn" onclick="nextCohortStep()">Next: Schedule →</button>
                    </div>
                </div>

                <!-- Step 3: Schedule Configuration -->
                <div id="cohortStep3" class="wizard-step">
                    <h3 class="cohort-step-title">📅 Schedule & Capacity</h3>
                    <form id="cohortScheduleForm">
                        <div class="form-group">
                            <label for="cohortStartDate" class="form-label">Start Date</label>
                            <input type="date" id="cohortStartDate" name="start_date" onchange="calculateCohortDuration()" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="cohortEndDate" class="form-label">End Date</label>
                            <input type="date" id="cohortEndDate" name="end_date" onchange="calculateCohortDuration()" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="cohortDuration" class="form-label">Duration (weeks)</label>
                            <input type="number" id="cohortDuration" name="duration_weeks" readonly class="readonly-input form-input">
                            <small class="form-help">Auto-calculated from start and end dates</small>
                        </div>
                        <div class="form-group">
                            <label for="cohortMaxParticipants" class="form-label">Maximum Participants</label>
                            <input type="number" id="cohortMaxParticipants" name="max_participants" min="1" placeholder="e.g., 30" class="form-input">
                            <small class="form-help">Leave empty for unlimited capacity</small>
                        </div>
                    </form>
                    <div class="cohort-step-nav">
                        <button type="button" class="btn btn-secondary" onclick="previousCohortStep()">← Back</button>
                        <button type="button" class="btn btn-primary next-step-btn" onclick="nextCohortStep()">Next: Tracks →</button>
                    </div>
                </div>

                <!-- Step 4: Track Selection -->
                <div id="cohortStep4" class="wizard-step">
                    <h3 class="cohort-step-title">📚 Select Tracks</h3>
                    <p class="text-muted mb-md">
                        Choose which tracks from the parent project will be included in this cohort.
                        You can customize start/end dates and instructors for each track.
                    </p>
                    <div id="availableTracksList" class="cohort-tracks-list">
                        <!-- Track items will be loaded dynamically -->
                        <div class="cohort-tracks-placeholder">
                            <p>Loading tracks from parent project...</p>
                        </div>
                    </div>
                    <div class="cohort-step-nav">
                        <button type="button" class="btn btn-secondary" onclick="previousCohortStep()">← Back</button>
                        <button type="button" class="btn btn-primary next-step-btn" onclick="nextCohortStep()">Next: Review →</button>
                    </div>
                </div>

                <!-- Step 5: Review & Create -->
                <div id="cohortStep5" class="wizard-step">
                    <h3 class="cohort-step-title">✅ Review & Create</h3>
                    <p class="subtitle-text">Review your cohort details before creating.</p>

                    <div id="reviewBasicInfo" class="review-section">
                        <h4 class="review-section-title">Basic Information</h4>
                        <p id="reviewName" class="review-text"></p>
                        <p id="reviewSlug" class="review-text--muted"></p>
                        <p id="reviewDescription" class="review-text--description"></p>
                    </div>

                    <div id="reviewLocation" class="review-section">
                        <h4 class="review-section-title">Location</h4>
                        <p id="reviewLocationDetails" class="review-text"></p>
                        <p id="reviewTimezone" class="review-text--muted"></p>
                    </div>

                    <div id="reviewSchedule" class="review-section">
                        <h4 class="review-section-title">Schedule & Capacity</h4>
                        <p id="reviewDates" class="review-text"></p>
                        <p id="reviewCapacity" class="review-text"></p>
                    </div>

                    <div id="reviewTracks" class="review-section">
                        <h4 class="review-section-title">Selected Tracks</h4>
                        <div id="reviewTracksList"></div>
                    </div>

                    <div class="cohort-step-nav">
                        <button type="button" class="btn btn-secondary" onclick="previousCohortStep()">← Back</button>
                        <button type="button" id="submitCohortBtn" class="btn btn-primary" onclick="submitCohortCreation()">Create Cohort</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Detail View Modal -->
    <div id="projectDetailView" class="modal-backdrop project-detail-modal" role="dialog" aria-modal="true" aria-labelledby="projectDetailTitle">
        <div class="modal-content modal-content--2xl modal-content--full-height">
            <div class="cohort-draggable-handle">
                <h2 id="projectDetailTitle" class="project-detail-title">📁 Project Details</h2>
                <span class="close" onclick="closeProjectDetail()">&times;</span>
            </div>

            <!-- Project Detail Tabs -->
            <div class="project-detail-tabs">
                <div class="project-tabs-container">
                    <button class="tab-btn active" data-tab="overview" onclick="switchProjectDetailTab('overview')">
                        📊 Overview
                    </button>
                    <button class="tab-btn" data-tab="cohorts" onclick="switchProjectDetailTab('cohorts')">
                        🌍 Cohorts
                    </button>
                    <button class="tab-btn" data-tab="analytics" onclick="switchProjectDetailTab('analytics')">
                        📈 Analytics
                    </button>
                </div>
            </div>

            <div class="cohort-modal-body">
                <!-- Overview Tab -->
                <div id="projectDetailOverview" class="project-detail-tab active">
                    <div id="projectOverviewContent">
                        <!-- Will be populated dynamically -->
                        <p class="project-detail-loading">Loading project details...</p>
                    </div>
                </div>

                <!-- Cohorts Tab -->
                <div id="cohortsTabContent" class="project-detail-tab">
                    <!-- Filters Section -->
                    <div class="cohort-filters-section">
                        <h3 class="cohort-filters-title">🔍 Filter Cohorts</h3>
                        <div class="summary-grid">
                            <div class="form-group cohort-filter-group">
                                <label for="cohortCountryFilter" class="form-label">Country</label>
                                <select id="cohortCountryFilter" onchange="applyCohortFilters()" class="cohort-filter-input form-select">
                                    <option value="">All Countries</option>
                                    <option value="United States">United States</option>
                                    <option value="United Kingdom">United Kingdom</option>
                                    <option value="Canada">Canada</option>
                                    <option value="Germany">Germany</option>
                                    <option value="France">France</option>
                                    <option value="Japan">Japan</option>
                                    <option value="Australia">Australia</option>
                                    <option value="Brazil">Brazil</option>
                                    <option value="India">India</option>
                                    <option value="China">China</option>
                                </select>
                            </div>
                            <div class="form-group cohort-filter-group">
                                <label for="cohortRegionFilter" class="form-label">Region/State</label>
                                <input type="text" id="cohortRegionFilter" placeholder="e.g., California" onchange="applyCohortFilters()" class="cohort-filter-input form-input">
                            </div>
                            <div class="form-group cohort-filter-group">
                                <label for="cohortCityFilter" class="form-label">City</label>
                                <input type="text" id="cohortCityFilter" placeholder="e.g., Boston" onchange="applyCohortFilters()" class="cohort-filter-input form-input">
                            </div>
                            <div class="form-group cohort-filter-group">
                                <label for="cohortStatusFilter" class="form-label">Status</label>
                                <select id="cohortStatusFilter" onchange="applyCohortFilters()" class="cohort-filter-input form-select">
                                    <option value="">All Status</option>
                                    <option value="draft">Draft</option>
                                    <option value="active">Active</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                    <option value="archived">Archived</option>
                                </select>
                            </div>
                            <div class="form-group cohort-filter-group">
                                <label for="cohortDateFromFilter" class="form-label">Start Date From</label>
                                <input type="date" id="cohortDateFromFilter" onchange="applyCohortFilters()" class="cohort-filter-input form-input">
                            </div>
                            <div class="form-group cohort-filter-group">
                                <label for="cohortDateToFilter" class="form-label">Start Date To</label>
                                <input type="date" id="cohortDateToFilter" onchange="applyCohortFilters()" class="cohort-filter-input form-input">
                            </div>
                        </div>
                        <div class="cohort-filters-actions">
                            <button id="clearCohortsFiltersBtn" class="btn btn-secondary" onclick="clearCohortFilters()">Clear Filters</button>
                        </div>
                    </div>

                    <!-- View Toggle and Create Button -->
                    <div class="cohort-view-controls">
                        <div class="chat-input-container">
                            <button id="cohortListViewBtn" class="btn btn-secondary active cohort-view-btn" onclick="showCohortListView()">
                                📋 List View
                            </button>
                            <button id="cohortTimelineViewBtn" class="btn btn-secondary cohort-view-btn" onclick="showCohortTimelineView()">
                                📅 Timeline View
                            </button>
                        </div>
                        <button id="createCohortBtn" class="btn btn-primary" onclick="openCreateCohortModal()">
                            ➕ Create Cohort
                        </button>
                    </div>

                    <!-- List View Container -->
                    <div id="cohortListViewContainer">
                        <!-- Cohorts List -->
                        <div id="cohortsList">
                            <!-- Cohort items will be loaded here dynamically -->
                        </div>

                        <!-- Empty State -->
                        <div id="cohortsEmptyState" class="cohort-empty-state">
                            <div class="cohort-empty-icon">🌍</div>
                            <h3 class="cohort-empty-title">No Cohorts Created Yet</h3>
                            <p class="subtitle-text">
                                This project doesn't have any cohorts yet. Create your first cohort to run this training program in multiple locations.
                            </p>
                            <button class="btn btn-primary" onclick="openCreateCohortModal()">Create First Cohort</button>
                        </div>
                    </div>

                    <!-- Timeline View Container (Hidden by default) -->
                    <div id="cohortTimelineContainer" class="cohort-timeline-container">
                        <div class="cohort-timeline-content">
                            <div id="timelineContent">
                                <!-- Timeline will be rendered here -->
                                <p class="cohort-timeline-placeholder">Timeline view will display cohorts on a visual calendar.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Comparison Controls (When cohorts selected) -->
                    <div id="cohortComparisonControls" class="cohort-comparison-controls">
                        <div class="cohort-comparison-inner">
                            <span id="selectedCohortCount">0 cohorts selected</span>
                            <button id="compareCohortsBtn" class="btn cohort-comparison-btn" onclick="openCohortComparison()">
                                Compare
                            </button>
                            <button class="btn cohort-comparison-btn--clear" onclick="clearCohortSelection()">
                                Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div id="projectDetailAnalytics" class="project-detail-tab">
                    <div id="projectAnalyticsContent">
                        <!-- Will be populated dynamically -->
                        <p class="project-detail-loading">Project analytics will be displayed here.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cohort Comparison Modal -->
    <div id="cohortComparisonModal" class="modal-backdrop cohort-comparison-modal" role="dialog" aria-modal="true" aria-labelledby="cohortComparisonTitle">
        <div class="modal-content modal-content--xl">
            <div class="cohort-comparison-header">
                <h2 id="cohortComparisonTitle" class="cohort-comparison-title">📊 Compare Cohorts</h2>
                <span class="close" onclick="closeModal('cohortComparisonModal')">&times;</span>
            </div>
            <div class="cohort-comparison-body">
                <table id="comparisonTable" class="data-table" class="cohort-filter-input">
                    <!-- Comparison table will be populated dynamically -->
                </table>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="addStudentModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="addStudentModalTitle">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addStudentModal')">&times;</span>
            <h2>Add Student to Organization</h2>
            <form id="addStudentForm">
                <div class="form-group">
                    <label for="studentEmail" class="form-label">Email Address *</label>
                    <input type="email" id="studentEmail" name="user_email" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="studentFirstName" class="form-label">First Name *</label>
                    <input type="text" id="studentFirstName" name="first_name" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="studentLastName" class="form-label">Last Name *</label>
                    <input type="text" id="studentLastName" name="last_name" required class="form-input">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sendStudentWelcomeEmail" name="send_welcome_email" checked>
                        Send welcome email
                    </label>
                </div>
                <div class="flex-end">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addStudentModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Student</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Project Instantiation Modal -->
    <div id="instantiateProjectModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="instantiateProjectModalTitle">
        <div class="modal-content modal-content--md">
            <span class="close" onclick="closeModal('instantiateProjectModal')">&times;</span>
            <h2>Instantiate Project</h2>
            <p>This will make the project active and available to students. Default tracks and modules will be created if none exist.</p>

            <div id="projectInstantiationDetails">
                <!-- Project details will be populated here -->
            </div>

            <div class="ai-processing-section">
                <h4>🤖 AI Processing Options</h4>
                <label>
                    <input type="checkbox" id="processWithAI" checked> Process project description with AI for enhanced content generation
                </label>
                <p class="ai-help-text">
                    AI will analyze the project description and suggest optimized tracks, modules, and learning paths.
                </p>
            </div>

            <div class="flex-end">
                <button type="button" class="btn btn-secondary" onclick="closeModal('instantiateProjectModal')">Cancel</button>
                <button type="button" class="btn btn-success" onclick="confirmProjectInstantiation()">🚀 Instantiate Project</button>
            </div>
        </div>
    </div>

    <!-- Instructor Assignment Modal -->
    <div id="instructorAssignmentModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="instructorAssignmentModalTitle">
        <div class="modal-content modal-content--lg">
            <span class="close" onclick="closeModal('instructorAssignmentModal')">&times;</span>
            <h2>Assign Instructors</h2>

            <div class="assignment-tabs">
                <button class="tab-btn active" onclick="switchAssignmentTab('tracks')">Track Assignments</button>
                <button class="tab-btn" onclick="switchAssignmentTab('modules')">Module Assignments</button>
            </div>

            <!-- Track Assignment Tab -->
            <div id="trackAssignmentTab" class="assignment-tab-content active">
                <h3>Assign Instructors to Tracks</h3>
                <div id="trackAssignmentList">
                    <!-- Track assignment interface will be populated here -->
                </div>
            </div>

            <!-- Module Assignment Tab -->
            <div id="moduleAssignmentTab" class="assignment-tab-content">
                <h3>Assign Instructors to Modules (Minimum 2 per module)</h3>
                <div id="moduleAssignmentList">
                    <!-- Module assignment interface will be populated here -->
                </div>
            </div>

            <div class="flex-end mt-xl">
                <button type="button" class="btn btn-secondary" onclick="closeModal('instructorAssignmentModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveInstructorAssignments()">Save Assignments</button>
            </div>
        </div>
    </div>

    <!-- Student Enrollment Modal -->
    <div id="studentEnrollmentModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="studentEnrollmentModalTitle">
        <div class="modal-content modal-content--xl">
            <span class="close" onclick="closeModal('studentEnrollmentModal')">&times;</span>
            <h2>Manage Student Enrollments</h2>

            <div class="flex-gap-2">
                <!-- Available Students -->
                <div class="flex-1">
                    <h3>Available Students</h3>
                    <div class="mb-md">
                        <input type="text" id="studentSearchInput" placeholder="Search students..."
                               onkeyup="searchStudents()" class="input-full form-input">
                    </div>
                    <div id="availableStudentsList" class="max-h-400 overflow-y-auto border-solid p-lg-1">
                        <!-- Available students will be populated here -->
                    </div>
                </div>

                <!-- Track Assignment -->
                <div class="flex-1">
                    <h3>Enroll in Track</h3>
                    <div class="mb-md">
                        <select id="enrollmentTrackSelect" class="input-full form-select">
                            <option value="">Select Track...</option>
                            <!-- Track options will be populated here -->
                        </select>
                    </div>

                    <div id="enrolledStudentsList" class="max-h-400 overflow-y-auto border-solid p-lg-1">
                        <!-- Enrolled students will be populated here -->
                    </div>
                </div>
            </div>

            <div class="flex-end mt-xl">
                <button type="button" class="btn btn-secondary" onclick="closeModal('studentEnrollmentModal')">Close</button>
                <button type="button" class="btn btn-primary" onclick="bulkEnrollStudents()">Enroll Selected Students</button>
            </div>
        </div>
    </div>

    <!-- Project Analytics Modal -->
    <div id="projectAnalyticsModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="projectAnalyticsModalTitle">
        <div class="modal-content modal-content--2xl">
            <span class="close" onclick="closeModal('projectAnalyticsModal')">&times;</span>
            <h2>Project Analytics Dashboard</h2>

            <div class="analytics-summary grid-analytics">
                <div class="stat-card">
                    <span class="stat-number" id="analyticsEnrolledStudents">0</span>
                    <span>Enrolled Students</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="analyticsActiveStudents">0</span>
                    <span>Active Students</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="analyticsCompletedStudents">0</span>
                    <span>Completed</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="analyticsAverageProgress">0%</span>
                    <span>Average Progress</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="analyticsAverageScore">0%</span>
                    <span>Average Quiz Score</span>
                </div>
            </div>

            <div class="analytics-tabs">
                <button class="tab-btn active" onclick="switchAnalyticsTab('overview')">Overview</button>
                <button class="tab-btn" onclick="switchAnalyticsTab('progress')">Progress Tracking</button>
                <button class="tab-btn" onclick="switchAnalyticsTab('performance')">Performance</button>
                <button class="tab-btn" onclick="switchAnalyticsTab('engagement')">Engagement</button>
            </div>

            <div id="analyticsTabContent" class="mt-xl">
                <!-- Analytics tab content will be populated here -->
            </div>

            <div class="flex-end mt-xl">
                <button type="button" class="btn btn-outline" onclick="exportAnalytics()">📊 Export Report</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('projectAnalyticsModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Student Unenrollment Modal -->
    <div id="studentUnenrollmentModal" class="modal student-unenrollment-modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('studentUnenrollmentModal')">&times;</span>
            <h2>Unenroll Students from Project</h2>
            <p>Select students to unenroll from this project. Their progress will be preserved for audit purposes.</p>
            
            <div class="unenrollment-options">
                <h4>🔧 Unenrollment Options</h4>
                <div>
                    <label>
                        <input type="checkbox" id="unenrollFromProject" checked> 
                        Unenroll from entire project (removes from all tracks)
                    </label>
                    <label>
                        <input type="checkbox" id="preserveProgress" checked> 
                        Preserve student progress data for audit purposes
                    </label>
                </div>
            </div>
            
            <div id="enrolledStudentsList" class="students-list">
                <!-- Enrolled students will be loaded here -->
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeModal('studentUnenrollmentModal')">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmStudentUnenrollment()" disabled>
                    ❌ Unenroll Selected Students
                </button>
            </div>
        </div>
    </div>

    <!-- Instructor Removal Modal -->
    <div id="instructorRemovalModal" class="modal instructor-removal-modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('instructorRemovalModal')">&times;</span>
            <h2>Remove Instructors</h2>
            <p>Select instructors to remove from project or organization. You can transfer their assignments to avoid disruption.</p>
            
            <div class="removal-options">
                <h4>🔧 Removal Options</h4>
                <div>
                    <label>
                        <input type="checkbox" id="removeFromOrganization"> 
                        Remove from entire organization (removes from all projects)
                    </label>
                    <label>
                        <input type="checkbox" id="transferAssignments"> 
                        Transfer assignments to another instructor
                    </label>
                </div>
                
                <div id="replacementInstructorSection" class="replacement-instructor-section d-none">
                    <label for="replacementInstructorSelect" class="form-label">Select Replacement Instructor:</label>
                    <select id="replacementInstructorSelect" class="form-input form-select">
                        <option value="">-- Select Replacement --</option>
                        <!-- Options populated dynamically -->
                    </select>
                </div>
            </div>
            
            <div id="assignedInstructorsList" class="instructors-list">
                <!-- Assigned instructors will be loaded here -->
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeModal('instructorRemovalModal')">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmInstructorRemoval()" disabled>
                    🗑️ Remove Selected Instructors
                </button>
            </div>
        </div>
    </div>

    <!-- Create/Edit Track Modal -->
    <div id="trackModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="trackModalTitle">
        <div class="modal-content modal-content--md">
            <span class="close" onclick="closeModal('trackModal')">&times;</span>
            <h2 id="trackModalTitle">Create New Track</h2>

            <form id="trackForm" onsubmit="submitTrack(event)">
                <input type="hidden" id="trackId" name="trackId">

                <div class="grid-2-cols">
                    <div class="form-group form-group--full">
                        <label for="trackName" class="form-label required">Track Name</label>
                        <input type="text" id="trackName" name="name" required maxlength="200"
                               placeholder="e.g., Python Fundamentals" class="form-input">
                    </div>

                    <div class="form-group form-group--full">
                        <label for="trackDescription" class="form-label">Description</label>
                        <textarea id="trackDescription" name="description" rows="4" maxlength="1000"
                                  placeholder="Describe the track objectives and content..." class="form-input"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="trackProject" class="form-label required">Project</label>
                        <select id="trackProject" name="project_id" required class="form-select">
                            <option value="">Select Project</option>
                            <!-- Projects will be populated here -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="trackDifficulty" class="form-label">Difficulty Level</label>
                        <select id="trackDifficulty" name="difficulty_level" class="form-select">
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="trackDuration" class="form-label">Duration (weeks)</label>
                        <input type="number" id="trackDuration" name="duration_weeks" min="1" max="52"
                               placeholder="e.g., 8" class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="trackMaxStudents" class="form-label">Max Students</label>
                        <input type="number" id="trackMaxStudents" name="max_students" min="1" max="1000"
                               placeholder="e.g., 30" class="form-input">
                    </div>

                    <div class="form-group form-group--full">
                        <label for="trackAudience" class="form-label">Target Audience (comma-separated)</label>
                        <input type="text" id="trackAudience" name="target_audience"
                               placeholder="e.g., Beginners, Students, Professionals" class="form-input">
                        <small>Enter audience types separated by commas</small>
                    </div>

                    <div class="form-group form-group--full">
                        <label for="trackPrerequisites" class="form-label">Prerequisites (comma-separated)</label>
                        <input type="text" id="trackPrerequisites" name="prerequisites"
                               placeholder="e.g., Basic programming, Computer literacy" class="form-input">
                        <small>Enter prerequisites separated by commas</small>
                    </div>

                    <div class="form-group form-group--full">
                        <label for="trackObjectives" class="form-label">Learning Objectives (comma-separated)</label>
                        <textarea id="trackObjectives" name="learning_objectives" rows="3"
                                  placeholder="e.g., Understand Python syntax, Build simple applications, Debug code" class="form-input"></textarea>
                        <small>Enter learning objectives separated by commas</small>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeModal('trackModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="trackSubmitBtn">Create Track</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Track Creation Modal (Advanced) -->
    <div id="customTrackModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="customTrackModalTitle">
        <div class="modal-content modal-content--lg modal-content--full-height">
            <span class="close" onclick="closeModal('customTrackModal')">&times;</span>
            <h2 id="customTrackModalTitle">Create Custom Track</h2>
            <p class="subtitle-text">
                Advanced track creation with custom options, scheduling, and automation
            </p>

            <form id="customTrackForm" onsubmit="submitCustomTrack(event)">
                <!-- Basic Information Section -->
                <fieldset class="fieldset-bordered">
                    <legend class="fieldset-legend">Basic Information</legend>

                    <div class="grid-2-cols">
                        <div class="form-group form-group--full">
                            <label for="customTrackName" class="form-label required">Track Name</label>
                            <input type="text" id="customTrackName" name="name" required maxlength="200"
                                   placeholder="e.g., Advanced Python Development" class="form-input">
                        </div>

                        <div class="form-group form-group--full">
                            <label for="customTrackDescription" class="form-label">Description</label>
                            <textarea id="customTrackDescription" name="description" rows="4" maxlength="1000"
                                      placeholder="Describe the track objectives, content, and expected outcomes..." class="form-input"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="customTrackProject" class="form-label required">Project</label>
                            <select id="customTrackProject" name="project_id" required class="form-select">
                                <option value="">Select Project</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="customTrackCategory" class="form-label">Category</label>
                            <select id="customTrackCategory" name="category" class="form-select">
                                <option value="">Select Category</option>
                                <option value="software-development">Software Development</option>
                                <option value="data-science">Data Science</option>
                                <option value="devops">DevOps & Cloud</option>
                                <option value="business-analysis">Business Analysis</option>
                                <option value="project-management">Project Management</option>
                                <option value="design">Design & UX</option>
                                <option value="security">Security & Compliance</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="customTrackDifficulty" class="form-label">Difficulty Level</label>
                            <select id="customTrackDifficulty" name="difficulty_level" class="form-select">
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                                <option value="expert">Expert</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="customTrackTags" class="form-label">Tags (comma-separated)</label>
                            <input type="text" id="customTrackTags" name="tags"
                                   placeholder="e.g., python, web, api, rest" class="form-input">
                            <small>Add searchable keywords</small>
                        </div>
                    </div>
                </fieldset>

                <!-- Schedule & Duration Section -->
                <fieldset class="fieldset-bordered">
                    <legend class="fieldset-legend">Schedule & Duration</legend>

                    <div class="grid-2-cols">
                        <div class="form-group">
                            <label for="customTrackDuration" class="form-label">Duration (weeks)</label>
                            <input type="number" id="customTrackDuration" name="duration_weeks" min="1" max="52"
                                   placeholder="e.g., 12" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="customTrackHoursPerWeek" class="form-label">Hours Per Week</label>
                            <input type="number" id="customTrackHoursPerWeek" name="hours_per_week" min="1" max="40"
                                   placeholder="e.g., 10" class="form-input">
                            <small>Expected time commitment</small>
                        </div>

                        <div class="form-group">
                            <label for="customTrackStartDate" class="form-label">Start Date</label>
                            <input type="date" id="customTrackStartDate" name="start_date" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="customTrackEndDate" class="form-label">End Date</label>
                            <input type="date" id="customTrackEndDate" name="end_date" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="customTrackSelfPaced" class="form-label">Self-Paced</label>
                            <select id="customTrackSelfPaced" name="self_paced" class="form-select">
                                <option value="false">No - Instructor-Led</option>
                                <option value="true">Yes - Self-Paced</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="customTrackStatus" class="form-label">Initial Status</label>
                            <select id="customTrackStatus" name="status" class="form-select">
                                <option value="draft">Draft</option>
                                <option value="active">Active</option>
                                <option value="scheduled">Scheduled</option>
                            </select>
                        </div>
                    </div>
                </fieldset>

                <!-- Enrollment & Capacity Section -->
                <fieldset class="fieldset-bordered">
                    <legend class="fieldset-legend">Enrollment & Capacity</legend>

                    <div class="grid-2-cols">
                        <div class="form-group">
                            <label for="customTrackMaxStudents" class="form-label">Max Students</label>
                            <input type="number" id="customTrackMaxStudents" name="max_students" min="1" max="1000"
                                   placeholder="e.g., 30" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="customTrackMinStudents" class="form-label">Min Students</label>
                            <input type="number" id="customTrackMinStudents" name="min_students" min="1" max="100"
                                   placeholder="e.g., 5" class="form-input">
                            <small>Minimum to run track</small>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackAutoEnroll" name="auto_enroll">
                                Enable Auto-Enrollment
                            </label>
                            <small>Automatically enroll matching users</small>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackWaitlist" name="waitlist_enabled">
                                Enable Waitlist
                            </label>
                            <small>When track reaches capacity</small>
                        </div>
                    </div>
                </fieldset>

                <!-- Learning Objectives & Prerequisites Section -->
                <fieldset class="fieldset-bordered">
                    <legend class="fieldset-legend">Learning Objectives & Prerequisites</legend>

                    <div class="grid grid-gap-1">
                        <div class="form-group">
                            <label for="customTrackAudience" class="form-label">Target Audience (comma-separated)</label>
                            <input type="text" id="customTrackAudience" name="target_audience"
                                   placeholder="e.g., Software Engineers, Data Analysts, Technical Leads" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="customTrackPrerequisites" class="form-label">Prerequisites (comma-separated)</label>
                            <textarea id="customTrackPrerequisites" name="prerequisites" rows="2"
                                      placeholder="e.g., Python basics, Command line proficiency, Git fundamentals" class="form-input"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="customTrackObjectives" class="form-label">Learning Objectives (comma-separated)</label>
                            <textarea id="customTrackObjectives" name="learning_objectives" rows="3"
                                      placeholder="e.g., Build RESTful APIs, Implement authentication, Deploy applications" class="form-input"></textarea>
                        </div>
                    </div>
                </fieldset>

                <!-- Assessment & Certification Section -->
                <fieldset class="fieldset-bordered">
                    <legend class="fieldset-legend">Assessment & Certification</legend>

                    <div class="grid-2-cols">
                        <div class="form-group">
                            <label for="customTrackPassingScore" class="form-label">Passing Score (%)</label>
                            <input type="number" id="customTrackPassingScore" name="passing_score"
                                   min="0" max="100" value="70" placeholder="e.g., 70" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="customTrackRequiredQuizzes" class="form-label">Required Quizzes</label>
                            <input type="number" id="customTrackRequiredQuizzes" name="required_quizzes"
                                   min="0" max="50" placeholder="e.g., 5" class="form-input">
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackCertificate" name="certificate_enabled" checked>
                                Issue Certificate
                            </label>
                            <small>Upon successful completion</small>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackFinalProject" name="final_project_required">
                                Require Final Project
                            </label>
                        </div>
                    </div>
                </fieldset>

                <!-- Advanced Options Section -->
                <fieldset class="fieldset-bordered">
                    <legend class="fieldset-legend">Advanced Options</legend>

                    <div class="grid-1-col-gap-1">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackAIAssistant" name="ai_assistant_enabled" checked>
                                Enable AI Learning Assistant
                            </label>
                            <small>Provide personalized AI support</small>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackPeerReview" name="peer_review_enabled">
                                Enable Peer Review
                            </label>
                            <small>Students review each other's work</small>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackDiscussionForum" name="discussion_forum_enabled" checked>
                                Enable Discussion Forum
                            </label>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customTrackProgressTracking" name="progress_tracking_enabled" checked>
                                Enable Progress Tracking
                            </label>
                            <small>Track student progress metrics</small>
                        </div>

                        <div class="form-group">
                            <label for="customTrackNotificationFrequency" class="form-label">Notification Frequency</label>
                            <select id="customTrackNotificationFrequency" name="notification_frequency" class="form-select">
                                <option value="none">None</option>
                                <option value="daily">Daily</option>
                                <option value="weekly" selected>Weekly</option>
                                <option value="milestone">Milestone-Based</option>
                            </select>
                        </div>
                    </div>
                </fieldset>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeModal('customTrackModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Custom Track</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Track Details Modal -->
    <div id="trackDetailsModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="trackDetailsModalTitle">
        <div class="modal-content modal-content--lg">
            <span class="close" onclick="closeModal('trackDetailsModal')">&times;</span>
            <h2 id="trackDetailsTitle">Track Details</h2>

            <div id="trackDetailsContent">
                <!-- Track details will be loaded here -->
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeModal('trackDetailsModal')">Close</button>
                <button type="button" class="btn btn-primary" onclick="editTrackFromDetails()">Edit Track</button>
            </div>
        </div>
    </div>

    <!-- Delete Track Confirmation Modal -->
    <div id="deleteTrackModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="deleteTrackModalTitle">
        <div class="modal-content" class="modal-w-500">
            <span class="close" onclick="closeModal('deleteTrackModal')">&times;</span>
            <h2>Delete Track</h2>

            <p>Are you sure you want to delete this track?</p>
            <p id="deleteTrackWarning" class="text-error-bold"></p>

            <input type="hidden" id="deleteTrackId">

            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeModal('deleteTrackModal')">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmDeleteTrack()">Delete Track</button>
            </div>
        </div>
    </div>

    <!-- Generate Course Modal -->
    <div id="generateCourseModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="generateCourseModalTitle">
        <div class="modal-content" class="modal-w-700">
            <span class="close" onclick="closeModal('generateCourseModal')">&times;</span>
            <h2 id="generateCourseModalTitle">Generate Course with AI</h2>

            <form id="generateCourseForm">
                <div class="form-group">
                    <label for="generateCourseTitle" class="form-label required">Course Title</label>
                    <input type="text" id="generateCourseTitle" name="title" required maxlength="200"
                           placeholder="e.g., Introduction to Python Programming" class="form-input">
                </div>

                <div class="form-group">
                    <label for="generateCourseDescription" class="form-label required">Course Description</label>
                    <textarea id="generateCourseDescription" name="description" required rows="4"
                              placeholder="A comprehensive course for beginners learning Python programming..." class="form-input"></textarea>
                    <small class="form-help">This description will be used by AI to generate course content</small>
                </div>

                <div class="grid-2-cols">
                    <div class="form-group">
                        <label for="generateCourseCategory" class="form-label required">Category</label>
                        <select id="generateCourseCategory" name="category" required class="form-select">
                            <option value="">Select Category</option>
                            <option value="Programming">Programming</option>
                            <option value="Data Science">Data Science</option>
                            <option value="Web Development">Web Development</option>
                            <option value="DevOps">DevOps</option>
                            <option value="Cloud Computing">Cloud Computing</option>
                            <option value="Cybersecurity">Cybersecurity</option>
                            <option value="Database">Database</option>
                            <option value="AI/ML">AI/ML</option>
                            <option value="Mobile Development">Mobile Development</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="generateCourseDifficulty" class="form-label required">Difficulty Level</label>
                        <select id="generateCourseDifficulty" name="difficulty" required class="form-select">
                            <option value="">Select Difficulty</option>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="generateCourseDuration" class="form-label">Estimated Duration (hours)</label>
                    <input type="number" id="generateCourseDuration" name="duration" min="1" max="500"
                           placeholder="e.g., 40" class="form-input">
                </div>

                <!-- Success message -->
                <div class="generation-success" id="generateCourseSuccess" class="success-banner">
                    Course generated successfully!
                </div>

                <div class="flex-end mt-2rem">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('generateCourseModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitGenerateCourse">
                        🚀 Generate Course
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Course Details/Edit Modal -->
    <div id="courseDetailsModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="courseDetailsModalTitle">
        <div class="modal-content modal-content--lg">
            <span class="close close-modal" onclick="closeModal('courseDetailsModal')">&times;</span>
            <h2 id="courseDetailsModalTitle">Course Details</h2>

            <div id="courseDetailsContent">
                <!-- Course details will be populated here -->
                <div id="courseSyllabusContent">
                    <!-- Syllabus content -->
                </div>
            </div>

            <div class="flex-end mt-2rem">
                <button type="button" class="btn btn-secondary" onclick="closeModal('courseDetailsModal')">Close</button>
                <button type="button" class="btn btn-primary" id="editSyllabusBtn" onclick="showEditSyllabusModal()">
                    ✏️ Edit Syllabus
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Syllabus Modal -->
    <div id="editSyllabusModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="editSyllabusModalTitle">
        <div class="modal-content modal-content--lg">
            <span class="close close-modal" onclick="closeModal('editSyllabusModal')">&times;</span>
            <h2 id="editSyllabusModalTitle">Edit Course Syllabus</h2>

            <form id="editSyllabusForm">
                <div class="form-group">
                    <label for="editSyllabusTitle" class="form-label required">Course Title</label>
                    <input type="text" id="editSyllabusTitle" name="title" required maxlength="200" class="form-input">
                </div>

                <div class="form-group">
                    <label for="editSyllabusDescription" class="form-label">Description</label>
                    <textarea id="editSyllabusDescription" name="description" rows="3" class="form-input"></textarea>
                </div>

                <h3 class="mt-2rem mb-lg">Course Modules</h3>
                <div id="editModulesList">
                    <!-- Module editing fields will be populated here -->
                    <div class="form-group course-module">
                        <label for="editModule1Title" class="form-label">Module 1 Title</label>
                        <input type="text" id="editModule1Title" name="module_1_title" maxlength="200"
                               placeholder="Module 1 Title" class="form-input">
                    </div>
                </div>

                <div class="generation-success" id="saveSyllabusSuccess" class="success-banner">
                    Syllabus updated successfully
                </div>

                <div class="flex-end mt-2rem">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editSyllabusModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="saveSyllabusEditsBtn">
                        💾 Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Floating Action Button (FAB) -->
    <button class="fab" id="fabButton" onclick="toggleFabMenu()" title="Quick Actions">
        <i class="fas fa-plus" id="fabIcon"></i>
    </button>

    <!-- FAB Menu -->
    <div class="fab-menu" id="fabMenu">
        <div class="fab-menu-item" onclick="fabAction('project')">
            <i class="fas fa-project-diagram"></i>
            <span>New Project</span>
        </div>
        <div class="fab-menu-item" onclick="fabAction('instructor')">
            <i class="fas fa-chalkboard-teacher"></i>
            <span>Add Instructor</span>
        </div>
        <div class="fab-menu-item" onclick="fabAction('student')">
            <i class="fas fa-user-plus"></i>
            <span>Add Student</span>
        </div>
        <div class="fab-menu-item" onclick="fabAction('track')">
            <i class="fas fa-road"></i>
            <span>New Track</span>
        </div>
        <div class="fab-menu-item" onclick="fabAction('settings')">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </div>
    </div>

    <script src="../js/config-global.js"></script>
    <script type="module">
        // Import Auth module and initialize it for dashboard
        import { Auth } from '../js/modules/auth.js';
        import { showNotification } from '../js/modules/notifications.js';

        // Make Auth available globally for the dashboard script
        window.Auth = Auth;
        window.showNotification = showNotification;

        console.log('✅ Auth module loaded and made global');
        console.log('🔍 Auth object:', window.Auth);
        console.log('🔍 Has startSessionMonitoring?', typeof window.Auth?.startSessionMonitoring);
        console.log('🔍 Has activityTracker?', typeof window.Auth?.activityTracker);

        // Start session monitoring immediately since Auth is already initialized
        if (window.Auth) {
            console.log('🔐 Starting session monitoring from dashboard HTML...');
            try {
                window.Auth.startSessionMonitoring();
                window.Auth.activityTracker.start();
                console.log('✅ Session monitoring started successfully');
            } catch (error) {
                console.error('❌ Error starting session monitoring:', error);
            }
        }
    </script>
    <!-- File Explorer Initialization -->
    <script type="module">
        // Initialize file explorer when Files tab is loaded
        import { initOrgAdminFileExplorer } from '../js/modules/org-admin-file-manager.js';

        // Track if file explorer has been initialized
        let fileExplorerInitialized = false;

        // Listen for tab changes
        document.addEventListener('click', (e) => {
            const tabLink = e.target.closest('[data-tab="files"]');
            if (tabLink && !fileExplorerInitialized) {
                // Get organization ID from URL
                const urlParams = new URLSearchParams(window.location.search);
                const orgId = urlParams.get('org_id') || 1;

                // Initialize file explorer
                setTimeout(() => {
                    const fileExplorer = initOrgAdminFileExplorer('orgFileExplorerContainer', orgId);
                    if (fileExplorer) {
                        fileExplorerInitialized = true;
                        console.log('✅ File explorer initialized for org admin');
                    }
                }, 100);
            }
        });
    </script>

    <!-- Floating AI Assistant for Main Dashboard -->
    <div id="dashboardAIChatPanel" class="ai-assistant-panel ai-panel-fixed">
        <!-- Draggable header -->
        <div class="ai-assistant-header ai-panel-header">
            <h4 class="ai-panel-title">💬 AI Assistant</h4>
            <button type="button" onclick="toggleDashboardAIChat()" class="ai-panel-close-btn">&times;</button>
        </div>

        <!-- Chat content -->
        <div class="ai-panel-content-wrapper">
            <p class="ai-panel-intro-text">
                Ask me anything about managing your organization, creating projects, or platform features.
            </p>

            <!-- Messages container -->
            <div id="dashboardAIChatMessages" class="ai-panel-messages-container">
                <div class="ai-message">
                    <strong class="ai-message-author">🤖 AI Assistant:</strong>
                    <p class="ai-message-text">
                        Hi! I'm here to help you manage your organization. You can ask me to:
                        <br>• Create new projects or tracks
                        <br>• Add instructors or students
                        <br>• Get analytics and reports
                        <br>• Find specific features
                    </p>
                </div>
            </div>

            <!-- Input area -->
            <div class="chat-input-container">
                <textarea id="dashboardAIChatInput" placeholder="Ask AI for help..." class="chat-textarea form-input" onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendDashboardAIChatMessage(); }"></textarea>
                <button type="button" onclick="sendDashboardAIChatMessage()" class="btn btn-primary" class="chat-send-button whitespace-nowrap">📤</button>
            </div>
        </div>
    </div>

    <!-- Floating AI Assistant Button -->
    <button id="aiAssistantButton" onclick="toggleDashboardAIChat()" class="ai-assistant-fab" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
        💬
    </button>

    <script>
        // Toggle dashboard AI chat panel
        function toggleDashboardAIChat() {
            const panel = document.getElementById('dashboardAIChatPanel');
            const button = document.getElementById('aiAssistantButton');

            if (panel.style.display === 'none' || !panel.style.display) {
                panel.style.display = 'flex';
                button.style.display = 'none';
                makeDraggable(panel, panel.querySelector('.ai-assistant-header'));
            } else {
                panel.style.display = 'none';
                button.style.display = 'block';
            }
        }

        // Toggle modal AI chat (inside project creation modal)
        function toggleModalAIChat() {
            const panel = document.getElementById('modalAIChatPanel');
            if (panel) {
                panel.style.display = panel.style.display === 'none' ? 'flex' : 'none';
            }
        }

        // Send dashboard AI chat message
        async function sendDashboardAIChatMessage() {
            const input = document.getElementById('dashboardAIChatInput');
            const messagesContainer = document.getElementById('dashboardAIChatMessages');

            if (!input || !messagesContainer) return;

            const userMessage = input.value.trim();
            if (!userMessage) return;

            // Add user message
            const userDiv = document.createElement('div');
            userDiv.innerHTML = `
                <div class="user-message-wrapper">
                    <strong class="user-message-sender">You:</strong>
                    <p class="user-message-bubble">
                        ${escapeHtml(userMessage)}
                    </p>
                </div>
            `;
            messagesContainer.appendChild(userDiv);
            input.value = '';
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Show typing indicator
            const typingDiv = document.createElement('div');
            typingDiv.className = 'ai-typing';
            typingDiv.innerHTML = '<em class="ai-typing">🤖 AI is thinking...</em>';
            messagesContainer.appendChild(typingDiv);

            try {
                // Call AI assistant (use existing AI module)
                if (window.OrgAdmin && window.OrgAdmin.AI && window.OrgAdmin.AI.sendMessage) {
                    const response = await window.OrgAdmin.AI.sendMessage(userMessage);
                    typingDiv.remove();

                    const aiDiv = document.createElement('div');
                    aiDiv.innerHTML = `
                        <div class="mb-lg">
                            <strong class="ai-message-author">🤖 AI Assistant:</strong>
                            <p class="ai-message-text">
                                ${escapeHtml(response.message || 'I can help you with that. What would you like to know?')}
                            </p>
                        </div>
                    `;
                    messagesContainer.appendChild(aiDiv);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            } catch (error) {
                typingDiv.remove();
                console.error('AI chat error:', error);
            }
        }

        // Send modal AI chat message
        async function sendModalAIChatMessage() {
            const input = document.getElementById('modalAIChatInput');
            const messagesContainer = document.getElementById('modalAIChatMessages');

            if (!input || !messagesContainer) return;

            const userMessage = input.value.trim();
            if (!userMessage) return;

            // Use the existing sendAIChatMessage from org-admin-projects.js
            if (window.OrgAdmin && window.OrgAdmin.Projects && window.OrgAdmin.Projects.sendAIChatMessage) {
                // Set the input values for the existing function
                document.getElementById('aiChatInput').value = userMessage;
                await window.OrgAdmin.Projects.sendAIChatMessage();
                input.value = '';
            }
        }

        // Make element draggable
        function makeDraggable(element, handle) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            let isDragging = false;
            let isInitialized = false;

            handle.onmousedown = dragMouseDown;
            handle.style.cursor = 'move';

            function dragMouseDown(e) {
                // Don't drag if clicking on interactive elements
                const target = e.target;
                const interactiveTags = ['INPUT', 'BUTTON', 'SELECT', 'TEXTAREA', 'A'];
                if (interactiveTags.includes(target.tagName) || target.closest('button, input, select, textarea, a')) {
                    return;
                }

                e.preventDefault();
                e.stopPropagation();  // Prevent event from bubbling to backdrop

                // On first drag, remove CSS centering transform and convert to positioned element
                if (!isInitialized) {
                    const rect = element.getBoundingClientRect();
                    // Use setProperty with 'important' to override CSS !important rules
                    element.style.setProperty('transform', 'none', 'important');
                    element.style.setProperty('top', rect.top + 'px', 'important');
                    element.style.setProperty('left', rect.left + 'px', 'important');
                    isInitialized = true;
                }

                pos3 = e.clientX;
                pos4 = e.clientY;
                isDragging = true;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;

                // Add dragging cursor to body
                document.body.style.cursor = 'move';
            }

            function elementDrag(e) {
                if (!isDragging) return;
                e.preventDefault();
                e.stopPropagation();

                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;

                // Use setProperty with 'important' to ensure positioning works
                element.style.setProperty('top', (element.offsetTop - pos2) + 'px', 'important');
                element.style.setProperty('left', (element.offsetLeft - pos1) + 'px', 'important');
            }

            function closeDragElement() {
                isDragging = false;
                document.onmouseup = null;
                document.onmousemove = null;

                // Restore default cursor
                document.body.style.cursor = '';
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Toggle upload help section
        function toggleUploadHelp() {
            const helpSection = document.getElementById('uploadHelp');
            if (helpSection) {
                helpSection.style.display = helpSection.style.display === 'none' ? 'block' : 'none';
            }
        }

        /**
         * Handle project type selection change
         * Updates UI to show/hide cohort information and sets has_sub_projects flag
         *
         * @param {string} value - The selected project type ('single_location' or 'multi_location')
         */
        function handleProjectTypeChange(value) {
            const hasSubProjectsInput = document.getElementById('hasSubProjects');
            const cohortInfoNote = document.getElementById('cohortInfoNote');

            if (value === 'multi_location') {
                // Multi-location project selected
                if (hasSubProjectsInput) {
                    hasSubProjectsInput.value = 'true';
                }
                if (cohortInfoNote) {
                    cohortInfoNote.style.display = 'block';
                }
            } else {
                // Single location project selected
                if (hasSubProjectsInput) {
                    hasSubProjectsInput.value = 'false';
                }
                if (cohortInfoNote) {
                    cohortInfoNote.style.display = 'none';
                }
            }
        }

        // ==============================================================================
        // COHORT CREATION WIZARD FUNCTIONS
        // ==============================================================================

        let currentCohortStep = 1;
        const cohortFormData = {};

        // Wave 5: Cohort wizard refactored - functions now in cohort-wizard.js module
        // Access via window.CohortWizard.nextStep(), window.CohortWizard.previousStep(), etc.
        
        // Initialize wizard when DOM ready
        document.addEventListener('DOMContentLoaded', async () => {
            if (typeof window.CohortWizard !== 'undefined') {
                await window.CohortWizard.initialize();
            }
        });

        // Wrapper functions for onclick handlers (delegate to module)
        function nextCohortStep() {
            if (window.CohortWizard) window.CohortWizard.nextStep();
        }
        
        function previousCohortStep() {
            if (window.CohortWizard) window.CohortWizard.previousStep();
        }
        
        function resetCohortWizard() {
            if (window.CohortWizard) window.CohortWizard.reset();
        }
        
        function submitCohortCreation() {
            if (window.CohortWizard) window.CohortWizard.submit();
        }
        // ==============================================================================
        // PROJECT DETAIL VIEW FUNCTIONS
        // ==============================================================================

        let currentCohorts = [];
        let selectedCohortIds = [];

        /**
         * Open project detail view modal
         * @param {string} projectId - The project ID to view
         */
        async function openProjectDetail(projectId) {
            // Store globally for cohort creation
            window.currentProjectId = projectId;

            const modal = document.getElementById('projectDetailView');
            modal.style.display = 'flex';

            try {
                const organizationId = localStorage.getItem('organization_id');
                const token = localStorage.getItem('token');

                // Fetch project details
                const response = await fetch(
                    `https://localhost:8004/api/v1/organizations/${organizationId}/projects/${projectId}`,
                    {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );

                if (!response.ok) {
                    throw new Error('Failed to load project details');
                }

                const project = await response.json();

                // Update modal title
                document.getElementById('projectDetailTitle').textContent = `📁 ${project.name}`;

                // Populate overview tab
                populateProjectOverview(project);

                // Load cohorts if project has sub-projects
                if (project.has_sub_projects) {
                    await loadProjectCohorts(projectId);
                }

            } catch (error) {
                console.error('Error loading project details:', error);
                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification(
                        `Failed to load project: ${error.message}`,
                        'error'
                    );
                }
            }
        }

        /**
         * Close project detail view modal
         */
        function closeProjectDetail() {
            const modal = document.getElementById('projectDetailView');
            modal.style.display = 'none';
            window.currentProjectId = null;
            currentCohorts = [];
            selectedCohortIds = [];
        }

        /**
         * Switch between project detail tabs
         * @param {string} tabName - The tab to switch to (overview, cohorts, analytics)
         */
        function switchProjectDetailTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('#projectDetailView .tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.borderBottomColor = 'transparent';
            });
            const activeBtn = document.querySelector(`#projectDetailView .tab-btn[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.style.borderBottomColor = 'var(--primary-color)';
            }

            // Update tab content
            document.querySelectorAll('.project-detail-tab').forEach(tab => {
                tab.style.display = 'none';
            });

            if (tabName === 'overview') {
                document.getElementById('projectDetailOverview').style.display = 'block';
            } else if (tabName === 'cohorts') {
                document.getElementById('cohortsTabContent').style.display = 'block';
            } else if (tabName === 'analytics') {
                document.getElementById('projectDetailAnalytics').style.display = 'block';
            }
        }

        /**
         * Populate project overview tab
         * @param {object} project - Project data
         */
        function populateProjectOverview(project) {
            const content = document.getElementById('projectOverviewContent');
            content.innerHTML = `
                <div class="grid grid-gap-1-5">
                    <div class="card-hover-bg">
                        <h3>Project Information</h3>
                        <p><strong>Name:</strong> ${project.name}</p>
                        <p><strong>Slug:</strong> ${project.slug}</p>
                        <p><strong>Description:</strong> ${project.description || 'No description'}</p>
                        <p><strong>Status:</strong> <span class="badge-status">${project.status}</span></p>
                        <p><strong>Multi-Location:</strong> ${project.has_sub_projects ? '✅ Yes (Cohorts enabled)' : '❌ No'}</p>
                    </div>
                    <div class="card-hover-bg">
                        <h3>Schedule</h3>
                        <p><strong>Start Date:</strong> ${project.start_date || 'Not set'}</p>
                        <p><strong>End Date:</strong> ${project.end_date || 'Not set'}</p>
                        <p><strong>Duration:</strong> ${project.duration_weeks ? `${project.duration_weeks} weeks` : 'Not calculated'}</p>
                    </div>
                </div>
            `;
        }

        /**
         * Load and display project cohorts
         * @param {string} projectId - The project ID
         */
        async function loadProjectCohorts(projectId) {
            try {
                const organizationId = localStorage.getItem('organization_id');
                const token = localStorage.getItem('token');

                // Build query params from filters
                const params = new URLSearchParams();
                const country = document.getElementById('cohortCountryFilter').value;
                const region = document.getElementById('cohortRegionFilter').value;
                const city = document.getElementById('cohortCityFilter').value;
                const status = document.getElementById('cohortStatusFilter').value;
                const dateFrom = document.getElementById('cohortDateFromFilter').value;
                const dateTo = document.getElementById('cohortDateToFilter').value;

                if (country) params.append('location_country', country);
                if (region) params.append('location_region', region);
                if (city) params.append('location_city', city);
                if (status) params.append('status', status);
                if (dateFrom) params.append('start_date_from', dateFrom);
                if (dateTo) params.append('start_date_to', dateTo);

                // Fetch cohorts
                const response = await fetch(
                    `https://localhost:8004/api/v1/organizations/${organizationId}/projects/${projectId}/sub-projects?${params}`,
                    {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );

                if (!response.ok) {
                    throw new Error('Failed to load cohorts');
                }

                const cohorts = await response.json();
                currentCohorts = Array.isArray(cohorts) ? cohorts : [];

                // Display cohorts
                displayCohortsList(currentCohorts);

            } catch (error) {
                console.error('Error loading cohorts:', error);
                document.getElementById('cohortsList').innerHTML = `
                    <div class="error-message-block">
                        <p>Failed to load cohorts: ${error.message}</p>
                    </div>
                `;
            }
        }

        /**
         * Display cohorts in list view
         * @param {array} cohorts - Array of cohort objects
         */
        function displayCohortsList(cohorts) {
            const cohortsList = document.getElementById('cohortsList');
            const emptyState = document.getElementById('cohortsEmptyState');

            if (!cohorts || cohorts.length === 0) {
                cohortsList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';

            cohortsList.innerHTML = cohorts.map(cohort => {
                const location = [cohort.location_city, cohort.location_region, cohort.location_country]
                    .filter(Boolean)
                    .join(', ');

                const capacity = cohort.max_participants
                    ? `${cohort.current_participants || 0}/${cohort.max_participants}`
                    : 'Unlimited';

                const statusColors = {
                    'draft': '#6c757d',
                    'active': '#28a745',
                    'completed': '#007bff',
                    'cancelled': '#dc3545',
                    'archived': '#6c757d'
                };

                return `
                    <div class="cohort-item card-cohort-item">
                        <div class="flex-between-start">
                            <div class="flex-1">
                                <div class="flex-center-gap-1">
                                    <input type="checkbox" class="cohort-checkbox w-18 h-18" data-cohort-id="${cohort.id}" onchange="toggleCohortSelection('${cohort.id}')">
                                    <h3 class="h3-no-margin">${cohort.name}</h3>
                                    <span class="badge-status-dynamic" style="background: ${statusColors[cohort.status] || '#6c757d'};">
                                        ${cohort.status}
                                    </span>
                                </div>
                                <p class="text-muted text-my-xs text-xs">${cohort.description || 'No description'}</p>
                                <div class="grid-auto-fit-200">
                                    <div>
                                        <strong class="cohort-location">📍 Location:</strong><br>
                                        <span>${location}</span>
                                    </div>
                                    <div>
                                        <strong>📅 Schedule:</strong><br>
                                        <span class="cohort-start-date">${cohort.start_date || 'TBD'}</span> - ${cohort.end_date || 'TBD'}
                                        ${cohort.duration_weeks ? `<span class="text-muted text-xs">(${cohort.duration_weeks} weeks)</span>` : ''}
                                    </div>
                                    <div>
                                        <strong class="cohort-capacity">👥 Capacity:</strong><br>
                                        <span>${capacity}</span>
                                    </div>
                                    <div>
                                        <strong>🌐 Timezone:</strong><br>
                                        <span>${cohort.timezone || 'UTC'}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-gap-0-5">
                                <button class="btn btn-secondary btn-padding-sm" onclick="editCohort('${cohort.id}')">✏️ Edit</button>
                                <button class="btn btn-secondary btn-padding-sm" onclick="viewCohortDetails('${cohort.id}')">👁️ View</button>
                                <button class="btn btn-secondary btn-padding-sm btn-danger" onclick="deleteCohort('${cohort.id}', '${cohort.name}')">🗑️</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * Apply cohort filters
         */
        function applyCohortFilters() {
            if (window.currentProjectId) {
                loadProjectCohorts(window.currentProjectId);
            }
        }

        /**
         * Clear all cohort filters
         */
        function clearCohortFilters() {
            document.getElementById('cohortCountryFilter').value = '';
            document.getElementById('cohortRegionFilter').value = '';
            document.getElementById('cohortCityFilter').value = '';
            document.getElementById('cohortStatusFilter').value = '';
            document.getElementById('cohortDateFromFilter').value = '';
            document.getElementById('cohortDateToFilter').value = '';

            applyCohortFilters();
        }

        /**
         * Show cohort list view
         */
        function showCohortListView() {
            document.getElementById('cohortListViewContainer').style.display = 'block';
            document.getElementById('cohortTimelineContainer').style.display = 'none';

            document.getElementById('cohortListViewBtn').classList.add('active');
            document.getElementById('cohortTimelineViewBtn').classList.remove('active');
        }

        /**
         * Show cohort timeline view
         */
        function showCohortTimelineView() {
            document.getElementById('cohortListViewContainer').style.display = 'none';
            document.getElementById('cohortTimelineContainer').style.display = 'block';

            document.getElementById('cohortListViewBtn').classList.remove('active');
            document.getElementById('cohortTimelineViewBtn').classList.add('active');

            // Render timeline
            renderCohortTimeline(currentCohorts);
        }

        /**
         * Render cohort timeline visualization
         * @param {array} cohorts - Array of cohort objects
         */
        function renderCohortTimeline(cohorts) {
            const timelineContent = document.getElementById('timelineContent');

            if (!cohorts || cohorts.length === 0) {
                timelineContent.innerHTML = '<p class="timeline-empty-message text-center">No cohorts to display on timeline.</p>';
                return;
            }

            // Simple timeline visualization (can be enhanced with a library like vis.js)
            const html = cohorts.map(cohort => {
                const width = cohort.duration_weeks ? `${Math.min(cohort.duration_weeks * 10, 300)}px` : '100px';
                return `
                    <div class="timeline-bar card-timeline-bar">
                        <div class="timeline-label">${cohort.name}</div>
                        <div class="flex-gap-2">
                            <span class="timeline-start"><strong>Start:</strong> ${cohort.start_date || 'TBD'}</span>
                            <div class="flex-1 timeline-progress-bar h-8" style="max-width: ${width};"></div>
                            <span class="timeline-end"><strong>End:</strong> ${cohort.end_date || 'TBD'}</span>
                        </div>
                        <div class="text-muted text-xs mt-0-5">
                            📍 ${[cohort.location_city, cohort.location_country].filter(Boolean).join(', ')}
                        </div>
                    </div>
                `;
            }).join('');

            timelineContent.innerHTML = html;
        }

        /**
         * Open create cohort modal
         */
        function openCreateCohortModal() {
            // Close project detail view
            closeProjectDetail();

            // Open cohort creation modal
            const modal = document.getElementById('createCohortModal');
            modal.style.display = 'flex';
        }

        /**
         * Toggle cohort selection for comparison
         * @param {string} cohortId - The cohort ID
         */
        function toggleCohortSelection(cohortId) {
            const checkbox = document.querySelector(`.cohort-checkbox[data-cohort-id="${cohortId}"]`);

            if (checkbox.checked) {
                if (!selectedCohortIds.includes(cohortId)) {
                    selectedCohortIds.push(cohortId);
                }
            } else {
                selectedCohortIds = selectedCohortIds.filter(id => id !== cohortId);
            }

            updateCohortSelectionControls();
        }

        /**
         * Update comparison controls visibility
         */
        function updateCohortSelectionControls() {
            const controls = document.getElementById('cohortComparisonControls');
            const countSpan = document.getElementById('selectedCohortCount');

            if (selectedCohortIds.length > 0) {
                controls.style.display = 'block';
                countSpan.textContent = `${selectedCohortIds.length} cohort${selectedCohortIds.length > 1 ? 's' : ''} selected`;
            } else {
                controls.style.display = 'none';
            }
        }

        /**
         * Clear cohort selection
         */
        function clearCohortSelection() {
            selectedCohortIds = [];
            document.querySelectorAll('.cohort-checkbox').forEach(cb => cb.checked = false);
            updateCohortSelectionControls();
        }

        /**
         * Open cohort comparison modal
         */
        function openCohortComparison() {
            if (selectedCohortIds.length < 2) {
                alert('Please select at least 2 cohorts to compare.');
                return;
            }

            const selectedCohorts = currentCohorts.filter(c => selectedCohortIds.includes(c.id));

            const modal = document.getElementById('cohortComparisonModal');
            const table = document.getElementById('comparisonTable');

            // Build comparison table
            const metrics = [
                { label: 'Location', key: 'location', format: (c) => [c.location_city, c.location_region, c.location_country].filter(Boolean).join(', ') },
                { label: 'Start Date', key: 'start_date' },
                { label: 'End Date', key: 'end_date' },
                { label: 'Duration', key: 'duration_weeks', format: (c) => c.duration_weeks ? `${c.duration_weeks} weeks` : 'N/A' },
                { label: 'Capacity', key: 'max_participants', format: (c) => c.max_participants ? `${c.current_participants || 0}/${c.max_participants}` : 'Unlimited' },
                { label: 'Status', key: 'status' },
                { label: 'Timezone', key: 'timezone' }
            ];

            let html = '<thead><tr><th>Metric</th>';
            selectedCohorts.forEach(cohort => {
                html += `<th class="cohort-column-header">${cohort.name}</th>`;
            });
            html += '</tr></thead><tbody>';

            metrics.forEach(metric => {
                html += `<tr data-metric="${metric.key}"><td><strong>${metric.label}</strong></td>`;
                selectedCohorts.forEach(cohort => {
                    const value = metric.format ? metric.format(cohort) : (cohort[metric.key] || 'N/A');
                    html += `<td>${value}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody>';
            table.innerHTML = html;

            modal.style.display = 'flex';
        }

        /**
         * Edit cohort
         * @param {string} cohortId - The cohort ID
         */
        function editCohort(cohortId) {
            // TODO: Implement edit functionality
            alert(`Edit cohort ${cohortId} - Feature coming soon`);
        }

        /**
         * View cohort details
         * @param {string} cohortId - The cohort ID
         */
        function viewCohortDetails(cohortId) {
            // TODO: Implement view details
            const cohort = currentCohorts.find(c => c.id === cohortId);
            if (cohort) {
                alert(`Cohort Details:\n\nName: ${cohort.name}\nLocation: ${[cohort.location_city, cohort.location_country].filter(Boolean).join(', ')}\nStatus: ${cohort.status}`);
            }
        }

        /**
         * Delete cohort
         * @param {string} cohortId - The cohort ID
         * @param {string} cohortName - The cohort name
         */
        async function deleteCohort(cohortId, cohortName) {
            if (!confirm(`Are you sure you want to delete "${cohortName}"? This action cannot be undone.`)) {
                return;
            }

            try {
                const organizationId = localStorage.getItem('organization_id');
                const token = localStorage.getItem('token');

                const response = await fetch(
                    `https://localhost:8004/api/v1/organizations/${organizationId}/projects/${window.currentProjectId}/sub-projects/${cohortId}`,
                    {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );

                if (!response.ok) {
                    throw new Error('Failed to delete cohort');
                }

                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification(
                        `Cohort "${cohortName}" deleted successfully`,
                        'success'
                    );
                }

                // Reload cohorts
                await loadProjectCohorts(window.currentProjectId);

            } catch (error) {
                console.error('Error deleting cohort:', error);
                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification(
                        `Failed to delete cohort: ${error.message}`,
                        'error'
                    );
                }
            }
        }

        // Handle spreadsheet upload for project creation
        async function handleProjectSpreadsheetUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const fileNameSpan = document.getElementById('uploadedFileName');
            fileNameSpan.textContent = `Uploading ${file.name}...`;

            try {
                // Create FormData to send file
                const formData = new FormData();
                formData.append('file', file);

                // Send to backend for parsing
                const response = await fetch('https://localhost:8004/api/v1/projects/import-spreadsheet', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`Upload failed: ${response.statusText}`);
                }

                const data = await response.json();

                fileNameSpan.textContent = `✅ ${file.name} parsed successfully! AI is analyzing...`;
                fileNameSpan.style.color = '#28a745';

                // Store parsed data globally for AI assistant and project creation
                window.parsedProjectData = data;

                // Send to AI assistant for validation and analysis
                await sendProjectToAIForValidation(data, file.name);

            } catch (error) {
                console.error('Error uploading spreadsheet:', error);
                fileNameSpan.textContent = `❌ Error: ${error.message}`;
                fileNameSpan.style.color = '#dc3545';

                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification(`Failed to import spreadsheet: ${error.message}`, 'error');
                }
            }
        }

        // Send parsed project data to AI assistant for validation
        async function sendProjectToAIForValidation(projectData, filename) {
            const aiChatMessages = document.getElementById('aiChatMessages');
            if (!aiChatMessages) {
                console.error('AI chat messages container not found');
                return;
            }

            // Build validation prompt for AI
            const validationPrompt = `I've uploaded a project spreadsheet (${filename}) with the following data:

**Project Information:**
- Name: ${projectData.project_name}
- Slug: ${projectData.project_slug}
- Description: ${projectData.description}
- Start Date: ${projectData.start_date || 'Not specified'}
- End Date: ${projectData.end_date || 'Not specified'}

**Training Tracks:** ${projectData.tracks && projectData.tracks.length > 0 ? projectData.tracks.join(', ') : 'None specified'}

**Students:** ${projectData.students && projectData.students.length > 0 ? projectData.students.length + ' students' : 'None specified'}
${projectData.students && projectData.students.length > 0 ? projectData.students.map(s => `  - ${s.email}${s.name ? ' (' + s.name + ')' : ''}`).join('\\n') : ''}

**Instructors:** ${projectData.instructors && projectData.instructors.length > 0 ? projectData.instructors.length + ' instructors' : 'None specified'}
${projectData.instructors && projectData.instructors.length > 0 ? projectData.instructors.map(i => `  - ${i.email}${i.name ? ' (' + i.name + ')' : ''}`).join('\\n') : ''}

Please analyze this project data and:
1. Check for any errors, inconsistencies, or missing critical information
2. Validate email addresses format
3. Suggest improvements or optimizations
4. Recommend any additional tracks, students, or instructors that might be beneficial
5. Provide an overall assessment

If everything looks good and you approve, I'll proceed with automated project creation including all tracks, students, and instructors.`;

            // Add user message to chat
            const userMessage = document.createElement('div');
            userMessage.className = 'ai-message user-message';
            userMessage.innerHTML = `<div class="message-content">${escapeHtml(validationPrompt).replace(/\n/g, '<br>')}</div>`;
            aiChatMessages.appendChild(userMessage);
            aiChatMessages.scrollTop = aiChatMessages.scrollHeight;

            // Send to AI assistant
            const aiInput = document.getElementById('aiInput');
            if (aiInput) {
                aiInput.value = validationPrompt;

                // Trigger AI assistant send (assumes sendAIMessage function exists)
                if (typeof sendAIMessage === 'function') {
                    await sendAIMessage();
                }
            }

            // Show notification
            if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                window.OrgAdmin.Utils.showNotification('Project data sent to AI for validation. Check the AI Assistant panel for analysis.', 'info');
            }
        }

        // Create project automatically after AI approval
        async function createProjectFromAIApproval() {
            if (!window.parsedProjectData) {
                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification('No project data available. Please upload a spreadsheet first.', 'error');
                }
                return;
            }

            const fileNameSpan = document.getElementById('uploadedFileName');
            if (fileNameSpan) {
                fileNameSpan.textContent = '⚙️ Creating project automatically...';
                fileNameSpan.style.color = '#007bff';
            }

            try {
                // Send to automated project creation endpoint
                const response = await fetch('https://localhost:8004/api/v1/projects/create-from-spreadsheet', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(window.parsedProjectData)
                });

                if (!response.ok) {
                    throw new Error(`Project creation failed: ${response.statusText}`);
                }

                const result = await response.json();

                if (fileNameSpan) {
                    fileNameSpan.textContent = `✅ Project created successfully!`;
                    fileNameSpan.style.color = '#28a745';
                }

                // Show success notification with details
                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    const message = `Project "${result.project_name}" created with ${result.tracks_created || 0} tracks, ${result.students_enrolled || 0} students, and ${result.instructors_assigned || 0} instructors.`;
                    window.OrgAdmin.Utils.showNotification(message, 'success');
                }

                // Close modal and refresh projects
                closeModal('createProjectModal');
                if (window.OrgAdmin && window.OrgAdmin.Projects && window.OrgAdmin.Projects.loadProjects) {
                    await window.OrgAdmin.Projects.loadProjects();
                }

                // Clear stored data
                window.parsedProjectData = null;

            } catch (error) {
                console.error('Error creating project:', error);

                if (fileNameSpan) {
                    fileNameSpan.textContent = `❌ Error: ${error.message}`;
                    fileNameSpan.style.color = '#dc3545';
                }

                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification(`Failed to create project: ${error.message}`, 'error');
                }
            }
        }

        // Download project import template
        async function downloadProjectTemplate() {
            try {
                const response = await fetch('https://localhost:8004/api/v1/projects/template', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`Download failed: ${response.statusText}`);
                }

                // Get the blob and create download link
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'project_import_template.xlsx';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);

                // Show notification
                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification('Template downloaded successfully!', 'success');
                }

            } catch (error) {
                console.error('Error downloading template:', error);

                if (window.OrgAdmin && window.OrgAdmin.Utils && window.OrgAdmin.Utils.showNotification) {
                    window.OrgAdmin.Utils.showNotification(`Failed to download template: ${error.message}`, 'error');
                }
            }
        }

        // Make modals draggable
        document.addEventListener('DOMContentLoaded', function() {
            // Make project creation modal draggable from anywhere
            const projectModal = document.getElementById('createProjectModal');
            const projectHandle = document.querySelector('#createProjectModal .modal-content-inner');

            if (projectModal && projectHandle) {
                makeDraggable(projectModal, projectHandle);
            }

            // Make cohort creation modal draggable
            const cohortModal = document.getElementById('createCohortModal');
            const cohortHandle = document.querySelector('#createCohortModal .draggable-handle');

            if (cohortModal && cohortHandle) {
                makeDraggable(cohortModal, cohortHandle);
            }

            // Make project detail view draggable
            const detailView = document.getElementById('projectDetailView');
            const detailHandle = document.querySelector('#projectDetailView .draggable-handle');

            if (detailView && detailHandle) {
                makeDraggable(detailView, detailHandle);
            }
        });
    </script>

    <!-- Navigation System Module (Wave 4) -->
    <script type="module" src="../js/modules/navigation-system.js"></script>

    <!-- Cohort Wizard Module (Wave 5 - WizardFramework) -->
    <script type="module" src="../js/modules/cohort-wizard.js"></script>

    <!-- Modular JavaScript Architecture -->
    <script type="module" src="../js/org-admin-main.js?v=20251017-fix-401-auth"></script>
    <script src="../js/focus-manager.js?v=20251016-auth-debug"></script>

</body>
</html>