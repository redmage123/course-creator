<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../css/modern-ui/modern-ui.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Student Enrollment - Course Creator</title>
    <link rel="stylesheet" href="../css/bulk-enrollment.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Bulk Student Enrollment</h1>
            <p class="subtitle">Upload a spreadsheet to enroll multiple students at once</p>
        </header>

        <!-- Instructions Panel -->
        <div class="instructions-panel">
            <h2>üìã Instructions</h2>
            <div class="instructions-grid">
                <div class="instruction-card">
                    <h3>1. Prepare Spreadsheet</h3>
                    <p>Create a spreadsheet with the following columns:</p>
                    <ul>
                        <li><strong>email</strong> (required) - Student email address</li>
                        <li><strong>last_name</strong> (required) - Student last name</li>
                        <li><strong>first_name</strong> (optional) - Student first name</li>
                        <li><strong>role</strong> (optional) - Defaults to "student"</li>
                    </ul>
                </div>
                <div class="instruction-card">
                    <h3>2. Supported Formats</h3>
                    <ul>
                        <li>üìÑ CSV (Comma-Separated Values)</li>
                        <li>üìä XLSX (Microsoft Excel)</li>
                        <li>üìä ODS (LibreOffice Calc)</li>
                    </ul>
                    <p><strong>Max file size:</strong> 10MB</p>
                </div>
                <div class="instruction-card">
                    <h3>3. Example Format</h3>
                    <pre>first_name,last_name,email,role
John,Doe,john.doe@example.com,student
Jane,Smith,jane.smith@example.com,student
Bob,Johnson,bob.johnson@example.com,student</pre>
                </div>
            </div>
            <div class="download-template">
                <button id="downloadTemplate" class="btn-secondary">
                    ‚¨áÔ∏è Download CSV Template
                </button>
            </div>
        </div>

        <!-- Upload Panel -->
        <div class="upload-panel">
            <h2>üì§ Upload Spreadsheet</h2>

            <!-- Enrollment Type Selection -->
            <div class="enrollment-type">
                <label class="radio-label">
                    <input type="radio" name="enrollmentType" value="course" checked>
                    <span>Enroll in Single Course</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="enrollmentType" value="track">
                    <span>Enroll in Track (All Courses)</span>
                </label>
            </div>

            <!-- Course/Track Selection -->
            <div id="courseSelection" class="selection-container">
                <label for="courseSelect">Select Course:</label>
                <select id="courseSelect" class="form-select">
                    <option value="">-- Select a course --</option>
                    <!-- Populated dynamically -->
                </select>
            </div>

            <div id="trackSelection" class="selection-container hidden">
                <label for="trackSelect">Select Track:</label>
                <select id="trackSelect" class="form-select">
                    <option value="">-- Select a track --</option>
                    <!-- Populated dynamically -->
                </select>
            </div>

            <!-- File Upload Area -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÅ</div>
                <p class="upload-text">Drag and drop your spreadsheet here</p>
                <p class="upload-subtext">or</p>
                <button class="btn-primary" id="browseButton">Browse Files</button>
                <input type="file" id="fileInput" accept=".csv,.xlsx,.xls,.ods" hidden>
                <p class="upload-info">Supported: CSV, XLSX, ODS (Max 10MB)</p>
            </div>

            <!-- Selected File Info -->
            <div id="fileInfo" class="file-info hidden">
                <div class="file-details">
                    <span class="file-name" id="fileName"></span>
                    <span class="file-size" id="fileSize"></span>
                </div>
                <button class="btn-danger" id="removeFile">‚úï Remove</button>
            </div>

            <!-- Upload Button -->
            <div class="upload-actions">
                <button class="btn-primary btn-large" id="uploadButton" disabled>
                    Upload and Enroll Students
                </button>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div id="progressPanel" class="progress-panel hidden">
            <div class="progress-header">
                <h3>Processing Enrollment...</h3>
                <div class="spinner"></div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-text" id="progressText">Uploading file...</p>
        </div>

        <!-- Results Panel -->
        <div id="resultsPanel" class="results-panel hidden">
            <div class="results-header">
                <h2>üìä Enrollment Results</h2>
                <button class="btn-secondary" id="closeResults">Close</button>
            </div>

            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="summary-card success">
                    <div class="card-icon">‚úì</div>
                    <div class="card-content">
                        <div class="card-value" id="successCount">0</div>
                        <div class="card-label">Successful</div>
                    </div>
                </div>
                <div class="summary-card warning">
                    <div class="card-icon">‚ö†</div>
                    <div class="card-content">
                        <div class="card-value" id="failedCount">0</div>
                        <div class="card-label">Failed</div>
                    </div>
                </div>
                <div class="summary-card info">
                    <div class="card-icon">üë•</div>
                    <div class="card-content">
                        <div class="card-value" id="totalCount">0</div>
                        <div class="card-label">Total Students</div>
                    </div>
                </div>
                <div class="summary-card primary">
                    <div class="card-icon">‚è±</div>
                    <div class="card-content">
                        <div class="card-value" id="processingTime">0ms</div>
                        <div class="card-label">Processing Time</div>
                    </div>
                </div>
            </div>

            <!-- Detailed Results Tabs -->
            <div class="results-tabs">
                <button class="tab-button active" data-tab="created">
                    Created Accounts (<span id="createdCount">0</span>)
                </button>
                <button class="tab-button" data-tab="skipped">
                    Skipped (<span id="skippedCount">0</span>)
                </button>
                <button class="tab-button" data-tab="errors">
                    Errors (<span id="errorsCount">0</span>)
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content active" id="createdTab">
                <h3>‚úì Newly Created Accounts</h3>
                <div class="results-table-container">
                    <table class="results-table" id="createdTable">
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Name</th>
                                <th>User ID</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="tab-content" id="skippedTab">
                <h3>‚äò Skipped (Already Enrolled)</h3>
                <div class="results-table-container">
                    <table class="results-table" id="skippedTable">
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Reason</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="tab-content" id="errorsTab">
                <h3>‚úï Errors</h3>
                <div class="results-table-container">
                    <table class="results-table" id="errorsTable">
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Error Details</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Validation Summary -->
            <div id="validationSummary" class="validation-summary">
                <h3>üìã Validation Summary</h3>
                <div class="validation-stats">
                    <div class="stat-item">
                        <span class="stat-label">Valid Records:</span>
                        <span class="stat-value" id="validRecords">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Invalid Records:</span>
                        <span class="stat-value" id="invalidRecords">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Validation Rate:</span>
                        <span class="stat-value" id="validationRate">0%</span>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="results-actions">
                <button class="btn-primary" id="enrollMore">
                    ‚ûï Enroll More Students
                </button>
                <button class="btn-secondary" id="downloadReport">
                    ‚¨áÔ∏è Download Report
                </button>
            </div>
        </div>

        <!-- Error Alert -->
        <div id="errorAlert" class="alert alert-error hidden">
            <span class="alert-icon">‚ö†</span>
            <span class="alert-message" id="errorMessage"></span>
            <button class="alert-close" id="closeError">‚úï</button>
        </div>
    </div>

    <script src="../js/bulk-enrollment.js"></script>
</body>
</html>
