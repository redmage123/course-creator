<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Creator Platform - AI-Powered Course Creation</title>
    <meta name="description" content="Create professional courses in minutes with AI-powered technology. Interactive labs, comprehensive analytics, and enterprise-grade management.">

    <!-- Design System -->
    <link rel="stylesheet" href="../css/design-system.css?v=5.3">
    <link rel="stylesheet" href="../css/accessibility.css">
    <link rel="stylesheet" href="../css/components/header-footer.css?v=5.3">
    <link rel="stylesheet" href="../css/components/modals.css?v=5.3">
    <link rel="stylesheet" href="../css/pages/home-redesign.css?v=5.3">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Skip Navigation Links -->
    <div class="skip-links">
        <a href="#main-content" class="skip-link">Skip to main content</a>
    </div>

    <!-- ARIA Live Regions -->
    <div id="errorMessage" role="alert" aria-live="assertive" style="position: absolute; left: -9999px;"></div>
    <div id="successMessage" role="status" aria-live="polite" style="position: absolute; left: -9999px;"></div>

    <!-- HEADER - Consistent across all pages -->
    <header class="site-header" role="banner">
        <div class="header-container">
            <!-- Logo -->
            <a href="/html/index.html" class="header-logo">
                <i class="fas fa-graduation-cap"></i>
                <span>Course Creator</span>
            </a>

            <!-- Navigation -->
            <nav class="header-nav" role="navigation" aria-label="Main navigation">
                <a href="#features" class="nav-link">Features</a>
                <a href="#pricing" class="nav-link">Pricing</a>
                <a href="#about" class="nav-link">About</a>
                <a href="#contact" class="nav-link">Contact</a>
            </nav>

            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" aria-label="Toggle menu">
                <i class="fas fa-bars"></i>
            </button>

            <!-- Auth Buttons / User Account -->
            <div class="header-actions">
                <!-- Login Dropdown -->
                <div id="loginDropdown" class="login-dropdown">
                    <button class="header-btn header-btn-login" id="loginBtn" aria-expanded="false" aria-haspopup="true">
                        Login
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="login-menu" id="loginMenu">
                        <!-- Guest Login - Primary Option -->
                        <div class="login-menu-section guest-section">
                            <h3>Continue as Guest</h3>
                            <p>Explore courses without creating an account</p>
                            <button class="dropdown-btn dropdown-btn-primary" onclick="continueAsGuest()">
                                <i class="fas fa-user-circle"></i>
                                Browse as Guest
                            </button>
                        </div>

                        <div class="login-menu-divider">
                            <span>or sign in with your account</span>
                        </div>

                        <!-- Account Login - Secondary Option -->
                        <form id="accountLoginForm" class="login-menu-section account-section" onsubmit="handleAccountLogin(event)">
                            <div class="dropdown-form-group">
                                <label for="loginEmail">Username or Email</label>
                                <input
                                    type="text"
                                    id="loginEmail"
                                    name="email"
                                    placeholder="username or email@example.com"
                                    class="dropdown-input"
                                    required
                                >
                            </div>
                            <div class="dropdown-form-group">
                                <label for="loginPassword">Password</label>
                                <div class="password-input-wrapper">
                                    <input
                                        type="password"
                                        id="loginPassword"
                                        name="password"
                                        placeholder="Enter your password"
                                        class="dropdown-input password-input"
                                        required
                                    >
                                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility()" aria-label="Toggle password visibility">
                                        <i class="fas fa-eye" id="passwordToggleIcon"></i>
                                    </button>
                                </div>
                            </div>
                            <button type="submit" class="dropdown-btn dropdown-btn-secondary">
                                Sign In
                            </button>
                            <p class="dropdown-footer-text">
                                Don't have an account? <a href="/html/register.html">Register here</a>
                            </p>
                        </form>
                    </div>
                </div>

                <button class="header-btn header-btn-register" id="registerBtn">Register</button>

                <!-- User Dropdown (hidden by default, shown when logged in) -->
                <div id="userDropdown" class="user-dropdown" style="display: none;">
                    <button class="user-trigger" aria-expanded="false" aria-haspopup="true">
                        <div class="user-avatar">
                            <span id="userInitials">U</span>
                        </div>
                        <span id="userName">User</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="user-menu" id="userMenu">
                        <a href="#dashboard"><i class="fas fa-th-large"></i> Dashboard</a>
                        <a href="#profile"><i class="fas fa-user"></i> Profile</a>
                        <a href="#settings"><i class="fas fa-cog"></i> Settings</a>
                        <hr style="margin: var(--space-2) 0; border: none; border-top: 1px solid var(--border);">
                        <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" role="main" style="padding-top: 80px;">

        <!-- HERO SECTION - Bold, Centered, Professional -->
        <section class="hero">
            <div class="hero-content">
                <h1 class="hero-title">
                    Transform Learning with<br>AI-Powered Courses
                </h1>
                <p class="hero-subtitle">
                    Create professional courses in minutes. Interactive labs, comprehensive analytics,
                    and enterprise-grade managementâ€”all powered by advanced AI technology.
                </p>
                <div class="hero-cta">
                    <button class="hero-btn hero-btn-primary" onclick="window.location.href='#register'">
                        Get Started Free
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <button class="hero-btn hero-btn-secondary" onclick="window.location.href='#demo'">
                        Watch Demo
                        <i class="fas fa-play"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- FEATURES SECTION - Clean Grid Layout -->
        <section class="features-section" id="features">
            <div class="features-header">
                <h2 class="features-title">Everything You Need</h2>
                <p class="features-subtitle">
                    Comprehensive tools for creating, managing, and delivering world-class educational experiences
                </p>
            </div>

            <div class="features-grid">
                <!-- Feature 1: AI Course Generation -->
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h3 class="feature-title">AI-Powered Generation</h3>
                    <p class="feature-description">
                        Generate complete courses with lessons, quizzes, and assessments in minutes using advanced AI technology.
                    </p>
                </div>

                <!-- Feature 2: Interactive Labs -->
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-code"></i>
                    </div>
                    <h3 class="feature-title">Interactive Lab Environments</h3>
                    <p class="feature-description">
                        Professional coding environments directly in the browser. No setup required, instant access for students.
                    </p>
                </div>

                <!-- Feature 3: Analytics -->
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3 class="feature-title">Comprehensive Analytics</h3>
                    <p class="feature-description">
                        Track student progress with detailed insights. Data-driven decision making for better learning outcomes.
                    </p>
                </div>

                <!-- Feature 4: Organization Management -->
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <h3 class="feature-title">Enterprise Management</h3>
                    <p class="feature-description">
                        Multi-tenant architecture with role-based access control. Perfect for institutions and organizations.
                    </p>
                </div>

                <!-- Feature 5: Content Library -->
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <h3 class="feature-title">Content Library</h3>
                    <p class="feature-description">
                        Rich library of reusable content. Share and collaborate across your organization seamlessly.
                    </p>
                </div>

                <!-- Feature 6: Mobile Friendly -->
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3 class="feature-title">Mobile Optimized</h3>
                    <p class="feature-description">
                        Fully responsive design. Learn anywhere, anytime, on any device with a seamless experience.
                    </p>
                </div>
            </div>
        </section>

        <!-- CTA SECTION - Compelling Call to Action -->
        <section class="cta-section">
            <div class="cta-content">
                <h2 class="cta-title">Ready to Transform Your Learning?</h2>
                <p class="cta-subtitle">
                    Join thousands of educators creating engaging courses with our AI-powered platform
                </p>
                <div class="cta-buttons">
                    <button class="hero-btn hero-btn-primary" onclick="window.location.href='#register'">
                        Start Free Trial
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <button class="hero-btn hero-btn-secondary" onclick="window.location.href='#contact'">
                        Contact Sales
                        <i class="fas fa-envelope"></i>
                    </button>
                </div>
            </div>
        </section>

    </main>

    <!-- FOOTER - Professional, Informative -->
    <footer class="site-footer" role="contentinfo">
        <div class="footer-container">
            <div class="footer-content">
                <!-- Brand Section -->
                <div class="footer-brand">
                    <a href="/html/index.html" class="footer-logo">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Course Creator</span>
                    </a>
                    <p class="footer-description">
                        Empowering educators with AI-powered course creation tools. Build better courses,
                        track student progress, and deliver exceptional learning experiences.
                    </p>
                </div>

                <!-- Product Links -->
                <div class="footer-section">
                    <h3>Product</h3>
                    <div class="footer-links">
                        <a href="#features" class="footer-link">Features</a>
                        <a href="#pricing" class="footer-link">Pricing</a>
                        <a href="#demo" class="footer-link">Demo</a>
                        <a href="#integrations" class="footer-link">Integrations</a>
                    </div>
                </div>

                <!-- Company Links -->
                <div class="footer-section">
                    <h3>Company</h3>
                    <div class="footer-links">
                        <a href="#about" class="footer-link">About Us</a>
                        <a href="#careers" class="footer-link">Careers</a>
                        <a href="#blog" class="footer-link">Blog</a>
                        <a href="#contact" class="footer-link">Contact</a>
                    </div>
                </div>

                <!-- Support Links -->
                <div class="footer-section">
                    <h3>Support</h3>
                    <div class="footer-links">
                        <a href="#help" class="footer-link">Help Center</a>
                        <a href="#docs" class="footer-link">Documentation</a>
                        <a href="#api" class="footer-link">API Reference</a>
                        <a href="#status" class="footer-link">System Status</a>
                    </div>
                </div>
            </div>

            <!-- Footer Bottom -->
            <div class="footer-bottom">
                <p class="footer-copyright">
                    &copy; 2025 Course Creator Platform. All rights reserved.
                </p>
                <div class="footer-social">
                    <a href="#" class="social-link" aria-label="Twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" class="social-link" aria-label="LinkedIn">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="#" class="social-link" aria-label="GitHub">
                        <i class="fab fa-github"></i>
                    </a>
                    <a href="#" class="social-link" aria-label="YouTube">
                        <i class="fab fa-youtube"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- PRIVACY CONSENT MODAL -->
    <div id="privacyModal" class="modal-backdrop privacy-consent-backdrop" role="dialog" aria-labelledby="privacyModalTitle" aria-hidden="true" style="display: none;">
        <div class="modal modal-md privacy-consent-modal">
            <div class="modal-header">
                <h2 id="privacyModalTitle" class="modal-title">Privacy & Data Protection</h2>
            </div>
            <div class="modal-body">
                <p class="privacy-intro">
                    We care about your privacy. This platform uses cookies and processes data to provide you with the best learning experience.
                </p>
                <div class="privacy-categories">
                    <div class="privacy-category">
                        <div class="privacy-category-header">
                            <input type="checkbox" id="essentialCookies" checked disabled>
                            <label for="essentialCookies">
                                <strong>Essential Cookies</strong>
                                <span class="privacy-required">(Required)</span>
                            </label>
                        </div>
                        <p class="privacy-category-description">
                            Necessary for authentication, security, and core platform functionality.
                        </p>
                    </div>
                    <div class="privacy-category">
                        <div class="privacy-category-header">
                            <input type="checkbox" id="analyticsCookies">
                            <label for="analyticsCookies">
                                <strong>Analytics & Performance</strong>
                            </label>
                        </div>
                        <p class="privacy-category-description">
                            Help us understand how you use the platform to improve your experience.
                        </p>
                    </div>
                </div>
                <p class="privacy-footer-text">
                    By continuing, you agree to our <a href="#privacy-policy">Privacy Policy</a> and <a href="#terms">Terms of Service</a>.
                </p>
            </div>
            <div class="modal-footer">
                <button class="hero-btn hero-btn-secondary" onclick="handlePrivacyChoice('reject')">
                    Reject Optional
                </button>
                <button class="hero-btn hero-btn-primary" onclick="handlePrivacyChoice('accept')">
                    Accept All
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script type="module">
        // Header scroll effect
        window.addEventListener('scroll', () => {
            const header = document.querySelector('.site-header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        // User dropdown toggle
        const userTrigger = document.querySelector('.user-trigger');
        const userMenu = document.querySelector('.user-menu');

        if (userTrigger && userMenu) {
            userTrigger.addEventListener('click', () => {
                const isExpanded = userTrigger.getAttribute('aria-expanded') === 'true';
                userTrigger.setAttribute('aria-expanded', !isExpanded);
                userMenu.classList.toggle('active');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.user-dropdown')) {
                    userTrigger.setAttribute('aria-expanded', 'false');
                    userMenu.classList.remove('active');
                }
            });
        }

        // Login dropdown toggle
        const loginBtn = document.getElementById('loginBtn');
        const loginMenu = document.getElementById('loginMenu');

        if (loginBtn && loginMenu) {
            loginBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const isExpanded = loginBtn.getAttribute('aria-expanded') === 'true';
                loginBtn.setAttribute('aria-expanded', !isExpanded);
                loginMenu.classList.toggle('active');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.login-dropdown')) {
                    loginBtn.setAttribute('aria-expanded', 'false');
                    loginMenu.classList.remove('active');
                }
            });
        }

        // Register button handler
        document.getElementById('registerBtn')?.addEventListener('click', () => {
            window.location.href = '/html/register.html';
        });

        // Logout function
        window.logout = function() {
            // Clear all auth data
            localStorage.removeItem('authToken');
            localStorage.removeItem('userRole');
            localStorage.removeItem('userName');
            localStorage.removeItem('isGuest');

            // Show login/register buttons
            const loginDropdown = document.getElementById('loginDropdown');
            const registerBtn = document.getElementById('registerBtn');
            const userDropdown = document.getElementById('userDropdown');

            if (loginDropdown) loginDropdown.style.display = 'block';
            if (registerBtn) registerBtn.style.display = 'block';
            if (userDropdown) userDropdown.style.display = 'none';

            window.location.href = '/html/index.html';
        };

        // Password visibility toggle
        window.togglePasswordVisibility = function() {
            const passwordInput = document.getElementById('loginPassword');
            const toggleIcon = document.getElementById('passwordToggleIcon');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        };

        // Check if user is logged in
        const authToken = localStorage.getItem('authToken');
        if (authToken) {
            document.getElementById('loginDropdown').style.display = 'none';
            document.getElementById('registerBtn').style.display = 'none';
            document.getElementById('userDropdown').style.display = 'block';

            // Set user info
            const userName = localStorage.getItem('userName') || 'User';
            document.getElementById('userName').textContent = userName;
            document.getElementById('userInitials').textContent = userName.charAt(0).toUpperCase();

            // Set dashboard link based on user role
            const userRole = (localStorage.getItem('userRole') || '').toLowerCase().replace(/[-_]/g, '_');
            const currentUserStr = localStorage.getItem('currentUser');
            const currentUser = currentUserStr ? JSON.parse(currentUserStr) : null;
            const dashboardLink = document.querySelector('#userMenu a[href="#dashboard"]');
            if (dashboardLink) {
                switch(userRole) {
                    case 'site_admin':
                    case 'siteadmin':
                        dashboardLink.href = '/html/site-admin-dashboard.html';
                        break;
                    case 'org_admin':
                    case 'organization_admin':
                    case 'orgadmin':
                    case 'organizationadmin':
                        // Include org_id parameter if available
                        const orgId = currentUser?.organization_id;
                        dashboardLink.href = orgId
                            ? `/html/org-admin-dashboard.html?org_id=${orgId}`
                            : '/html/org-admin-dashboard.html';
                        break;
                    case 'instructor':
                        dashboardLink.href = '/html/instructor-dashboard.html';
                        break;
                    case 'student':
                        dashboardLink.href = '/html/student-dashboard.html';
                        break;
                    default:
                        dashboardLink.href = '/html/student-dashboard.html';
                }
            }
        }

        // =========================================================================
        // LOGIN DROPDOWN FUNCTIONS
        // =========================================================================

        function closeLoginDropdown() {
            const loginBtn = document.getElementById('loginBtn');
            const loginMenu = document.getElementById('loginMenu');
            if (loginBtn && loginMenu) {
                loginBtn.setAttribute('aria-expanded', 'false');
                loginMenu.classList.remove('active');
            }
        }

        // Guest Login - Default option
        window.continueAsGuest = function() {
            // Set guest session
            localStorage.setItem('userRole', 'guest');
            localStorage.setItem('isGuest', 'true');
            localStorage.setItem('userName', 'Guest User');

            // Close dropdown
            closeLoginDropdown();

            // Redirect to guest portal (browse courses without full access)
            window.location.href = '/html/student-dashboard.html?guest=true';
        };

        // Account Login - Check DB for role
        window.handleAccountLogin = async function(event) {
            event.preventDefault();

            const usernameOrEmail = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            // Determine if input is email or username
            const isEmail = usernameOrEmail.includes('@');
            const loginData = isEmail
                ? { email: usernameOrEmail, password }
                : { username: usernameOrEmail, password };

            try {
                // Call authentication API through nginx proxy
                const response = await fetch('/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(loginData),
                });

                if (response.ok) {
                    const data = await response.json();

                    // Debug logging to see what role is returned
                    console.log('Login response:', data);
                    console.log('Role received:', data.user.role);

                    // Store authentication token and user info
                    localStorage.setItem('authToken', data.access_token);
                    localStorage.setItem('userRole', data.user.role);
                    localStorage.setItem('userName', data.user.username);
                    localStorage.setItem('isGuest', 'false');

                    // Store FULL user object for dashboard (site-admin-dashboard needs this)
                    localStorage.setItem('currentUser', JSON.stringify(data.user));

                    // Store session timestamps (required by site-admin-dashboard.js validateSession)
                    const now = Date.now();
                    localStorage.setItem('sessionStart', now.toString());
                    localStorage.setItem('lastActivity', now.toString());

                    // Close dropdown
                    closeLoginDropdown();

                    // Normalize role name to handle variations
                    const role = (data.user.role || '').toLowerCase().replace(/[-_]/g, '_');

                    // Redirect based on role
                    switch(role) {
                        case 'site_admin':
                        case 'siteadmin':
                            window.location.href = '/html/site-admin-dashboard.html';
                            break;
                        case 'org_admin':
                        case 'organization_admin':
                        case 'orgadmin':
                        case 'organizationadmin':
                            // Include org_id parameter if available
                            const orgId = data.user.organization_id;
                            window.location.href = orgId
                                ? `/html/org-admin-dashboard.html?org_id=${orgId}`
                                : '/html/org-admin-dashboard.html';
                            break;
                        case 'instructor':
                            window.location.href = '/html/instructor-dashboard.html';
                            break;
                        case 'student':
                            window.location.href = '/html/student-dashboard.html';
                            break;
                        default:
                            console.error('Unknown role:', data.user.role);
                            alert(`Unknown role: ${data.user.role}. Contact support.`);
                            // If no role assigned, treat as guest
                            continueAsGuest();
                    }
                } else {
                    const error = await response.json();
                    alert('Login failed: ' + (error.message || 'Invalid credentials'));
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed. Please check your connection and try again.');
            }
        };

        // =========================================================================
        // PRIVACY CONSENT FUNCTIONS
        // =========================================================================

        let scrollPosition = 0;

        window.openPrivacyModal = function() {
            const modal = document.getElementById('privacyModal');

            // Save current scroll position
            scrollPosition = window.pageYOffset || document.documentElement.scrollTop;

            // Lock body scroll
            document.body.classList.add('modal-open');
            document.body.style.top = `-${scrollPosition}px`;

            // Show modal
            modal.style.display = 'flex';
            modal.setAttribute('aria-hidden', 'false');
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
        };

        window.closePrivacyModal = function() {
            const modal = document.getElementById('privacyModal');
            modal.classList.remove('show');
            modal.setAttribute('aria-hidden', 'true');

            setTimeout(() => {
                modal.style.display = 'none';

                // Restore body scroll
                document.body.classList.remove('modal-open');
                document.body.style.top = '';
                window.scrollTo(0, scrollPosition);
            }, 300);
        };

        window.handlePrivacyChoice = function(choice) {
            const analyticsCookies = document.getElementById('analyticsCookies').checked;

            // Store consent
            const consent = {
                essential: true, // Always required
                analytics: choice === 'accept' ? true : analyticsCookies,
                timestamp: new Date().toISOString(),
            };

            localStorage.setItem('privacyConsent', JSON.stringify(consent));

            // Close modal
            closePrivacyModal();
        };

        // Check if privacy consent has been given
        function checkPrivacyConsent() {
            const consent = localStorage.getItem('privacyConsent');
            if (!consent) {
                // Show privacy modal on first visit
                setTimeout(() => {
                    openPrivacyModal();
                }, 1000); // Delay 1 second after page load
            }
        }

        // Check privacy consent on page load
        checkPrivacyConsent();

        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-backdrop')) {
                if (e.target.id === 'loginModal') {
                    closeLoginModal();
                }
                // Don't auto-close privacy modal (user must make choice)
            }
        });

        // Escape key to close modals
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeLoginModal();
                // Don't close privacy modal on escape (user must make choice)
            }
        });
    </script>

    <!-- Accessibility Manager -->
    <script src="/js/accessibility-manager.js"></script>
</body>
</html>
