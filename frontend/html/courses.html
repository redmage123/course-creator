<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Catalog - Course Creator Platform</title>
    <link rel="stylesheet" href="../css/design-system.css?v=5.5">
    <link rel="stylesheet" href="../css/accessibility.css">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .catalog-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .catalog-header {
            margin-bottom: 30px;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .search-bar input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 16px;
        }

        .search-bar button {
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
        }

        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
        }

        .course-card {
            background: var(--surface-elevated);
            border-radius: var(--radius-xl);
            border: 1px solid var(--border);
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .course-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .course-card-content {
            padding: 20px;
        }

        .course-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .course-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .view-details-btn {
            width: 100%;
            padding: 10px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .no-results-guidance {
            margin-top: 20px;
        }

        .no-results-guidance a {
            color: var(--primary-color);
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- Skip links for accessibility -->
    <div class="skip-links">
        <a href="#main-content" class="skip-link">Skip to main content</a>
        <a href="#course-search" class="skip-link">Skip to search</a>
    </div>

    <header class="site-header" role="banner">
        <div class="header-container">
            <a href="/html/index.html" class="header-logo">
                <i class="fas fa-graduation-cap"></i>
                <span>Course Creator</span>
            </a>
        </div>
    </header>

    <main id="main-content" class="catalog-container" role="main">
        <div class="catalog-header">
            <h1>Course Catalog</h1>
            <p>Explore and enroll in available courses</p>
        </div>

        <form class="search-bar" role="search" onsubmit="event.preventDefault(); searchCourses();">
            <label for="course-search" class="sr-only">Search courses</label>
            <input type="search" id="course-search" placeholder="Search courses..." aria-label="Search courses by title or description">
            <button type="submit">
                <i class="fas fa-search" aria-hidden="true"></i> Search
            </button>
        </form>

        <div id="courses-container" class="courses-grid">
            <!-- Courses will be loaded here -->
        </div>

        <div id="no-results" class="no-results" style="display: none;" role="status" aria-live="polite">
            <p><strong>No courses found matching your search.</strong></p>
            <p class="no-results-guidance">Try adjusting your search terms or <a href="#course-search">clear your search</a> to view all available courses.</p>
        </div>
    </main>

    <script src="../js/accessibility-manager.js"></script>
    <script>
        let allCourses = [];

        // Load courses on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadCourses();
        });

        async function loadCourses() {
            try {
                // Get auth token from localStorage
                const authToken = localStorage.getItem('authToken');
                const headers = {
                    'Content-Type': 'application/json'
                };

                if (authToken) {
                    headers['Authorization'] = `Bearer ${authToken}`;
                }

                const response = await fetch('https://localhost:8004/courses', {
                    headers: headers
                });

                if (response.ok) {
                    const courses = await response.json();
                    allCourses = courses;
                    displayCourses(courses);
                } else {
                    console.error('Failed to load courses', response.status);
                    document.getElementById('courses-container').innerHTML =
                        '<p class="no-results">Failed to load courses. Please try again later.</p>';
                }
            } catch (error) {
                console.error('Error loading courses:', error);
                document.getElementById('courses-container').innerHTML =
                    '<p class="no-results">Failed to load courses. Please try again later.</p>';
            }
        }

        function displayCourses(courses) {
            const container = document.getElementById('courses-container');
            const noResults = document.getElementById('no-results');

            if (!courses || courses.length === 0) {
                container.innerHTML = '';
                noResults.style.display = 'block';
                return;
            }

            noResults.style.display = 'none';
            container.innerHTML = courses.map((course, index) => `
                <article class="course-card" data-index="${index}" aria-labelledby="course-title-${course.id}">
                    <div class="course-card-content">
                        <h2 id="course-title-${course.id}" class="course-title">${escapeHtml(course.title || 'Untitled Course')}</h2>
                        <p class="course-description">${escapeHtml(course.description || 'No description available')}</p>
                        <button class="view-details-btn" onclick="viewCourseDetails('${course.id}')" aria-label="View details for ${escapeHtml(course.title || 'Untitled Course')}">
                            <i class="fas fa-arrow-right" aria-hidden="true"></i> View Details
                        </button>
                    </div>
                </article>
            `).join('');

            // Scroll submit button into view
            window.scrollTo(0, document.body.scrollHeight);
        }

        function searchCourses() {
            const query = document.getElementById('course-search').value.toLowerCase().trim();

            if (!query) {
                displayCourses(allCourses);
                return;
            }

            const filtered = allCourses.filter(course =>
                (course.title && course.title.toLowerCase().includes(query)) ||
                (course.description && course.description.toLowerCase().includes(query))
            );

            displayCourses(filtered);
        }

        function viewCourseDetails(courseId) {
            // Store course ID and navigate to details page
            localStorage.setItem('selectedCourseId', courseId);
            window.location.href = `/html/course-details.html?id=${courseId}`;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
