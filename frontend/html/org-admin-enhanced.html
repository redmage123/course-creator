<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organization Admin Dashboard - Enhanced RBAC</title>
    <link rel="stylesheet" href="../css/main.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Security: DOMPurify for XSS protection -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js" integrity="sha512-HN8xvPHO2yev9LkzQc1w8T5/2yH6F0LNc6T5w0DKPcP5p8JqX0Lx6/P8X5B1wJXvkBFDFTqZJE3xrGPzqQHwQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
    <!-- Skip Links for Keyboard Users -->
    <div class="skip-links">
        <a href="#main-content" class="skip-link">Skip to main content</a>
        <a href="#navigation" class="skip-link">Skip to navigation</a>
        <a href="#user-menu" class="skip-link">Skip to user menu</a>
    </div>
    
    <!-- Live Region for Screen Reader Announcements -->
    <div id="live-region" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    <div id="live-region-assertive" aria-live="assertive" aria-atomic="true" class="sr-only"></div>
    <div class="dashboard-container">
        <!-- Header -->
        <header role="banner" class="dashboard-header">
            <div class="header-content">
                <h1><i class="fas fa-users-cog" aria-hidden="true"></i> Organization Admin Dashboard</h1>
                <nav role="navigation" aria-label="User account menu" id="user-menu">
                    <div class="header-actions">
                        <div class="user-info" role="status" aria-live="polite">
                            <div class="user-avatar" id="userAvatar">
                                <span id="userInitials">?</span>
                            </div>
                            <div class="user-details">
                                <span id="currentUserName" aria-label="Current user name">Loading...</span>
                                <span class="user-role status-badge active" aria-label="User role">Organization Admin</span>
                            </div>
                        </div>
                        <button class="btn btn-outline" onclick="logout()" aria-label="Logout of dashboard">
                            <i class="fas fa-sign-out-alt" aria-hidden="true"></i> Logout
                        </button>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Main Navigation -->
        <nav role="navigation" aria-label="Dashboard navigation" id="navigation" class="dashboard-nav">
            <div class="nav-tabs" role="tablist" aria-label="Dashboard sections">
                <button class="nav-tab active" 
                        role="tab" 
                        data-tab="overview" 
                        aria-selected="true" 
                        aria-controls="overview-panel"
                        id="overview-tab"
                        tabindex="0">
                    <i class="fas fa-chart-line" aria-hidden="true"></i> 
                    <span>Overview</span>
                    <span class="sr-only">- Currently selected</span>
                </button>
                <button class="nav-tab" 
                        role="tab" 
                        data-tab="projects" 
                        aria-selected="false" 
                        aria-controls="projects-panel"
                        id="projects-tab"
                        tabindex="-1">
                    <i class="fas fa-folder-open" aria-hidden="true"></i> 
                    <span>Projects</span>
                </button>
                <button class="nav-tab" 
                        role="tab" 
                        data-tab="project-details" 
                        aria-selected="false" 
                        aria-controls="project-details-panel"
                        id="project-details-tab"
                        tabindex="-1"
                        style="display: none;">
                    <i class="fas fa-folder-open" aria-hidden="true"></i> 
                    <span id="projectDetailsTabLabel">Project Details</span>
                </button>
                <button class="nav-tab" 
                        role="tab" 
                        data-tab="members" 
                        aria-selected="false" 
                        aria-controls="members-panel"
                        id="members-tab"
                        tabindex="-1">
                    <i class="fas fa-users" aria-hidden="true"></i> 
                    <span>Members</span>
                </button>
                <button class="nav-tab" 
                        role="tab" 
                        data-tab="tracks" 
                        aria-selected="false" 
                        aria-controls="tracks-panel"
                        id="tracks-tab"
                        tabindex="-1">
                    <i class="fas fa-road" aria-hidden="true"></i> 
                    <span>Tracks</span>
                </button>
                <button class="nav-tab" 
                        role="tab" 
                        data-tab="assignments" 
                        aria-selected="false" 
                        aria-controls="assignments-panel"
                        id="assignments-tab"
                        tabindex="-1">
                    <i class="fas fa-user-tag" aria-hidden="true"></i> 
                    <span>Assignments</span>
                </button>
                <button class="nav-tab" 
                        role="tab" 
                        data-tab="meeting-rooms" 
                        aria-selected="false" 
                        aria-controls="meeting-rooms-panel"
                        id="meeting-rooms-tab"
                        tabindex="-1">
                    <i class="fas fa-video" aria-hidden="true"></i> 
                    <span>Meeting Rooms</span>
                </button>
                <button class="nav-tab" 
                        role="tab" 
                        data-tab="settings" 
                        aria-selected="false" 
                        aria-controls="settings-panel"
                        id="settings-tab"
                        tabindex="-1">
                    <i class="fas fa-cog" aria-hidden="true"></i> 
                    <span>Settings</span>
                </button>
                
                <!-- Navigation Search -->
                <div class="nav-search">
                    <i class="fas fa-search nav-search-icon" aria-hidden="true"></i>
                    <input type="text" 
                           class="nav-search-input" 
                           placeholder="Search sections..." 
                           aria-label="Search dashboard sections"
                           id="navSearchInput">
                </div>
            </div>
        </nav>
        
        <!-- Breadcrumb Navigation -->
        <nav class="breadcrumb-nav" id="breadcrumbNav" aria-label="Breadcrumb navigation">
            <div class="breadcrumb" id="breadcrumbContent">
                <div class="breadcrumb-item">
                    <a href="#" data-tab="overview">Dashboard</a>
                </div>
                <div class="breadcrumb-item current">
                    <span id="currentBreadcrumb">Overview</span>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main role="main" id="main-content" class="dashboard-main">
            <!-- Overview Tab Panel -->
            <section class="tab-content active" 
                     id="overview-panel" 
                     role="tabpanel" 
                     aria-labelledby="overview-tab"
                     tabindex="0">
                <!-- Organization Header -->
                <header class="org-header" role="banner" aria-labelledby="orgName" style="text-align: center; padding: 40px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white; margin-bottom: 30px;">
                    <div class="org-icon" style="font-size: 48px; margin-bottom: 15px;" aria-hidden="true">
                        <i class="fas fa-building"></i>
                    </div>
                    <h2 id="orgName" style="margin: 0 0 10px 0; font-size: 32px; font-weight: 300;" aria-live="polite">Loading...</h2>
                    <p style="margin: 0; font-size: 18px; opacity: 0.9;" role="text">Organization Administration Dashboard</p>
                </header>

                <!-- Enhanced Statistics Dashboard -->
                <section class="stat-cards-grid" role="region" aria-labelledby="stats-heading">
                    <h3 id="stats-heading" class="sr-only">Organization Statistics</h3>
                    
                    <div id="projects-stat-card"></div>
                    <div id="members-stat-card"></div>
                    <div id="activity-stat-card"></div>
                    <div id="completion-stat-card"></div>
                </section>

                <!-- Analytics Charts Section -->
                <section class="analytics-section" role="region" aria-labelledby="analytics-heading">
                    <h3 id="analytics-heading" class="sr-only">Analytics and Charts</h3>
                    
                    <div class="analytics-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-md); margin-bottom: var(--space-xl);">
                        <div id="activity-chart"></div>
                        <div id="progress-overview"></div>
                    </div>
                    
                    <div id="projects-table"></div>
                </section>

                <!-- Recent Activity Timeline -->
                <section class="activity-section" role="region" aria-labelledby="activity-heading">
                    <h3 id="activity-heading" style="font-size: var(--font-size-xl); margin-bottom: var(--space-md); color: var(--text-primary);">
                        <i class="fas fa-clock" aria-hidden="true"></i> Recent Activity
                    </h3>
                    <div id="activity-timeline"></div>
                </section>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h2>Quick Actions</h2>
                    <div class="action-grid">
                        <button class="action-btn" onclick="orgAdmin.showCreateProjectModal()">
                            <i class="fas fa-folder-plus"></i>
                            <span>Create Project</span>
                        </button>
                        <button class="action-btn" onclick="orgAdmin.showAddMemberModal('organization_admin')">
                            <i class="fas fa-user-plus"></i>
                            <span>Add Admin</span>
                        </button>
                        <button class="action-btn" onclick="orgAdmin.showAddMemberModal('instructor')">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <span>Add Instructor</span>
                        </button>
                        <button class="action-btn" onclick="orgAdmin.showCreateMeetingRoomModal()">
                            <i class="fas fa-video"></i>
                            <span>Create Meeting Room</span>
                        </button>
                        <button class="action-btn" onclick="orgAdmin.viewReports()">
                            <i class="fas fa-chart-bar"></i>
                            <span>View Reports</span>
                        </button>
                        <button class="action-btn" onclick="orgAdmin.showTab('projects')">
                            <i class="fas fa-folder-open"></i>
                            <span>Manage Projects</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Projects Tab Panel -->
            <section class="tab-content" 
                     id="projects-panel" 
                     role="tabpanel" 
                     aria-labelledby="projects-tab"
                     aria-hidden="true"
                     tabindex="0"
                     style="display: none;">
                <div class="tab-header">
                    <h2>Organization Projects</h2>
                    <div class="tab-actions">
                        <div class="filter-group">
                            <select id="projectStatusFilter" onchange="orgAdmin.filterProjects()">
                                <option value="">All Statuses</option>
                                <option value="draft">Draft</option>
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                                <option value="archived">Archived</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="orgAdmin.showCreateProjectModal()">
                            <i class="fas fa-folder-plus"></i> Create Project
                        </button>
                    </div>
                </div>

                <div class="projects-grid">
                    <div id="projectsContainer" class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading projects...</p>
                    </div>
                </div>
            </div>

            <!-- Project Details Tab ---->
            <!-- Project Details Tab Panel -->
            <section class="tab-content" 
                     id="project-details-panel" 
                     role="tabpanel" 
                     aria-labelledby="project-details-tab"
                     aria-hidden="true"
                     tabindex="0"
                     style="display: none;">
                <div class="project-details-header">
                    <div class="project-title">
                        <button class="btn btn-outline btn-sm" onclick="orgAdmin.backToProjects()">
                            <i class="fas fa-arrow-left"></i> Back to Projects
                        </button>
                        <h2 id="selectedProjectName">Project Details</h2>
                    </div>
                    <div class="project-actions">
                        <button class="btn btn-primary" onclick="orgAdmin.editSelectedProject()">
                            <i class="fas fa-edit"></i> Edit Project
                        </button>
                        <button class="btn btn-success" onclick="orgAdmin.addProjectMember()">
                            <i class="fas fa-user-plus"></i> Add Member
                        </button>
                    </div>
                </div>

                <div class="project-details-content">
                    <!-- Project Info Card -->
                    <div class="project-info-card">
                        <h3>Project Information</h3>
                        <div id="projectInfoDisplay">
                            <div class="loading">Loading project details...</div>
                        </div>
                    </div>

                    <!-- Project Stats -->
                    <div class="project-stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="projectMemberCount">0</h3>
                                <p>Members</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-road"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="projectTrackCount">0</h3>
                                <p>Learning Tracks</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-video"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="projectMeetingRoomCount">0</h3>
                                <p>Meeting Rooms</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="projectInstructorCount">0</h3>
                                <p>Instructors</p>
                            </div>
                        </div>
                    </div>

                    <!-- Project Content Tabs -->
                    <div class="project-content-tabs">
                        <div class="tab-nav">
                            <button class="tab-button active" data-content="project-members">
                                <i class="fas fa-users"></i> Members
                            </button>
                            <button class="tab-button" data-content="project-tracks">
                                <i class="fas fa-road"></i> Learning Tracks  
                            </button>
                            <button class="tab-button" data-content="project-rooms">
                                <i class="fas fa-video"></i> Meeting Rooms
                            </button>
                        </div>

                        <!-- Project Members -->
                        <div class="tab-pane active" id="project-members">
                            <div class="section-header">
                                <h4>Project Members</h4>
                                <button class="btn btn-primary btn-sm" onclick="orgAdmin.showAddProjectMemberModal()">
                                    <i class="fas fa-user-plus"></i> Add Member
                                </button>
                            </div>
                            <div id="projectMembersContainer" class="members-grid">
                                <div class="loading">Loading project members...</div>
                            </div>
                        </div>

                        <!-- Project Tracks -->
                        <div class="tab-pane" id="project-tracks">
                            <div class="section-header">
                                <h4>Learning Tracks</h4>
                                <button class="btn btn-primary btn-sm" onclick="orgAdmin.showCreateProjectTrackModal()">
                                    <i class="fas fa-plus"></i> Create Track
                                </button>
                            </div>
                            <div id="projectTracksContainer" class="tracks-grid">
                                <div class="loading">Loading project tracks...</div>
                            </div>
                        </div>

                        <!-- Project Meeting Rooms -->
                        <div class="tab-pane" id="project-rooms">
                            <div class="section-header">
                                <h4>Meeting Rooms</h4>
                                <button class="btn btn-primary btn-sm" onclick="orgAdmin.showCreateProjectRoomModal()">
                                    <i class="fas fa-video"></i> Create Room
                                </button>
                            </div>
                            <div id="projectMeetingRoomsContainer" class="meeting-rooms-grid">
                                <div class="loading">Loading project meeting rooms...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Members Tab Panel -->
            <section class="tab-content" 
                     id="members-panel" 
                     role="tabpanel" 
                     aria-labelledby="members-tab"
                     aria-hidden="true"
                     tabindex="0"
                     style="display: none;">
                <div class="tab-header">
                    <h2>Organization Members</h2>
                    <div class="tab-actions">
                        <div class="filter-group">
                            <select id="memberRoleFilter" onchange="filterMembers()">
                                <option value="">All Roles</option>
                                <option value="organization_admin">Organization Admins</option>
                                <option value="instructor">Instructors</option>
                                <option value="student">Students</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="showAddMemberModal()">
                            <i class="fas fa-user-plus"></i> Add Member
                        </button>
                    </div>
                </div>

                <div class="members-grid">
                    <div id="membersContainer" class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading members...</p>
                    </div>
                </div>
            </div>

            <!-- Tracks Tab -->
            <!-- Tracks Tab Panel -->
            <section class="tab-content" 
                     id="tracks-panel" 
                     role="tabpanel" 
                     aria-labelledby="tracks-tab"
                     aria-hidden="true"
                     tabindex="0"
                     style="display: none;">
                <div class="tab-header">
                    <h2>Learning Tracks</h2>
                    <div class="tab-actions">
                        <button class="btn btn-primary" onclick="showCreateTrackModal()">
                            <i class="fas fa-plus"></i> Create Track
                        </button>
                    </div>
                </div>

                <div class="tracks-grid">
                    <div id="tracksContainer" class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading tracks...</p>
                    </div>
                </div>
            </div>

            <!-- Assignments Tab -->
            <!-- Assignments Tab Panel -->
            <section class="tab-content" 
                     id="assignments-panel" 
                     role="tabpanel" 
                     aria-labelledby="assignments-tab"
                     aria-hidden="true"
                     tabindex="0"
                     style="display: none;">
                <div class="assignments-section">
                    <h2>Track Assignments</h2>
                    
                    <!-- Instructor Assignments -->
                    <div class="assignment-group">
                        <h3>Instructor Assignments</h3>
                        <div class="assignment-actions">
                            <button class="btn btn-primary" onclick="showAssignInstructorModal()">
                                <i class="fas fa-user-tag"></i> Assign Instructor to Track
                            </button>
                        </div>
                        <div id="instructorAssignments" class="assignments-container">
                            <div class="loading">Loading instructor assignments...</div>
                        </div>
                    </div>

                    <!-- Student Assignments -->
                    <div class="assignment-group">
                        <h3>Student Assignments</h3>
                        <div class="assignment-actions">
                            <button class="btn btn-primary" onclick="showAssignStudentModal()">
                                <i class="fas fa-user-plus"></i> Assign Student to Track
                            </button>
                        </div>
                        <div id="studentAssignments" class="assignments-container">
                            <div class="loading">Loading student assignments...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Meeting Rooms Tab -->
            <!-- Meeting Rooms Tab Panel -->
            <section class="tab-content" 
                     id="meeting-rooms-panel" 
                     role="tabpanel" 
                     aria-labelledby="meeting-rooms-tab"
                     aria-hidden="true"
                     tabindex="0"
                     style="display: none;">
                <div class="tab-header">
                    <h2>Meeting Rooms</h2>
                    <div class="tab-actions">
                        <div class="filter-group">
                            <select id="platformFilter" onchange="filterMeetingRooms()">
                                <option value="">All Platforms</option>
                                <option value="teams">Microsoft Teams</option>
                                <option value="zoom">Zoom</option>
                            </select>
                            <select id="roomTypeFilter" onchange="filterMeetingRooms()">
                                <option value="">All Types</option>
                                <option value="track_room">Track Rooms</option>
                                <option value="instructor_room">Instructor Rooms</option>
                                <option value="project_room">Project Rooms</option>
                                <option value="organization_room">Organization Rooms</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="showCreateMeetingRoomModal()">
                            <i class="fas fa-video"></i> Create Room
                        </button>
                    </div>
                </div>

                <div class="meeting-rooms-grid">
                    <div id="meetingRoomsContainer" class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading meeting rooms...</p>
                    </div>
                </div>
            </div>

            <!-- Settings Tab Panel -->
            <section class="tab-content" 
                     id="settings-panel" 
                     role="tabpanel" 
                     aria-labelledby="settings-tab"
                     aria-hidden="true"
                     tabindex="0"
                     style="display: none;">
                <div class="settings-section">
                    <h2>Organization Settings</h2>
                    
                    <div class="settings-grid">
                        <!-- Organization Info -->
                        <div class="settings-card">
                            <h3>Organization Information</h3>
                            <form id="orgSettingsForm">
                                <div class="form-group">
                                    <label for="orgNameSetting">Organization Name</label>
                                    <input type="text" id="orgNameSetting" name="name" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="orgDescriptionSetting">Description</label>
                                    <textarea id="orgDescriptionSetting" name="description" class="form-control" rows="3"></textarea>
                                </div>
                                <button type="button" class="btn btn-primary" onclick="updateOrgSettings()">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                            </form>
                        </div>

                        <!-- Integration Settings -->
                        <div class="settings-card">
                            <h3>Integration Status</h3>
                            <div class="integration-status">
                                <div class="status-item">
                                    <div class="status-indicator" id="teamsStatus">
                                        <i class="fas fa-circle"></i>
                                    </div>
                                    <span>Microsoft Teams</span>
                                    <button class="btn btn-sm btn-outline" onclick="testTeamsIntegration()">Test</button>
                                </div>
                                <div class="status-item">
                                    <div class="status-indicator" id="zoomStatus">
                                        <i class="fas fa-circle"></i>
                                    </div>
                                    <span>Zoom</span>
                                    <button class="btn btn-sm btn-outline" onclick="testZoomIntegration()">Test</button>
                                </div>
                            </div>
                        </div>

                        <!-- Permissions -->
                        <div class="settings-card">
                            <h3>Your Permissions</h3>
                            <div id="userPermissions" class="permissions-list">
                                <div class="loading">Loading permissions...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Add Member Modal -->
    <div id="addMemberModal" 
         class="modal" 
         role="dialog" 
         aria-modal="true" 
         aria-labelledby="addMemberTitle"
         aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="addMemberTitle" class="modal-title">Add Organization Member</h3>
                <button class="modal-close" 
                        onclick="closeModal('addMemberModal')"
                        aria-label="Close dialog">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addMemberForm" role="form" aria-labelledby="addMemberTitle">
                    <div class="form-group">
                        <label for="memberEmail" class="required">Email Address</label>
                        <input type="email" 
                               id="memberEmail" 
                               name="user_email" 
                               class="form-control" 
                               required
                               aria-describedby="memberEmail-help memberEmail-error"
                               aria-invalid="false">
                        <div id="memberEmail-help" class="form-help">Enter the email address of the person to invite</div>
                        <div id="memberEmail-error" class="form-error" role="alert" aria-live="polite"></div>
                    </div>
                    <div class="form-group">
                        <label for="memberRole" class="required">Role</label>
                        <select id="memberRole" 
                                name="role_type" 
                                class="form-control" 
                                required
                                aria-describedby="memberRole-help memberRole-error"
                                aria-invalid="false">
                            <option value="" disabled selected>Select a role...</option>
                            <option value="instructor">Instructor</option>
                            <option value="organization_admin">Organization Admin</option>
                        </select>
                        <div id="memberRole-help" class="form-help">Choose the role and permissions for this member</div>
                        <div id="memberRole-error" class="form-error" role="alert" aria-live="polite"></div>
                    </div>
                    <div class="form-group" id="projectAccessGroup" style="display: none;">
                        <label for="projectAccess">Project Access</label>
                        <select id="projectAccess" 
                                name="project_ids" 
                                class="form-control" 
                                multiple
                                aria-describedby="projectAccess-help"
                                aria-label="Select projects for instructor access">
                            <!-- Projects loaded dynamically -->
                        </select>
                        <div id="projectAccess-help" class="form-help">Hold Ctrl (Windows) or Cmd (Mac) to select multiple projects. Use arrow keys to navigate options.</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('addMemberModal')">Cancel</button>
                <button class="btn btn-primary" onclick="addMember()">
                    <i class="fas fa-user-plus"></i> Add Member
                </button>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="addStudentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Student to Track</h3>
                <button class="modal-close" onclick="closeModal('addStudentModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addStudentForm">
                    <div class="form-group">
                        <label for="studentEmail">Student Email</label>
                        <input type="email" id="studentEmail" name="user_email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="studentTrack">Assign to Track</label>
                        <select id="studentTrack" name="track_id" class="form-control" required>
                            <option value="">Select a track...</option>
                            <!-- Tracks loaded dynamically -->
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('addStudentModal')">Cancel</button>
                <button class="btn btn-primary" onclick="addStudent()">
                    <i class="fas fa-user-graduate"></i> Add Student
                </button>
            </div>
        </div>
    </div>

    <!-- Create Meeting Room Modal -->
    <div id="createMeetingRoomModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>Create Meeting Room</h3>
                <button class="modal-close" onclick="closeModal('createMeetingRoomModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="createMeetingRoomForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="roomName">Room Name</label>
                            <input type="text" id="roomName" name="name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="roomPlatform">Platform</label>
                            <select id="roomPlatform" name="platform" class="form-control" required>
                                <option value="teams">Microsoft Teams</option>
                                <option value="zoom">Zoom</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="roomType">Room Type</label>
                            <select id="roomType" name="room_type" class="form-control" required onchange="updateRoomTypeFields()">
                                <option value="organization_room">Organization Room</option>
                                <option value="project_room">Project Room</option>
                                <option value="track_room">Track Room</option>
                                <option value="instructor_room">Instructor Room</option>
                            </select>
                        </div>
                        <div class="form-group" id="maxParticipantsGroup">
                            <label for="maxParticipants">Max Participants</label>
                            <input type="number" id="maxParticipants" name="max_participants" class="form-control" min="1" max="1000">
                        </div>
                    </div>
                    
                    <!-- Dynamic fields based on room type -->
                    <div id="projectSelectGroup" class="form-group" style="display:none;">
                        <label for="roomProject">Project</label>
                        <select id="roomProject" name="project_id" class="form-control">
                            <!-- Projects loaded dynamically -->
                        </select>
                    </div>
                    
                    <div id="trackSelectGroup" class="form-group" style="display:none;">
                        <label for="roomTrack">Track</label>
                        <select id="roomTrack" name="track_id" class="form-control">
                            <!-- Tracks loaded dynamically -->
                        </select>
                    </div>
                    
                    <div id="instructorSelectGroup" class="form-group" style="display:none;">
                        <label for="roomInstructor">Instructor</label>
                        <select id="roomInstructor" name="instructor_id" class="form-control">
                            <!-- Instructors loaded dynamically -->
                        </select>
                    </div>

                    <!-- Room Settings -->
                    <div class="form-section">
                        <h4>Room Settings</h4>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="auto_recording" id="autoRecording">
                                    <span class="checkmark"></span>
                                    Auto Recording
                                </label>
                            </div>
                            <div class="setting-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="waiting_room" id="waitingRoom" checked>
                                    <span class="checkmark"></span>
                                    Waiting Room
                                </label>
                            </div>
                            <div class="setting-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="mute_on_entry" id="muteOnEntry" checked>
                                    <span class="checkmark"></span>
                                    Mute on Entry
                                </label>
                            </div>
                            <div class="setting-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="allow_screen_sharing" id="allowScreenSharing" checked>
                                    <span class="checkmark"></span>
                                    Screen Sharing
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('createMeetingRoomModal')">Cancel</button>
                <button class="btn btn-primary" onclick="createMeetingRoom()">
                    <i class="fas fa-video"></i> Create Room
                </button>
            </div>
        </div>
    </div>

    <!-- Create Project Modal -->
    <div id="createProjectModal" 
         class="modal" 
         role="dialog" 
         aria-modal="true" 
         aria-labelledby="createProjectTitle"
         aria-hidden="true">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="createProjectTitle" class="modal-title">Create New Project</h3>
                <button class="modal-close" 
                        onclick="orgAdmin.closeModal('createProjectModal')"
                        aria-label="Close dialog">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="createProjectForm" role="form" aria-labelledby="createProjectTitle">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectName" class="required">Project Name</label>
                            <input type="text" 
                                   id="projectName" 
                                   name="name" 
                                   class="form-control" 
                                   required
                                   aria-describedby="projectName-help projectName-error"
                                   aria-invalid="false">
                            <div id="projectName-help" class="form-help">A descriptive name for your project</div>
                            <div id="projectName-error" class="form-error" role="alert" aria-live="polite"></div>
                        </div>
                        <div class="form-group">
                            <label for="projectSlug" class="required">Project Slug</label>
                            <input type="text" 
                                   id="projectSlug" 
                                   name="slug" 
                                   class="form-control" 
                                   required 
                                   pattern="[a-z0-9\-]+"
                                   aria-describedby="projectSlug-help projectSlug-error"
                                   aria-invalid="false">
                            <div id="projectSlug-help" class="form-help">URL-friendly identifier (lowercase, hyphens only). This will be used in URLs and cannot be changed later.</div>
                            <div id="projectSlug-error" class="form-error" role="alert" aria-live="polite"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="projectDescription">Description</label>
                        <textarea id="projectDescription" name="description" class="form-control" rows="3"></textarea>
                        <small class="form-help">Brief description of the project goals and content</small>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectDurationWeeks">Duration (weeks)</label>
                            <input type="number" id="projectDurationWeeks" name="duration_weeks" class="form-control" min="1" max="104">
                            <small class="form-help">Expected project duration</small>
                        </div>
                        <div class="form-group">
                            <label for="projectMaxParticipants">Max Participants</label>
                            <input type="number" id="projectMaxParticipants" name="max_participants" class="form-control" min="1">
                            <small class="form-help">Maximum number of participants</small>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectStartDate">Start Date</label>
                            <input type="date" id="projectStartDate" name="start_date" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="projectEndDate">End Date</label>
                            <input type="date" id="projectEndDate" name="end_date" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="projectObjectives">Learning Objectives</label>
                        <textarea id="projectObjectives" name="objectives" class="form-control" rows="3" placeholder="Enter learning objectives, one per line"></textarea>
                        <small class="form-help">Key learning outcomes participants will achieve</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="projectTargetRoles">Target Roles</label>
                        <input type="text" id="projectTargetRoles" name="target_roles" class="form-control" placeholder="e.g. developer, analyst, manager">
                        <small class="form-help">Comma-separated list of target job roles</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="orgAdmin.closeModal('createProjectModal')">Cancel</button>
                <button class="btn btn-primary" onclick="orgAdmin.createProject()">
                    <i class="fas fa-folder-plus"></i> Create Project
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="notification">
        <div class="notification-content">
            <i class="notification-icon"></i>
            <span class="notification-message"></span>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner large"></div>
        <p>Processing...</p>
    </div>

    <!-- Scripts -->
    <script type="module" src="../js/modules/auth.js"></script>
    <script type="module" src="../js/modules/notifications.js"></script>
    <script type="module" src="../js/org-admin-enhanced.js"></script>
</body>
</html>